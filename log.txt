Postgres is up - executing command
Server.js is being executed!
API_KEY_ENCRYPTION_KEY is not defined in .env. Please set it for security.
Conexão com o banco de dados estabelecida com sucesso (Sequelize).
Server is running on port 5000
Agendador de relatório diário iniciado. A tarefa será executada todos os dias às 8:00.
Agendador de lembrete de cupons iniciado. A tarefa será executada todos os dias às 9:00.
[Auth Middleware] Request: POST /api/auth/verify-token
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: GET /api/campanhas?tenantId=3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "tenantId", "nome", "mensagem", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "messageDelaySeconds", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: POST /api/auth/verify-token
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: GET /api/campanhas/5c5cf5e5-57ca-4be1-a47e-ccb2594fee3f
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "tenantId", "nome", "mensagem", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "messageDelaySeconds", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."id" = '5c5cf5e5-57ca-4be1-a47e-ccb2594fee3f' AND "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: GET /api/campanhas/5c5cf5e5-57ca-4be1-a47e-ccb2594fee3f
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "tenantId", "nome", "mensagem", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "messageDelaySeconds", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."id" = '5c5cf5e5-57ca-4be1-a47e-ccb2594fee3f' AND "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: POST /api/auth/verify-token
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: GET /api/campanhas?tenantId=3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "tenantId", "nome", "mensagem", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "messageDelaySeconds", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: GET /api/campanhas?tenantId=3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "tenantId", "nome", "mensagem", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "messageDelaySeconds", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: POST /api/auth/verify-token
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: GET /api/recompensas
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: GET /api/roletas
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "name", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "id", "name", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
[Authorize Debug] User Role: Admin, Required: recompensas:read
[Authorize Debug] Role ID: ce609d07-d83f-4002-a892-e17c91b767d3, Module: recompensas, Action: read
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'recompensas' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
[Authorize Debug] User Role: Admin, Required: roletas:read
[Authorize Debug] Role ID: ce609d07-d83f-4002-a892-e17c91b767d3, Module: roletas, Action: read
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'roletas' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
[Authorize Debug] Has Permission Result: true
Executing (default): SELECT "id", "tenantId", "name", "description", "pointsRequired", "type", "value", "imageUrl", "active", "createdAt", "updatedAt" FROM "recompensas" AS "Recompensa" WHERE "Recompensa"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' ORDER BY "Recompensa"."name" ASC;
[Authorize Debug] Has Permission Result: true
Executing (default): SELECT "id", "tenantId", "nome", "descricao", "active", "createdAt", "updatedAt" FROM "roletas" AS "Roleta" WHERE "Roleta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: POST /api/auth/verify-token
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: GET /api/recompensas
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: GET /api/roletas
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "name", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "id", "name", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
[Authorize Debug] User Role: Admin, Required: recompensas:read
[Authorize Debug] Role ID: ce609d07-d83f-4002-a892-e17c91b767d3, Module: recompensas, Action: read
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'recompensas' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
[Authorize Debug] User Role: Admin, Required: roletas:read
[Authorize Debug] Role ID: ce609d07-d83f-4002-a892-e17c91b767d3, Module: roletas, Action: read
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'roletas' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
[Authorize Debug] Has Permission Result: true
Executing (default): SELECT "id", "tenantId", "name", "description", "pointsRequired", "type", "value", "imageUrl", "active", "createdAt", "updatedAt" FROM "recompensas" AS "Recompensa" WHERE "Recompensa"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' ORDER BY "Recompensa"."name" ASC;
[Authorize Debug] Has Permission Result: true
Executing (default): SELECT "id", "tenantId", "nome", "descricao", "active", "createdAt", "updatedAt" FROM "roletas" AS "Roleta" WHERE "Roleta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: POST /api/auth/verify-token
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: GET /api/campanhas?tenantId=3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "tenantId", "nome", "mensagem", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "messageDelaySeconds", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: GET /api/campanhas?tenantId=3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "tenantId", "nome", "mensagem", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "messageDelaySeconds", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: POST /api/auth/verify-token
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: GET /api/campanhas/2471eca5-5da6-4ec9-85b7-2ba434cbbdf5
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "tenantId", "nome", "mensagem", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "messageDelaySeconds", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."id" = '2471eca5-5da6-4ec9-85b7-2ba434cbbdf5' AND "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: GET /api/campanhas/2471eca5-5da6-4ec9-85b7-2ba434cbbdf5
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "tenantId", "nome", "mensagem", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "messageDelaySeconds", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."id" = '2471eca5-5da6-4ec9-85b7-2ba434cbbdf5' AND "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: POST /api/auth/verify-token
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: GET /api/campanhas?tenantId=3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "tenantId", "nome", "mensagem", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "messageDelaySeconds", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: GET /api/campanhas?tenantId=3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "tenantId", "nome", "mensagem", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "messageDelaySeconds", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: POST /api/campanhas/2471eca5-5da6-4ec9-85b7-2ba434cbbdf5/process
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "tenantId", "nome", "mensagem", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "messageDelaySeconds", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."id" = '2471eca5-5da6-4ec9-85b7-2ba434cbbdf5' AND "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "tenantId", "nome", "mensagem", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "messageDelaySeconds", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."id" = '2471eca5-5da6-4ec9-85b7-2ba434cbbdf5' AND "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): UPDATE "campanhas" SET "status"=$1,"updatedAt"=$2 WHERE "id" = $3 AND "tenantId" = $4
Executing (default): SELECT "id", "tenantId", "nome", "mensagem", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "messageDelaySeconds", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."id" = '2471eca5-5da6-4ec9-85b7-2ba434cbbdf5' AND "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Campanha] Iniciando processamento para campanha 2471eca5-5da6-4ec9-85b7-2ba434cbbdf5
Executing (default): SELECT "id", "tenantId", "nome", "mensagem", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "messageDelaySeconds", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."id" = '2471eca5-5da6-4ec9-85b7-2ba434cbbdf5' AND "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "Client"."id", "Client"."tenantId", "Client"."name", "Client"."email", "Client"."phone", "Client"."birthDate", "Client"."respondentSessionId", "Client"."gender", "Client"."createdAt", "Client"."updatedAt", COUNT("respostas"."id") AS "visitCount" FROM "clients" AS "Client" INNER JOIN "respostas" AS "respostas" ON "Client"."respondentSessionId" = "respostas"."respondentSessionId" AND "respostas"."createdAt" >= '2025-07-21 14:06:40.194 +00:00' WHERE "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' GROUP BY "Client"."id" HAVING COUNT(respostas.id) >= 5;
Executing (default): INSERT INTO "cupons" ("id","tenantId","recompensaId","codigo","clienteId","dataGeracao","dataValidade","status","createdAt","updatedAt","campanhaId") VALUES ('f2dec4b4-0464-444f-8940-4017c0ce71b5','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-185CD7F3','90c675d5-c5dc-462b-a68f-a10cfa96334c','2025-10-21 14:06:40.207 +00:00','2025-11-13 09:49:59.105 +00:00','active','2025-10-21 14:06:40.208 +00:00','2025-10-21 14:06:40.208 +00:00','2471eca5-5da6-4ec9-85b7-2ba434cbbdf5'),('cc3101cb-aee0-42ee-8c0f-95afb80ce8e3','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-C2380DD0','e4a34a27-16e4-4d0d-b872-f3023765fcdf','2025-10-21 14:06:40.207 +00:00','2025-11-13 09:49:59.105 +00:00','active','2025-10-21 14:06:40.208 +00:00','2025-10-21 14:06:40.208 +00:00','2471eca5-5da6-4ec9-85b7-2ba434cbbdf5'),('270024e1-2d4e-4237-a699-f2058b64dc53','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-30C25788','03aa0613-a231-4c70-8532-139b3fc92a3e','2025-10-21 14:06:40.207 +00:00','2025-11-13 09:49:59.105 +00:00','active','2025-10-21 14:06:40.208 +00:00','2025-10-21 14:06:40.208 +00:00','2471eca5-5da6-4ec9-85b7-2ba434cbbdf5'),('7339689a-f800-4d6e-92e0-ba402cda5a79','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-4F6F2545','e19b17d9-a6c6-4acf-9be1-fe84e4ffcdaf','2025-10-21 14:06:40.208 +00:00','2025-11-13 09:49:59.105 +00:00','active','2025-10-21 14:06:40.208 +00:00','2025-10-21 14:06:40.208 +00:00','2471eca5-5da6-4ec9-85b7-2ba434cbbdf5'),('0e662fac-39df-4e07-adf8-b5e33aaa8f65','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-33E60B92','9924658b-8675-4198-bf85-073ae60b7d6c','2025-10-21 14:06:40.208 +00:00','2025-11-13 09:49:59.105 +00:00','active','2025-10-21 14:06:40.208 +00:00','2025-10-21 14:06:40.208 +00:00','2471eca5-5da6-4ec9-85b7-2ba434cbbdf5'),('d27bf4cb-b991-4efb-a0f4-489572f4095b','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-D12A0A70','0c3affd4-31f5-419f-b560-646340c6b6e7','2025-10-21 14:06:40.208 +00:00','2025-11-13 09:49:59.105 +00:00','active','2025-10-21 14:06:40.208 +00:00','2025-10-21 14:06:40.208 +00:00','2471eca5-5da6-4ec9-85b7-2ba434cbbdf5'),('bc2cf5c8-9ab7-4ba2-82ac-2d9b995f0740','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-09FC3710','5e4239d4-a711-47ff-b882-80164ba291eb','2025-10-21 14:06:40.208 +00:00','2025-11-13 09:49:59.105 +00:00','active','2025-10-21 14:06:40.208 +00:00','2025-10-21 14:06:40.208 +00:00','2471eca5-5da6-4ec9-85b7-2ba434cbbdf5'),('8fc967f3-e6e7-4f98-8ac6-a8b01b685b65','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-FE73CE9B','ec9b4596-8cbc-453f-ac47-f481efd3537c','2025-10-21 14:06:40.208 +00:00','2025-11-13 09:49:59.105 +00:00','active','2025-10-21 14:06:40.208 +00:00','2025-10-21 14:06:40.208 +00:00','2471eca5-5da6-4ec9-85b7-2ba434cbbdf5') RETURNING "id","pesquisaId","tenantId","recompensaId","codigo","clienteId","dataGeracao","dataUtilizacao","dataValidade","status","ultimoContato","createdAt","updatedAt","campanhaId";
[Campanha] Falha crítica no processamento da campanha 2471eca5-5da6-4ec9-85b7-2ba434cbbdf5: Error
    at Query.run (/usr/src/app/node_modules/sequelize/lib/dialects/postgres/query.js:50:25)
    at /usr/src/app/node_modules/sequelize/lib/sequelize.js:315:28
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async PostgresQueryInterface.bulkInsert (/usr/src/app/node_modules/sequelize/lib/dialects/abstract/query-interface.js:346:21)
    at async recursiveBulkCreate (/usr/src/app/node_modules/sequelize/lib/model.js:1697:25)
    at async Cupom.bulkCreate (/usr/src/app/node_modules/sequelize/lib/model.js:1786:12)
    at async CampanhaService._processCampaign (/usr/src/app/src/services/campanhaService.js:80:21) {
  name: 'SequelizeDatabaseError',
  parent: error: null value in column "recompensaId" of relation "cupons" violates not-null constraint
      at Parser.parseErrorMessage (/usr/src/app/node_modules/pg-protocol/dist/parser.js:285:98)
      at Parser.handlePacket (/usr/src/app/node_modules/pg-protocol/dist/parser.js:122:29)
      at Parser.parse (/usr/src/app/node_modules/pg-protocol/dist/parser.js:35:38)
      at Socket.<anonymous> (/usr/src/app/node_modules/pg-protocol/dist/index.js:11:42)
      at Socket.emit (node:events:517:28)
      at addChunk (node:internal/streams/readable:368:12)
      at readableAddChunk (node:internal/streams/readable:341:9)
      at Readable.push (node:internal/streams/readable:278:10)
      at TCP.onStreamRead (node:internal/stream_base_commons:190:23) {
    length: 513,
    severity: 'ERROR',
    code: '23502',
    detail: 'Failing row contains (f2dec4b4-0464-444f-8940-4017c0ce71b5, 3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd, null, CAMP-185CD7F3, 90c675d5-c5dc-462b-a68f-a10cfa96334c, 2025-10-21 14:06:40.207+00, null, 2025-11-13 09:49:59.105+00, active, null, 2025-10-21 14:06:40.208+00, 2025-10-21 14:06:40.208+00, 2471eca5-5da6-4ec9-85b7-2ba434cbbdf5, null).',
    hint: undefined,
    position: undefined,
    internalPosition: undefined,
    internalQuery: undefined,
    where: undefined,
    schema: 'public',
    table: 'cupons',
    column: 'recompensaId',
    dataType: undefined,
    constraint: undefined,
    file: 'execMain.c',
    line: '1886',
    routine: 'ExecConstraints',
    sql: `INSERT INTO "cupons" ("id","tenantId","recompensaId","codigo","clienteId","dataGeracao","dataValidade","status","createdAt","updatedAt","campanhaId") VALUES ('f2dec4b4-0464-444f-8940-4017c0ce71b5','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-185CD7F3','90c675d5-c5dc-462b-a68f-a10cfa96334c','2025-10-21 14:06:40.207 +00:00','2025-11-13 09:49:59.105 +00:00','active','2025-10-21 14:06:40.208 +00:00','2025-10-21 14:06:40.208 +00:00','2471eca5-5da6-4ec9-85b7-2ba434cbbdf5'),('cc3101cb-aee0-42ee-8c0f-95afb80ce8e3','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-C2380DD0','e4a34a27-16e4-4d0d-b872-f3023765fcdf','2025-10-21 14:06:40.207 +00:00','2025-11-13 09:49:59.105 +00:00','active','2025-10-21 14:06:40.208 +00:00','2025-10-21 14:06:40.208 +00:00','2471eca5-5da6-4ec9-85b7-2ba434cbbdf5'),('270024e1-2d4e-4237-a699-f2058b64dc53','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-30C25788','03aa0613-a231-4c70-8532-139b3fc92a3e','2025-10-21 14:06:40.207 +00:00','2025-11-13 09:49:59.105 +00:00','active','2025-10-21 14:06:40.208 +00:00','2025-10-21 14:06:40.208 +00:00','2471eca5-5da6-4ec9-85b7-2ba434cbbdf5'),('7339689a-f800-4d6e-92e0-ba402cda5a79','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-4F6F2545','e19b17d9-a6c6-4acf-9be1-fe84e4ffcdaf','2025-10-21 14:06:40.208 +00:00','2025-11-13 09:49:59.105 +00:00','active','2025-10-21 14:06:40.208 +00:00','2025-10-21 14:06:40.208 +00:00','2471eca5-5da6-4ec9-85b7-2ba434cbbdf5'),('0e662fac-39df-4e07-adf8-b5e33aaa8f65','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-33E60B92','9924658b-8675-4198-bf85-073ae60b7d6c','2025-10-21 14:06:40.208 +00:00','2025-11-13 09:49:59.105 +00:00','active','2025-10-21 14:06:40.208 +00:00','2025-10-21 14:06:40.208 +00:00','2471eca5-5da6-4ec9-85b7-2ba434cbbdf5'),('d27bf4cb-b991-4efb-a0f4-489572f4095b','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-D12A0A70','0c3affd4-31f5-419f-b560-646340c6b6e7','2025-10-21 14:06:40.208 +00:00','2025-11-13 09:49:59.105 +00:00','active','2025-10-21 14:06:40.208 +00:00','2025-10-21 14:06:40.208 +00:00','2471eca5-5da6-4ec9-85b7-2ba434cbbdf5'),('bc2cf5c8-9ab7-4ba2-82ac-2d9b995f0740','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-09FC3710','5e4239d4-a711-47ff-b882-80164ba291eb','2025-10-21 14:06:40.208 +00:00','2025-11-13 09:49:59.105 +00:00','active','2025-10-21 14:06:40.208 +00:00','2025-10-21 14:06:40.208 +00:00','2471eca5-5da6-4ec9-85b7-2ba434cbbdf5'),('8fc967f3-e6e7-4f98-8ac6-a8b01b685b65','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-FE73CE9B','ec9b4596-8cbc-453f-ac47-f481efd3537c','2025-10-21 14:06:40.208 +00:00','2025-11-13 09:49:59.105 +00:00','active','2025-10-21 14:06:40.208 +00:00','2025-10-21 14:06:40.208 +00:00','2471eca5-5da6-4ec9-85b7-2ba434cbbdf5') RETURNING "id","pesquisaId","tenantId","recompensaId","codigo","clienteId","dataGeracao","dataUtilizacao","dataValidade","status","ultimoContato","createdAt","updatedAt","campanhaId";`,
    parameters: undefined
  },
  original: error: null value in column "recompensaId" of relation "cupons" violates not-null constraint
      at Parser.parseErrorMessage (/usr/src/app/node_modules/pg-protocol/dist/parser.js:285:98)
      at Parser.handlePacket (/usr/src/app/node_modules/pg-protocol/dist/parser.js:122:29)
      at Parser.parse (/usr/src/app/node_modules/pg-protocol/dist/parser.js:35:38)
      at Socket.<anonymous> (/usr/src/app/node_modules/pg-protocol/dist/index.js:11:42)
      at Socket.emit (node:events:517:28)
      at addChunk (node:internal/streams/readable:368:12)
      at readableAddChunk (node:internal/streams/readable:341:9)
      at Readable.push (node:internal/streams/readable:278:10)
      at TCP.onStreamRead (node:internal/stream_base_commons:190:23) {
    length: 513,
    severity: 'ERROR',
    code: '23502',
    detail: 'Failing row contains (f2dec4b4-0464-444f-8940-4017c0ce71b5, 3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd, null, CAMP-185CD7F3, 90c675d5-c5dc-462b-a68f-a10cfa96334c, 2025-10-21 14:06:40.207+00, null, 2025-11-13 09:49:59.105+00, active, null, 2025-10-21 14:06:40.208+00, 2025-10-21 14:06:40.208+00, 2471eca5-5da6-4ec9-85b7-2ba434cbbdf5, null).',
    hint: undefined,
    position: undefined,
    internalPosition: undefined,
    internalQuery: undefined,
    where: undefined,
    schema: 'public',
    table: 'cupons',
    column: 'recompensaId',
    dataType: undefined,
    constraint: undefined,
    file: 'execMain.c',
    line: '1886',
    routine: 'ExecConstraints',
    sql: `INSERT INTO "cupons" ("id","tenantId","recompensaId","codigo","clienteId","dataGeracao","dataValidade","status","createdAt","updatedAt","campanhaId") VALUES ('f2dec4b4-0464-444f-8940-4017c0ce71b5','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-185CD7F3','90c675d5-c5dc-462b-a68f-a10cfa96334c','2025-10-21 14:06:40.207 +00:00','2025-11-13 09:49:59.105 +00:00','active','2025-10-21 14:06:40.208 +00:00','2025-10-21 14:06:40.208 +00:00','2471eca5-5da6-4ec9-85b7-2ba434cbbdf5'),('cc3101cb-aee0-42ee-8c0f-95afb80ce8e3','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-C2380DD0','e4a34a27-16e4-4d0d-b872-f3023765fcdf','2025-10-21 14:06:40.207 +00:00','2025-11-13 09:49:59.105 +00:00','active','2025-10-21 14:06:40.208 +00:00','2025-10-21 14:06:40.208 +00:00','2471eca5-5da6-4ec9-85b7-2ba434cbbdf5'),('270024e1-2d4e-4237-a699-f2058b64dc53','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-30C25788','03aa0613-a231-4c70-8532-139b3fc92a3e','2025-10-21 14:06:40.207 +00:00','2025-11-13 09:49:59.105 +00:00','active','2025-10-21 14:06:40.208 +00:00','2025-10-21 14:06:40.208 +00:00','2471eca5-5da6-4ec9-85b7-2ba434cbbdf5'),('7339689a-f800-4d6e-92e0-ba402cda5a79','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-4F6F2545','e19b17d9-a6c6-4acf-9be1-fe84e4ffcdaf','2025-10-21 14:06:40.208 +00:00','2025-11-13 09:49:59.105 +00:00','active','2025-10-21 14:06:40.208 +00:00','2025-10-21 14:06:40.208 +00:00','2471eca5-5da6-4ec9-85b7-2ba434cbbdf5'),('0e662fac-39df-4e07-adf8-b5e33aaa8f65','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-33E60B92','9924658b-8675-4198-bf85-073ae60b7d6c','2025-10-21 14:06:40.208 +00:00','2025-11-13 09:49:59.105 +00:00','active','2025-10-21 14:06:40.208 +00:00','2025-10-21 14:06:40.208 +00:00','2471eca5-5da6-4ec9-85b7-2ba434cbbdf5'),('d27bf4cb-b991-4efb-a0f4-489572f4095b','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-D12A0A70','0c3affd4-31f5-419f-b560-646340c6b6e7','2025-10-21 14:06:40.208 +00:00','2025-11-13 09:49:59.105 +00:00','active','2025-10-21 14:06:40.208 +00:00','2025-10-21 14:06:40.208 +00:00','2471eca5-5da6-4ec9-85b7-2ba434cbbdf5'),('bc2cf5c8-9ab7-4ba2-82ac-2d9b995f0740','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-09FC3710','5e4239d4-a711-47ff-b882-80164ba291eb','2025-10-21 14:06:40.208 +00:00','2025-11-13 09:49:59.105 +00:00','active','2025-10-21 14:06:40.208 +00:00','2025-10-21 14:06:40.208 +00:00','2471eca5-5da6-4ec9-85b7-2ba434cbbdf5'),('8fc967f3-e6e7-4f98-8ac6-a8b01b685b65','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-FE73CE9B','ec9b4596-8cbc-453f-ac47-f481efd3537c','2025-10-21 14:06:40.208 +00:00','2025-11-13 09:49:59.105 +00:00','active','2025-10-21 14:06:40.208 +00:00','2025-10-21 14:06:40.208 +00:00','2471eca5-5da6-4ec9-85b7-2ba434cbbdf5') RETURNING "id","pesquisaId","tenantId","recompensaId","codigo","clienteId","dataGeracao","dataUtilizacao","dataValidade","status","ultimoContato","createdAt","updatedAt","campanhaId";`,
    parameters: undefined
  },
  sql: `INSERT INTO "cupons" ("id","tenantId","recompensaId","codigo","clienteId","dataGeracao","dataValidade","status","createdAt","updatedAt","campanhaId") VALUES ('f2dec4b4-0464-444f-8940-4017c0ce71b5','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-185CD7F3','90c675d5-c5dc-462b-a68f-a10cfa96334c','2025-10-21 14:06:40.207 +00:00','2025-11-13 09:49:59.105 +00:00','active','2025-10-21 14:06:40.208 +00:00','2025-10-21 14:06:40.208 +00:00','2471eca5-5da6-4ec9-85b7-2ba434cbbdf5'),('cc3101cb-aee0-42ee-8c0f-95afb80ce8e3','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-C2380DD0','e4a34a27-16e4-4d0d-b872-f3023765fcdf','2025-10-21 14:06:40.207 +00:00','2025-11-13 09:49:59.105 +00:00','active','2025-10-21 14:06:40.208 +00:00','2025-10-21 14:06:40.208 +00:00','2471eca5-5da6-4ec9-85b7-2ba434cbbdf5'),('270024e1-2d4e-4237-a699-f2058b64dc53','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-30C25788','03aa0613-a231-4c70-8532-139b3fc92a3e','2025-10-21 14:06:40.207 +00:00','2025-11-13 09:49:59.105 +00:00','active','2025-10-21 14:06:40.208 +00:00','2025-10-21 14:06:40.208 +00:00','2471eca5-5da6-4ec9-85b7-2ba434cbbdf5'),('7339689a-f800-4d6e-92e0-ba402cda5a79','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-4F6F2545','e19b17d9-a6c6-4acf-9be1-fe84e4ffcdaf','2025-10-21 14:06:40.208 +00:00','2025-11-13 09:49:59.105 +00:00','active','2025-10-21 14:06:40.208 +00:00','2025-10-21 14:06:40.208 +00:00','2471eca5-5da6-4ec9-85b7-2ba434cbbdf5'),('0e662fac-39df-4e07-adf8-b5e33aaa8f65','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-33E60B92','9924658b-8675-4198-bf85-073ae60b7d6c','2025-10-21 14:06:40.208 +00:00','2025-11-13 09:49:59.105 +00:00','active','2025-10-21 14:06:40.208 +00:00','2025-10-21 14:06:40.208 +00:00','2471eca5-5da6-4ec9-85b7-2ba434cbbdf5'),('d27bf4cb-b991-4efb-a0f4-489572f4095b','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-D12A0A70','0c3affd4-31f5-419f-b560-646340c6b6e7','2025-10-21 14:06:40.208 +00:00','2025-11-13 09:49:59.105 +00:00','active','2025-10-21 14:06:40.208 +00:00','2025-10-21 14:06:40.208 +00:00','2471eca5-5da6-4ec9-85b7-2ba434cbbdf5'),('bc2cf5c8-9ab7-4ba2-82ac-2d9b995f0740','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-09FC3710','5e4239d4-a711-47ff-b882-80164ba291eb','2025-10-21 14:06:40.208 +00:00','2025-11-13 09:49:59.105 +00:00','active','2025-10-21 14:06:40.208 +00:00','2025-10-21 14:06:40.208 +00:00','2471eca5-5da6-4ec9-85b7-2ba434cbbdf5'),('8fc967f3-e6e7-4f98-8ac6-a8b01b685b65','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-FE73CE9B','ec9b4596-8cbc-453f-ac47-f481efd3537c','2025-10-21 14:06:40.208 +00:00','2025-11-13 09:49:59.105 +00:00','active','2025-10-21 14:06:40.208 +00:00','2025-10-21 14:06:40.208 +00:00','2471eca5-5da6-4ec9-85b7-2ba434cbbdf5') RETURNING "id","pesquisaId","tenantId","recompensaId","codigo","clienteId","dataGeracao","dataUtilizacao","dataValidade","status","ultimoContato","createdAt","updatedAt","campanhaId";`,
  parameters: {}
}
Executing (default): SELECT "id", "tenantId", "nome", "mensagem", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "messageDelaySeconds", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."id" = '2471eca5-5da6-4ec9-85b7-2ba434cbbdf5' AND "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): UPDATE "campanhas" SET "status"=$1,"updatedAt"=$2 WHERE "id" = $3 AND "tenantId" = $4
Executing (default): SELECT "id", "tenantId", "nome", "mensagem", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "messageDelaySeconds", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."id" = '2471eca5-5da6-4ec9-85b7-2ba434cbbdf5' AND "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: POST /api/auth/verify-token
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: GET /api/campanhas/2471eca5-5da6-4ec9-85b7-2ba434cbbdf5
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "tenantId", "nome", "mensagem", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "messageDelaySeconds", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."id" = '2471eca5-5da6-4ec9-85b7-2ba434cbbdf5' AND "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: GET /api/campanhas/2471eca5-5da6-4ec9-85b7-2ba434cbbdf5
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "tenantId", "nome", "mensagem", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "messageDelaySeconds", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."id" = '2471eca5-5da6-4ec9-85b7-2ba434cbbdf5' AND "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: POST /api/auth/verify-token
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: GET /api/campanhas?tenantId=3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "tenantId", "nome", "mensagem", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "messageDelaySeconds", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: GET /api/campanhas?tenantId=3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "tenantId", "nome", "mensagem", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "messageDelaySeconds", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: POST /api/auth/verify-token
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: GET /api/campanhas/2471eca5-5da6-4ec9-85b7-2ba434cbbdf5
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "tenantId", "nome", "mensagem", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "messageDelaySeconds", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."id" = '2471eca5-5da6-4ec9-85b7-2ba434cbbdf5' AND "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: GET /api/campanhas/2471eca5-5da6-4ec9-85b7-2ba434cbbdf5
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "tenantId", "nome", "mensagem", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "messageDelaySeconds", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."id" = '2471eca5-5da6-4ec9-85b7-2ba434cbbdf5' AND "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: GET /api/campanhas?tenantId=3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: POST /api/auth/verify-token
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "tenantId", "nome", "mensagem", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "messageDelaySeconds", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: GET /api/campanhas?tenantId=3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "tenantId", "nome", "mensagem", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "messageDelaySeconds", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: POST /api/auth/verify-token
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: GET /api/recompensas
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: GET /api/roletas
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "name", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "id", "name", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
[Authorize Debug] User Role: Admin, Required: recompensas:read
[Authorize Debug] Role ID: ce609d07-d83f-4002-a892-e17c91b767d3, Module: recompensas, Action: read
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'recompensas' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
[Authorize Debug] User Role: Admin, Required: roletas:read
[Authorize Debug] Role ID: ce609d07-d83f-4002-a892-e17c91b767d3, Module: roletas, Action: read
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'roletas' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
[Authorize Debug] Has Permission Result: true
Executing (default): SELECT "id", "tenantId", "name", "description", "pointsRequired", "type", "value", "imageUrl", "active", "createdAt", "updatedAt" FROM "recompensas" AS "Recompensa" WHERE "Recompensa"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' ORDER BY "Recompensa"."name" ASC;
[Authorize Debug] Has Permission Result: true
Executing (default): SELECT "id", "tenantId", "nome", "descricao", "active", "createdAt", "updatedAt" FROM "roletas" AS "Roleta" WHERE "Roleta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: GET /api/campanhas/2471eca5-5da6-4ec9-85b7-2ba434cbbdf5
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "tenantId", "nome", "mensagem", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "messageDelaySeconds", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."id" = '2471eca5-5da6-4ec9-85b7-2ba434cbbdf5' AND "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: POST /api/auth/verify-token
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: GET /api/dashboard/main
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "name", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
[Authorize Debug] User Role: Admin, Required: dashboard:read
[Authorize Debug] Role ID: ce609d07-d83f-4002-a892-e17c91b767d3, Module: dashboard, Action: read
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
[Authorize Debug] Has Permission Result: true
Executing (default): SELECT "Resposta"."id", "Resposta"."perguntaId", "Resposta"."pesquisaId", "Resposta"."tenantId", "Resposta"."atendenteId", "Resposta"."respondentSessionId", "Resposta"."ratingValue", "Resposta"."textValue", "Resposta"."selectedOption", "Resposta"."createdAt", "Resposta"."updatedAt", "pergunta"."id" AS "pergunta.id", "pergunta"."type" AS "pergunta.type" FROM "respostas" AS "Resposta" INNER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" AND ("pergunta"."type" = 'rating_0_10' OR "pergunta"."type" = 'rating_1_5') WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."ratingValue" IS NOT NULL;
Executing (default): SELECT count(DISTINCT("respondentSessionId")) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."respondentSessionId" IS NOT NULL;
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."status" = 'used' AND "Cupom"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT date_trunc('day', "createdAt") AS "date", COUNT("id") AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' GROUP BY date_trunc('day', "createdAt") ORDER BY date_trunc('day', "createdAt") ASC;
Executing (default): SELECT "Resposta"."id", "Resposta"."perguntaId", "Resposta"."pesquisaId", "Resposta"."tenantId", "Resposta"."atendenteId", "Resposta"."respondentSessionId", "Resposta"."ratingValue", "Resposta"."textValue", "Resposta"."selectedOption", "Resposta"."createdAt", "Resposta"."updatedAt", "pergunta"."id" AS "pergunta.id", "pergunta"."type" AS "pergunta.type", "client"."id" AS "client.id", "atendente"."id" AS "atendente.id", "atendente"."name" AS "atendente.name" FROM "respostas" AS "Resposta" LEFT OUTER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" LEFT OUTER JOIN "clients" AS "client" ON "Resposta"."respondentSessionId" = "client"."respondentSessionId" LEFT OUTER JOIN "atendentes" AS "atendente" ON "Resposta"."atendenteId" = "atendente"."id" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."ratingValue" IS NOT NULL;
Executing (default): SELECT "id", "atendenteId", "tenantId", "npsGoal", "responsesGoal", "registrationsGoal", "createdAt", "updatedAt" FROM "atendente_metas" AS "AtendenteMeta" WHERE "AtendenteMeta"."atendenteId" = 'f60c5a4d-1c9a-474c-89db-2abd95e8e06f' AND "AtendenteMeta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "atendenteId", "tenantId", "npsGoal", "responsesGoal", "registrationsGoal", "createdAt", "updatedAt" FROM "atendente_metas" AS "AtendenteMeta" WHERE "AtendenteMeta"."atendenteId" = '49c162d2-fdde-448c-86f8-14b9c93be792' AND "AtendenteMeta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "atendenteId", "tenantId", "npsGoal", "responsesGoal", "registrationsGoal", "createdAt", "updatedAt" FROM "atendente_metas" AS "AtendenteMeta" WHERE "AtendenteMeta"."atendenteId" = 'b13aa606-ae37-4d5b-8405-9610cbdffc25' AND "AtendenteMeta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "atendenteId", "tenantId", "npsGoal", "responsesGoal", "registrationsGoal", "createdAt", "updatedAt" FROM "atendente_metas" AS "AtendenteMeta" WHERE "AtendenteMeta"."atendenteId" = '2a4fd6a3-c581-401d-ba65-9225b56cd850' AND "AtendenteMeta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "atendenteId", "tenantId", "npsGoal", "responsesGoal", "registrationsGoal", "createdAt", "updatedAt" FROM "atendente_metas" AS "AtendenteMeta" WHERE "AtendenteMeta"."atendenteId" = '78b6809d-1ef3-4950-920c-ca4adfdbf114' AND "AtendenteMeta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "atendenteId", "tenantId", "npsGoal", "responsesGoal", "registrationsGoal", "createdAt", "updatedAt" FROM "atendente_metas" AS "AtendenteMeta" WHERE "AtendenteMeta"."atendenteId" = 'ead2104c-7963-47ff-8336-852ad10d355f' AND "AtendenteMeta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "atendenteId", "tenantId", "npsGoal", "responsesGoal", "registrationsGoal", "createdAt", "updatedAt" FROM "atendente_metas" AS "AtendenteMeta" WHERE "AtendenteMeta"."atendenteId" = '2dbadb84-aafa-4c99-a50d-9b01d56ca921' AND "AtendenteMeta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "Resposta"."id", "Resposta"."perguntaId", "Resposta"."pesquisaId", "Resposta"."tenantId", "Resposta"."atendenteId", "Resposta"."respondentSessionId", "Resposta"."ratingValue", "Resposta"."textValue", "Resposta"."selectedOption", "Resposta"."createdAt", "Resposta"."updatedAt", "pergunta"."id" AS "pergunta.id", "pergunta"."text" AS "pergunta.text", "pergunta"."type" AS "pergunta.type", "pergunta"."criterioId" AS "pergunta.criterioId", "pergunta->criterio"."id" AS "pergunta.criterio.id", "pergunta->criterio"."name" AS "pergunta.criterio.name", "pergunta->criterio"."type" AS "pergunta.criterio.type" FROM "respostas" AS "Resposta" INNER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" AND "pergunta"."type" LIKE 'rating%' LEFT OUTER JOIN "criterios" AS "pergunta->criterio" ON "pergunta"."criterioId" = "pergunta->criterio"."id" WHERE "Resposta"."ratingValue" IS NOT NULL AND "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "Resposta"."id", "Resposta"."createdAt", "Resposta"."textValue", "Resposta"."ratingValue", "Resposta"."respondentSessionId", "client"."id" AS "client.id", "client"."name" AS "client.name" FROM "respostas" AS "Resposta" LEFT OUTER JOIN "clients" AS "client" ON "Resposta"."respondentSessionId" = "client"."respondentSessionId" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."textValue" != '' ORDER BY "Resposta"."createdAt" DESC LIMIT 7;
Executing (default): SELECT count(DISTINCT("respondentSessionId")) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Cupom"."createdAt" = '2025-10-21 14:08:21.051 +00:00';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Cupom"."status" = 'used' AND "Cupom"."updatedAt" = '2025-10-21 14:08:21.053 +00:00';
Executing (default): SELECT "Resposta"."id", "Resposta"."createdAt", "Resposta"."ratingValue", "pergunta"."id" AS "pergunta.id", "pergunta"."type" AS "pergunta.type" FROM "respostas" AS "Resposta" INNER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" AND "pergunta"."type" = 'rating_0_10' WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."ratingValue" IS NOT NULL;
Executing (default): SELECT "Resposta"."id", "Resposta"."textValue" FROM "respostas" AS "Resposta" INNER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" AND "pergunta"."type" = 'free_text' WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."textValue" != '';
Executing (default): SELECT date_trunc('day', "Resposta"."createdAt") AS "period", SUM(CASE WHEN "ratingValue" >= 9 THEN 1 ELSE 0 END) AS "promoters", SUM(CASE WHEN "ratingValue" <= 6 THEN 1 ELSE 0 END) AS "detractors", COUNT("Resposta"."id") AS "total" FROM "respostas" AS "Resposta" INNER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" AND "pergunta"."type" = 'rating_0_10' WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."ratingValue" IS NOT NULL GROUP BY date_trunc('day', "Resposta"."createdAt") ORDER BY date_trunc('day', "Resposta"."createdAt") ASC;
[Auth Middleware] Request: POST /api/auth/verify-token
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: GET /api/dashboard/main
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "name", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
[Authorize Debug] User Role: Admin, Required: dashboard:read
[Authorize Debug] Role ID: ce609d07-d83f-4002-a892-e17c91b767d3, Module: dashboard, Action: read
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
[Authorize Debug] Has Permission Result: true
Executing (default): SELECT "Resposta"."id", "Resposta"."perguntaId", "Resposta"."pesquisaId", "Resposta"."tenantId", "Resposta"."atendenteId", "Resposta"."respondentSessionId", "Resposta"."ratingValue", "Resposta"."textValue", "Resposta"."selectedOption", "Resposta"."createdAt", "Resposta"."updatedAt", "pergunta"."id" AS "pergunta.id", "pergunta"."type" AS "pergunta.type" FROM "respostas" AS "Resposta" INNER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" AND ("pergunta"."type" = 'rating_0_10' OR "pergunta"."type" = 'rating_1_5') WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."ratingValue" IS NOT NULL;
Executing (default): SELECT count(DISTINCT("respondentSessionId")) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."respondentSessionId" IS NOT NULL;
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."status" = 'used' AND "Cupom"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT date_trunc('day', "createdAt") AS "date", COUNT("id") AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' GROUP BY date_trunc('day', "createdAt") ORDER BY date_trunc('day', "createdAt") ASC;
Executing (default): SELECT "Resposta"."id", "Resposta"."perguntaId", "Resposta"."pesquisaId", "Resposta"."tenantId", "Resposta"."atendenteId", "Resposta"."respondentSessionId", "Resposta"."ratingValue", "Resposta"."textValue", "Resposta"."selectedOption", "Resposta"."createdAt", "Resposta"."updatedAt", "pergunta"."id" AS "pergunta.id", "pergunta"."type" AS "pergunta.type", "client"."id" AS "client.id", "atendente"."id" AS "atendente.id", "atendente"."name" AS "atendente.name" FROM "respostas" AS "Resposta" LEFT OUTER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" LEFT OUTER JOIN "clients" AS "client" ON "Resposta"."respondentSessionId" = "client"."respondentSessionId" LEFT OUTER JOIN "atendentes" AS "atendente" ON "Resposta"."atendenteId" = "atendente"."id" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."ratingValue" IS NOT NULL;
Executing (default): SELECT "id", "atendenteId", "tenantId", "npsGoal", "responsesGoal", "registrationsGoal", "createdAt", "updatedAt" FROM "atendente_metas" AS "AtendenteMeta" WHERE "AtendenteMeta"."atendenteId" = 'f60c5a4d-1c9a-474c-89db-2abd95e8e06f' AND "AtendenteMeta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "atendenteId", "tenantId", "npsGoal", "responsesGoal", "registrationsGoal", "createdAt", "updatedAt" FROM "atendente_metas" AS "AtendenteMeta" WHERE "AtendenteMeta"."atendenteId" = '49c162d2-fdde-448c-86f8-14b9c93be792' AND "AtendenteMeta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "atendenteId", "tenantId", "npsGoal", "responsesGoal", "registrationsGoal", "createdAt", "updatedAt" FROM "atendente_metas" AS "AtendenteMeta" WHERE "AtendenteMeta"."atendenteId" = 'b13aa606-ae37-4d5b-8405-9610cbdffc25' AND "AtendenteMeta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "atendenteId", "tenantId", "npsGoal", "responsesGoal", "registrationsGoal", "createdAt", "updatedAt" FROM "atendente_metas" AS "AtendenteMeta" WHERE "AtendenteMeta"."atendenteId" = '2a4fd6a3-c581-401d-ba65-9225b56cd850' AND "AtendenteMeta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "atendenteId", "tenantId", "npsGoal", "responsesGoal", "registrationsGoal", "createdAt", "updatedAt" FROM "atendente_metas" AS "AtendenteMeta" WHERE "AtendenteMeta"."atendenteId" = '78b6809d-1ef3-4950-920c-ca4adfdbf114' AND "AtendenteMeta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "atendenteId", "tenantId", "npsGoal", "responsesGoal", "registrationsGoal", "createdAt", "updatedAt" FROM "atendente_metas" AS "AtendenteMeta" WHERE "AtendenteMeta"."atendenteId" = 'ead2104c-7963-47ff-8336-852ad10d355f' AND "AtendenteMeta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "atendenteId", "tenantId", "npsGoal", "responsesGoal", "registrationsGoal", "createdAt", "updatedAt" FROM "atendente_metas" AS "AtendenteMeta" WHERE "AtendenteMeta"."atendenteId" = '2dbadb84-aafa-4c99-a50d-9b01d56ca921' AND "AtendenteMeta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "Resposta"."id", "Resposta"."perguntaId", "Resposta"."pesquisaId", "Resposta"."tenantId", "Resposta"."atendenteId", "Resposta"."respondentSessionId", "Resposta"."ratingValue", "Resposta"."textValue", "Resposta"."selectedOption", "Resposta"."createdAt", "Resposta"."updatedAt", "pergunta"."id" AS "pergunta.id", "pergunta"."text" AS "pergunta.text", "pergunta"."type" AS "pergunta.type", "pergunta"."criterioId" AS "pergunta.criterioId", "pergunta->criterio"."id" AS "pergunta.criterio.id", "pergunta->criterio"."name" AS "pergunta.criterio.name", "pergunta->criterio"."type" AS "pergunta.criterio.type" FROM "respostas" AS "Resposta" INNER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" AND "pergunta"."type" LIKE 'rating%' LEFT OUTER JOIN "criterios" AS "pergunta->criterio" ON "pergunta"."criterioId" = "pergunta->criterio"."id" WHERE "Resposta"."ratingValue" IS NOT NULL AND "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "Resposta"."id", "Resposta"."createdAt", "Resposta"."textValue", "Resposta"."ratingValue", "Resposta"."respondentSessionId", "client"."id" AS "client.id", "client"."name" AS "client.name" FROM "respostas" AS "Resposta" LEFT OUTER JOIN "clients" AS "client" ON "Resposta"."respondentSessionId" = "client"."respondentSessionId" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."textValue" != '' ORDER BY "Resposta"."createdAt" DESC LIMIT 7;
Executing (default): SELECT count(DISTINCT("respondentSessionId")) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Cupom"."createdAt" = '2025-10-21 14:15:29.337 +00:00';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Cupom"."status" = 'used' AND "Cupom"."updatedAt" = '2025-10-21 14:15:29.339 +00:00';
Executing (default): SELECT "Resposta"."id", "Resposta"."createdAt", "Resposta"."ratingValue", "pergunta"."id" AS "pergunta.id", "pergunta"."type" AS "pergunta.type" FROM "respostas" AS "Resposta" INNER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" AND "pergunta"."type" = 'rating_0_10' WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."ratingValue" IS NOT NULL;
Executing (default): SELECT "Resposta"."id", "Resposta"."textValue" FROM "respostas" AS "Resposta" INNER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" AND "pergunta"."type" = 'free_text' WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."textValue" != '';
Executing (default): SELECT date_trunc('day', "Resposta"."createdAt") AS "period", SUM(CASE WHEN "ratingValue" >= 9 THEN 1 ELSE 0 END) AS "promoters", SUM(CASE WHEN "ratingValue" <= 6 THEN 1 ELSE 0 END) AS "detractors", COUNT("Resposta"."id") AS "total" FROM "respostas" AS "Resposta" INNER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" AND "pergunta"."type" = 'rating_0_10' WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."ratingValue" IS NOT NULL GROUP BY date_trunc('day', "Resposta"."createdAt") ORDER BY date_trunc('day', "Resposta"."createdAt") ASC;
[Auth Middleware] Request: POST /api/auth/verify-token
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: GET /api/campanhas?tenantId=3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "tenantId", "nome", "mensagem", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "messageDelaySeconds", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: GET /api/campanhas?tenantId=3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "tenantId", "nome", "mensagem", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "messageDelaySeconds", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: POST /api/auth/verify-token
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: GET /api/campanhas/2471eca5-5da6-4ec9-85b7-2ba434cbbdf5
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "tenantId", "nome", "mensagem", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "messageDelaySeconds", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."id" = '2471eca5-5da6-4ec9-85b7-2ba434cbbdf5' AND "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: GET /api/campanhas/2471eca5-5da6-4ec9-85b7-2ba434cbbdf5
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "tenantId", "nome", "mensagem", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "messageDelaySeconds", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."id" = '2471eca5-5da6-4ec9-85b7-2ba434cbbdf5' AND "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: GET /api/campanhas?tenantId=3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "tenantId", "nome", "mensagem", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "messageDelaySeconds", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: POST /api/auth/verify-token
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: GET /api/campanhas?tenantId=3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "tenantId", "nome", "mensagem", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "messageDelaySeconds", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: POST /api/auth/verify-token
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: GET /api/recompensas
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: GET /api/roletas
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "name", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "id", "name", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
[Authorize Debug] User Role: Admin, Required: recompensas:read
[Authorize Debug] Role ID: ce609d07-d83f-4002-a892-e17c91b767d3, Module: recompensas, Action: read
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'recompensas' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
[Authorize Debug] User Role: Admin, Required: roletas:read
[Authorize Debug] Role ID: ce609d07-d83f-4002-a892-e17c91b767d3, Module: roletas, Action: read
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'roletas' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
[Authorize Debug] Has Permission Result: true
Executing (default): SELECT "id", "tenantId", "name", "description", "pointsRequired", "type", "value", "imageUrl", "active", "createdAt", "updatedAt" FROM "recompensas" AS "Recompensa" WHERE "Recompensa"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' ORDER BY "Recompensa"."name" ASC;
[Authorize Debug] Has Permission Result: true
Executing (default): SELECT "id", "tenantId", "nome", "descricao", "active", "createdAt", "updatedAt" FROM "roletas" AS "Roleta" WHERE "Roleta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: POST /api/auth/verify-token
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: GET /api/recompensas
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: GET /api/roletas
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "name", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "id", "name", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
[Authorize Debug] User Role: Admin, Required: recompensas:read
[Authorize Debug] Role ID: ce609d07-d83f-4002-a892-e17c91b767d3, Module: recompensas, Action: read
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'recompensas' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
[Authorize Debug] User Role: Admin, Required: roletas:read
[Authorize Debug] Role ID: ce609d07-d83f-4002-a892-e17c91b767d3, Module: roletas, Action: read
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'roletas' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
[Authorize Debug] Has Permission Result: true
Executing (default): SELECT "id", "tenantId", "name", "description", "pointsRequired", "type", "value", "imageUrl", "active", "createdAt", "updatedAt" FROM "recompensas" AS "Recompensa" WHERE "Recompensa"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' ORDER BY "Recompensa"."name" ASC;
[Authorize Debug] Has Permission Result: true
Executing (default): SELECT "id", "tenantId", "nome", "descricao", "active", "createdAt", "updatedAt" FROM "roletas" AS "Roleta" WHERE "Roleta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: POST /api/campanhas
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): INSERT INTO "campanhas" ("id","tenantId","nome","mensagem","rewardType","recompensaId","roletaId","dataValidade","criterioSelecao","status","messageDelaySeconds","createdAt","updatedAt") VALUES ($1,$2,$3,$4,$5,$6,$7,$8,$9,$10,$11,$12,$13) RETURNING "id","tenantId","nome","mensagem","rewardType","recompensaId","roletaId","dataValidade","criterioSelecao","status","startDate","endDate","messageDelaySeconds","createdAt","updatedAt";
[Auth Middleware] Request: POST /api/auth/verify-token
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: GET /api/campanhas?tenantId=3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "tenantId", "nome", "mensagem", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "messageDelaySeconds", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: GET /api/campanhas?tenantId=3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "tenantId", "nome", "mensagem", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "messageDelaySeconds", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: POST /api/campanhas/0a136ce2-6544-47f8-89af-76960216eeda/process
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "tenantId", "nome", "mensagem", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "messageDelaySeconds", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."id" = '0a136ce2-6544-47f8-89af-76960216eeda' AND "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "tenantId", "nome", "mensagem", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "messageDelaySeconds", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."id" = '0a136ce2-6544-47f8-89af-76960216eeda' AND "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): UPDATE "campanhas" SET "status"=$1,"updatedAt"=$2 WHERE "id" = $3 AND "tenantId" = $4
Executing (default): SELECT "id", "tenantId", "nome", "mensagem", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "messageDelaySeconds", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."id" = '0a136ce2-6544-47f8-89af-76960216eeda' AND "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Campanha] Iniciando processamento para campanha 0a136ce2-6544-47f8-89af-76960216eeda
Executing (default): SELECT "id", "tenantId", "nome", "mensagem", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "messageDelaySeconds", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."id" = '0a136ce2-6544-47f8-89af-76960216eeda' AND "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "tenantId", "name", "email", "phone", "birthDate", "respondentSessionId", "gender", "createdAt", "updatedAt" FROM "clients" AS "Client" WHERE "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): INSERT INTO "cupons" ("id","tenantId","recompensaId","codigo","clienteId","dataGeracao","dataValidade","status","createdAt","updatedAt","campanhaId") VALUES ('864ccec3-7d47-49b4-9d5a-722fe9cce48a','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-A564659A','07adfe04-c0e5-4ad2-88c9-e935cf3e9832','2025-10-21 14:17:42.987 +00:00','2025-11-20 14:17:38.576 +00:00','active','2025-10-21 14:17:42.988 +00:00','2025-10-21 14:17:42.988 +00:00','0a136ce2-6544-47f8-89af-76960216eeda'),('a88ce9c3-2472-40f1-85a6-76e0cf0704cc','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-1AE88AC3','c808fcb4-66ef-45b8-b5f2-d17477709f5a','2025-10-21 14:17:42.988 +00:00','2025-11-20 14:17:38.576 +00:00','active','2025-10-21 14:17:42.988 +00:00','2025-10-21 14:17:42.988 +00:00','0a136ce2-6544-47f8-89af-76960216eeda'),('19e7aecd-78e6-4883-8d20-4474b0806e33','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-97C4794A','79e7cedd-2d8a-41d7-afe1-fc2ba06fbb4a','2025-10-21 14:17:42.988 +00:00','2025-11-20 14:17:38.576 +00:00','active','2025-10-21 14:17:42.988 +00:00','2025-10-21 14:17:42.988 +00:00','0a136ce2-6544-47f8-89af-76960216eeda'),('fc21b19e-63e1-4630-943a-6a24c566a23a','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-BCF4934A','0c08fc9f-713f-4cad-a145-2392cc2c0b02','2025-10-21 14:17:42.988 +00:00','2025-11-20 14:17:38.576 +00:00','active','2025-10-21 14:17:42.988 +00:00','2025-10-21 14:17:42.988 +00:00','0a136ce2-6544-47f8-89af-76960216eeda'),('fc75ebbc-3749-4af7-914c-73998c284933','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-22A9C898','aa3fb8bd-6204-428d-a02b-b3b9c50e88d4','2025-10-21 14:17:42.988 +00:00','2025-11-20 14:17:38.576 +00:00','active','2025-10-21 14:17:42.988 +00:00','2025-10-21 14:17:42.988 +00:00','0a136ce2-6544-47f8-89af-76960216eeda'),('b1476166-1587-4fb7-b2cd-abe5092c05c6','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-719281F7','5c17ebf1-51db-4987-a358-d60711da7617','2025-10-21 14:17:42.988 +00:00','2025-11-20 14:17:38.576 +00:00','active','2025-10-21 14:17:42.988 +00:00','2025-10-21 14:17:42.988 +00:00','0a136ce2-6544-47f8-89af-76960216eeda'),('443bc00a-0580-49d8-be2f-807faeeb8810','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-3AA9F8F5','0c3affd4-31f5-419f-b560-646340c6b6e7','2025-10-21 14:17:42.988 +00:00','2025-11-20 14:17:38.576 +00:00','active','2025-10-21 14:17:42.988 +00:00','2025-10-21 14:17:42.988 +00:00','0a136ce2-6544-47f8-89af-76960216eeda'),('f79d0119-cb83-436c-b5ca-2ddad32735a1','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-F5430670','90c675d5-c5dc-462b-a68f-a10cfa96334c','2025-10-21 14:17:42.988 +00:00','2025-11-20 14:17:38.576 +00:00','active','2025-10-21 14:17:42.988 +00:00','2025-10-21 14:17:42.988 +00:00','0a136ce2-6544-47f8-89af-76960216eeda'),('4badf55b-2462-4004-8c6a-42d511da5ad2','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-84F96596','e4a34a27-16e4-4d0d-b872-f3023765fcdf','2025-10-21 14:17:42.988 +00:00','2025-11-20 14:17:38.576 +00:00','active','2025-10-21 14:17:42.988 +00:00','2025-10-21 14:17:42.988 +00:00','0a136ce2-6544-47f8-89af-76960216eeda'),('4a4bf1e3-ac9c-48fe-9114-91a639d57e08','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-2D7E935E','03aa0613-a231-4c70-8532-139b3fc92a3e','2025-10-21 14:17:42.988 +00:00','2025-11-20 14:17:38.576 +00:00','active','2025-10-21 14:17:42.988 +00:00','2025-10-21 14:17:42.988 +00:00','0a136ce2-6544-47f8-89af-76960216eeda'),('955eeaed-d752-421b-a615-406afd1bc718','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-FE0AF42C','ec9b4596-8cbc-453f-ac47-f481efd3537c','2025-10-21 14:17:42.988 +00:00','2025-11-20 14:17:38.576 +00:00','active','2025-10-21 14:17:42.988 +00:00','2025-10-21 14:17:42.988 +00:00','0a136ce2-6544-47f8-89af-76960216eeda'),('9fdb9abb-ac54-4450-b555-433e12d28e8f','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-A68A4D8E','e19b17d9-a6c6-4acf-9be1-fe84e4ffcdaf','2025-10-21 14:17:42.988 +00:00','2025-11-20 14:17:38.576 +00:00','active','2025-10-21 14:17:42.988 +00:00','2025-10-21 14:17:42.988 +00:00','0a136ce2-6544-47f8-89af-76960216eeda'),('e0b86950-541b-45e6-bcc7-a84be8d676af','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-39B71771','5e4239d4-a711-47ff-b882-80164ba291eb','2025-10-21 14:17:42.988 +00:00','2025-11-20 14:17:38.576 +00:00','active','2025-10-21 14:17:42.988 +00:00','2025-10-21 14:17:42.988 +00:00','0a136ce2-6544-47f8-89af-76960216eeda'),('e7777386-3439-4068-9433-c3c2dc60cf6a','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-B448442F','9924658b-8675-4198-bf85-073ae60b7d6c','2025-10-21 14:17:42.988 +00:00','2025-11-20 14:17:38.576 +00:00','active','2025-10-21 14:17:42.988 +00:00','2025-10-21 14:17:42.988 +00:00','0a136ce2-6544-47f8-89af-76960216eeda') RETURNING "id","pesquisaId","tenantId","recompensaId","codigo","clienteId","dataGeracao","dataUtilizacao","dataValidade","status","ultimoContato","createdAt","updatedAt","campanhaId";
[Campanha] Falha crítica no processamento da campanha 0a136ce2-6544-47f8-89af-76960216eeda: Error
    at Query.run (/usr/src/app/node_modules/sequelize/lib/dialects/postgres/query.js:50:25)
    at /usr/src/app/node_modules/sequelize/lib/sequelize.js:315:28
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async PostgresQueryInterface.bulkInsert (/usr/src/app/node_modules/sequelize/lib/dialects/abstract/query-interface.js:346:21)
    at async recursiveBulkCreate (/usr/src/app/node_modules/sequelize/lib/model.js:1697:25)
    at async Cupom.bulkCreate (/usr/src/app/node_modules/sequelize/lib/model.js:1786:12)
    at async CampanhaService._processCampaign (/usr/src/app/src/services/campanhaService.js:80:21) {
  name: 'SequelizeDatabaseError',
  parent: error: null value in column "recompensaId" of relation "cupons" violates not-null constraint
      at Parser.parseErrorMessage (/usr/src/app/node_modules/pg-protocol/dist/parser.js:285:98)
      at Parser.handlePacket (/usr/src/app/node_modules/pg-protocol/dist/parser.js:122:29)
      at Parser.parse (/usr/src/app/node_modules/pg-protocol/dist/parser.js:35:38)
      at Socket.<anonymous> (/usr/src/app/node_modules/pg-protocol/dist/index.js:11:42)
      at Socket.emit (node:events:517:28)
      at addChunk (node:internal/streams/readable:368:12)
      at readableAddChunk (node:internal/streams/readable:341:9)
      at Readable.push (node:internal/streams/readable:278:10)
      at TCP.onStreamRead (node:internal/stream_base_commons:190:23) {
    length: 513,
    severity: 'ERROR',
    code: '23502',
    detail: 'Failing row contains (864ccec3-7d47-49b4-9d5a-722fe9cce48a, 3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd, null, CAMP-A564659A, 07adfe04-c0e5-4ad2-88c9-e935cf3e9832, 2025-10-21 14:17:42.987+00, null, 2025-11-20 14:17:38.576+00, active, null, 2025-10-21 14:17:42.988+00, 2025-10-21 14:17:42.988+00, 0a136ce2-6544-47f8-89af-76960216eeda, null).',
    hint: undefined,
    position: undefined,
    internalPosition: undefined,
    internalQuery: undefined,
    where: undefined,
    schema: 'public',
    table: 'cupons',
    column: 'recompensaId',
    dataType: undefined,
    constraint: undefined,
    file: 'execMain.c',
    line: '1886',
    routine: 'ExecConstraints',
    sql: `INSERT INTO "cupons" ("id","tenantId","recompensaId","codigo","clienteId","dataGeracao","dataValidade","status","createdAt","updatedAt","campanhaId") VALUES ('864ccec3-7d47-49b4-9d5a-722fe9cce48a','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-A564659A','07adfe04-c0e5-4ad2-88c9-e935cf3e9832','2025-10-21 14:17:42.987 +00:00','2025-11-20 14:17:38.576 +00:00','active','2025-10-21 14:17:42.988 +00:00','2025-10-21 14:17:42.988 +00:00','0a136ce2-6544-47f8-89af-76960216eeda'),('a88ce9c3-2472-40f1-85a6-76e0cf0704cc','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-1AE88AC3','c808fcb4-66ef-45b8-b5f2-d17477709f5a','2025-10-21 14:17:42.988 +00:00','2025-11-20 14:17:38.576 +00:00','active','2025-10-21 14:17:42.988 +00:00','2025-10-21 14:17:42.988 +00:00','0a136ce2-6544-47f8-89af-76960216eeda'),('19e7aecd-78e6-4883-8d20-4474b0806e33','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-97C4794A','79e7cedd-2d8a-41d7-afe1-fc2ba06fbb4a','2025-10-21 14:17:42.988 +00:00','2025-11-20 14:17:38.576 +00:00','active','2025-10-21 14:17:42.988 +00:00','2025-10-21 14:17:42.988 +00:00','0a136ce2-6544-47f8-89af-76960216eeda'),('fc21b19e-63e1-4630-943a-6a24c566a23a','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-BCF4934A','0c08fc9f-713f-4cad-a145-2392cc2c0b02','2025-10-21 14:17:42.988 +00:00','2025-11-20 14:17:38.576 +00:00','active','2025-10-21 14:17:42.988 +00:00','2025-10-21 14:17:42.988 +00:00','0a136ce2-6544-47f8-89af-76960216eeda'),('fc75ebbc-3749-4af7-914c-73998c284933','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-22A9C898','aa3fb8bd-6204-428d-a02b-b3b9c50e88d4','2025-10-21 14:17:42.988 +00:00','2025-11-20 14:17:38.576 +00:00','active','2025-10-21 14:17:42.988 +00:00','2025-10-21 14:17:42.988 +00:00','0a136ce2-6544-47f8-89af-76960216eeda'),('b1476166-1587-4fb7-b2cd-abe5092c05c6','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-719281F7','5c17ebf1-51db-4987-a358-d60711da7617','2025-10-21 14:17:42.988 +00:00','2025-11-20 14:17:38.576 +00:00','active','2025-10-21 14:17:42.988 +00:00','2025-10-21 14:17:42.988 +00:00','0a136ce2-6544-47f8-89af-76960216eeda'),('443bc00a-0580-49d8-be2f-807faeeb8810','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-3AA9F8F5','0c3affd4-31f5-419f-b560-646340c6b6e7','2025-10-21 14:17:42.988 +00:00','2025-11-20 14:17:38.576 +00:00','active','2025-10-21 14:17:42.988 +00:00','2025-10-21 14:17:42.988 +00:00','0a136ce2-6544-47f8-89af-76960216eeda'),('f79d0119-cb83-436c-b5ca-2ddad32735a1','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-F5430670','90c675d5-c5dc-462b-a68f-a10cfa96334c','2025-10-21 14:17:42.988 +00:00','2025-11-20 14:17:38.576 +00:00','active','2025-10-21 14:17:42.988 +00:00','2025-10-21 14:17:42.988 +00:00','0a136ce2-6544-47f8-89af-76960216eeda'),('4badf55b-2462-4004-8c6a-42d511da5ad2','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-84F96596','e4a34a27-16e4-4d0d-b872-f3023765fcdf','2025-10-21 14:17:42.988 +00:00','2025-11-20 14:17:38.576 +00:00','active','2025-10-21 14:17:42.988 +00:00','2025-10-21 14:17:42.988 +00:00','0a136ce2-6544-47f8-89af-76960216eeda'),('4a4bf1e3-ac9c-48fe-9114-91a639d57e08','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-2D7E935E','03aa0613-a231-4c70-8532-139b3fc92a3e','2025-10-21 14:17:42.988 +00:00','2025-11-20 14:17:38.576 +00:00','active','2025-10-21 14:17:42.988 +00:00','2025-10-21 14:17:42.988 +00:00','0a136ce2-6544-47f8-89af-76960216eeda'),('955eeaed-d752-421b-a615-406afd1bc718','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-FE0AF42C','ec9b4596-8cbc-453f-ac47-f481efd3537c','2025-10-21 14:17:42.988 +00:00','2025-11-20 14:17:38.576 +00:00','active','2025-10-21 14:17:42.988 +00:00','2025-10-21 14:17:42.988 +00:00','0a136ce2-6544-47f8-89af-76960216eeda'),('9fdb9abb-ac54-4450-b555-433e12d28e8f','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-A68A4D8E','e19b17d9-a6c6-4acf-9be1-fe84e4ffcdaf','2025-10-21 14:17:42.988 +00:00','2025-11-20 14:17:38.576 +00:00','active','2025-10-21 14:17:42.988 +00:00','2025-10-21 14:17:42.988 +00:00','0a136ce2-6544-47f8-89af-76960216eeda'),('e0b86950-541b-45e6-bcc7-a84be8d676af','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-39B71771','5e4239d4-a711-47ff-b882-80164ba291eb','2025-10-21 14:17:42.988 +00:00','2025-11-20 14:17:38.576 +00:00','active','2025-10-21 14:17:42.988 +00:00','2025-10-21 14:17:42.988 +00:00','0a136ce2-6544-47f8-89af-76960216eeda'),('e7777386-3439-4068-9433-c3c2dc60cf6a','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-B448442F','9924658b-8675-4198-bf85-073ae60b7d6c','2025-10-21 14:17:42.988 +00:00','2025-11-20 14:17:38.576 +00:00','active','2025-10-21 14:17:42.988 +00:00','2025-10-21 14:17:42.988 +00:00','0a136ce2-6544-47f8-89af-76960216eeda') RETURNING "id","pesquisaId","tenantId","recompensaId","codigo","clienteId","dataGeracao","dataUtilizacao","dataValidade","status","ultimoContato","createdAt","updatedAt","campanhaId";`,
    parameters: undefined
  },
  original: error: null value in column "recompensaId" of relation "cupons" violates not-null constraint
      at Parser.parseErrorMessage (/usr/src/app/node_modules/pg-protocol/dist/parser.js:285:98)
      at Parser.handlePacket (/usr/src/app/node_modules/pg-protocol/dist/parser.js:122:29)
      at Parser.parse (/usr/src/app/node_modules/pg-protocol/dist/parser.js:35:38)
      at Socket.<anonymous> (/usr/src/app/node_modules/pg-protocol/dist/index.js:11:42)
      at Socket.emit (node:events:517:28)
      at addChunk (node:internal/streams/readable:368:12)
      at readableAddChunk (node:internal/streams/readable:341:9)
      at Readable.push (node:internal/streams/readable:278:10)
      at TCP.onStreamRead (node:internal/stream_base_commons:190:23) {
    length: 513,
    severity: 'ERROR',
    code: '23502',
    detail: 'Failing row contains (864ccec3-7d47-49b4-9d5a-722fe9cce48a, 3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd, null, CAMP-A564659A, 07adfe04-c0e5-4ad2-88c9-e935cf3e9832, 2025-10-21 14:17:42.987+00, null, 2025-11-20 14:17:38.576+00, active, null, 2025-10-21 14:17:42.988+00, 2025-10-21 14:17:42.988+00, 0a136ce2-6544-47f8-89af-76960216eeda, null).',
    hint: undefined,
    position: undefined,
    internalPosition: undefined,
    internalQuery: undefined,
    where: undefined,
    schema: 'public',
    table: 'cupons',
    column: 'recompensaId',
    dataType: undefined,
    constraint: undefined,
    file: 'execMain.c',
    line: '1886',
    routine: 'ExecConstraints',
    sql: `INSERT INTO "cupons" ("id","tenantId","recompensaId","codigo","clienteId","dataGeracao","dataValidade","status","createdAt","updatedAt","campanhaId") VALUES ('864ccec3-7d47-49b4-9d5a-722fe9cce48a','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-A564659A','07adfe04-c0e5-4ad2-88c9-e935cf3e9832','2025-10-21 14:17:42.987 +00:00','2025-11-20 14:17:38.576 +00:00','active','2025-10-21 14:17:42.988 +00:00','2025-10-21 14:17:42.988 +00:00','0a136ce2-6544-47f8-89af-76960216eeda'),('a88ce9c3-2472-40f1-85a6-76e0cf0704cc','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-1AE88AC3','c808fcb4-66ef-45b8-b5f2-d17477709f5a','2025-10-21 14:17:42.988 +00:00','2025-11-20 14:17:38.576 +00:00','active','2025-10-21 14:17:42.988 +00:00','2025-10-21 14:17:42.988 +00:00','0a136ce2-6544-47f8-89af-76960216eeda'),('19e7aecd-78e6-4883-8d20-4474b0806e33','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-97C4794A','79e7cedd-2d8a-41d7-afe1-fc2ba06fbb4a','2025-10-21 14:17:42.988 +00:00','2025-11-20 14:17:38.576 +00:00','active','2025-10-21 14:17:42.988 +00:00','2025-10-21 14:17:42.988 +00:00','0a136ce2-6544-47f8-89af-76960216eeda'),('fc21b19e-63e1-4630-943a-6a24c566a23a','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-BCF4934A','0c08fc9f-713f-4cad-a145-2392cc2c0b02','2025-10-21 14:17:42.988 +00:00','2025-11-20 14:17:38.576 +00:00','active','2025-10-21 14:17:42.988 +00:00','2025-10-21 14:17:42.988 +00:00','0a136ce2-6544-47f8-89af-76960216eeda'),('fc75ebbc-3749-4af7-914c-73998c284933','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-22A9C898','aa3fb8bd-6204-428d-a02b-b3b9c50e88d4','2025-10-21 14:17:42.988 +00:00','2025-11-20 14:17:38.576 +00:00','active','2025-10-21 14:17:42.988 +00:00','2025-10-21 14:17:42.988 +00:00','0a136ce2-6544-47f8-89af-76960216eeda'),('b1476166-1587-4fb7-b2cd-abe5092c05c6','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-719281F7','5c17ebf1-51db-4987-a358-d60711da7617','2025-10-21 14:17:42.988 +00:00','2025-11-20 14:17:38.576 +00:00','active','2025-10-21 14:17:42.988 +00:00','2025-10-21 14:17:42.988 +00:00','0a136ce2-6544-47f8-89af-76960216eeda'),('443bc00a-0580-49d8-be2f-807faeeb8810','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-3AA9F8F5','0c3affd4-31f5-419f-b560-646340c6b6e7','2025-10-21 14:17:42.988 +00:00','2025-11-20 14:17:38.576 +00:00','active','2025-10-21 14:17:42.988 +00:00','2025-10-21 14:17:42.988 +00:00','0a136ce2-6544-47f8-89af-76960216eeda'),('f79d0119-cb83-436c-b5ca-2ddad32735a1','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-F5430670','90c675d5-c5dc-462b-a68f-a10cfa96334c','2025-10-21 14:17:42.988 +00:00','2025-11-20 14:17:38.576 +00:00','active','2025-10-21 14:17:42.988 +00:00','2025-10-21 14:17:42.988 +00:00','0a136ce2-6544-47f8-89af-76960216eeda'),('4badf55b-2462-4004-8c6a-42d511da5ad2','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-84F96596','e4a34a27-16e4-4d0d-b872-f3023765fcdf','2025-10-21 14:17:42.988 +00:00','2025-11-20 14:17:38.576 +00:00','active','2025-10-21 14:17:42.988 +00:00','2025-10-21 14:17:42.988 +00:00','0a136ce2-6544-47f8-89af-76960216eeda'),('4a4bf1e3-ac9c-48fe-9114-91a639d57e08','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-2D7E935E','03aa0613-a231-4c70-8532-139b3fc92a3e','2025-10-21 14:17:42.988 +00:00','2025-11-20 14:17:38.576 +00:00','active','2025-10-21 14:17:42.988 +00:00','2025-10-21 14:17:42.988 +00:00','0a136ce2-6544-47f8-89af-76960216eeda'),('955eeaed-d752-421b-a615-406afd1bc718','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-FE0AF42C','ec9b4596-8cbc-453f-ac47-f481efd3537c','2025-10-21 14:17:42.988 +00:00','2025-11-20 14:17:38.576 +00:00','active','2025-10-21 14:17:42.988 +00:00','2025-10-21 14:17:42.988 +00:00','0a136ce2-6544-47f8-89af-76960216eeda'),('9fdb9abb-ac54-4450-b555-433e12d28e8f','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-A68A4D8E','e19b17d9-a6c6-4acf-9be1-fe84e4ffcdaf','2025-10-21 14:17:42.988 +00:00','2025-11-20 14:17:38.576 +00:00','active','2025-10-21 14:17:42.988 +00:00','2025-10-21 14:17:42.988 +00:00','0a136ce2-6544-47f8-89af-76960216eeda'),('e0b86950-541b-45e6-bcc7-a84be8d676af','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-39B71771','5e4239d4-a711-47ff-b882-80164ba291eb','2025-10-21 14:17:42.988 +00:00','2025-11-20 14:17:38.576 +00:00','active','2025-10-21 14:17:42.988 +00:00','2025-10-21 14:17:42.988 +00:00','0a136ce2-6544-47f8-89af-76960216eeda'),('e7777386-3439-4068-9433-c3c2dc60cf6a','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-B448442F','9924658b-8675-4198-bf85-073ae60b7d6c','2025-10-21 14:17:42.988 +00:00','2025-11-20 14:17:38.576 +00:00','active','2025-10-21 14:17:42.988 +00:00','2025-10-21 14:17:42.988 +00:00','0a136ce2-6544-47f8-89af-76960216eeda') RETURNING "id","pesquisaId","tenantId","recompensaId","codigo","clienteId","dataGeracao","dataUtilizacao","dataValidade","status","ultimoContato","createdAt","updatedAt","campanhaId";`,
    parameters: undefined
  },
  sql: `INSERT INTO "cupons" ("id","tenantId","recompensaId","codigo","clienteId","dataGeracao","dataValidade","status","createdAt","updatedAt","campanhaId") VALUES ('864ccec3-7d47-49b4-9d5a-722fe9cce48a','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-A564659A','07adfe04-c0e5-4ad2-88c9-e935cf3e9832','2025-10-21 14:17:42.987 +00:00','2025-11-20 14:17:38.576 +00:00','active','2025-10-21 14:17:42.988 +00:00','2025-10-21 14:17:42.988 +00:00','0a136ce2-6544-47f8-89af-76960216eeda'),('a88ce9c3-2472-40f1-85a6-76e0cf0704cc','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-1AE88AC3','c808fcb4-66ef-45b8-b5f2-d17477709f5a','2025-10-21 14:17:42.988 +00:00','2025-11-20 14:17:38.576 +00:00','active','2025-10-21 14:17:42.988 +00:00','2025-10-21 14:17:42.988 +00:00','0a136ce2-6544-47f8-89af-76960216eeda'),('19e7aecd-78e6-4883-8d20-4474b0806e33','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-97C4794A','79e7cedd-2d8a-41d7-afe1-fc2ba06fbb4a','2025-10-21 14:17:42.988 +00:00','2025-11-20 14:17:38.576 +00:00','active','2025-10-21 14:17:42.988 +00:00','2025-10-21 14:17:42.988 +00:00','0a136ce2-6544-47f8-89af-76960216eeda'),('fc21b19e-63e1-4630-943a-6a24c566a23a','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-BCF4934A','0c08fc9f-713f-4cad-a145-2392cc2c0b02','2025-10-21 14:17:42.988 +00:00','2025-11-20 14:17:38.576 +00:00','active','2025-10-21 14:17:42.988 +00:00','2025-10-21 14:17:42.988 +00:00','0a136ce2-6544-47f8-89af-76960216eeda'),('fc75ebbc-3749-4af7-914c-73998c284933','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-22A9C898','aa3fb8bd-6204-428d-a02b-b3b9c50e88d4','2025-10-21 14:17:42.988 +00:00','2025-11-20 14:17:38.576 +00:00','active','2025-10-21 14:17:42.988 +00:00','2025-10-21 14:17:42.988 +00:00','0a136ce2-6544-47f8-89af-76960216eeda'),('b1476166-1587-4fb7-b2cd-abe5092c05c6','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-719281F7','5c17ebf1-51db-4987-a358-d60711da7617','2025-10-21 14:17:42.988 +00:00','2025-11-20 14:17:38.576 +00:00','active','2025-10-21 14:17:42.988 +00:00','2025-10-21 14:17:42.988 +00:00','0a136ce2-6544-47f8-89af-76960216eeda'),('443bc00a-0580-49d8-be2f-807faeeb8810','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-3AA9F8F5','0c3affd4-31f5-419f-b560-646340c6b6e7','2025-10-21 14:17:42.988 +00:00','2025-11-20 14:17:38.576 +00:00','active','2025-10-21 14:17:42.988 +00:00','2025-10-21 14:17:42.988 +00:00','0a136ce2-6544-47f8-89af-76960216eeda'),('f79d0119-cb83-436c-b5ca-2ddad32735a1','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-F5430670','90c675d5-c5dc-462b-a68f-a10cfa96334c','2025-10-21 14:17:42.988 +00:00','2025-11-20 14:17:38.576 +00:00','active','2025-10-21 14:17:42.988 +00:00','2025-10-21 14:17:42.988 +00:00','0a136ce2-6544-47f8-89af-76960216eeda'),('4badf55b-2462-4004-8c6a-42d511da5ad2','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-84F96596','e4a34a27-16e4-4d0d-b872-f3023765fcdf','2025-10-21 14:17:42.988 +00:00','2025-11-20 14:17:38.576 +00:00','active','2025-10-21 14:17:42.988 +00:00','2025-10-21 14:17:42.988 +00:00','0a136ce2-6544-47f8-89af-76960216eeda'),('4a4bf1e3-ac9c-48fe-9114-91a639d57e08','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-2D7E935E','03aa0613-a231-4c70-8532-139b3fc92a3e','2025-10-21 14:17:42.988 +00:00','2025-11-20 14:17:38.576 +00:00','active','2025-10-21 14:17:42.988 +00:00','2025-10-21 14:17:42.988 +00:00','0a136ce2-6544-47f8-89af-76960216eeda'),('955eeaed-d752-421b-a615-406afd1bc718','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-FE0AF42C','ec9b4596-8cbc-453f-ac47-f481efd3537c','2025-10-21 14:17:42.988 +00:00','2025-11-20 14:17:38.576 +00:00','active','2025-10-21 14:17:42.988 +00:00','2025-10-21 14:17:42.988 +00:00','0a136ce2-6544-47f8-89af-76960216eeda'),('9fdb9abb-ac54-4450-b555-433e12d28e8f','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-A68A4D8E','e19b17d9-a6c6-4acf-9be1-fe84e4ffcdaf','2025-10-21 14:17:42.988 +00:00','2025-11-20 14:17:38.576 +00:00','active','2025-10-21 14:17:42.988 +00:00','2025-10-21 14:17:42.988 +00:00','0a136ce2-6544-47f8-89af-76960216eeda'),('e0b86950-541b-45e6-bcc7-a84be8d676af','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-39B71771','5e4239d4-a711-47ff-b882-80164ba291eb','2025-10-21 14:17:42.988 +00:00','2025-11-20 14:17:38.576 +00:00','active','2025-10-21 14:17:42.988 +00:00','2025-10-21 14:17:42.988 +00:00','0a136ce2-6544-47f8-89af-76960216eeda'),('e7777386-3439-4068-9433-c3c2dc60cf6a','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-B448442F','9924658b-8675-4198-bf85-073ae60b7d6c','2025-10-21 14:17:42.988 +00:00','2025-11-20 14:17:38.576 +00:00','active','2025-10-21 14:17:42.988 +00:00','2025-10-21 14:17:42.988 +00:00','0a136ce2-6544-47f8-89af-76960216eeda') RETURNING "id","pesquisaId","tenantId","recompensaId","codigo","clienteId","dataGeracao","dataUtilizacao","dataValidade","status","ultimoContato","createdAt","updatedAt","campanhaId";`,
  parameters: {}
}
Executing (default): SELECT "id", "tenantId", "nome", "mensagem", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "messageDelaySeconds", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."id" = '0a136ce2-6544-47f8-89af-76960216eeda' AND "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): UPDATE "campanhas" SET "status"=$1,"updatedAt"=$2 WHERE "id" = $3 AND "tenantId" = $4
Executing (default): SELECT "id", "tenantId", "nome", "mensagem", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "messageDelaySeconds", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."id" = '0a136ce2-6544-47f8-89af-76960216eeda' AND "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: POST /api/auth/verify-token
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: GET /api/campanhas/0a136ce2-6544-47f8-89af-76960216eeda
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "tenantId", "nome", "mensagem", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "messageDelaySeconds", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."id" = '0a136ce2-6544-47f8-89af-76960216eeda' AND "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: GET /api/campanhas/0a136ce2-6544-47f8-89af-76960216eeda
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "tenantId", "nome", "mensagem", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "messageDelaySeconds", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."id" = '0a136ce2-6544-47f8-89af-76960216eeda' AND "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: POST /api/auth/verify-token
[Auth Middleware] Request: GET /api/campanhas?tenantId=3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "tenantId", "nome", "mensagem", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "messageDelaySeconds", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: GET /api/campanhas?tenantId=3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "tenantId", "nome", "mensagem", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "messageDelaySeconds", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: POST /api/auth/verify-token
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: GET /api/recompensas
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: GET /api/roletas
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "name", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "id", "name", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
[Authorize Debug] User Role: Admin, Required: recompensas:read
[Authorize Debug] Role ID: ce609d07-d83f-4002-a892-e17c91b767d3, Module: recompensas, Action: read
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'recompensas' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
[Authorize Debug] User Role: Admin, Required: roletas:read
[Authorize Debug] Role ID: ce609d07-d83f-4002-a892-e17c91b767d3, Module: roletas, Action: read
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'roletas' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
[Authorize Debug] Has Permission Result: true
Executing (default): SELECT "id", "tenantId", "name", "description", "pointsRequired", "type", "value", "imageUrl", "active", "createdAt", "updatedAt" FROM "recompensas" AS "Recompensa" WHERE "Recompensa"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' ORDER BY "Recompensa"."name" ASC;
[Authorize Debug] Has Permission Result: true
Executing (default): SELECT "id", "tenantId", "nome", "descricao", "active", "createdAt", "updatedAt" FROM "roletas" AS "Roleta" WHERE "Roleta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: POST /api/campanhas
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): INSERT INTO "campanhas" ("id","tenantId","nome","mensagem","rewardType","recompensaId","roletaId","dataValidade","criterioSelecao","status","messageDelaySeconds","createdAt","updatedAt") VALUES ($1,$2,$3,$4,$5,$6,$7,$8,$9,$10,$11,$12,$13) RETURNING "id","tenantId","nome","mensagem","rewardType","recompensaId","roletaId","dataValidade","criterioSelecao","status","startDate","endDate","messageDelaySeconds","createdAt","updatedAt";
[Auth Middleware] Request: GET /api/campanhas?tenantId=3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: POST /api/auth/verify-token
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "tenantId", "nome", "mensagem", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "messageDelaySeconds", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: GET /api/campanhas?tenantId=3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "tenantId", "nome", "mensagem", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "messageDelaySeconds", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: POST /api/campanhas/181849dc-a6f7-4f27-ab90-1535a3d34818/process
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "tenantId", "nome", "mensagem", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "messageDelaySeconds", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."id" = '181849dc-a6f7-4f27-ab90-1535a3d34818' AND "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "tenantId", "nome", "mensagem", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "messageDelaySeconds", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."id" = '181849dc-a6f7-4f27-ab90-1535a3d34818' AND "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): UPDATE "campanhas" SET "status"=$1,"updatedAt"=$2 WHERE "id" = $3 AND "tenantId" = $4
Executing (default): SELECT "id", "tenantId", "nome", "mensagem", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "messageDelaySeconds", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."id" = '181849dc-a6f7-4f27-ab90-1535a3d34818' AND "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Campanha] Iniciando processamento para campanha 181849dc-a6f7-4f27-ab90-1535a3d34818
Executing (default): SELECT "id", "tenantId", "nome", "mensagem", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "messageDelaySeconds", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."id" = '181849dc-a6f7-4f27-ab90-1535a3d34818' AND "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "tenantId", "name", "email", "phone", "birthDate", "respondentSessionId", "gender", "createdAt", "updatedAt" FROM "clients" AS "Client" WHERE "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): INSERT INTO "cupons" ("id","tenantId","recompensaId","codigo","clienteId","dataGeracao","dataValidade","status","createdAt","updatedAt","campanhaId") VALUES ('f1f42fc3-423d-47dd-96b6-ea03d92ec5c0','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-427E6E7F','07adfe04-c0e5-4ad2-88c9-e935cf3e9832','2025-10-21 14:18:27.836 +00:00','2025-11-20 14:18:20.324 +00:00','active','2025-10-21 14:18:27.836 +00:00','2025-10-21 14:18:27.836 +00:00','181849dc-a6f7-4f27-ab90-1535a3d34818'),('0e603f09-95c1-4d3e-a4bc-c726b163ec71','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-0FE8BBD7','c808fcb4-66ef-45b8-b5f2-d17477709f5a','2025-10-21 14:18:27.836 +00:00','2025-11-20 14:18:20.324 +00:00','active','2025-10-21 14:18:27.836 +00:00','2025-10-21 14:18:27.836 +00:00','181849dc-a6f7-4f27-ab90-1535a3d34818'),('5a4ec839-7b00-4f13-bb5a-b795626a21fa','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-AD4389A2','79e7cedd-2d8a-41d7-afe1-fc2ba06fbb4a','2025-10-21 14:18:27.836 +00:00','2025-11-20 14:18:20.324 +00:00','active','2025-10-21 14:18:27.836 +00:00','2025-10-21 14:18:27.836 +00:00','181849dc-a6f7-4f27-ab90-1535a3d34818'),('5938e90b-9790-4dbe-9581-06874f9886f3','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-2A2FDFA3','0c08fc9f-713f-4cad-a145-2392cc2c0b02','2025-10-21 14:18:27.836 +00:00','2025-11-20 14:18:20.324 +00:00','active','2025-10-21 14:18:27.836 +00:00','2025-10-21 14:18:27.836 +00:00','181849dc-a6f7-4f27-ab90-1535a3d34818'),('9c7e85d5-c351-4805-a745-fbaa868a87d0','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-5C2B6719','aa3fb8bd-6204-428d-a02b-b3b9c50e88d4','2025-10-21 14:18:27.836 +00:00','2025-11-20 14:18:20.324 +00:00','active','2025-10-21 14:18:27.836 +00:00','2025-10-21 14:18:27.836 +00:00','181849dc-a6f7-4f27-ab90-1535a3d34818'),('21e60600-2717-4884-8e3a-487270417a26','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-E6387D98','5c17ebf1-51db-4987-a358-d60711da7617','2025-10-21 14:18:27.836 +00:00','2025-11-20 14:18:20.324 +00:00','active','2025-10-21 14:18:27.836 +00:00','2025-10-21 14:18:27.836 +00:00','181849dc-a6f7-4f27-ab90-1535a3d34818'),('7dfd5cff-c59c-4179-bd46-b4ac72093167','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-4EB25A8F','0c3affd4-31f5-419f-b560-646340c6b6e7','2025-10-21 14:18:27.836 +00:00','2025-11-20 14:18:20.324 +00:00','active','2025-10-21 14:18:27.836 +00:00','2025-10-21 14:18:27.836 +00:00','181849dc-a6f7-4f27-ab90-1535a3d34818'),('a4ca1335-9521-467e-8089-4b411ddd0275','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-6396D327','90c675d5-c5dc-462b-a68f-a10cfa96334c','2025-10-21 14:18:27.836 +00:00','2025-11-20 14:18:20.324 +00:00','active','2025-10-21 14:18:27.836 +00:00','2025-10-21 14:18:27.836 +00:00','181849dc-a6f7-4f27-ab90-1535a3d34818'),('e529bda2-8566-4c8e-b729-8d773aebbdbc','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-8DE3827B','e4a34a27-16e4-4d0d-b872-f3023765fcdf','2025-10-21 14:18:27.836 +00:00','2025-11-20 14:18:20.324 +00:00','active','2025-10-21 14:18:27.836 +00:00','2025-10-21 14:18:27.836 +00:00','181849dc-a6f7-4f27-ab90-1535a3d34818'),('0b1865e8-a65a-4532-978b-81e68b5e5564','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-36618A89','03aa0613-a231-4c70-8532-139b3fc92a3e','2025-10-21 14:18:27.836 +00:00','2025-11-20 14:18:20.324 +00:00','active','2025-10-21 14:18:27.836 +00:00','2025-10-21 14:18:27.836 +00:00','181849dc-a6f7-4f27-ab90-1535a3d34818'),('504b6383-5fbb-408c-9cee-2e7a67e0d241','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-E23F4CCA','ec9b4596-8cbc-453f-ac47-f481efd3537c','2025-10-21 14:18:27.836 +00:00','2025-11-20 14:18:20.324 +00:00','active','2025-10-21 14:18:27.836 +00:00','2025-10-21 14:18:27.836 +00:00','181849dc-a6f7-4f27-ab90-1535a3d34818'),('0dfe84b8-5497-4098-aa9f-a8fd31c883ad','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-E4CD0314','e19b17d9-a6c6-4acf-9be1-fe84e4ffcdaf','2025-10-21 14:18:27.836 +00:00','2025-11-20 14:18:20.324 +00:00','active','2025-10-21 14:18:27.836 +00:00','2025-10-21 14:18:27.836 +00:00','181849dc-a6f7-4f27-ab90-1535a3d34818'),('76ece76f-7ccf-439f-9786-e8d975a789bd','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-3432415D','5e4239d4-a711-47ff-b882-80164ba291eb','2025-10-21 14:18:27.836 +00:00','2025-11-20 14:18:20.324 +00:00','active','2025-10-21 14:18:27.836 +00:00','2025-10-21 14:18:27.836 +00:00','181849dc-a6f7-4f27-ab90-1535a3d34818'),('5aa67451-d892-4318-91e7-1721aee0d0dc','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-DAE1AF97','9924658b-8675-4198-bf85-073ae60b7d6c','2025-10-21 14:18:27.836 +00:00','2025-11-20 14:18:20.324 +00:00','active','2025-10-21 14:18:27.836 +00:00','2025-10-21 14:18:27.836 +00:00','181849dc-a6f7-4f27-ab90-1535a3d34818') RETURNING "id","pesquisaId","tenantId","recompensaId","codigo","clienteId","dataGeracao","dataUtilizacao","dataValidade","status","ultimoContato","createdAt","updatedAt","campanhaId";
[Campanha] Falha crítica no processamento da campanha 181849dc-a6f7-4f27-ab90-1535a3d34818: Error
    at Query.run (/usr/src/app/node_modules/sequelize/lib/dialects/postgres/query.js:50:25)
    at /usr/src/app/node_modules/sequelize/lib/sequelize.js:315:28
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async PostgresQueryInterface.bulkInsert (/usr/src/app/node_modules/sequelize/lib/dialects/abstract/query-interface.js:346:21)
    at async recursiveBulkCreate (/usr/src/app/node_modules/sequelize/lib/model.js:1697:25)
    at async Cupom.bulkCreate (/usr/src/app/node_modules/sequelize/lib/model.js:1786:12)
    at async CampanhaService._processCampaign (/usr/src/app/src/services/campanhaService.js:80:21) {
  name: 'SequelizeDatabaseError',
  parent: error: null value in column "recompensaId" of relation "cupons" violates not-null constraint
      at Parser.parseErrorMessage (/usr/src/app/node_modules/pg-protocol/dist/parser.js:285:98)
      at Parser.handlePacket (/usr/src/app/node_modules/pg-protocol/dist/parser.js:122:29)
      at Parser.parse (/usr/src/app/node_modules/pg-protocol/dist/parser.js:35:38)
      at Socket.<anonymous> (/usr/src/app/node_modules/pg-protocol/dist/index.js:11:42)
      at Socket.emit (node:events:517:28)
      at addChunk (node:internal/streams/readable:368:12)
      at readableAddChunk (node:internal/streams/readable:341:9)
      at Readable.push (node:internal/streams/readable:278:10)
      at TCP.onStreamRead (node:internal/stream_base_commons:190:23) {
    length: 513,
    severity: 'ERROR',
    code: '23502',
    detail: 'Failing row contains (f1f42fc3-423d-47dd-96b6-ea03d92ec5c0, 3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd, null, CAMP-427E6E7F, 07adfe04-c0e5-4ad2-88c9-e935cf3e9832, 2025-10-21 14:18:27.836+00, null, 2025-11-20 14:18:20.324+00, active, null, 2025-10-21 14:18:27.836+00, 2025-10-21 14:18:27.836+00, 181849dc-a6f7-4f27-ab90-1535a3d34818, null).',
    hint: undefined,
    position: undefined,
    internalPosition: undefined,
    internalQuery: undefined,
    where: undefined,
    schema: 'public',
    table: 'cupons',
    column: 'recompensaId',
    dataType: undefined,
    constraint: undefined,
    file: 'execMain.c',
    line: '1886',
    routine: 'ExecConstraints',
    sql: `INSERT INTO "cupons" ("id","tenantId","recompensaId","codigo","clienteId","dataGeracao","dataValidade","status","createdAt","updatedAt","campanhaId") VALUES ('f1f42fc3-423d-47dd-96b6-ea03d92ec5c0','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-427E6E7F','07adfe04-c0e5-4ad2-88c9-e935cf3e9832','2025-10-21 14:18:27.836 +00:00','2025-11-20 14:18:20.324 +00:00','active','2025-10-21 14:18:27.836 +00:00','2025-10-21 14:18:27.836 +00:00','181849dc-a6f7-4f27-ab90-1535a3d34818'),('0e603f09-95c1-4d3e-a4bc-c726b163ec71','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-0FE8BBD7','c808fcb4-66ef-45b8-b5f2-d17477709f5a','2025-10-21 14:18:27.836 +00:00','2025-11-20 14:18:20.324 +00:00','active','2025-10-21 14:18:27.836 +00:00','2025-10-21 14:18:27.836 +00:00','181849dc-a6f7-4f27-ab90-1535a3d34818'),('5a4ec839-7b00-4f13-bb5a-b795626a21fa','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-AD4389A2','79e7cedd-2d8a-41d7-afe1-fc2ba06fbb4a','2025-10-21 14:18:27.836 +00:00','2025-11-20 14:18:20.324 +00:00','active','2025-10-21 14:18:27.836 +00:00','2025-10-21 14:18:27.836 +00:00','181849dc-a6f7-4f27-ab90-1535a3d34818'),('5938e90b-9790-4dbe-9581-06874f9886f3','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-2A2FDFA3','0c08fc9f-713f-4cad-a145-2392cc2c0b02','2025-10-21 14:18:27.836 +00:00','2025-11-20 14:18:20.324 +00:00','active','2025-10-21 14:18:27.836 +00:00','2025-10-21 14:18:27.836 +00:00','181849dc-a6f7-4f27-ab90-1535a3d34818'),('9c7e85d5-c351-4805-a745-fbaa868a87d0','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-5C2B6719','aa3fb8bd-6204-428d-a02b-b3b9c50e88d4','2025-10-21 14:18:27.836 +00:00','2025-11-20 14:18:20.324 +00:00','active','2025-10-21 14:18:27.836 +00:00','2025-10-21 14:18:27.836 +00:00','181849dc-a6f7-4f27-ab90-1535a3d34818'),('21e60600-2717-4884-8e3a-487270417a26','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-E6387D98','5c17ebf1-51db-4987-a358-d60711da7617','2025-10-21 14:18:27.836 +00:00','2025-11-20 14:18:20.324 +00:00','active','2025-10-21 14:18:27.836 +00:00','2025-10-21 14:18:27.836 +00:00','181849dc-a6f7-4f27-ab90-1535a3d34818'),('7dfd5cff-c59c-4179-bd46-b4ac72093167','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-4EB25A8F','0c3affd4-31f5-419f-b560-646340c6b6e7','2025-10-21 14:18:27.836 +00:00','2025-11-20 14:18:20.324 +00:00','active','2025-10-21 14:18:27.836 +00:00','2025-10-21 14:18:27.836 +00:00','181849dc-a6f7-4f27-ab90-1535a3d34818'),('a4ca1335-9521-467e-8089-4b411ddd0275','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-6396D327','90c675d5-c5dc-462b-a68f-a10cfa96334c','2025-10-21 14:18:27.836 +00:00','2025-11-20 14:18:20.324 +00:00','active','2025-10-21 14:18:27.836 +00:00','2025-10-21 14:18:27.836 +00:00','181849dc-a6f7-4f27-ab90-1535a3d34818'),('e529bda2-8566-4c8e-b729-8d773aebbdbc','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-8DE3827B','e4a34a27-16e4-4d0d-b872-f3023765fcdf','2025-10-21 14:18:27.836 +00:00','2025-11-20 14:18:20.324 +00:00','active','2025-10-21 14:18:27.836 +00:00','2025-10-21 14:18:27.836 +00:00','181849dc-a6f7-4f27-ab90-1535a3d34818'),('0b1865e8-a65a-4532-978b-81e68b5e5564','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-36618A89','03aa0613-a231-4c70-8532-139b3fc92a3e','2025-10-21 14:18:27.836 +00:00','2025-11-20 14:18:20.324 +00:00','active','2025-10-21 14:18:27.836 +00:00','2025-10-21 14:18:27.836 +00:00','181849dc-a6f7-4f27-ab90-1535a3d34818'),('504b6383-5fbb-408c-9cee-2e7a67e0d241','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-E23F4CCA','ec9b4596-8cbc-453f-ac47-f481efd3537c','2025-10-21 14:18:27.836 +00:00','2025-11-20 14:18:20.324 +00:00','active','2025-10-21 14:18:27.836 +00:00','2025-10-21 14:18:27.836 +00:00','181849dc-a6f7-4f27-ab90-1535a3d34818'),('0dfe84b8-5497-4098-aa9f-a8fd31c883ad','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-E4CD0314','e19b17d9-a6c6-4acf-9be1-fe84e4ffcdaf','2025-10-21 14:18:27.836 +00:00','2025-11-20 14:18:20.324 +00:00','active','2025-10-21 14:18:27.836 +00:00','2025-10-21 14:18:27.836 +00:00','181849dc-a6f7-4f27-ab90-1535a3d34818'),('76ece76f-7ccf-439f-9786-e8d975a789bd','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-3432415D','5e4239d4-a711-47ff-b882-80164ba291eb','2025-10-21 14:18:27.836 +00:00','2025-11-20 14:18:20.324 +00:00','active','2025-10-21 14:18:27.836 +00:00','2025-10-21 14:18:27.836 +00:00','181849dc-a6f7-4f27-ab90-1535a3d34818'),('5aa67451-d892-4318-91e7-1721aee0d0dc','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-DAE1AF97','9924658b-8675-4198-bf85-073ae60b7d6c','2025-10-21 14:18:27.836 +00:00','2025-11-20 14:18:20.324 +00:00','active','2025-10-21 14:18:27.836 +00:00','2025-10-21 14:18:27.836 +00:00','181849dc-a6f7-4f27-ab90-1535a3d34818') RETURNING "id","pesquisaId","tenantId","recompensaId","codigo","clienteId","dataGeracao","dataUtilizacao","dataValidade","status","ultimoContato","createdAt","updatedAt","campanhaId";`,
    parameters: undefined
  },
  original: error: null value in column "recompensaId" of relation "cupons" violates not-null constraint
      at Parser.parseErrorMessage (/usr/src/app/node_modules/pg-protocol/dist/parser.js:285:98)
      at Parser.handlePacket (/usr/src/app/node_modules/pg-protocol/dist/parser.js:122:29)
      at Parser.parse (/usr/src/app/node_modules/pg-protocol/dist/parser.js:35:38)
      at Socket.<anonymous> (/usr/src/app/node_modules/pg-protocol/dist/index.js:11:42)
      at Socket.emit (node:events:517:28)
      at addChunk (node:internal/streams/readable:368:12)
      at readableAddChunk (node:internal/streams/readable:341:9)
      at Readable.push (node:internal/streams/readable:278:10)
      at TCP.onStreamRead (node:internal/stream_base_commons:190:23) {
    length: 513,
    severity: 'ERROR',
    code: '23502',
    detail: 'Failing row contains (f1f42fc3-423d-47dd-96b6-ea03d92ec5c0, 3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd, null, CAMP-427E6E7F, 07adfe04-c0e5-4ad2-88c9-e935cf3e9832, 2025-10-21 14:18:27.836+00, null, 2025-11-20 14:18:20.324+00, active, null, 2025-10-21 14:18:27.836+00, 2025-10-21 14:18:27.836+00, 181849dc-a6f7-4f27-ab90-1535a3d34818, null).',
    hint: undefined,
    position: undefined,
    internalPosition: undefined,
    internalQuery: undefined,
    where: undefined,
    schema: 'public',
    table: 'cupons',
    column: 'recompensaId',
    dataType: undefined,
    constraint: undefined,
    file: 'execMain.c',
    line: '1886',
    routine: 'ExecConstraints',
    sql: `INSERT INTO "cupons" ("id","tenantId","recompensaId","codigo","clienteId","dataGeracao","dataValidade","status","createdAt","updatedAt","campanhaId") VALUES ('f1f42fc3-423d-47dd-96b6-ea03d92ec5c0','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-427E6E7F','07adfe04-c0e5-4ad2-88c9-e935cf3e9832','2025-10-21 14:18:27.836 +00:00','2025-11-20 14:18:20.324 +00:00','active','2025-10-21 14:18:27.836 +00:00','2025-10-21 14:18:27.836 +00:00','181849dc-a6f7-4f27-ab90-1535a3d34818'),('0e603f09-95c1-4d3e-a4bc-c726b163ec71','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-0FE8BBD7','c808fcb4-66ef-45b8-b5f2-d17477709f5a','2025-10-21 14:18:27.836 +00:00','2025-11-20 14:18:20.324 +00:00','active','2025-10-21 14:18:27.836 +00:00','2025-10-21 14:18:27.836 +00:00','181849dc-a6f7-4f27-ab90-1535a3d34818'),('5a4ec839-7b00-4f13-bb5a-b795626a21fa','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-AD4389A2','79e7cedd-2d8a-41d7-afe1-fc2ba06fbb4a','2025-10-21 14:18:27.836 +00:00','2025-11-20 14:18:20.324 +00:00','active','2025-10-21 14:18:27.836 +00:00','2025-10-21 14:18:27.836 +00:00','181849dc-a6f7-4f27-ab90-1535a3d34818'),('5938e90b-9790-4dbe-9581-06874f9886f3','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-2A2FDFA3','0c08fc9f-713f-4cad-a145-2392cc2c0b02','2025-10-21 14:18:27.836 +00:00','2025-11-20 14:18:20.324 +00:00','active','2025-10-21 14:18:27.836 +00:00','2025-10-21 14:18:27.836 +00:00','181849dc-a6f7-4f27-ab90-1535a3d34818'),('9c7e85d5-c351-4805-a745-fbaa868a87d0','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-5C2B6719','aa3fb8bd-6204-428d-a02b-b3b9c50e88d4','2025-10-21 14:18:27.836 +00:00','2025-11-20 14:18:20.324 +00:00','active','2025-10-21 14:18:27.836 +00:00','2025-10-21 14:18:27.836 +00:00','181849dc-a6f7-4f27-ab90-1535a3d34818'),('21e60600-2717-4884-8e3a-487270417a26','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-E6387D98','5c17ebf1-51db-4987-a358-d60711da7617','2025-10-21 14:18:27.836 +00:00','2025-11-20 14:18:20.324 +00:00','active','2025-10-21 14:18:27.836 +00:00','2025-10-21 14:18:27.836 +00:00','181849dc-a6f7-4f27-ab90-1535a3d34818'),('7dfd5cff-c59c-4179-bd46-b4ac72093167','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-4EB25A8F','0c3affd4-31f5-419f-b560-646340c6b6e7','2025-10-21 14:18:27.836 +00:00','2025-11-20 14:18:20.324 +00:00','active','2025-10-21 14:18:27.836 +00:00','2025-10-21 14:18:27.836 +00:00','181849dc-a6f7-4f27-ab90-1535a3d34818'),('a4ca1335-9521-467e-8089-4b411ddd0275','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-6396D327','90c675d5-c5dc-462b-a68f-a10cfa96334c','2025-10-21 14:18:27.836 +00:00','2025-11-20 14:18:20.324 +00:00','active','2025-10-21 14:18:27.836 +00:00','2025-10-21 14:18:27.836 +00:00','181849dc-a6f7-4f27-ab90-1535a3d34818'),('e529bda2-8566-4c8e-b729-8d773aebbdbc','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-8DE3827B','e4a34a27-16e4-4d0d-b872-f3023765fcdf','2025-10-21 14:18:27.836 +00:00','2025-11-20 14:18:20.324 +00:00','active','2025-10-21 14:18:27.836 +00:00','2025-10-21 14:18:27.836 +00:00','181849dc-a6f7-4f27-ab90-1535a3d34818'),('0b1865e8-a65a-4532-978b-81e68b5e5564','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-36618A89','03aa0613-a231-4c70-8532-139b3fc92a3e','2025-10-21 14:18:27.836 +00:00','2025-11-20 14:18:20.324 +00:00','active','2025-10-21 14:18:27.836 +00:00','2025-10-21 14:18:27.836 +00:00','181849dc-a6f7-4f27-ab90-1535a3d34818'),('504b6383-5fbb-408c-9cee-2e7a67e0d241','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-E23F4CCA','ec9b4596-8cbc-453f-ac47-f481efd3537c','2025-10-21 14:18:27.836 +00:00','2025-11-20 14:18:20.324 +00:00','active','2025-10-21 14:18:27.836 +00:00','2025-10-21 14:18:27.836 +00:00','181849dc-a6f7-4f27-ab90-1535a3d34818'),('0dfe84b8-5497-4098-aa9f-a8fd31c883ad','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-E4CD0314','e19b17d9-a6c6-4acf-9be1-fe84e4ffcdaf','2025-10-21 14:18:27.836 +00:00','2025-11-20 14:18:20.324 +00:00','active','2025-10-21 14:18:27.836 +00:00','2025-10-21 14:18:27.836 +00:00','181849dc-a6f7-4f27-ab90-1535a3d34818'),('76ece76f-7ccf-439f-9786-e8d975a789bd','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-3432415D','5e4239d4-a711-47ff-b882-80164ba291eb','2025-10-21 14:18:27.836 +00:00','2025-11-20 14:18:20.324 +00:00','active','2025-10-21 14:18:27.836 +00:00','2025-10-21 14:18:27.836 +00:00','181849dc-a6f7-4f27-ab90-1535a3d34818'),('5aa67451-d892-4318-91e7-1721aee0d0dc','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-DAE1AF97','9924658b-8675-4198-bf85-073ae60b7d6c','2025-10-21 14:18:27.836 +00:00','2025-11-20 14:18:20.324 +00:00','active','2025-10-21 14:18:27.836 +00:00','2025-10-21 14:18:27.836 +00:00','181849dc-a6f7-4f27-ab90-1535a3d34818') RETURNING "id","pesquisaId","tenantId","recompensaId","codigo","clienteId","dataGeracao","dataUtilizacao","dataValidade","status","ultimoContato","createdAt","updatedAt","campanhaId";`,
    parameters: undefined
  },
  sql: `INSERT INTO "cupons" ("id","tenantId","recompensaId","codigo","clienteId","dataGeracao","dataValidade","status","createdAt","updatedAt","campanhaId") VALUES ('f1f42fc3-423d-47dd-96b6-ea03d92ec5c0','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-427E6E7F','07adfe04-c0e5-4ad2-88c9-e935cf3e9832','2025-10-21 14:18:27.836 +00:00','2025-11-20 14:18:20.324 +00:00','active','2025-10-21 14:18:27.836 +00:00','2025-10-21 14:18:27.836 +00:00','181849dc-a6f7-4f27-ab90-1535a3d34818'),('0e603f09-95c1-4d3e-a4bc-c726b163ec71','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-0FE8BBD7','c808fcb4-66ef-45b8-b5f2-d17477709f5a','2025-10-21 14:18:27.836 +00:00','2025-11-20 14:18:20.324 +00:00','active','2025-10-21 14:18:27.836 +00:00','2025-10-21 14:18:27.836 +00:00','181849dc-a6f7-4f27-ab90-1535a3d34818'),('5a4ec839-7b00-4f13-bb5a-b795626a21fa','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-AD4389A2','79e7cedd-2d8a-41d7-afe1-fc2ba06fbb4a','2025-10-21 14:18:27.836 +00:00','2025-11-20 14:18:20.324 +00:00','active','2025-10-21 14:18:27.836 +00:00','2025-10-21 14:18:27.836 +00:00','181849dc-a6f7-4f27-ab90-1535a3d34818'),('5938e90b-9790-4dbe-9581-06874f9886f3','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-2A2FDFA3','0c08fc9f-713f-4cad-a145-2392cc2c0b02','2025-10-21 14:18:27.836 +00:00','2025-11-20 14:18:20.324 +00:00','active','2025-10-21 14:18:27.836 +00:00','2025-10-21 14:18:27.836 +00:00','181849dc-a6f7-4f27-ab90-1535a3d34818'),('9c7e85d5-c351-4805-a745-fbaa868a87d0','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-5C2B6719','aa3fb8bd-6204-428d-a02b-b3b9c50e88d4','2025-10-21 14:18:27.836 +00:00','2025-11-20 14:18:20.324 +00:00','active','2025-10-21 14:18:27.836 +00:00','2025-10-21 14:18:27.836 +00:00','181849dc-a6f7-4f27-ab90-1535a3d34818'),('21e60600-2717-4884-8e3a-487270417a26','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-E6387D98','5c17ebf1-51db-4987-a358-d60711da7617','2025-10-21 14:18:27.836 +00:00','2025-11-20 14:18:20.324 +00:00','active','2025-10-21 14:18:27.836 +00:00','2025-10-21 14:18:27.836 +00:00','181849dc-a6f7-4f27-ab90-1535a3d34818'),('7dfd5cff-c59c-4179-bd46-b4ac72093167','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-4EB25A8F','0c3affd4-31f5-419f-b560-646340c6b6e7','2025-10-21 14:18:27.836 +00:00','2025-11-20 14:18:20.324 +00:00','active','2025-10-21 14:18:27.836 +00:00','2025-10-21 14:18:27.836 +00:00','181849dc-a6f7-4f27-ab90-1535a3d34818'),('a4ca1335-9521-467e-8089-4b411ddd0275','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-6396D327','90c675d5-c5dc-462b-a68f-a10cfa96334c','2025-10-21 14:18:27.836 +00:00','2025-11-20 14:18:20.324 +00:00','active','2025-10-21 14:18:27.836 +00:00','2025-10-21 14:18:27.836 +00:00','181849dc-a6f7-4f27-ab90-1535a3d34818'),('e529bda2-8566-4c8e-b729-8d773aebbdbc','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-8DE3827B','e4a34a27-16e4-4d0d-b872-f3023765fcdf','2025-10-21 14:18:27.836 +00:00','2025-11-20 14:18:20.324 +00:00','active','2025-10-21 14:18:27.836 +00:00','2025-10-21 14:18:27.836 +00:00','181849dc-a6f7-4f27-ab90-1535a3d34818'),('0b1865e8-a65a-4532-978b-81e68b5e5564','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-36618A89','03aa0613-a231-4c70-8532-139b3fc92a3e','2025-10-21 14:18:27.836 +00:00','2025-11-20 14:18:20.324 +00:00','active','2025-10-21 14:18:27.836 +00:00','2025-10-21 14:18:27.836 +00:00','181849dc-a6f7-4f27-ab90-1535a3d34818'),('504b6383-5fbb-408c-9cee-2e7a67e0d241','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-E23F4CCA','ec9b4596-8cbc-453f-ac47-f481efd3537c','2025-10-21 14:18:27.836 +00:00','2025-11-20 14:18:20.324 +00:00','active','2025-10-21 14:18:27.836 +00:00','2025-10-21 14:18:27.836 +00:00','181849dc-a6f7-4f27-ab90-1535a3d34818'),('0dfe84b8-5497-4098-aa9f-a8fd31c883ad','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-E4CD0314','e19b17d9-a6c6-4acf-9be1-fe84e4ffcdaf','2025-10-21 14:18:27.836 +00:00','2025-11-20 14:18:20.324 +00:00','active','2025-10-21 14:18:27.836 +00:00','2025-10-21 14:18:27.836 +00:00','181849dc-a6f7-4f27-ab90-1535a3d34818'),('76ece76f-7ccf-439f-9786-e8d975a789bd','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-3432415D','5e4239d4-a711-47ff-b882-80164ba291eb','2025-10-21 14:18:27.836 +00:00','2025-11-20 14:18:20.324 +00:00','active','2025-10-21 14:18:27.836 +00:00','2025-10-21 14:18:27.836 +00:00','181849dc-a6f7-4f27-ab90-1535a3d34818'),('5aa67451-d892-4318-91e7-1721aee0d0dc','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-DAE1AF97','9924658b-8675-4198-bf85-073ae60b7d6c','2025-10-21 14:18:27.836 +00:00','2025-11-20 14:18:20.324 +00:00','active','2025-10-21 14:18:27.836 +00:00','2025-10-21 14:18:27.836 +00:00','181849dc-a6f7-4f27-ab90-1535a3d34818') RETURNING "id","pesquisaId","tenantId","recompensaId","codigo","clienteId","dataGeracao","dataUtilizacao","dataValidade","status","ultimoContato","createdAt","updatedAt","campanhaId";`,
  parameters: {}
}
Executing (default): SELECT "id", "tenantId", "nome", "mensagem", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "messageDelaySeconds", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."id" = '181849dc-a6f7-4f27-ab90-1535a3d34818' AND "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): UPDATE "campanhas" SET "status"=$1,"updatedAt"=$2 WHERE "id" = $3 AND "tenantId" = $4
Executing (default): SELECT "id", "tenantId", "nome", "mensagem", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "messageDelaySeconds", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."id" = '181849dc-a6f7-4f27-ab90-1535a3d34818' AND "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: POST /api/auth/verify-token
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: GET /api/campanhas/181849dc-a6f7-4f27-ab90-1535a3d34818
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "tenantId", "nome", "mensagem", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "messageDelaySeconds", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."id" = '181849dc-a6f7-4f27-ab90-1535a3d34818' AND "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: GET /api/campanhas/181849dc-a6f7-4f27-ab90-1535a3d34818
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "tenantId", "nome", "mensagem", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "messageDelaySeconds", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."id" = '181849dc-a6f7-4f27-ab90-1535a3d34818' AND "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';