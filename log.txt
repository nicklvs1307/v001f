Postgres is up - executing command
Server.js is being executed!
API_KEY_ENCRYPTION_KEY is not defined in .env. Please set it for security.
Conexão com o banco de dados estabelecida com sucesso (Sequelize).
Server is running on port 5000
Agendador de relatório diário iniciado. A tarefa será executada todos os dias às 8:00.
Agendador de lembrete de cupons iniciado. A tarefa será executada todos os dias às 9:00.
Login request body: { email: 'rafael1@towersfy.com', password: '123456' }
Executing (default): SELECT "Usuario"."id", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."tenantId", "Usuario"."roleId", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."email" = 'rafael1@towersfy.com';
Executing (default): SELECT "name" FROM "roles" AS "Role" WHERE "Role"."id" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
[Auth Middleware] Request: POST /api/auth/verify-token
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: GET /api/dashboard/main
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "name", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
[Authorize Debug] User Role: Admin, Required: dashboard:read
[Authorize Debug] Role ID: ce609d07-d83f-4002-a892-e17c91b767d3, Module: dashboard, Action: read
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
[Authorize Debug] Has Permission Result: true
Executing (default): SELECT "Resposta"."id", "Resposta"."perguntaId", "Resposta"."pesquisaId", "Resposta"."tenantId", "Resposta"."atendenteId", "Resposta"."respondentSessionId", "Resposta"."ratingValue", "Resposta"."textValue", "Resposta"."selectedOption", "Resposta"."createdAt", "Resposta"."updatedAt", "pergunta"."id" AS "pergunta.id", "pergunta"."type" AS "pergunta.type" FROM "respostas" AS "Resposta" INNER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" AND ("pergunta"."type" = 'rating_0_10' OR "pergunta"."type" = 'rating_1_5') WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."ratingValue" IS NOT NULL;
Executing (default): SELECT count(DISTINCT("respondentSessionId")) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."respondentSessionId" IS NOT NULL;
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."status" = 'used' AND "Cupom"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT date_trunc('day', "createdAt") AS "date", COUNT("id") AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' GROUP BY date_trunc('day', "createdAt") ORDER BY date_trunc('day', "createdAt") ASC;
Executing (default): SELECT "Resposta"."id", "Resposta"."perguntaId", "Resposta"."pesquisaId", "Resposta"."tenantId", "Resposta"."atendenteId", "Resposta"."respondentSessionId", "Resposta"."ratingValue", "Resposta"."textValue", "Resposta"."selectedOption", "Resposta"."createdAt", "Resposta"."updatedAt", "pergunta"."id" AS "pergunta.id", "pergunta"."type" AS "pergunta.type", "client"."id" AS "client.id", "atendente"."id" AS "atendente.id", "atendente"."name" AS "atendente.name" FROM "respostas" AS "Resposta" LEFT OUTER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" LEFT OUTER JOIN "clients" AS "client" ON "Resposta"."respondentSessionId" = "client"."respondentSessionId" LEFT OUTER JOIN "atendentes" AS "atendente" ON "Resposta"."atendenteId" = "atendente"."id" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."ratingValue" IS NOT NULL;
Executing (default): SELECT "id", "atendenteId", "tenantId", "npsGoal", "responsesGoal", "registrationsGoal", "createdAt", "updatedAt" FROM "atendente_metas" AS "AtendenteMeta" WHERE "AtendenteMeta"."atendenteId" = 'f60c5a4d-1c9a-474c-89db-2abd95e8e06f' AND "AtendenteMeta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "atendenteId", "tenantId", "npsGoal", "responsesGoal", "registrationsGoal", "createdAt", "updatedAt" FROM "atendente_metas" AS "AtendenteMeta" WHERE "AtendenteMeta"."atendenteId" = '49c162d2-fdde-448c-86f8-14b9c93be792' AND "AtendenteMeta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "atendenteId", "tenantId", "npsGoal", "responsesGoal", "registrationsGoal", "createdAt", "updatedAt" FROM "atendente_metas" AS "AtendenteMeta" WHERE "AtendenteMeta"."atendenteId" = 'b13aa606-ae37-4d5b-8405-9610cbdffc25' AND "AtendenteMeta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "atendenteId", "tenantId", "npsGoal", "responsesGoal", "registrationsGoal", "createdAt", "updatedAt" FROM "atendente_metas" AS "AtendenteMeta" WHERE "AtendenteMeta"."atendenteId" = '2a4fd6a3-c581-401d-ba65-9225b56cd850' AND "AtendenteMeta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "atendenteId", "tenantId", "npsGoal", "responsesGoal", "registrationsGoal", "createdAt", "updatedAt" FROM "atendente_metas" AS "AtendenteMeta" WHERE "AtendenteMeta"."atendenteId" = '78b6809d-1ef3-4950-920c-ca4adfdbf114' AND "AtendenteMeta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "atendenteId", "tenantId", "npsGoal", "responsesGoal", "registrationsGoal", "createdAt", "updatedAt" FROM "atendente_metas" AS "AtendenteMeta" WHERE "AtendenteMeta"."atendenteId" = 'ead2104c-7963-47ff-8336-852ad10d355f' AND "AtendenteMeta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "atendenteId", "tenantId", "npsGoal", "responsesGoal", "registrationsGoal", "createdAt", "updatedAt" FROM "atendente_metas" AS "AtendenteMeta" WHERE "AtendenteMeta"."atendenteId" = '2dbadb84-aafa-4c99-a50d-9b01d56ca921' AND "AtendenteMeta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "Resposta"."id", "Resposta"."perguntaId", "Resposta"."pesquisaId", "Resposta"."tenantId", "Resposta"."atendenteId", "Resposta"."respondentSessionId", "Resposta"."ratingValue", "Resposta"."textValue", "Resposta"."selectedOption", "Resposta"."createdAt", "Resposta"."updatedAt", "pergunta"."id" AS "pergunta.id", "pergunta"."text" AS "pergunta.text", "pergunta"."type" AS "pergunta.type", "pergunta"."criterioId" AS "pergunta.criterioId", "pergunta->criterio"."id" AS "pergunta.criterio.id", "pergunta->criterio"."name" AS "pergunta.criterio.name", "pergunta->criterio"."type" AS "pergunta.criterio.type" FROM "respostas" AS "Resposta" INNER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" AND "pergunta"."type" LIKE 'rating%' LEFT OUTER JOIN "criterios" AS "pergunta->criterio" ON "pergunta"."criterioId" = "pergunta->criterio"."id" WHERE "Resposta"."ratingValue" IS NOT NULL AND "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "Resposta"."id", "Resposta"."createdAt", "Resposta"."textValue", "Resposta"."ratingValue", "Resposta"."respondentSessionId", "client"."id" AS "client.id", "client"."name" AS "client.name" FROM "respostas" AS "Resposta" LEFT OUTER JOIN "clients" AS "client" ON "Resposta"."respondentSessionId" = "client"."respondentSessionId" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."textValue" != '' ORDER BY "Resposta"."createdAt" DESC LIMIT 7;
Executing (default): SELECT count(DISTINCT("respondentSessionId")) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Cupom"."createdAt" = '2025-10-21 15:18:22.480 +00:00';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Cupom"."status" = 'used' AND "Cupom"."updatedAt" = '2025-10-21 15:18:22.484 +00:00';
Executing (default): SELECT "Resposta"."id", "Resposta"."createdAt", "Resposta"."ratingValue", "pergunta"."id" AS "pergunta.id", "pergunta"."type" AS "pergunta.type" FROM "respostas" AS "Resposta" INNER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" AND "pergunta"."type" = 'rating_0_10' WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."ratingValue" IS NOT NULL;
Executing (default): SELECT "Resposta"."id", "Resposta"."textValue" FROM "respostas" AS "Resposta" INNER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" AND "pergunta"."type" = 'free_text' WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."textValue" != '';
Executing (default): SELECT date_trunc('day', "Resposta"."createdAt") AS "period", SUM(CASE WHEN "ratingValue" >= 9 THEN 1 ELSE 0 END) AS "promoters", SUM(CASE WHEN "ratingValue" <= 6 THEN 1 ELSE 0 END) AS "detractors", COUNT("Resposta"."id") AS "total" FROM "respostas" AS "Resposta" INNER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" AND "pergunta"."type" = 'rating_0_10' WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."ratingValue" IS NOT NULL GROUP BY date_trunc('day', "Resposta"."createdAt") ORDER BY date_trunc('day', "Resposta"."createdAt") ASC;
[Auth Middleware] Request: POST /api/auth/verify-token
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: GET /api/campanhas?tenantId=3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "tenantId", "nome", "mensagem", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "messageDelaySeconds", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: GET /api/campanhas?tenantId=3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "tenantId", "nome", "mensagem", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "messageDelaySeconds", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: DELETE /api/campanhas/5a1b51bf-4301-4445-8b96-f108fefa00d8
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: POST /api/auth/verify-token
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: GET /api/campanhas?tenantId=3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "tenantId", "nome", "mensagem", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "messageDelaySeconds", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: POST /api/auth/verify-token
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: GET /api/recompensas
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: GET /api/roletas
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "name", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "id", "name", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
[Authorize Debug] User Role: Admin, Required: recompensas:read
[Authorize Debug] Role ID: ce609d07-d83f-4002-a892-e17c91b767d3, Module: recompensas, Action: read
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'recompensas' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
[Authorize Debug] User Role: Admin, Required: roletas:read
[Authorize Debug] Role ID: ce609d07-d83f-4002-a892-e17c91b767d3, Module: roletas, Action: read
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'roletas' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
[Authorize Debug] Has Permission Result: true
Executing (default): SELECT "id", "tenantId", "name", "description", "pointsRequired", "type", "value", "imageUrl", "active", "createdAt", "updatedAt" FROM "recompensas" AS "Recompensa" WHERE "Recompensa"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' ORDER BY "Recompensa"."name" ASC;
[Authorize Debug] Has Permission Result: true
Executing (default): SELECT "id", "tenantId", "nome", "descricao", "active", "createdAt", "updatedAt" FROM "roletas" AS "Roleta" WHERE "Roleta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: POST /api/campanhas
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): INSERT INTO "campanhas" ("id","tenantId","nome","mensagem","rewardType","recompensaId","roletaId","dataValidade","criterioSelecao","status","messageDelaySeconds","createdAt","updatedAt") VALUES ($1,$2,$3,$4,$5,$6,$7,$8,$9,$10,$11,$12,$13) RETURNING "id","tenantId","nome","mensagem","rewardType","recompensaId","roletaId","dataValidade","criterioSelecao","status","startDate","endDate","messageDelaySeconds","createdAt","updatedAt";
[Auth Middleware] Request: GET /api/campanhas?tenantId=3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: POST /api/auth/verify-token
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "tenantId", "nome", "mensagem", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "messageDelaySeconds", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: GET /api/campanhas?tenantId=3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "tenantId", "nome", "mensagem", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "messageDelaySeconds", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: POST /api/campanhas/dc72ed6a-a8d9-470f-86b6-79835c88b33b/process
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "tenantId", "nome", "mensagem", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "messageDelaySeconds", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."id" = 'dc72ed6a-a8d9-470f-86b6-79835c88b33b' AND "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "tenantId", "nome", "mensagem", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "messageDelaySeconds", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."id" = 'dc72ed6a-a8d9-470f-86b6-79835c88b33b' AND "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): UPDATE "campanhas" SET "status"=$1,"updatedAt"=$2 WHERE "id" = $3 AND "tenantId" = $4
Executing (default): SELECT "id", "tenantId", "nome", "mensagem", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "messageDelaySeconds", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."id" = 'dc72ed6a-a8d9-470f-86b6-79835c88b33b' AND "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Campanha] Iniciando processamento para campanha dc72ed6a-a8d9-470f-86b6-79835c88b33b
Executing (default): SELECT "id", "tenantId", "nome", "mensagem", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "messageDelaySeconds", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."id" = 'dc72ed6a-a8d9-470f-86b6-79835c88b33b' AND "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "tenantId", "name", "email", "phone", "birthDate", "respondentSessionId", "gender", "createdAt", "updatedAt" FROM "clients" AS "Client" WHERE "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): INSERT INTO "cupons" ("id","tenantId","recompensaId","codigo","clienteId","dataGeracao","dataValidade","status","createdAt","updatedAt","campanhaId") VALUES ('8f03699f-0099-42a1-a1b9-3921ee54ced0','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-2260D371','07adfe04-c0e5-4ad2-88c9-e935cf3e9832','2025-10-21 15:18:50.469 +00:00','2025-11-20 15:18:45.752 +00:00','active','2025-10-21 15:18:50.470 +00:00','2025-10-21 15:18:50.470 +00:00','dc72ed6a-a8d9-470f-86b6-79835c88b33b'),('6983edc4-ffc1-48f5-a31d-e194c0f50e3c','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-46849780','c808fcb4-66ef-45b8-b5f2-d17477709f5a','2025-10-21 15:18:50.469 +00:00','2025-11-20 15:18:45.752 +00:00','active','2025-10-21 15:18:50.470 +00:00','2025-10-21 15:18:50.470 +00:00','dc72ed6a-a8d9-470f-86b6-79835c88b33b'),('cd919fd8-ef9a-4f9f-8ac6-93adb46f77e0','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-7A7082C8','79e7cedd-2d8a-41d7-afe1-fc2ba06fbb4a','2025-10-21 15:18:50.469 +00:00','2025-11-20 15:18:45.752 +00:00','active','2025-10-21 15:18:50.470 +00:00','2025-10-21 15:18:50.470 +00:00','dc72ed6a-a8d9-470f-86b6-79835c88b33b'),('74d9f4c0-2473-4f85-b1f1-5c69c4bbbea8','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-1E05CF71','0c08fc9f-713f-4cad-a145-2392cc2c0b02','2025-10-21 15:18:50.470 +00:00','2025-11-20 15:18:45.752 +00:00','active','2025-10-21 15:18:50.470 +00:00','2025-10-21 15:18:50.470 +00:00','dc72ed6a-a8d9-470f-86b6-79835c88b33b'),('929c1d24-cdf4-452b-8f5d-157592c2e278','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-D980CE5A','aa3fb8bd-6204-428d-a02b-b3b9c50e88d4','2025-10-21 15:18:50.470 +00:00','2025-11-20 15:18:45.752 +00:00','active','2025-10-21 15:18:50.470 +00:00','2025-10-21 15:18:50.470 +00:00','dc72ed6a-a8d9-470f-86b6-79835c88b33b'),('6046d716-e22e-4179-afae-33516d4b9d5c','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-27A1EDC9','5c17ebf1-51db-4987-a358-d60711da7617','2025-10-21 15:18:50.470 +00:00','2025-11-20 15:18:45.752 +00:00','active','2025-10-21 15:18:50.470 +00:00','2025-10-21 15:18:50.470 +00:00','dc72ed6a-a8d9-470f-86b6-79835c88b33b'),('be312bd8-8053-4207-a9c6-490577ef6215','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-F23A5693','0c3affd4-31f5-419f-b560-646340c6b6e7','2025-10-21 15:18:50.470 +00:00','2025-11-20 15:18:45.752 +00:00','active','2025-10-21 15:18:50.470 +00:00','2025-10-21 15:18:50.470 +00:00','dc72ed6a-a8d9-470f-86b6-79835c88b33b'),('cb443038-814f-4f93-8359-e5d8ee939430','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-3F824E90','90c675d5-c5dc-462b-a68f-a10cfa96334c','2025-10-21 15:18:50.470 +00:00','2025-11-20 15:18:45.752 +00:00','active','2025-10-21 15:18:50.470 +00:00','2025-10-21 15:18:50.470 +00:00','dc72ed6a-a8d9-470f-86b6-79835c88b33b'),('d697ebcf-c92f-4e4f-a982-7962c83ae0fd','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-DA4BD84D','e4a34a27-16e4-4d0d-b872-f3023765fcdf','2025-10-21 15:18:50.470 +00:00','2025-11-20 15:18:45.752 +00:00','active','2025-10-21 15:18:50.470 +00:00','2025-10-21 15:18:50.470 +00:00','dc72ed6a-a8d9-470f-86b6-79835c88b33b'),('fbf58cff-5180-42c6-9415-0ff48ac83635','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-3AB7F8D2','03aa0613-a231-4c70-8532-139b3fc92a3e','2025-10-21 15:18:50.470 +00:00','2025-11-20 15:18:45.752 +00:00','active','2025-10-21 15:18:50.470 +00:00','2025-10-21 15:18:50.470 +00:00','dc72ed6a-a8d9-470f-86b6-79835c88b33b'),('56962229-0d20-4eec-bcd4-0076777eaf69','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-E81E5A4F','ec9b4596-8cbc-453f-ac47-f481efd3537c','2025-10-21 15:18:50.470 +00:00','2025-11-20 15:18:45.752 +00:00','active','2025-10-21 15:18:50.470 +00:00','2025-10-21 15:18:50.470 +00:00','dc72ed6a-a8d9-470f-86b6-79835c88b33b'),('ea0342a5-0bfd-4a97-bac7-e1baa758e99f','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-5AB34487','e19b17d9-a6c6-4acf-9be1-fe84e4ffcdaf','2025-10-21 15:18:50.470 +00:00','2025-11-20 15:18:45.752 +00:00','active','2025-10-21 15:18:50.470 +00:00','2025-10-21 15:18:50.470 +00:00','dc72ed6a-a8d9-470f-86b6-79835c88b33b'),('c9048e58-0634-403d-b01d-e262197c0b29','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-5F0A1519','5e4239d4-a711-47ff-b882-80164ba291eb','2025-10-21 15:18:50.470 +00:00','2025-11-20 15:18:45.752 +00:00','active','2025-10-21 15:18:50.470 +00:00','2025-10-21 15:18:50.470 +00:00','dc72ed6a-a8d9-470f-86b6-79835c88b33b'),('b708a963-21b2-4690-8128-c19695272722','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-5D947FEA','9924658b-8675-4198-bf85-073ae60b7d6c','2025-10-21 15:18:50.470 +00:00','2025-11-20 15:18:45.752 +00:00','active','2025-10-21 15:18:50.470 +00:00','2025-10-21 15:18:50.470 +00:00','dc72ed6a-a8d9-470f-86b6-79835c88b33b') RETURNING "id","pesquisaId","tenantId","recompensaId","codigo","clienteId","dataGeracao","dataUtilizacao","dataValidade","status","ultimoContato","createdAt","updatedAt","campanhaId";
[Campanha] Falha crítica no processamento da campanha dc72ed6a-a8d9-470f-86b6-79835c88b33b: Error
    at Query.run (/usr/src/app/node_modules/sequelize/lib/dialects/postgres/query.js:50:25)
    at /usr/src/app/node_modules/sequelize/lib/sequelize.js:315:28
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async PostgresQueryInterface.bulkInsert (/usr/src/app/node_modules/sequelize/lib/dialects/abstract/query-interface.js:346:21)
    at async recursiveBulkCreate (/usr/src/app/node_modules/sequelize/lib/model.js:1697:25)
    at async Cupom.bulkCreate (/usr/src/app/node_modules/sequelize/lib/model.js:1786:12)
    at async CampanhaService._processCampaign (/usr/src/app/src/services/campanhaService.js:80:21) {
  name: 'SequelizeDatabaseError',
  parent: error: null value in column "recompensaId" of relation "cupons" violates not-null constraint
      at Parser.parseErrorMessage (/usr/src/app/node_modules/pg-protocol/dist/parser.js:285:98)
      at Parser.handlePacket (/usr/src/app/node_modules/pg-protocol/dist/parser.js:122:29)
      at Parser.parse (/usr/src/app/node_modules/pg-protocol/dist/parser.js:35:38)
      at Socket.<anonymous> (/usr/src/app/node_modules/pg-protocol/dist/index.js:11:42)
      at Socket.emit (node:events:517:28)
      at addChunk (node:internal/streams/readable:368:12)
      at readableAddChunk (node:internal/streams/readable:341:9)
      at Readable.push (node:internal/streams/readable:278:10)
      at TCP.onStreamRead (node:internal/stream_base_commons:190:23) {
    length: 511,
    severity: 'ERROR',
    code: '23502',
    detail: 'Failing row contains (8f03699f-0099-42a1-a1b9-3921ee54ced0, 3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd, null, CAMP-2260D371, 07adfe04-c0e5-4ad2-88c9-e935cf3e9832, 2025-10-21 15:18:50.469+00, null, 2025-11-20 15:18:45.752+00, active, null, 2025-10-21 15:18:50.47+00, 2025-10-21 15:18:50.47+00, dc72ed6a-a8d9-470f-86b6-79835c88b33b, null).',
    hint: undefined,
    position: undefined,
    internalPosition: undefined,
    internalQuery: undefined,
    where: undefined,
    schema: 'public',
    table: 'cupons',
    column: 'recompensaId',
    dataType: undefined,
    constraint: undefined,
    file: 'execMain.c',
    line: '1886',
    routine: 'ExecConstraints',
    sql: `INSERT INTO "cupons" ("id","tenantId","recompensaId","codigo","clienteId","dataGeracao","dataValidade","status","createdAt","updatedAt","campanhaId") VALUES ('8f03699f-0099-42a1-a1b9-3921ee54ced0','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-2260D371','07adfe04-c0e5-4ad2-88c9-e935cf3e9832','2025-10-21 15:18:50.469 +00:00','2025-11-20 15:18:45.752 +00:00','active','2025-10-21 15:18:50.470 +00:00','2025-10-21 15:18:50.470 +00:00','dc72ed6a-a8d9-470f-86b6-79835c88b33b'),('6983edc4-ffc1-48f5-a31d-e194c0f50e3c','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-46849780','c808fcb4-66ef-45b8-b5f2-d17477709f5a','2025-10-21 15:18:50.469 +00:00','2025-11-20 15:18:45.752 +00:00','active','2025-10-21 15:18:50.470 +00:00','2025-10-21 15:18:50.470 +00:00','dc72ed6a-a8d9-470f-86b6-79835c88b33b'),('cd919fd8-ef9a-4f9f-8ac6-93adb46f77e0','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-7A7082C8','79e7cedd-2d8a-41d7-afe1-fc2ba06fbb4a','2025-10-21 15:18:50.469 +00:00','2025-11-20 15:18:45.752 +00:00','active','2025-10-21 15:18:50.470 +00:00','2025-10-21 15:18:50.470 +00:00','dc72ed6a-a8d9-470f-86b6-79835c88b33b'),('74d9f4c0-2473-4f85-b1f1-5c69c4bbbea8','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-1E05CF71','0c08fc9f-713f-4cad-a145-2392cc2c0b02','2025-10-21 15:18:50.470 +00:00','2025-11-20 15:18:45.752 +00:00','active','2025-10-21 15:18:50.470 +00:00','2025-10-21 15:18:50.470 +00:00','dc72ed6a-a8d9-470f-86b6-79835c88b33b'),('929c1d24-cdf4-452b-8f5d-157592c2e278','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-D980CE5A','aa3fb8bd-6204-428d-a02b-b3b9c50e88d4','2025-10-21 15:18:50.470 +00:00','2025-11-20 15:18:45.752 +00:00','active','2025-10-21 15:18:50.470 +00:00','2025-10-21 15:18:50.470 +00:00','dc72ed6a-a8d9-470f-86b6-79835c88b33b'),('6046d716-e22e-4179-afae-33516d4b9d5c','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-27A1EDC9','5c17ebf1-51db-4987-a358-d60711da7617','2025-10-21 15:18:50.470 +00:00','2025-11-20 15:18:45.752 +00:00','active','2025-10-21 15:18:50.470 +00:00','2025-10-21 15:18:50.470 +00:00','dc72ed6a-a8d9-470f-86b6-79835c88b33b'),('be312bd8-8053-4207-a9c6-490577ef6215','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-F23A5693','0c3affd4-31f5-419f-b560-646340c6b6e7','2025-10-21 15:18:50.470 +00:00','2025-11-20 15:18:45.752 +00:00','active','2025-10-21 15:18:50.470 +00:00','2025-10-21 15:18:50.470 +00:00','dc72ed6a-a8d9-470f-86b6-79835c88b33b'),('cb443038-814f-4f93-8359-e5d8ee939430','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-3F824E90','90c675d5-c5dc-462b-a68f-a10cfa96334c','2025-10-21 15:18:50.470 +00:00','2025-11-20 15:18:45.752 +00:00','active','2025-10-21 15:18:50.470 +00:00','2025-10-21 15:18:50.470 +00:00','dc72ed6a-a8d9-470f-86b6-79835c88b33b'),('d697ebcf-c92f-4e4f-a982-7962c83ae0fd','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-DA4BD84D','e4a34a27-16e4-4d0d-b872-f3023765fcdf','2025-10-21 15:18:50.470 +00:00','2025-11-20 15:18:45.752 +00:00','active','2025-10-21 15:18:50.470 +00:00','2025-10-21 15:18:50.470 +00:00','dc72ed6a-a8d9-470f-86b6-79835c88b33b'),('fbf58cff-5180-42c6-9415-0ff48ac83635','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-3AB7F8D2','03aa0613-a231-4c70-8532-139b3fc92a3e','2025-10-21 15:18:50.470 +00:00','2025-11-20 15:18:45.752 +00:00','active','2025-10-21 15:18:50.470 +00:00','2025-10-21 15:18:50.470 +00:00','dc72ed6a-a8d9-470f-86b6-79835c88b33b'),('56962229-0d20-4eec-bcd4-0076777eaf69','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-E81E5A4F','ec9b4596-8cbc-453f-ac47-f481efd3537c','2025-10-21 15:18:50.470 +00:00','2025-11-20 15:18:45.752 +00:00','active','2025-10-21 15:18:50.470 +00:00','2025-10-21 15:18:50.470 +00:00','dc72ed6a-a8d9-470f-86b6-79835c88b33b'),('ea0342a5-0bfd-4a97-bac7-e1baa758e99f','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-5AB34487','e19b17d9-a6c6-4acf-9be1-fe84e4ffcdaf','2025-10-21 15:18:50.470 +00:00','2025-11-20 15:18:45.752 +00:00','active','2025-10-21 15:18:50.470 +00:00','2025-10-21 15:18:50.470 +00:00','dc72ed6a-a8d9-470f-86b6-79835c88b33b'),('c9048e58-0634-403d-b01d-e262197c0b29','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-5F0A1519','5e4239d4-a711-47ff-b882-80164ba291eb','2025-10-21 15:18:50.470 +00:00','2025-11-20 15:18:45.752 +00:00','active','2025-10-21 15:18:50.470 +00:00','2025-10-21 15:18:50.470 +00:00','dc72ed6a-a8d9-470f-86b6-79835c88b33b'),('b708a963-21b2-4690-8128-c19695272722','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-5D947FEA','9924658b-8675-4198-bf85-073ae60b7d6c','2025-10-21 15:18:50.470 +00:00','2025-11-20 15:18:45.752 +00:00','active','2025-10-21 15:18:50.470 +00:00','2025-10-21 15:18:50.470 +00:00','dc72ed6a-a8d9-470f-86b6-79835c88b33b') RETURNING "id","pesquisaId","tenantId","recompensaId","codigo","clienteId","dataGeracao","dataUtilizacao","dataValidade","status","ultimoContato","createdAt","updatedAt","campanhaId";`,
    parameters: undefined
  },
  original: error: null value in column "recompensaId" of relation "cupons" violates not-null constraint
      at Parser.parseErrorMessage (/usr/src/app/node_modules/pg-protocol/dist/parser.js:285:98)
      at Parser.handlePacket (/usr/src/app/node_modules/pg-protocol/dist/parser.js:122:29)
      at Parser.parse (/usr/src/app/node_modules/pg-protocol/dist/parser.js:35:38)
      at Socket.<anonymous> (/usr/src/app/node_modules/pg-protocol/dist/index.js:11:42)
      at Socket.emit (node:events:517:28)
      at addChunk (node:internal/streams/readable:368:12)
      at readableAddChunk (node:internal/streams/readable:341:9)
      at Readable.push (node:internal/streams/readable:278:10)
      at TCP.onStreamRead (node:internal/stream_base_commons:190:23) {
    length: 511,
    severity: 'ERROR',
    code: '23502',
    detail: 'Failing row contains (8f03699f-0099-42a1-a1b9-3921ee54ced0, 3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd, null, CAMP-2260D371, 07adfe04-c0e5-4ad2-88c9-e935cf3e9832, 2025-10-21 15:18:50.469+00, null, 2025-11-20 15:18:45.752+00, active, null, 2025-10-21 15:18:50.47+00, 2025-10-21 15:18:50.47+00, dc72ed6a-a8d9-470f-86b6-79835c88b33b, null).',
    hint: undefined,
    position: undefined,
    internalPosition: undefined,
    internalQuery: undefined,
    where: undefined,
    schema: 'public',
    table: 'cupons',
    column: 'recompensaId',
    dataType: undefined,
    constraint: undefined,
    file: 'execMain.c',
    line: '1886',
    routine: 'ExecConstraints',
    sql: `INSERT INTO "cupons" ("id","tenantId","recompensaId","codigo","clienteId","dataGeracao","dataValidade","status","createdAt","updatedAt","campanhaId") VALUES ('8f03699f-0099-42a1-a1b9-3921ee54ced0','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-2260D371','07adfe04-c0e5-4ad2-88c9-e935cf3e9832','2025-10-21 15:18:50.469 +00:00','2025-11-20 15:18:45.752 +00:00','active','2025-10-21 15:18:50.470 +00:00','2025-10-21 15:18:50.470 +00:00','dc72ed6a-a8d9-470f-86b6-79835c88b33b'),('6983edc4-ffc1-48f5-a31d-e194c0f50e3c','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-46849780','c808fcb4-66ef-45b8-b5f2-d17477709f5a','2025-10-21 15:18:50.469 +00:00','2025-11-20 15:18:45.752 +00:00','active','2025-10-21 15:18:50.470 +00:00','2025-10-21 15:18:50.470 +00:00','dc72ed6a-a8d9-470f-86b6-79835c88b33b'),('cd919fd8-ef9a-4f9f-8ac6-93adb46f77e0','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-7A7082C8','79e7cedd-2d8a-41d7-afe1-fc2ba06fbb4a','2025-10-21 15:18:50.469 +00:00','2025-11-20 15:18:45.752 +00:00','active','2025-10-21 15:18:50.470 +00:00','2025-10-21 15:18:50.470 +00:00','dc72ed6a-a8d9-470f-86b6-79835c88b33b'),('74d9f4c0-2473-4f85-b1f1-5c69c4bbbea8','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-1E05CF71','0c08fc9f-713f-4cad-a145-2392cc2c0b02','2025-10-21 15:18:50.470 +00:00','2025-11-20 15:18:45.752 +00:00','active','2025-10-21 15:18:50.470 +00:00','2025-10-21 15:18:50.470 +00:00','dc72ed6a-a8d9-470f-86b6-79835c88b33b'),('929c1d24-cdf4-452b-8f5d-157592c2e278','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-D980CE5A','aa3fb8bd-6204-428d-a02b-b3b9c50e88d4','2025-10-21 15:18:50.470 +00:00','2025-11-20 15:18:45.752 +00:00','active','2025-10-21 15:18:50.470 +00:00','2025-10-21 15:18:50.470 +00:00','dc72ed6a-a8d9-470f-86b6-79835c88b33b'),('6046d716-e22e-4179-afae-33516d4b9d5c','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-27A1EDC9','5c17ebf1-51db-4987-a358-d60711da7617','2025-10-21 15:18:50.470 +00:00','2025-11-20 15:18:45.752 +00:00','active','2025-10-21 15:18:50.470 +00:00','2025-10-21 15:18:50.470 +00:00','dc72ed6a-a8d9-470f-86b6-79835c88b33b'),('be312bd8-8053-4207-a9c6-490577ef6215','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-F23A5693','0c3affd4-31f5-419f-b560-646340c6b6e7','2025-10-21 15:18:50.470 +00:00','2025-11-20 15:18:45.752 +00:00','active','2025-10-21 15:18:50.470 +00:00','2025-10-21 15:18:50.470 +00:00','dc72ed6a-a8d9-470f-86b6-79835c88b33b'),('cb443038-814f-4f93-8359-e5d8ee939430','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-3F824E90','90c675d5-c5dc-462b-a68f-a10cfa96334c','2025-10-21 15:18:50.470 +00:00','2025-11-20 15:18:45.752 +00:00','active','2025-10-21 15:18:50.470 +00:00','2025-10-21 15:18:50.470 +00:00','dc72ed6a-a8d9-470f-86b6-79835c88b33b'),('d697ebcf-c92f-4e4f-a982-7962c83ae0fd','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-DA4BD84D','e4a34a27-16e4-4d0d-b872-f3023765fcdf','2025-10-21 15:18:50.470 +00:00','2025-11-20 15:18:45.752 +00:00','active','2025-10-21 15:18:50.470 +00:00','2025-10-21 15:18:50.470 +00:00','dc72ed6a-a8d9-470f-86b6-79835c88b33b'),('fbf58cff-5180-42c6-9415-0ff48ac83635','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-3AB7F8D2','03aa0613-a231-4c70-8532-139b3fc92a3e','2025-10-21 15:18:50.470 +00:00','2025-11-20 15:18:45.752 +00:00','active','2025-10-21 15:18:50.470 +00:00','2025-10-21 15:18:50.470 +00:00','dc72ed6a-a8d9-470f-86b6-79835c88b33b'),('56962229-0d20-4eec-bcd4-0076777eaf69','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-E81E5A4F','ec9b4596-8cbc-453f-ac47-f481efd3537c','2025-10-21 15:18:50.470 +00:00','2025-11-20 15:18:45.752 +00:00','active','2025-10-21 15:18:50.470 +00:00','2025-10-21 15:18:50.470 +00:00','dc72ed6a-a8d9-470f-86b6-79835c88b33b'),('ea0342a5-0bfd-4a97-bac7-e1baa758e99f','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-5AB34487','e19b17d9-a6c6-4acf-9be1-fe84e4ffcdaf','2025-10-21 15:18:50.470 +00:00','2025-11-20 15:18:45.752 +00:00','active','2025-10-21 15:18:50.470 +00:00','2025-10-21 15:18:50.470 +00:00','dc72ed6a-a8d9-470f-86b6-79835c88b33b'),('c9048e58-0634-403d-b01d-e262197c0b29','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-5F0A1519','5e4239d4-a711-47ff-b882-80164ba291eb','2025-10-21 15:18:50.470 +00:00','2025-11-20 15:18:45.752 +00:00','active','2025-10-21 15:18:50.470 +00:00','2025-10-21 15:18:50.470 +00:00','dc72ed6a-a8d9-470f-86b6-79835c88b33b'),('b708a963-21b2-4690-8128-c19695272722','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-5D947FEA','9924658b-8675-4198-bf85-073ae60b7d6c','2025-10-21 15:18:50.470 +00:00','2025-11-20 15:18:45.752 +00:00','active','2025-10-21 15:18:50.470 +00:00','2025-10-21 15:18:50.470 +00:00','dc72ed6a-a8d9-470f-86b6-79835c88b33b') RETURNING "id","pesquisaId","tenantId","recompensaId","codigo","clienteId","dataGeracao","dataUtilizacao","dataValidade","status","ultimoContato","createdAt","updatedAt","campanhaId";`,
    parameters: undefined
  },
  sql: `INSERT INTO "cupons" ("id","tenantId","recompensaId","codigo","clienteId","dataGeracao","dataValidade","status","createdAt","updatedAt","campanhaId") VALUES ('8f03699f-0099-42a1-a1b9-3921ee54ced0','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-2260D371','07adfe04-c0e5-4ad2-88c9-e935cf3e9832','2025-10-21 15:18:50.469 +00:00','2025-11-20 15:18:45.752 +00:00','active','2025-10-21 15:18:50.470 +00:00','2025-10-21 15:18:50.470 +00:00','dc72ed6a-a8d9-470f-86b6-79835c88b33b'),('6983edc4-ffc1-48f5-a31d-e194c0f50e3c','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-46849780','c808fcb4-66ef-45b8-b5f2-d17477709f5a','2025-10-21 15:18:50.469 +00:00','2025-11-20 15:18:45.752 +00:00','active','2025-10-21 15:18:50.470 +00:00','2025-10-21 15:18:50.470 +00:00','dc72ed6a-a8d9-470f-86b6-79835c88b33b'),('cd919fd8-ef9a-4f9f-8ac6-93adb46f77e0','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-7A7082C8','79e7cedd-2d8a-41d7-afe1-fc2ba06fbb4a','2025-10-21 15:18:50.469 +00:00','2025-11-20 15:18:45.752 +00:00','active','2025-10-21 15:18:50.470 +00:00','2025-10-21 15:18:50.470 +00:00','dc72ed6a-a8d9-470f-86b6-79835c88b33b'),('74d9f4c0-2473-4f85-b1f1-5c69c4bbbea8','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-1E05CF71','0c08fc9f-713f-4cad-a145-2392cc2c0b02','2025-10-21 15:18:50.470 +00:00','2025-11-20 15:18:45.752 +00:00','active','2025-10-21 15:18:50.470 +00:00','2025-10-21 15:18:50.470 +00:00','dc72ed6a-a8d9-470f-86b6-79835c88b33b'),('929c1d24-cdf4-452b-8f5d-157592c2e278','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-D980CE5A','aa3fb8bd-6204-428d-a02b-b3b9c50e88d4','2025-10-21 15:18:50.470 +00:00','2025-11-20 15:18:45.752 +00:00','active','2025-10-21 15:18:50.470 +00:00','2025-10-21 15:18:50.470 +00:00','dc72ed6a-a8d9-470f-86b6-79835c88b33b'),('6046d716-e22e-4179-afae-33516d4b9d5c','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-27A1EDC9','5c17ebf1-51db-4987-a358-d60711da7617','2025-10-21 15:18:50.470 +00:00','2025-11-20 15:18:45.752 +00:00','active','2025-10-21 15:18:50.470 +00:00','2025-10-21 15:18:50.470 +00:00','dc72ed6a-a8d9-470f-86b6-79835c88b33b'),('be312bd8-8053-4207-a9c6-490577ef6215','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-F23A5693','0c3affd4-31f5-419f-b560-646340c6b6e7','2025-10-21 15:18:50.470 +00:00','2025-11-20 15:18:45.752 +00:00','active','2025-10-21 15:18:50.470 +00:00','2025-10-21 15:18:50.470 +00:00','dc72ed6a-a8d9-470f-86b6-79835c88b33b'),('cb443038-814f-4f93-8359-e5d8ee939430','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-3F824E90','90c675d5-c5dc-462b-a68f-a10cfa96334c','2025-10-21 15:18:50.470 +00:00','2025-11-20 15:18:45.752 +00:00','active','2025-10-21 15:18:50.470 +00:00','2025-10-21 15:18:50.470 +00:00','dc72ed6a-a8d9-470f-86b6-79835c88b33b'),('d697ebcf-c92f-4e4f-a982-7962c83ae0fd','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-DA4BD84D','e4a34a27-16e4-4d0d-b872-f3023765fcdf','2025-10-21 15:18:50.470 +00:00','2025-11-20 15:18:45.752 +00:00','active','2025-10-21 15:18:50.470 +00:00','2025-10-21 15:18:50.470 +00:00','dc72ed6a-a8d9-470f-86b6-79835c88b33b'),('fbf58cff-5180-42c6-9415-0ff48ac83635','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-3AB7F8D2','03aa0613-a231-4c70-8532-139b3fc92a3e','2025-10-21 15:18:50.470 +00:00','2025-11-20 15:18:45.752 +00:00','active','2025-10-21 15:18:50.470 +00:00','2025-10-21 15:18:50.470 +00:00','dc72ed6a-a8d9-470f-86b6-79835c88b33b'),('56962229-0d20-4eec-bcd4-0076777eaf69','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-E81E5A4F','ec9b4596-8cbc-453f-ac47-f481efd3537c','2025-10-21 15:18:50.470 +00:00','2025-11-20 15:18:45.752 +00:00','active','2025-10-21 15:18:50.470 +00:00','2025-10-21 15:18:50.470 +00:00','dc72ed6a-a8d9-470f-86b6-79835c88b33b'),('ea0342a5-0bfd-4a97-bac7-e1baa758e99f','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-5AB34487','e19b17d9-a6c6-4acf-9be1-fe84e4ffcdaf','2025-10-21 15:18:50.470 +00:00','2025-11-20 15:18:45.752 +00:00','active','2025-10-21 15:18:50.470 +00:00','2025-10-21 15:18:50.470 +00:00','dc72ed6a-a8d9-470f-86b6-79835c88b33b'),('c9048e58-0634-403d-b01d-e262197c0b29','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-5F0A1519','5e4239d4-a711-47ff-b882-80164ba291eb','2025-10-21 15:18:50.470 +00:00','2025-11-20 15:18:45.752 +00:00','active','2025-10-21 15:18:50.470 +00:00','2025-10-21 15:18:50.470 +00:00','dc72ed6a-a8d9-470f-86b6-79835c88b33b'),('b708a963-21b2-4690-8128-c19695272722','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd',NULL,'CAMP-5D947FEA','9924658b-8675-4198-bf85-073ae60b7d6c','2025-10-21 15:18:50.470 +00:00','2025-11-20 15:18:45.752 +00:00','active','2025-10-21 15:18:50.470 +00:00','2025-10-21 15:18:50.470 +00:00','dc72ed6a-a8d9-470f-86b6-79835c88b33b') RETURNING "id","pesquisaId","tenantId","recompensaId","codigo","clienteId","dataGeracao","dataUtilizacao","dataValidade","status","ultimoContato","createdAt","updatedAt","campanhaId";`,
  parameters: {}
}
Executing (default): SELECT "id", "tenantId", "nome", "mensagem", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "messageDelaySeconds", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."id" = 'dc72ed6a-a8d9-470f-86b6-79835c88b33b' AND "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): UPDATE "campanhas" SET "status"=$1,"updatedAt"=$2 WHERE "id" = $3 AND "tenantId" = $4
Executing (default): SELECT "id", "tenantId", "nome", "mensagem", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "messageDelaySeconds", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."id" = 'dc72ed6a-a8d9-470f-86b6-79835c88b33b' AND "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: POST /api/auth/verify-token
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: GET /api/campanhas/dc72ed6a-a8d9-470f-86b6-79835c88b33b
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "tenantId", "nome", "mensagem", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "messageDelaySeconds", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."id" = 'dc72ed6a-a8d9-470f-86b6-79835c88b33b' AND "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: GET /api/campanhas/dc72ed6a-a8d9-470f-86b6-79835c88b33b
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "tenantId", "nome", "mensagem", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "messageDelaySeconds", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."id" = 'dc72ed6a-a8d9-470f-86b6-79835c88b33b' AND "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';