URL da solicitação
https://apivoltaki.towersfy.com/api/campanhas/a2961325-91c3-4f4c-8580-078e20fa68dd/logs
Método da solicitação
GET
Código de status
500 Internal Server Erro
{
    "status": "error",
    "code": "HTTP_500",
    "message": "campanhaId is not defined",
    "details": "ReferenceError: campanhaId is not defined\n    at CampanhaService.getCampaignLogs (/usr/src/app/src/services/campanhaService.js:326:16)\n    at CampanhaController.getLogs (/usr/src/app/src/controllers/campanhaController.js:153:42)\n    at /usr/src/app/src/routes/campanhaRoutes.js:26:64\n    at Layer.handle [as handle_request] (/usr/src/app/node_modules/express/lib/router/layer.js:95:5)\n    at next (/usr/src/app/node_modules/express/lib/router/route.js:149:13)\n    at Route.dispatch (/usr/src/app/node_modules/express/lib/router/route.js:119:3)\n    at Layer.handle [as handle_request] (/usr/src/app/node_modules/express/lib/router/layer.js:95:5)\n    at /usr/src/app/node_modules/express/lib/router/index.js:284:15\n    at param (/usr/src/app/node_modules/express/lib/router/index.js:365:14)\n    at param (/usr/src/app/node_modules/express/lib/router/index.js:376:14)"
}

URL da solicitação
https://apivoltaki.towersfy.com/api/campanhas/a2961325-91c3-4f4c-8580-078e20fa68dd/report
Método da solicitação
GET
Código de status
500 Internal Server Erro
{
    "status": "error",
    "code": "HTTP_500",
    "message": "campanhaId is not defined",
    "details": "ReferenceError: campanhaId is not defined\n    at CampanhaService.getAbTestResults (/usr/src/app/src/services/campanhaService.js:338:16)\n    at CampanhaService.getCampaignReport (/usr/src/app/src/services/campanhaService.js:387:38)\n    at CampanhaController.getCampaignReport (/usr/src/app/src/controllers/campanhaController.js:173:44)\n    at /usr/src/app/src/routes/campanhaRoutes.js:32:66\n    at Layer.handle [as handle_request] (/usr/src/app/node_modules/express/lib/router/layer.js:95:5)\n    at next (/usr/src/app/node_modules/express/lib/router/route.js:149:13)\n    at Route.dispatch (/usr/src/app/node_modules/express/lib/router/route.js:119:3)\n    at Layer.handle [as handle_request] (/usr/src/app/node_modules/express/lib/router/layer.js:95:5)\n    at /usr/src/app/node_modules/express/lib/router/index.js:284:15\n    at param (/usr/src/app/node_modules/express/lib/router/index.js:365:14)"
}

URL da solicitação
https://apivoltaki.towersfy.com/api/campanhas/a2961325-91c3-4f4c-8580-078e20fa68dd/test
Método da solicitação
POST
Código de status
500 Internal Server Error

{
    "status": "error",
    "code": "HTTP_500",
    "message": "spin is not a function",
    "details": "TypeError: spin is not a function\n    at CampanhaService._buildPersonalizedMessage (/usr/src/app/src/services/campanhaService.js:131:19)\n    at CampanhaService.sendTest (/usr/src/app/src/services/campanhaService.js:114:38)\n    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)\n    at async CampanhaController.sendTest (/usr/src/app/src/controllers/campanhaController.js:143:22)"
}


Postgres is up - executing command
Server.js is being executed!
Conexão com o banco de dados estabelecida com sucesso (Sequelize).
Server is running on port 5000
Agendador de relatório diário iniciado. A tarefa será executada todos os dias às 8:00.
Agendador de lembrete de cupons iniciado. A tarefa será executada todos os dias às 9:00.
Agendador de expiração de cupons iniciado. A tarefa será executada todo dia à meia-noite.
[SenderMonitorJob] Job de monitoramento de disparadores inicializado para rodar a cada 5 minutos.
[WarmingUpProgressJob] Job de progressão de aquecimento inicializado para rodar diariamente à 1h.
[CampaignMonitorJob] Job de monitoramento de campanhas inicializado para rodar a cada 10 minutos.
[CampanhaService] Inicializando campanhas agendadas...
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."status" = 'scheduled' AND "Campanha"."startDate" IS NOT NULL;
[CampanhaService] 0 campanhas reagendadas.
[Auth Middleware] Request: POST /api/auth/verify-token
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'd6b790f2-474f-442b-934b-731898c6c795';
[Auth Middleware] Request: GET /api/superadmin/senders
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'd6b790f2-474f-442b-934b-731898c6c795';
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" ORDER BY "WhatsappSender"."priority" ASC, "WhatsappSender"."name" ASC;
[WhatsappService] Error getting status for sender Disparador 2: Request failed with status code 404
[WhatsappService] Error getting status for sender Disparo 1: Request failed with status code 404
[Auth Middleware] Request: GET /api/superadmin/senders/ecf657e6-84ac-42e7-adb4-8fc19223049e/connect
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'd6b790f2-474f-442b-934b-731898c6c795';
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."id" = 'ecf657e6-84ac-42e7-adb4-8fc19223049e';
[WhatsappService] createSenderRemoteInstance: sender.apiUrl = https://evolution2.towersfy.com
[WhatsappService] Error creating remote instance for sender Disparo 1: Request failed with status code 400
AxiosError: Request failed with status code 400
    at settle (/usr/src/app/node_modules/axios/dist/node/axios.cjs:2097:12)
    at IncomingMessage.handleStreamEnd (/usr/src/app/node_modules/axios/dist/node/axios.cjs:3305:11)
    at IncomingMessage.emit (node:events:529:35)
    at endReadableNT (node:internal/streams/readable:1400:12)
    at process.processTicksAndRejections (node:internal/process/task_queues:82:21)
    at Axios.request (/usr/src/app/node_modules/axios/dist/node/axios.cjs:4483:41)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async createSenderRemoteInstance (/usr/src/app/src/services/whatsappService.js:442:5)
    at async Object.getSenderQrCodeForConnect (/usr/src/app/src/services/whatsappService.js:460:24)
    at async getQrCode (/usr/src/app/src/controllers/superadmin/senderController.js:56:26) {
  code: 'ERR_BAD_REQUEST',
  config: {
    transitional: {
      silentJSONParsing: true,
      forcedJSONParsing: true,
      clarifyTimeoutError: false
    },
    adapter: [ 'xhr', 'http', 'fetch' ],
    transformRequest: [ [Function: transformRequest] ],
    transformResponse: [ [Function: transformResponse] ],
    timeout: 0,
    xsrfCookieName: 'XSRF-TOKEN',
    xsrfHeaderName: 'X-XSRF-TOKEN',
    maxContentLength: -1,
    maxBodyLength: -1,
    env: { FormData: [Function [FormData]], Blob: [class Blob] },
    validateStatus: [Function: validateStatus],
    headers: Object [AxiosHeaders] {
      Accept: 'application/json, text/plain, */*',
      'Content-Type': 'application/json',
      apikey: '9df82dcbee60ce08f6ca93aa4024ca6c',
      'User-Agent': 'axios/1.12.2',
      'Content-Length': '196',
      'Accept-Encoding': 'gzip, compress, deflate, br'
    },
    method: 'post',
    url: 'https://evolution2.towersfy.com/instance/create',
    data: '{"instanceName":"disparador01","integration":"WHATSAPP-BAILEYS","webhook":"https://apivoltaki.towersfy.com/superadmin/senders/webhook","events":["QRCODE_UPDATED","CONNECTION_UPDATE"],"headers":{}}',
    allowAbsoluteUrls: true
  },
  request: <ref *1> ClientRequest {
    _events: [Object: null prototype] {
      abort: [Function (anonymous)],
      aborted: [Function (anonymous)],
      connect: [Function (anonymous)],
      error: [Function (anonymous)],
      socket: [Function (anonymous)],
      timeout: [Function (anonymous)],
      finish: [Function: requestOnFinish]
    },
    _eventsCount: 7,
    _maxListeners: undefined,
    outputData: [],
    outputSize: 0,
    writable: true,
    destroyed: false,
    _last: true,
    chunkedEncoding: false,
    shouldKeepAlive: false,
    maxRequestsOnConnectionReached: false,
    _defaultKeepAlive: true,
    useChunkedEncodingByDefault: true,
    sendDate: false,
    _removedConnection: false,
    _removedContLen: false,
    _removedTE: false,
    strictContentLength: false,
    _contentLength: '196',
    _hasBody: true,
    _trailer: '',
    finished: true,
    _headerSent: true,
    _closed: false,
    socket: TLSSocket {
      _tlsOptions: [Object],
      _secureEstablished: true,
      _securePending: false,
      _newSessionPending: false,
      _controlReleased: true,
      secureConnecting: false,
      _SNICallback: null,
      servername: 'evolution2.towersfy.com',
      alpnProtocol: false,
      authorized: true,
      authorizationError: null,
      encrypted: true,
      _events: [Object: null prototype],
      _eventsCount: 10,
      connecting: false,
      _hadError: false,
      _parent: null,
      _host: 'evolution2.towersfy.com',
      _closeAfterHandlingError: false,
      _readableState: [ReadableState],
      _maxListeners: undefined,
      _writableState: [WritableState],
      allowHalfOpen: false,
      _sockname: null,
      _pendingData: null,
      _pendingEncoding: '',
      server: undefined,
      _server: null,
      ssl: [TLSWrap],
      _requestCert: true,
      _rejectUnauthorized: true,
      parser: null,
      _httpMessage: [Circular *1],
      [Symbol(alpncallback)]: null,
      [Symbol(res)]: [TLSWrap],
      [Symbol(verified)]: true,
      [Symbol(pendingSession)]: null,
      [Symbol(async_id_symbol)]: 346,
      [Symbol(kHandle)]: [TLSWrap],
      [Symbol(lastWriteQueueSize)]: 0,
      [Symbol(timeout)]: null,
      [Symbol(kBuffer)]: null,
      [Symbol(kBufferCb)]: null,
      [Symbol(kBufferGen)]: null,
      [Symbol(kCapture)]: false,
      [Symbol(kSetNoDelay)]: false,
      [Symbol(kSetKeepAlive)]: true,
      [Symbol(kSetKeepAliveInitialDelay)]: 60,
      [Symbol(kBytesRead)]: 0,
      [Symbol(kBytesWritten)]: 0,
      [Symbol(connect-options)]: [Object]
    },
    _header: 'POST /instance/create HTTP/1.1\r\n' +
      'Accept: application/json, text/plain, */*\r\n' +
      'Content-Type: application/json\r\n' +
      'apikey: 9df82dcbee60ce08f6ca93aa4024ca6c\r\n' +
      'User-Agent: axios/1.12.2\r\n' +
      'Content-Length: 196\r\n' +
      'Accept-Encoding: gzip, compress, deflate, br\r\n' +
      'Host: evolution2.towersfy.com\r\n' +
      'Connection: close\r\n' +
      '\r\n',
    _keepAliveTimeout: 0,
    _onPendingData: [Function: nop],
    agent: Agent {
      _events: [Object: null prototype],
      _eventsCount: 2,
      _maxListeners: undefined,
      defaultPort: 443,
      protocol: 'https:',
      options: [Object: null prototype],
      requests: [Object: null prototype] {},
      sockets: [Object: null prototype],
      freeSockets: [Object: null prototype] {},
      keepAliveMsecs: 1000,
      keepAlive: false,
      maxSockets: Infinity,
      maxFreeSockets: 256,
      scheduling: 'lifo',
      maxTotalSockets: Infinity,
      totalSocketCount: 1,
      maxCachedSessions: 100,
      _sessionCache: [Object],
      [Symbol(kCapture)]: false
    },
    socketPath: undefined,
    method: 'POST',
    maxHeaderSize: undefined,
    insecureHTTPParser: undefined,
    joinDuplicateHeaders: undefined,
    path: '/instance/create',
    _ended: true,
    res: IncomingMessage {
      _readableState: [ReadableState],
      _events: [Object: null prototype],
      _eventsCount: 4,
      _maxListeners: undefined,
      socket: [TLSSocket],
      httpVersionMajor: 1,
      httpVersionMinor: 1,
      httpVersion: '1.1',
      complete: true,
      rawHeaders: [Array],
      rawTrailers: [],
      joinDuplicateHeaders: undefined,
      aborted: false,
      upgrade: false,
      url: '',
      method: null,
      statusCode: 400,
      statusMessage: 'Bad Request',
      client: [TLSSocket],
      _consuming: false,
      _dumped: false,
      req: [Circular *1],
      responseUrl: 'https://evolution2.towersfy.com/instance/create',
      redirects: [],
      [Symbol(kCapture)]: false,
      [Symbol(kHeaders)]: [Object],
      [Symbol(kHeadersCount)]: 16,
      [Symbol(kTrailers)]: null,
      [Symbol(kTrailersCount)]: 0
    },
    aborted: false,
    timeoutCb: null,
    upgradeOrConnect: false,
    parser: null,
    maxHeadersCount: null,
    reusedSocket: false,
    host: 'evolution2.towersfy.com',
    protocol: 'https:',
    _redirectable: Writable {
      _writableState: [WritableState],
      _events: [Object: null prototype],
      _eventsCount: 3,
      _maxListeners: undefined,
      _options: [Object],
      _ended: true,
      _ending: true,
      _redirectCount: 0,
      _redirects: [],
      _requestBodyLength: 196,
      _requestBodyBuffers: [],
      _onNativeResponse: [Function (anonymous)],
      _currentRequest: [Circular *1],
      _currentUrl: 'https://evolution2.towersfy.com/instance/create',
      [Symbol(kCapture)]: false
    },
    [Symbol(kCapture)]: false,
    [Symbol(kBytesWritten)]: 0,
    [Symbol(kNeedDrain)]: false,
    [Symbol(corked)]: 0,
    [Symbol(kOutHeaders)]: [Object: null prototype] {
      accept: [Array],
      'content-type': [Array],
      apikey: [Array],
      'user-agent': [Array],
      'content-length': [Array],
      'accept-encoding': [Array],
      host: [Array]
    },
    [Symbol(errored)]: null,
    [Symbol(kHighWaterMark)]: 16384,
    [Symbol(kRejectNonStandardBodyWrites)]: false,
    [Symbol(kUniqueHeaders)]: null
  },
  response: {
    status: 400,
    statusText: 'Bad Request',
    headers: Object [AxiosHeaders] {
      'access-control-allow-credentials': 'true',
      'content-length': '118',
      'content-type': 'application/json; charset=utf-8',
      date: 'Tue, 11 Nov 2025 14:37:43 GMT',
      etag: 'W/"76-CbTyULjIK3fn3Tp6Omq0MwEg8kk"',
      vary: 'Origin, Accept-Encoding',
      'x-powered-by': 'Express',
      connection: 'close'
    },
    config: {
      transitional: [Object],
      adapter: [Array],
      transformRequest: [Array],
      transformResponse: [Array],
      timeout: 0,
      xsrfCookieName: 'XSRF-TOKEN',
      xsrfHeaderName: 'X-XSRF-TOKEN',
      maxContentLength: -1,
      maxBodyLength: -1,
      env: [Object],
      validateStatus: [Function: validateStatus],
      headers: [Object [AxiosHeaders]],
      method: 'post',
      url: 'https://evolution2.towersfy.com/instance/create',
      data: '{"instanceName":"disparador01","integration":"WHATSAPP-BAILEYS","webhook":"https://apivoltaki.towersfy.com/superadmin/senders/webhook","events":["QRCODE_UPDATED","CONNECTION_UPDATE"],"headers":{}}',
      allowAbsoluteUrls: true
    },
    request: <ref *1> ClientRequest {
      _events: [Object: null prototype],
      _eventsCount: 7,
      _maxListeners: undefined,
      outputData: [],
      outputSize: 0,
      writable: true,
      destroyed: false,
      _last: true,
      chunkedEncoding: false,
      shouldKeepAlive: false,
      maxRequestsOnConnectionReached: false,
      _defaultKeepAlive: true,
      useChunkedEncodingByDefault: true,
      sendDate: false,
      _removedConnection: false,
      _removedContLen: false,
      _removedTE: false,
      strictContentLength: false,
      _contentLength: '196',
      _hasBody: true,
      _trailer: '',
      finished: true,
      _headerSent: true,
      _closed: false,
      socket: [TLSSocket],
      _header: 'POST /instance/create HTTP/1.1\r\n' +
        'Accept: application/json, text/plain, */*\r\n' +
        'Content-Type: application/json\r\n' +
        'apikey: 9df82dcbee60ce08f6ca93aa4024ca6c\r\n' +
        'User-Agent: axios/1.12.2\r\n' +
        'Content-Length: 196\r\n' +
        'Accept-Encoding: gzip, compress, deflate, br\r\n' +
        'Host: evolution2.towersfy.com\r\n' +
        'Connection: close\r\n' +
        '\r\n',
      _keepAliveTimeout: 0,
      _onPendingData: [Function: nop],
      agent: [Agent],
      socketPath: undefined,
      method: 'POST',
      maxHeaderSize: undefined,
      insecureHTTPParser: undefined,
      joinDuplicateHeaders: undefined,
      path: '/instance/create',
      _ended: true,
      res: [IncomingMessage],
      aborted: false,
      timeoutCb: null,
      upgradeOrConnect: false,
      parser: null,
      maxHeadersCount: null,
      reusedSocket: false,
      host: 'evolution2.towersfy.com',
      protocol: 'https:',
      _redirectable: [Writable],
      [Symbol(kCapture)]: false,
      [Symbol(kBytesWritten)]: 0,
      [Symbol(kNeedDrain)]: false,
      [Symbol(corked)]: 0,
      [Symbol(kOutHeaders)]: [Object: null prototype],
      [Symbol(errored)]: null,
      [Symbol(kHighWaterMark)]: 16384,
      [Symbol(kRejectNonStandardBodyWrites)]: false,
      [Symbol(kUniqueHeaders)]: null
    },
    data: { status: 400, error: 'Bad Request', response: [Object] }
  },
  status: 400
}
[Auth Middleware] Request: DELETE /api/superadmin/senders/ecf657e6-84ac-42e7-adb4-8fc19223049e
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'd6b790f2-474f-442b-934b-731898c6c795';
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."id" = 'ecf657e6-84ac-42e7-adb4-8fc19223049e';
[WhatsappService] deleteSenderInstance: sender.apiUrl = https://evolution2.towersfy.com
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."id" = 'ecf657e6-84ac-42e7-adb4-8fc19223049e';
Executing (default): DELETE FROM "WhatsappSenders" WHERE "id" = 'ecf657e6-84ac-42e7-adb4-8fc19223049e'
[Auth Middleware] Request: GET /api/superadmin/senders
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'd6b790f2-474f-442b-934b-731898c6c795';
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" ORDER BY "WhatsappSender"."priority" ASC, "WhatsappSender"."name" ASC;
[WhatsappService] Error getting status for sender Disparador 2: Request failed with status code 404
[Auth Middleware] Request: DELETE /api/superadmin/senders/887355cf-5d94-4cac-a810-a1cf00162cc8
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'd6b790f2-474f-442b-934b-731898c6c795';
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."id" = '887355cf-5d94-4cac-a810-a1cf00162cc8';
[WhatsappService] deleteSenderInstance: sender.apiUrl = https://evolution2.towersfy.com
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."id" = '887355cf-5d94-4cac-a810-a1cf00162cc8';
Executing (default): DELETE FROM "WhatsappSenders" WHERE "id" = '887355cf-5d94-4cac-a810-a1cf00162cc8'
[Auth Middleware] Request: GET /api/superadmin/senders
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'd6b790f2-474f-442b-934b-731898c6c795';
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" ORDER BY "WhatsappSender"."priority" ASC, "WhatsappSender"."name" ASC;
[Auth Middleware] Request: POST /api/superadmin/senders
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'd6b790f2-474f-442b-934b-731898c6c795';
Executing (default): INSERT INTO "WhatsappSenders" ("id","name","apiUrl","apiKey","instanceName","status","priority","dailyLimit","messagesSentToday","warmingUpDay","createdAt","updatedAt") VALUES ($1,$2,$3,$4,$5,$6,$7,$8,$9,$10,$11,$12) RETURNING "id","name","apiUrl","apiKey","instanceName","status","priority","dailyLimit","messagesSentToday","lastUsedAt","warmingUpDay","createdAt","updatedAt";
[WhatsappService] createSenderRemoteInstance: sender.apiUrl = https://evolution2.towersfy.com
[WhatsappService] Error creating remote instance for sender Disparador 1: Request failed with status code 401
AxiosError: Request failed with status code 401
    at settle (/usr/src/app/node_modules/axios/dist/node/axios.cjs:2097:12)
    at IncomingMessage.handleStreamEnd (/usr/src/app/node_modules/axios/dist/node/axios.cjs:3305:11)
    at IncomingMessage.emit (node:events:529:35)
    at endReadableNT (node:internal/streams/readable:1400:12)
    at process.processTicksAndRejections (node:internal/process/task_queues:82:21)
    at Axios.request (/usr/src/app/node_modules/axios/dist/node/axios.cjs:4483:41)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async Object.createSenderRemoteInstance (/usr/src/app/src/services/whatsappService.js:442:5)
    at async SenderService.createSender (/usr/src/app/src/services/superadmin/senderService.js:32:5)
    at async create (/usr/src/app/src/controllers/superadmin/senderController.js:26:25) {
  code: 'ERR_BAD_REQUEST',
  config: {
    transitional: {
      silentJSONParsing: true,
      forcedJSONParsing: true,
      clarifyTimeoutError: false
    },
    adapter: [ 'xhr', 'http', 'fetch' ],
    transformRequest: [ [Function: transformRequest] ],
    transformResponse: [ [Function: transformResponse] ],
    timeout: 0,
    xsrfCookieName: 'XSRF-TOKEN',
    xsrfHeaderName: 'X-XSRF-TOKEN',
    maxContentLength: -1,
    maxBodyLength: -1,
    env: { FormData: [Function [FormData]], Blob: [class Blob] },
    validateStatus: [Function: validateStatus],
    headers: Object [AxiosHeaders] {
      Accept: 'application/json, text/plain, */*',
      'Content-Type': 'application/json',
      apikey: 'aasadasasdasdasdas',
      'User-Agent': 'axios/1.12.2',
      'Content-Length': '188',
      'Accept-Encoding': 'gzip, compress, deflate, br'
    },
    method: 'post',
    url: 'https://evolution2.towersfy.com/instance/create',
    data: '{"instanceName":"api1","integration":"WHATSAPP-BAILEYS","webhook":"https://apivoltaki.towersfy.com/superadmin/senders/webhook","events":["QRCODE_UPDATED","CONNECTION_UPDATE"],"headers":{}}',
    allowAbsoluteUrls: true
  },
  request: <ref *1> ClientRequest {
    _events: [Object: null prototype] {
      abort: [Function (anonymous)],
      aborted: [Function (anonymous)],
      connect: [Function (anonymous)],
      error: [Function (anonymous)],
      socket: [Function (anonymous)],
      timeout: [Function (anonymous)],
      finish: [Function: requestOnFinish]
    },
    _eventsCount: 7,
    _maxListeners: undefined,
    outputData: [],
    outputSize: 0,
    writable: true,
    destroyed: false,
    _last: true,
    chunkedEncoding: false,
    shouldKeepAlive: false,
    maxRequestsOnConnectionReached: false,
    _defaultKeepAlive: true,
    useChunkedEncodingByDefault: true,
    sendDate: false,
    _removedConnection: false,
    _removedContLen: false,
    _removedTE: false,
    strictContentLength: false,
    _contentLength: '188',
    _hasBody: true,
    _trailer: '',
    finished: true,
    _headerSent: true,
    _closed: false,
    socket: TLSSocket {
      _tlsOptions: [Object],
      _secureEstablished: true,
      _securePending: false,
      _newSessionPending: false,
      _controlReleased: true,
      secureConnecting: false,
      _SNICallback: null,
      servername: 'evolution2.towersfy.com',
      alpnProtocol: false,
      authorized: true,
      authorizationError: null,
      encrypted: true,
      _events: [Object: null prototype],
      _eventsCount: 10,
      connecting: false,
      _hadError: false,
      _parent: null,
      _host: 'evolution2.towersfy.com',
      _closeAfterHandlingError: false,
      _readableState: [ReadableState],
      _maxListeners: undefined,
      _writableState: [WritableState],
      allowHalfOpen: false,
      _sockname: null,
      _pendingData: null,
      _pendingEncoding: '',
      server: undefined,
      _server: null,
      ssl: [TLSWrap],
      _requestCert: true,
      _rejectUnauthorized: true,
      parser: null,
      _httpMessage: [Circular *1],
      [Symbol(alpncallback)]: null,
      [Symbol(res)]: [TLSWrap],
      [Symbol(verified)]: true,
      [Symbol(pendingSession)]: null,
      [Symbol(async_id_symbol)]: 704,
      [Symbol(kHandle)]: [TLSWrap],
      [Symbol(lastWriteQueueSize)]: 0,
      [Symbol(timeout)]: null,
      [Symbol(kBuffer)]: null,
      [Symbol(kBufferCb)]: null,
      [Symbol(kBufferGen)]: null,
      [Symbol(kCapture)]: false,
      [Symbol(kSetNoDelay)]: false,
      [Symbol(kSetKeepAlive)]: true,
      [Symbol(kSetKeepAliveInitialDelay)]: 60,
      [Symbol(kBytesRead)]: 0,
      [Symbol(kBytesWritten)]: 0,
      [Symbol(connect-options)]: [Object]
    },
    _header: 'POST /instance/create HTTP/1.1\r\n' +
      'Accept: application/json, text/plain, */*\r\n' +
      'Content-Type: application/json\r\n' +
      'apikey: aasadasasdasdasdas\r\n' +
      'User-Agent: axios/1.12.2\r\n' +
      'Content-Length: 188\r\n' +
      'Accept-Encoding: gzip, compress, deflate, br\r\n' +
      'Host: evolution2.towersfy.com\r\n' +
      'Connection: close\r\n' +
      '\r\n',
    _keepAliveTimeout: 0,
    _onPendingData: [Function: nop],
    agent: Agent {
      _events: [Object: null prototype],
      _eventsCount: 2,
      _maxListeners: undefined,
      defaultPort: 443,
      protocol: 'https:',
      options: [Object: null prototype],
      requests: [Object: null prototype] {},
      sockets: [Object: null prototype],
      freeSockets: [Object: null prototype] {},
      keepAliveMsecs: 1000,
      keepAlive: false,
      maxSockets: Infinity,
      maxFreeSockets: 256,
      scheduling: 'lifo',
      maxTotalSockets: Infinity,
      totalSocketCount: 1,
      maxCachedSessions: 100,
      _sessionCache: [Object],
      [Symbol(kCapture)]: false
    },
    socketPath: undefined,
    method: 'POST',
    maxHeaderSize: undefined,
    insecureHTTPParser: undefined,
    joinDuplicateHeaders: undefined,
    path: '/instance/create',
    _ended: true,
    res: IncomingMessage {
      _readableState: [ReadableState],
      _events: [Object: null prototype],
      _eventsCount: 4,
      _maxListeners: undefined,
      socket: [TLSSocket],
      httpVersionMajor: 1,
      httpVersionMinor: 1,
      httpVersion: '1.1',
      complete: true,
      rawHeaders: [Array],
      rawTrailers: [],
      joinDuplicateHeaders: undefined,
      aborted: false,
      upgrade: false,
      url: '',
      method: null,
      statusCode: 401,
      statusMessage: 'Unauthorized',
      client: [TLSSocket],
      _consuming: false,
      _dumped: false,
      req: [Circular *1],
      responseUrl: 'https://evolution2.towersfy.com/instance/create',
      redirects: [],
      [Symbol(kCapture)]: false,
      [Symbol(kHeaders)]: [Object],
      [Symbol(kHeadersCount)]: 16,
      [Symbol(kTrailers)]: null,
      [Symbol(kTrailersCount)]: 0
    },
    aborted: false,
    timeoutCb: null,
    upgradeOrConnect: false,
    parser: null,
    maxHeadersCount: null,
    reusedSocket: false,
    host: 'evolution2.towersfy.com',
    protocol: 'https:',
    _redirectable: Writable {
      _writableState: [WritableState],
      _events: [Object: null prototype],
      _eventsCount: 3,
      _maxListeners: undefined,
      _options: [Object],
      _ended: true,
      _ending: true,
      _redirectCount: 0,
      _redirects: [],
      _requestBodyLength: 188,
      _requestBodyBuffers: [],
      _onNativeResponse: [Function (anonymous)],
      _currentRequest: [Circular *1],
      _currentUrl: 'https://evolution2.towersfy.com/instance/create',
      [Symbol(kCapture)]: false
    },
    [Symbol(kCapture)]: false,
    [Symbol(kBytesWritten)]: 0,
    [Symbol(kNeedDrain)]: false,
    [Symbol(corked)]: 0,
    [Symbol(kOutHeaders)]: [Object: null prototype] {
      accept: [Array],
      'content-type': [Array],
      apikey: [Array],
      'user-agent': [Array],
      'content-length': [Array],
      'accept-encoding': [Array],
      host: [Array]
    },
    [Symbol(errored)]: null,
    [Symbol(kHighWaterMark)]: 16384,
    [Symbol(kRejectNonStandardBodyWrites)]: false,
    [Symbol(kUniqueHeaders)]: null
  },
  response: {
    status: 401,
    statusText: 'Unauthorized',
    headers: Object [AxiosHeaders] {
      'access-control-allow-credentials': 'true',
      'content-length': '75',
      'content-type': 'application/json; charset=utf-8',
      date: 'Tue, 11 Nov 2025 14:38:26 GMT',
      etag: 'W/"4b-/cax6Lc/qf7t4ufEf8qFabwljtA"',
      vary: 'Origin, Accept-Encoding',
      'x-powered-by': 'Express',
      connection: 'close'
    },
    config: {
      transitional: [Object],
      adapter: [Array],
      transformRequest: [Array],
      transformResponse: [Array],
      timeout: 0,
      xsrfCookieName: 'XSRF-TOKEN',
      xsrfHeaderName: 'X-XSRF-TOKEN',
      maxContentLength: -1,
      maxBodyLength: -1,
      env: [Object],
      validateStatus: [Function: validateStatus],
      headers: [Object [AxiosHeaders]],
      method: 'post',
      url: 'https://evolution2.towersfy.com/instance/create',
      data: '{"instanceName":"api1","integration":"WHATSAPP-BAILEYS","webhook":"https://apivoltaki.towersfy.com/superadmin/senders/webhook","events":["QRCODE_UPDATED","CONNECTION_UPDATE"],"headers":{}}',
      allowAbsoluteUrls: true
    },
    request: <ref *1> ClientRequest {
      _events: [Object: null prototype],
      _eventsCount: 7,
      _maxListeners: undefined,
      outputData: [],
      outputSize: 0,
      writable: true,
      destroyed: false,
      _last: true,
      chunkedEncoding: false,
      shouldKeepAlive: false,
      maxRequestsOnConnectionReached: false,
      _defaultKeepAlive: true,
      useChunkedEncodingByDefault: true,
      sendDate: false,
      _removedConnection: false,
      _removedContLen: false,
      _removedTE: false,
      strictContentLength: false,
      _contentLength: '188',
      _hasBody: true,
      _trailer: '',
      finished: true,
      _headerSent: true,
      _closed: false,
      socket: [TLSSocket],
      _header: 'POST /instance/create HTTP/1.1\r\n' +
        'Accept: application/json, text/plain, */*\r\n' +
        'Content-Type: application/json\r\n' +
        'apikey: aasadasasdasdasdas\r\n' +
        'User-Agent: axios/1.12.2\r\n' +
        'Content-Length: 188\r\n' +
        'Accept-Encoding: gzip, compress, deflate, br\r\n' +
        'Host: evolution2.towersfy.com\r\n' +
        'Connection: close\r\n' +
        '\r\n',
      _keepAliveTimeout: 0,
      _onPendingData: [Function: nop],
      agent: [Agent],
      socketPath: undefined,
      method: 'POST',
      maxHeaderSize: undefined,
      insecureHTTPParser: undefined,
      joinDuplicateHeaders: undefined,
      path: '/instance/create',
      _ended: true,
      res: [IncomingMessage],
      aborted: false,
      timeoutCb: null,
      upgradeOrConnect: false,
      parser: null,
      maxHeadersCount: null,
      reusedSocket: false,
      host: 'evolution2.towersfy.com',
      protocol: 'https:',
      _redirectable: [Writable],
      [Symbol(kCapture)]: false,
      [Symbol(kBytesWritten)]: 0,
      [Symbol(kNeedDrain)]: false,
      [Symbol(corked)]: 0,
      [Symbol(kOutHeaders)]: [Object: null prototype],
      [Symbol(errored)]: null,
      [Symbol(kHighWaterMark)]: 16384,
      [Symbol(kRejectNonStandardBodyWrites)]: false,
      [Symbol(kUniqueHeaders)]: null
    },
    data: { status: 401, error: 'Unauthorized', response: [Object] }
  },
  status: 401
}
[Auth Middleware] Request: POST /api/auth/verify-token
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
[Auth Middleware] Request: GET /api/whatsapp-config/instance
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' LIMIT 1;
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' LIMIT 1;
[Auth Middleware] Request: POST /api/whatsapp-config/instance/create
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' LIMIT 1;
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "gmb_link", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): UPDATE "whatsapp_configs" SET "instanceName"=$1,"updatedAt"=$2 WHERE "id" = $3
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."id" = '49d77722-0c52-4972-8156-e39d424ed638';
Executing (default): UPDATE "whatsapp_configs" SET "instanceApiKey"=$1,"updatedAt"=$2 WHERE "id" = $3
Executing (default): UPDATE "whatsapp_configs" SET "instanceApiKey"=$1,"updatedAt"=$2 WHERE "id" = $3
[Auth Middleware] Request: GET /api/whatsapp-config/instance
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' LIMIT 1;
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' LIMIT 1;
Executing (default): UPDATE "whatsapp_configs" SET "instanceStatus"=$1,"updatedAt"=$2 WHERE "id" = $3
[Auth Middleware] Request: POST /api/whatsapp-config/instance/connect
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
[WhatsappService] Attempting to generate a new QR Code for tenant 3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd.
[WhatsappService] Logging out instance for tenant 3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd before generating new QR code.
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' LIMIT 1;
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' LIMIT 1;
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' LIMIT 1;
[WhatsappService] Fetching new QR code from API for instance roma-pizzaria--chopperiaaa.
[DEBUG] QR Code Response from Service: {
  pairingCode: null,
  code: '2@7ebw9Zyuh5+Bx0zVjNuKLnjbARupXGkDQJuZgB0WydimWFgyEiW8m4p9UEd/jCzcZECCnIeASmzVs1Ivr+qL2yfkToHD8s55KYc=,gDqaw9GPfoVbZYOmK9/uXsCCS80ZOk2mdiwfrvQ6zwU=,OlMHu4s8LcvFQtombiSumO/Vtzd1vaWUN7b81fjqdnA=,u8pwLp7V9h+i+UGBVQe5PuiDnR+ZN4Kmq3QoGc/wnAw=',
  base64: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAVwAAAFcCAYAAACEFgYsAAAjDUlEQVR4AezBwZEky65EydMhRQToAhUgCVQYXcZFTy8xGxdxyay4789A9c/ff1hrrfXrHtZaa73iYa211ise1lprveJhrbXWKx7WWmu94mGttdYrHtZaa73iYa211ise1lprveJhrbXWKx7WWmu94odLkc2brGKKbE6sYopsbljFjcjmhlWcRDYnVnES2fwmqziJbCarOIlsJqs4iWxuWMWbIpsbVnEjspms4psimxtWMUU2k1VMkc2JVXwisnmTVdx4WGut9YqHtdZar3hYa631ih8+ZBXfFNl8IrKZrOITkc1kFZNVTJHNZBVTZPNNkc1/KbKZrGKKbE6sYopsJqs4sYopsjmJbL7JKiarmCKbySqmyOa/FNmcWMUU2UyRzQ2rOIlsbljFiVV8U2TziYe11lqveFhrrfWKh7XWWq/44csimxtWccMqPhHZTFYxRTbfFNncsIopspkimxOrmCKbySqmyOYTVnFiFSeRzWQVNyKbySq+ySpOIpvJKiaruGEVNyKbG1bxCauYIpvJKqbI5sQqTqxiimw+EdncsIpvelhrrfWKh7XWWq94WGut9Yof/o+JbCarmCKbG5HNJyKbySpOIpvJKqbIZrKKk8hmimxOIpvJKn5TZDNZxWQVU2RzYhUnkc1kFb/JKk4im8kqbkQ23xTZ/KbI5sQqpsjm/08e1lprveJhrbXWKx7WWmu94of1/2IVJ5HNZBUnkc0NqziJbN4U2UxW8U2RzWQVU2TzichmsopPRDafiGwmq/iEVUyRzWQVJ5HNSWRzYhXfZBUnVvF/2cNaa61XPKy11nrFw1prrVf88GVW8abIZrKKG5HNFNlMVnES2UxWcSOymaxiimxOrOJGZPNNkc1kFSeRzQ2rmCKbySpuRDYnVnHDKm5ENieRzY3I5iSymaxisopPRDaTVUyRzYlVnEQ2k1V8wir+Sw9rrbVe8bDWWusVD2uttV7xw4cim/+SVUyRzWQVU2QzWcUU2dywiimymaxiimwmq5gim8kqpsjmJLKZrOJGZDNZxRTZTFYxRTaTVUyRzWQVU2QzWcUnrGKKbCarmCKbySpuRDaTVXzCKqbIZrKKKbKZrGKKbCarmCKbySqmyGayiimymaxiimxOIpvJKqbIZrKKk8jmf8nDWmutVzystdZ6xcNaa61X/HDJKv5LVjFFNp+IbD4R2UxWcSOyOYlsbljFjcjmE5HNJyKbT0Q2k1WcWMUU2XyTVXxTZHMS2Xwispms4sQqpsjmN0U2k1WcWMX/soe11lqveFhrrfWKh7XWWq/44ZdFNpNVnEQ2k1XcsIoTq5gim5PI5sQqTiKbySqmyOYTkc03WcWJVZxENlNkM1nFSWQzRTYnVjFFNpNVTJHNN0U2v8kqpsjmRmTzJqu4EdmcWMUnIpsbVjFFNidWceNhrbXWKx7WWmu94mGttdYrfrgU2UxWcSOyObGKKbKZrOIksjmxihOrOIlsbljFFNlMVjFFNjesYopsJquYIpvJKqbIZrKKKbL5RGQzWcVkFVNk84nIZrKKk8hmimwmq7gR2UxWMUU2/8sim8kqbkQ2n4hsbljFDas4sYopsvnEw1prrVc8rLXWesXDWmutV/zwocjmxCqmyOYkspms4sQqpshmsoopspms4iSyuRHZTFZxEtlMVnES2UyRzWQVU2TzichmsoqTyGayihuRzWQV3xTZTFZxYhUnkc1kFZNVnFjFSWTzTVZxwyqmyOYTVnES2ZxYxUlkcyOyObGKb3pYa631ioe11lqveFhrrfWKP3//4QORzWQVU2RzYhW/KbK5YRU3IpsTq/hEZDNZxUlkc8MqpsjmhlVMkc1vsoopsjmxipPIZrKKk8hmsoobkc1kFVNkM1nFSWTzm6ziN0U2k1WcRDY3rOIkspmsYopsJqv4xMNaa61XPKy11nrFw1prrVf88CGrOLGKG5HNZBVTZPObIpvJKk6s4iSymaxiimy+ySpOIpsTq5gim8kqPmEVU2RzYhVTZDNZxY3I5psim8kqpsjmmyKbG1YxRTYnVvGJyGayiimy+U1WcRLZ3LCKKbKZrOLGw1prrVc8rLXWesXDWmutV/zwyyKbySqmyGayiimyObGKKbKZrGKKbH5TZDNZxRTZfFNkc8MqPhHZfJNVTJHNiVXciGwmq7gR2dyIbCarOIls3mQVJ5HNiVVMkc1JZHMjsvmmyObEKt70sNZa6xUPa621XvGw1lrrFT/8MquYIpuTyObEKqbI5oZVTJHNZBW/ySqmyGayihtWMUU2k1XciGwmq5gim/9SZPOJyGayihtWMUU2NyKbySp+U2Rzwyo+YRUnkc2JVUyRzSesYopspsjmTQ9rrbVe8bDWWusVD2uttV7x5+8/fCCymazimyKbT1jFjcjmxCqmyObEKk4imxOrOIlsJqu4EdlMVjFFNjesYopsTqxiimy+ySqmyGayihuRzWQVJ5HNZBXfFNn8JquYIpvfZBVTZDNZxZsim8kqPvGw1lrrFQ9rrbVe8bDWWusVP/yyyObEKqbIZrKKKbK5EdlMVjFFNpNVfMIqTiKbySqmyGaKbG5ENidWMVnFFNmcWMUNqziJbCarmCKbE6s4iWxuRDaTVUxWMUU2k1XciGwmq5gimxOruBHZTFYxRTYnVnEjspmsYopsTqzimyKbySpuRDaTVdx4WGut9YqHtdZar3hYa631ij9//+EDkc0Nq5gim8kqpsjmxCpuRDZvsoqTyGayiimymaziE5HNiVVMkc2JVXwisjmxiimymaziE5HNZBWfiGwmq7gR2UxWcRLZTFYxRTY3rGKKbCarOIlsJquYIpsbVvGJyGayiimymaziNz2stdZ6xcNaa61XPKy11nrFn7//8IHI5sQqpshmsoopspms4psimxOrOIlsbljFb4psJqs4iWwmq7gR2ZxYxRTZfJNVfCKymaxiimw+YRVTZHPDKk4im09YxScimxtWMUU2J1ZxI7I5sYopsvkmq7jxsNZa6xUPa621XvGw1lrrFT9cimwmqziJbE4im8kqpshmsoopsvlNkc0nIpsTqziJbCar+E2RzQ2ruGEVU2RzYhUnkc2JVUxWcWIVJ5HNDauYIpuTyOYTVvFNkc1kFVNk85sim8kqJquYIpspsjmxipPIZrKKTzystdZ6xcNaa61XPKy11nrFn7//8IHIZrKKKbKZrOIkspms4kZkM1nFSWQzWcVJZHNiFZ+IbD5hFVNkM1nFJyKbySqmyOaGVZxENpNVTJHNZBVTZDNZxScim8kqTiKbySo+EdlMVnES2UxW8V+KbCarmCKbE6uYIpvJKqbI5oZV/KaHtdZar3hYa631ioe11lqv+PP3Hz4Q2ZxYxRTZTFbxmyKbE6uYIpvJKk4imxOrOIlsJqs4iWwmqziJbCar+ERk8wmrOIlsTqxiimwmqziJbCaruBHZnFjFFNl8k1VMkc3/EquYIpvJKqbI5jdZxRTZTFYxRTY3rOLGw1prrVc8rLXWesXDWmutV/z5+w+/KLL5hFWcRDYnVjFFNpNVTJHNZBU3IpvJKqbI5oZV3IhsJquYIpvJKqbI5sQqpshmsoopsrlhFVNkM1nFSWQzWcUU2bzJKqbI5sQqpsjmm6xiimwmq/hNkc1kFVNkM1nFjchmsoqTyOYTVnHjYa211ise1lprveJhrbXWK374ZVbxicjmE5HNSWQzWcUU2ZxYxWQVU2QzWcUU2UxWMUU2k1V8wiqmyObEKk6s4psim8kqTiKb32QVn4hsJqv4hFVMkc1kFVNkcyOymaxiimwmq5gimxOrmCKbySpOIpvJKiar+IRVTJHNZBWfeFhrrfWKh7XWWq94WGut9Yo/f//hiyKbySqmyOY3WcUnIpvJKj4R2dywiimy+b/EKqbIZrKKT0Q2J1YxRTYnVnEjsvkmq/hEZHNiFVNkc8MqbkQ2k1WcRDb/S6ziJLKZrOLGw1prrVc8rLXWesXDWmutV/xwKbKZrOIksjmxihuRzWQVU2QzWcUU2dyIbL7JKr7JKm5ENjes4iSy+U2RzSesYopsTiKbySpOrOJGZDNFNpNVnEQ2J1ZxYhUnkc0U2UxWMUU232QVU2RzYhU3IpvJKqbIZrKKb3pYa631ioe11lqveFhrrfWKHz4U2XxTZDNZxUlkM1nFN1nFFNlMVjFFNpNV3IhsJquYIpuTyGayihOrmCKbKbKZrGKyihuRzWQVJ1YxRTaTVUyRzYlVTJHNZBWfiGwmqzixipPI5kZk8wmrmCKbKbKZrGKKbE4im5PI5hORzWQVN6zixCo+8bDWWusVD2uttV7xsNZa6xU//DKrmCKbE6v4psjmE5HNZBUnVjFFNpNVnFjFJ6zim6ziE1ZxEtmcWMVkFVNkM1nFFNlMkc1kFd9kFZ+IbCarOIlsJqs4iWwmq5gim/8lVjFFNidW8U2RzWQVn3hYa631ioe11lqveFhrrfWKP3//4QORzYlVTJHNN1nFSWRzYhVTZDNZxRTZ3LCKKbKZrGKKbP5LVnES2UxWcRLZTFYxRTbfZBUnkc2JVUyRzZusYopsJqv4RGRzwypOIpvJKqbI5hNWMUU232QVU2RzYhWfeFhrrfWKh7XWWq94WGut9YofPmQVU2RzwypuRDafsIopsjmJbCarmCKbySpuRDYnVnEjsvlNVvFNVvGJyGaKbCarmKxiimw+YRU3IpvJKqbI5kZkc8MqpshmsoopsvmEVZxENpNVnFjFSWRzI7KZrOI3Pay11nrFw1prrVc8rLXWesUPlyKbE6uYIpsbkc2JVZxENieRzYlVfCKyObGKKbKZrGKKbE6s4sQqTiKbk8hmsoopspmsYrKKKbKZrGKKbN5kFSdWcSOymaxisoopsjmxihOrmCKbk8hmsopPWMVJZDNZxY3IZrKKG1ZxEtmcRDYnVnHjYa211ise1lprveJhrbXWK374kFVMkc0nrGKKbKbIZrKKN0U2k1WcRDYnVnFiFVNk84nIZrKKE6s4sYqTyGayihtWMUU2k1XciGy+ySomqziJbE6sYopsTqxisoqTyGaKbCarmKziJLKZrOIksjmJbD5hFVNkM1nFDauYIptPPKy11nrFw1prrVc8rLXWesUPl6zixCpOIpuTyGayiimymSKbySpuRDYnkc1kFTes4iSyObGKb7KKk8hmsoobkc1JZHNiFTcimxOrmKziRmQzWcVJZDNZxYlVnFjFFNmcRDYnVjFFNp+wihOrOIlsbkQ2N6xiimwmq3jTw1prrVc8rLXWesXDWmutV/xwKbI5sYoTq5gim8kqbljFFNlMVnFiFSdWMUU2k1VMkc1kFVNkM1nFN1nFFNlMVjFFNpNVnEQ2k1WcWMUU2UxWMUU2k1WcWMU3RTaTVXyTVUyRzWQVU2QzWcUU2UxWMUU2U2RzEtlMVjFFNjes4hNW8U1WMUU2J1YxWcUnHtZaa73iYa211ise1lprveKHXxbZ3IhsJquYrOLEKk4im8kqpsjmE1bxicjmxCpuWMUU2ZxENpNVTFYxRTYnkc1kFb8pspms4iSymaxiimwmq5gim8kqpsjmE1YxRTY3rGKKbCarmCKbKbL5RGQzWcWJVZxENpNV3IhsJquYIpuTyGayihsPa621XvGw1lrrFQ9rrbVe8cOHrOLEKqbIZrKKk8jmxCpOIpvJKqbIZrKKKbKZrGKKbE6s4oZVTJHNjchmsorJKk4imymyuWEV3xTZfFNk84nI5iSyObGKKbL5pshmsoobVjFFNidWMUU2J5HNZBVTZHNiFSeRzY3IZrKKE6v4xMNaa61XPKy11nrFw1prrVf8+fsPvyiy+SarOIlsJqs4iWwmq5gim8kqbkQ2N6ziN0U2J1ZxI7KZrOKbIpvJKqbIZrKKKbI5sYqTyGayihuRzWQVJ5HNZBUnkc03WcVJZDNZxScimxOrOIlsvskqpshmsopPPKy11nrFw1prrVc8rLXWesUPL7OKG5HNDauYIpvJKiarmCKbk8hmsoopspmsYopsJquYIpvJKk4imxOrmKziRmRzYhWfiGxOrGKKbCarmCKbG5HNiVVMkc1kFZ+IbH6TVUyRzWQVU2QzWcVJZHNiFb/JKk4im2+KbCaruPGw1lrrFQ9rrbVe8bDWWusVf/7+wwcim99kFVNkM1nFSWQzWcVJZDNZxUlkM1nFFNncsIopsjmxiimyuWEVJ5HNZBU3IpsbVjFFNpNVfCKyObGKT0Q2k1V8IrI5sYobkc1vsoqTyObEKm5ENt9kFb/pYa211ise1lprveJhrbXWK/78/YcLkc0nrGKKbCaruBHZnFjFSWQzWcUU2UxWcRLZnFjFSWQzWcVJZDNZxRTZTFbxmyKbySqmyGayiimymaziJLI5sYopsvlNVvGbIpsTqziJbE6s4iSymaziRmRzwyq+KbKZrOJGZDNZxY2HtdZar3hYa631ioe11lqv+OFDVjFFNjesYops3mQVU2RzEtlMVnFiFVNkM1nFZBVTZDNZxUlkM1nFJyKbySq+KbKZrOKbIpvJKqbI5sQqpshmsoopspms4iSymaxiimxOrOKGVZxENpNVnEQ2N6xiimw+EdncsIopspmsYopsvulhrbXWKx7WWmu94mGttdYrfvhlVnES2UxWMUU2J1YxRTYnkc1vsooTq/hfEtnciGxuRDYnVnEjsjmxiimyObGKKbI5sYoTqziJbCaruGEVU2QzWcUU2Xwispms4kZkc8Mqpshmsopvsoopspms4pse1lprveJhrbXWKx7WWmu94odLVnFiFSeRzWQVU2QzWcUU2dyIbE6sYopsJquYIptvimwmq/hNkc1kFd8U2UxWMUU2U2QzWcUNqzixiimy+abIZrKKE6u4YRVTZDNZxYlVnEQ2k1VMkc1JZDNZxQ2ruBHZfCKymaziJLI5sYobD2uttV7xsNZa6xUPa621XvHn7z98ILKZrGKKbCarmCKbySpOIpsTq5gim8kqpsjmhlVMkc2JVUyRzWQVU2QzWcVJZDNZxRTZ3LCKKbL5hFVMkc2JVUyRzQ2rmCKbG1YxRTafsIopspmsYopsPmEVJ5HNiVXciGxOrGKKbE6s4psim8kqPhHZTFZx42GttdYrHtZaa73iYa211iv+/P2HL4psJqs4iWxOrGKKbCarOIlsJqu4EdncsIopspmsYopsJquYIpsTq5gimxOrmCKbE6u4EdlMVjFFNpNVnEQ2k1WcRDY3rOJGZDNZxRTZ3LCK3xTZfMIqTiKbySo+EdlMVnES2bzJKj7xsNZa6xUPa621XvGw1lrrFT+8LLI5sYopspmsYopsbkQ2J1YxWcUU2UxWMUU2J5HNZBXfZBVTZHPDKqbIZrKKE6uYIptPWMUU2XzCKk4im2+yiimymSKbySpOIpsTqzixiimymaziE5HNZBUnkc1JZDNZxYlVTJHNZBX/pYe11lqveFhrrfWKh7XWWq/44VJk801WMUU2J5HNZBVTZHNiFSeRzWQVb4psJqu4EdlMVjFFNpNVTJHNZBUnkc0Nq7gR2UxWMUU2NyKbE6s4iWymyGayiimyObGKk8jmRmQzWcWJVUyRzYlVnFjFFNlMVnHDKk6s4kZkM1nFjchmsoobD2uttV7xsNZa6xUPa621XvHn7z9ciGwmq5gim8kqTiKbySpuRDaTVUyRzWQVNyKbySqmyGayipPI5sQqbkQ2N6ziJLKZrGKKbCarmCKbG1bxTZHNZBVTZDNZxUlkc2IVJ5HNDauYIpvJKk4im09YxRTZ3LCKT0Q2J1ZxEtlMVnES2UxWcRLZTFZx42GttdYrHtZaa73iYa211iv+/P2HL4ps/ktWMUU2n7CKT0Q2k1VMkc1/ySqmyOYTVnES2UxWcSOymaxiimwmq/hEZPMmq/hEZDNZxRTZnFjFjcjmxCqmyGayihuRzW+yiimyObGKGw9rrbVe8bDWWusVD2uttV7xw3/MKm5ENpNVTJHNJ6ziRmQzWcVkFVNkM1nFFNlMVjFFNpNV3IhsTqxiimw+Edl8k1VMkc1JZDNZxRTZfMIqbkQ2k1XciGxOrGKKbE6sYopsTqzixCpuRDaTVUyRzYlV3Ihs/ksPa621XvGw1lrrFQ9rrbVe8cOlyOY3RTaTVdywiimyuRHZTFZxYhUnkc1kFSdWMUU2NyKbySpOIpvJKk6s4iSyObGKKbK5YRUnVvFfimwmqziJbCar+CarmCKbG1bxichmsoopspkim09ENpNVnFjFFNmcWMUnHtZaa73iYa211ise1lprveKHD1nFFNlMVjFFNidW8U1WMUU2k1VMkc0nIptPRDaTVUyRzYlV3LCKG5HNZBU3IpvJKqbIZrKKKbK5EdncsIqTyObEKn6TVXxTZDNZxRTZfMIqpsjmxCqmyOaGVXzCKn7Tw1prrVc8rLXWesXDWmutV/z5+w8fiGz+l1jFFNn8l6zimyKbb7KKG5HNiVVMkc1kFSeRzWQVNyKbE6v4RGTzTVYxRTY3rOITkc1kFSeRzf+XWMVJZHNiFTce1lprveJhrbXWKx7WWmu94odLkc1kFZ+IbCarmCKbySqmyGaKbG5YxRTZTFbxTZHNZBU3rGKKbCarmCKbySqmyGayiimymazimyKbySpOIpsTq/imyOaGVdyIbD4R2fymyGayim+KbD5hFd8U2ZxYxSce1lprveJhrbXWKx7WWmu94s/ff/hAZHPDKqbI5sQqpsjmxCqmyOaGVUyRzQ2ruBHZnFjFFNlMVvGbIpvJKqbIZrKKG5HNJ6ziJLI5sYopsjmxipPI5sQqvimymazimyKbySqmyObEKr4pspms4hORzWQVU2RzYhU3HtZaa73iYa211ise1lprveLP33/4oshmsoopsjmxiimyObGKG5HNZBVTZHNiFVNkM1nFFNlMVjFFNpNVnEQ232QVU2QzWcWNyOaGVUyRzWQVU2QzWcWbIpvJKqbI5sQqTiKb/2VWcSOyObGKKbI5sYqTyGayiimymaziTQ9rrbVe8bDWWusVD2uttV7xw6XI5sQqpsjmxCqmyGayihuRzW+KbP4vsYqTyOYkspms4sQqbkQ2k1VMkc2NyObEKqbIZrKKE6uYIpsTq/iEVUyRzYlVTJHNZBVTZHNiFTcim8kqpshmimxOrOIkspms4kZkM1nFFNlMVvGJh7XWWq94WGut9YqHtdZar/jhyyKbySpOIpvJKqbIZrKK32QVU2RzYhUnVnFiFSeRzYlVfMIqpsjmE5HNZBXfZBVTZHMjspmsYopsbljFSWRzwyo+Edl8U2TzichmsoopsvmmyGayiskqpshmimxOIpvJKm48rLXWesXDWmutVzystdZ6xQ+XrGKKbG5ENpNVTJHNZBVTZHNiFVNkcxLZTFYxWcUU2dyIbD5hFSeRzWQVn7CKk8hmsorJKk4im8kqpsjmJLL5hFXcsIopsjmJbCar+ERkM1nFSWRzEtmcWMU3RTa/ySpOIpsbVnES2XziYa211ise1lprveJhrbXWK364FNl8wipOrGKKbD5hFVNkM1nFSWQzWcVJZPMJq5gim8kqbkQ2k1VMkc1kFb/JKqbI5sQqTiKbySqmyOYkspmsYopsJquYIpuTyGayiimymaziE1ZxEtmcRDY3rGKKbG5YxUlkM1nFFNlMVnFiFVNkc8MqPvGw1lrrFQ9rrbVe8bDWWusVP3yZVXwispmsYopsvimymaziJLI5sYopspms4iSymaxiimwmq7gR2UxWMUU2k1VMVjFFNpNVTJHNZBXfZBVTZHPDKk6sYopsTqziE5HNZBUnkc2JVZxYxRTZTFZxEtmcWMVJZDNZxWQVU2RzEtlMVjFFNieRzWQVU2QzWcWNh7XWWq94WGut9YqHtdZar/jhyyKbySqmyGayiskqTqxiimxOIpvJKqbIZopsTqziJLK5EdmcRD'... 3306 more characters,
  count: 2
}
[Auth Middleware] Request: GET /api/whatsapp-config/instance
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' LIMIT 1;
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' LIMIT 1;
[Auth Middleware] Request: GET /api/whatsapp-config/instance
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' LIMIT 1;
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' LIMIT 1;
Executing (default): UPDATE "whatsapp_configs" SET "instanceStatus"=$1,"updatedAt"=$2 WHERE "id" = $3
[Auth Middleware] Request: GET /api/campanhas?tenantId=3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[CAMPAIGN_MONITOR] Iniciando verificação de campanhas pausadas...
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."status" = 'paused';
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
[CAMPAIGN_MONITOR] Nenhuma campanha pausada encontrada.
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
[WhatsappService] Error getting status for sender Disparador 1: Request failed with status code 404
[Auth Middleware] Request: POST /api/campanhas/a2961325-91c3-4f4c-8580-078e20fa68dd/test
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
Executing (default): SELECT "Campanha"."id", "Campanha"."tenantId", "Campanha"."nome", "Campanha"."mensagens", "Campanha"."rewardType", "Campanha"."recompensaId", "Campanha"."roletaId", "Campanha"."dataValidade", "Campanha"."criterioSelecao", "Campanha"."status", "Campanha"."startDate", "Campanha"."endDate", "Campanha"."minMessageDelaySeconds", "Campanha"."maxMessageDelaySeconds", "Campanha"."mediaUrl", "Campanha"."createdAt", "Campanha"."updatedAt", "recompensa"."id" AS "recompensa.id", "recompensa"."tenantId" AS "recompensa.tenantId", "recompensa"."name" AS "recompensa.name", "recompensa"."description" AS "recompensa.description", "recompensa"."pointsRequired" AS "recompensa.pointsRequired", "recompensa"."type" AS "recompensa.type", "recompensa"."value" AS "recompensa.value", "recompensa"."imageUrl" AS "recompensa.imageUrl", "recompensa"."active" AS "recompensa.active", "recompensa"."createdAt" AS "recompensa.createdAt", "recompensa"."updatedAt" AS "recompensa.updatedAt" FROM "campanhas" AS "Campanha" LEFT OUTER JOIN "recompensas" AS "recompensa" ON "Campanha"."recompensaId" = "recompensa"."id" WHERE "Campanha"."id" = 'a2961325-91c3-4f4c-8580-078e20fa68dd' AND "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
TypeError: spin is not a function
    at CampanhaService._buildPersonalizedMessage (/usr/src/app/src/services/campanhaService.js:131:19)
    at CampanhaService.sendTest (/usr/src/app/src/services/campanhaService.js:114:38)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async CampanhaController.sendTest (/usr/src/app/src/controllers/campanhaController.js:143:22)
[Auth Middleware] Request: GET /api/campanhas/a2961325-91c3-4f4c-8580-078e20fa68dd
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
[Auth Middleware] Request: GET /api/campanhas/a2961325-91c3-4f4c-8580-078e20fa68dd/logs
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
[Auth Middleware] Request: GET /api/campanhas/a2961325-91c3-4f4c-8580-078e20fa68dd/report
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
Executing (default): SELECT "Campanha"."id", "Campanha"."tenantId", "Campanha"."nome", "Campanha"."mensagens", "Campanha"."rewardType", "Campanha"."recompensaId", "Campanha"."roletaId", "Campanha"."dataValidade", "Campanha"."criterioSelecao", "Campanha"."status", "Campanha"."startDate", "Campanha"."endDate", "Campanha"."minMessageDelaySeconds", "Campanha"."maxMessageDelaySeconds", "Campanha"."mediaUrl", "Campanha"."createdAt", "Campanha"."updatedAt", "recompensa"."id" AS "recompensa.id", "recompensa"."tenantId" AS "recompensa.tenantId", "recompensa"."name" AS "recompensa.name", "recompensa"."description" AS "recompensa.description", "recompensa"."pointsRequired" AS "recompensa.pointsRequired", "recompensa"."type" AS "recompensa.type", "recompensa"."value" AS "recompensa.value", "recompensa"."imageUrl" AS "recompensa.imageUrl", "recompensa"."active" AS "recompensa.active", "recompensa"."createdAt" AS "recompensa.createdAt", "recompensa"."updatedAt" AS "recompensa.updatedAt" FROM "campanhas" AS "Campanha" LEFT OUTER JOIN "recompensas" AS "recompensa" ON "Campanha"."recompensaId" = "recompensa"."id" WHERE "Campanha"."id" = 'a2961325-91c3-4f4c-8580-078e20fa68dd' AND "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
ReferenceError: campanhaId is not defined
    at CampanhaService.getCampaignLogs (/usr/src/app/src/services/campanhaService.js:326:16)
    at CampanhaController.getLogs (/usr/src/app/src/controllers/campanhaController.js:153:42)
    at /usr/src/app/src/routes/campanhaRoutes.js:26:64
    at Layer.handle [as handle_request] (/usr/src/app/node_modules/express/lib/router/layer.js:95:5)
    at next (/usr/src/app/node_modules/express/lib/router/route.js:149:13)
    at Route.dispatch (/usr/src/app/node_modules/express/lib/router/route.js:119:3)
    at Layer.handle [as handle_request] (/usr/src/app/node_modules/express/lib/router/layer.js:95:5)
    at /usr/src/app/node_modules/express/lib/router/index.js:284:15
    at param (/usr/src/app/node_modules/express/lib/router/index.js:365:14)
    at param (/usr/src/app/node_modules/express/lib/router/index.js:376:14)
ReferenceError: campanhaId is not defined
    at CampanhaService.getAbTestResults (/usr/src/app/src/services/campanhaService.js:338:16)
    at CampanhaService.getCampaignReport (/usr/src/app/src/services/campanhaService.js:387:38)
    at CampanhaController.getCampaignReport (/usr/src/app/src/controllers/campanhaController.js:173:44)
    at /usr/src/app/src/routes/campanhaRoutes.js:32:66
    at Layer.handle [as handle_request] (/usr/src/app/node_modules/express/lib/router/layer.js:95:5)
    at next (/usr/src/app/node_modules/express/lib/router/route.js:149:13)
    at Route.dispatch (/usr/src/app/node_modules/express/lib/router/route.js:119:3)
    at Layer.handle [as handle_request] (/usr/src/app/node_modules/express/lib/router/layer.js:95:5)
    at /usr/src/app/node_modules/express/lib/router/index.js:284:15
    at param (/usr/src/app/node_modules/express/lib/router/index.js:365:14)
[Auth Middleware] Request: GET /api/campanhas?tenantId=3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[WhatsappService] Error getting status for sender Disparador 1: Request failed with status code 404
[SENDER_MONITOR] Verificação de status concluída.
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[CAMPAIGN_MONITOR] Iniciando verificação de campanhas pausadas...
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."status" = 'paused';
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[CAMPAIGN_MONITOR] Nenhuma campanha pausada encontrada.
[SENDER_MONITOR] Verificação de status concluída.
[WhatsappService] Error getting status for sender Disparador 1: Request failed with status code 404
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
[WhatsappService] Error getting status for sender Disparador 1: Request failed with status code 404
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[CAMPAIGN_MONITOR] Iniciando verificação de campanhas pausadas...
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."status" = 'paused';
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[CAMPAIGN_MONITOR] Nenhuma campanha pausada encontrada.
[SENDER_MONITOR] Verificação de status concluída.
[WhatsappService] Error getting status for sender Disparador 1: Request failed with status code 404
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
[WhatsappService] Error getting status for sender Disparador 1: Request failed with status code 404
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[CAMPAIGN_MONITOR] Iniciando verificação de campanhas pausadas...
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."status" = 'paused';
[CAMPAIGN_MONITOR] Nenhuma campanha pausada encontrada.
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[WhatsappService] Error getting status for sender Disparador 1: Request failed with status code 404
[SENDER_MONITOR] Verificação de status concluída.
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
[WhatsappService] Error getting status for sender Disparador 1: Request failed with status code 404
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[CAMPAIGN_MONITOR] Iniciando verificação de campanhas pausadas...
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."status" = 'paused';
[CAMPAIGN_MONITOR] Nenhuma campanha pausada encontrada.
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[WhatsappService] Error getting status for sender Disparador 1: Request failed with status code 404
[SENDER_MONITOR] Verificação de status concluída.
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
[WhatsappService] Error getting status for sender Disparador 1: Request failed with status code 404
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[CAMPAIGN_MONITOR] Iniciando verificação de campanhas pausadas...
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."status" = 'paused';
[CAMPAIGN_MONITOR] Nenhuma campanha pausada encontrada.
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[WhatsappService] Error getting status for sender Disparador 1: Request failed with status code 404
[SENDER_MONITOR] Verificação de status concluída.
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
[WhatsappService] Error getting status for sender Disparador 1: Request failed with status code 404
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[CAMPAIGN_MONITOR] Iniciando verificação de campanhas pausadas...
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."status" = 'paused';
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[CAMPAIGN_MONITOR] Nenhuma campanha pausada encontrada.
[WhatsappService] Error getting status for sender Disparador 1: Request failed with status code 404
[SENDER_MONITOR] Verificação de status concluída.
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
[WhatsappService] Error getting status for sender Disparador 1: Request failed with status code 404
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[CAMPAIGN_MONITOR] Iniciando verificação de campanhas pausadas...
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."status" = 'paused';
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[CAMPAIGN_MONITOR] Nenhuma campanha pausada encontrada.
[SENDER_MONITOR] Verificação de status concluída.
[WhatsappService] Error getting status for sender Disparador 1: Request failed with status code 404
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[WhatsappService] Error getting status for sender Disparador 1: Request failed with status code 404
[SENDER_MONITOR] Verificação de status concluída.
[Auth Middleware] Request: GET /api/campanhas/5c5cf5e5-57ca-4be1-a47e-ccb2594fee3f/report
[Auth Middleware] Request: GET /api/campanhas/5c5cf5e5-57ca-4be1-a47e-ccb2594fee3f/logs
[Auth Middleware] Request: GET /api/campanhas/5c5cf5e5-57ca-4be1-a47e-ccb2594fee3f
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
ReferenceError: campanhaId is not defined
    at CampanhaService.getAbTestResults (/usr/src/app/src/services/campanhaService.js:338:16)
    at CampanhaService.getCampaignReport (/usr/src/app/src/services/campanhaService.js:387:38)
    at CampanhaController.getCampaignReport (/usr/src/app/src/controllers/campanhaController.js:173:44)
    at /usr/src/app/src/routes/campanhaRoutes.js:32:66
    at Layer.handle [as handle_request] (/usr/src/app/node_modules/express/lib/router/layer.js:95:5)
    at next (/usr/src/app/node_modules/express/lib/router/route.js:149:13)
    at Route.dispatch (/usr/src/app/node_modules/express/lib/router/route.js:119:3)
    at Layer.handle [as handle_request] (/usr/src/app/node_modules/express/lib/router/layer.js:95:5)
    at /usr/src/app/node_modules/express/lib/router/index.js:284:15
    at param (/usr/src/app/node_modules/express/lib/router/index.js:365:14)
Executing (default): SELECT "Campanha"."id", "Campanha"."tenantId", "Campanha"."nome", "Campanha"."mensagens", "Campanha"."rewardType", "Campanha"."recompensaId", "Campanha"."roletaId", "Campanha"."dataValidade", "Campanha"."criterioSelecao", "Campanha"."status", "Campanha"."startDate", "Campanha"."endDate", "Campanha"."minMessageDelaySeconds", "Campanha"."maxMessageDelaySeconds", "Campanha"."mediaUrl", "Campanha"."createdAt", "Campanha"."updatedAt", "recompensa"."id" AS "recompensa.id", "recompensa"."tenantId" AS "recompensa.tenantId", "recompensa"."name" AS "recompensa.name", "recompensa"."description" AS "recompensa.description", "recompensa"."pointsRequired" AS "recompensa.pointsRequired", "recompensa"."type" AS "recompensa.type", "recompensa"."value" AS "recompensa.value", "recompensa"."imageUrl" AS "recompensa.imageUrl", "recompensa"."active" AS "recompensa.active", "recompensa"."createdAt" AS "recompensa.createdAt", "recompensa"."updatedAt" AS "recompensa.updatedAt" FROM "campanhas" AS "Campanha" LEFT OUTER JOIN "recompensas" AS "recompensa" ON "Campanha"."recompensaId" = "recompensa"."id" WHERE "Campanha"."id" = '5c5cf5e5-57ca-4be1-a47e-ccb2594fee3f' AND "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
ReferenceError: campanhaId is not defined
    at CampanhaService.getCampaignLogs (/usr/src/app/src/services/campanhaService.js:326:16)
    at CampanhaController.getLogs (/usr/src/app/src/controllers/campanhaController.js:153:42)
    at /usr/src/app/src/routes/campanhaRoutes.js:26:64
    at Layer.handle [as handle_request] (/usr/src/app/node_modules/express/lib/router/layer.js:95:5)
    at next (/usr/src/app/node_modules/express/lib/router/route.js:149:13)
    at Route.dispatch (/usr/src/app/node_modules/express/lib/router/route.js:119:3)
    at Layer.handle [as handle_request] (/usr/src/app/node_modules/express/lib/router/layer.js:95:5)
    at /usr/src/app/node_modules/express/lib/router/index.js:284:15
    at param (/usr/src/app/node_modules/express/lib/router/index.js:365:14)
    at param (/usr/src/app/node_modules/express/lib/router/index.js:376:14)
[Auth Middleware] Request: GET /api/whatsapp-config/instance
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' LIMIT 1;
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' LIMIT 1;
[Auth Middleware] Request: GET /api/campanhas?tenantId=3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: POST /api/campanhas/2471eca5-5da6-4ec9-85b7-2ba434cbbdf5/test
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
Executing (default): SELECT "Campanha"."id", "Campanha"."tenantId", "Campanha"."nome", "Campanha"."mensagens", "Campanha"."rewardType", "Campanha"."recompensaId", "Campanha"."roletaId", "Campanha"."dataValidade", "Campanha"."criterioSelecao", "Campanha"."status", "Campanha"."startDate", "Campanha"."endDate", "Campanha"."minMessageDelaySeconds", "Campanha"."maxMessageDelaySeconds", "Campanha"."mediaUrl", "Campanha"."createdAt", "Campanha"."updatedAt", "recompensa"."id" AS "recompensa.id", "recompensa"."tenantId" AS "recompensa.tenantId", "recompensa"."name" AS "recompensa.name", "recompensa"."description" AS "recompensa.description", "recompensa"."pointsRequired" AS "recompensa.pointsRequired", "recompensa"."type" AS "recompensa.type", "recompensa"."value" AS "recompensa.value", "recompensa"."imageUrl" AS "recompensa.imageUrl", "recompensa"."active" AS "recompensa.active", "recompensa"."createdAt" AS "recompensa.createdAt", "recompensa"."updatedAt" AS "recompensa.updatedAt" FROM "campanhas" AS "Campanha" LEFT OUTER JOIN "recompensas" AS "recompensa" ON "Campanha"."recompensaId" = "recompensa"."id" WHERE "Campanha"."id" = '2471eca5-5da6-4ec9-85b7-2ba434cbbdf5' AND "Campanha"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
TypeError: spin is not a function
    at CampanhaService._buildPersonalizedMessage (/usr/src/app/src/services/campanhaService.js:131:19)
    at CampanhaService.sendTest (/usr/src/app/src/services/campanhaService.js:114:38)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async CampanhaController.sendTest (/usr/src/app/src/controllers/campanhaController.js:143:22)