Postgres is up - executing command
Server.js is being executed!
JWT Secret loaded: ********
JWT Secret length: 32
Conexão com o banco de dados estabelecida com sucesso (Sequelize).
Server is running on port 5000
Agendador de relatório diário iniciado. A tarefa será executada todos os dias às 8:00.
Agendador de relatório semanal iniciado. A tarefa será executada toda segunda-feira às 8:00.
Agendador de relatório mensal iniciado. A tarefa será executada todo dia 1º, às 8:00.
Agendador de lembrete de cupons iniciado. A tarefa será executada todos os dias às 9:00.
Agendador de automação de aniversário iniciado. A tarefa será executada todos os dias às 9:00.
Agendador de expiração de cupons iniciado. A tarefa será executada todo dia à meia-noite.
[SenderMonitorJob] Job de monitoramento de disparadores inicializado para rodar a cada 5 minutos.
[WarmingUpProgressJob] Job de progressão de aquecimento inicializado para rodar diariamente à 1h.
[CampaignMonitorJob] Job de monitoramento de campanhas inicializado para rodar a cada 10 minutos.
Agendador de processamento de premiações iniciado. A tarefa será executada todo dia às 2h.
[iFood Polling Job] Scheduling iFood polling to run every */5 * * * *
[CampanhaService] Inicializando campanhas agendadas...
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."status" = 'scheduled' AND "Campanha"."startDate" IS NOT NULL;
[CampanhaService] 0 campanhas reagendadas.
[Auth Middleware] Request: GET /api/surveys/stats
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'surveys' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT count(*) AS "count" FROM "pesquisas" AS "Pesquisa" WHERE "Pesquisa"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Pesquisa"."status" = 'active';
Executing (default): SELECT count(DISTINCT("respondentSessionId")) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."createdAt" >= '2026-01-01 00:00:00.000 +00:00';
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT count(*) AS "count" FROM "pesquisas" AS "Pesquisa" WHERE "Pesquisa"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Pesquisa"."status" = 'pending';
[Auth Middleware] Request: GET /api/surveys/list?status=all
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'surveys' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT "Pesquisa"."id", "Pesquisa"."title", "Pesquisa"."description", "Pesquisa"."createdAt", "Pesquisa"."dueDate", "Pesquisa"."status", "Pesquisa"."isOpen", "Pesquisa"."expectedRespondents", "Pesquisa"."askForAttendant", "Pesquisa"."tenantId", "perguntas"."id" AS "perguntas.id", "perguntas"."text" AS "perguntas.text", "perguntas"."type" AS "perguntas.type", "perguntas"."options" AS "perguntas.options", "perguntas"."order" AS "perguntas.order" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" WHERE "Pesquisa"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' ORDER BY "Pesquisa"."createdAt" DESC;
Executing (default): SELECT "pesquisaId", COUNT(DISTINCT("respondentSessionId")) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."pesquisaId" IN ('53d96820-1ea1-4c5b-b033-78ed0aa3e4d0', '87d63f62-4bb9-43e5-ab76-9eb004d4d2bb') GROUP BY "pesquisaId";
Executing (default): SELECT "Pesquisa"."id", "Pesquisa"."title", "Pesquisa"."description", "Pesquisa"."createdAt", "Pesquisa"."updatedAt", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."status", "Pesquisa"."recompensaId", "Pesquisa"."roletaId", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."text" AS "perguntas.text", "perguntas"."options" AS "perguntas.options", "perguntas"."order" AS "perguntas.order", "perguntas"."required" AS "perguntas.required", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."description" AS "tenant.description", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "roleta"."id" AS "roleta.id", "roleta"."nome" AS "roleta.nome", "roleta"."descricao" AS "roleta.descricao", "roleta"."active" AS "roleta.active" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" LEFT OUTER JOIN "tenants" AS "tenant" ON "Pesquisa"."tenantId" = "tenant"."id" LEFT OUTER JOIN "roletas" AS "roleta" ON "Pesquisa"."roletaId" = "roleta"."id" WHERE "Pesquisa"."id" = '87d63f62-4bb9-43e5-ab76-9eb004d4d2bb';
[Auth Middleware] Request: POST /api/auth/verify-token
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
Executing (default): SELECT "id", "name" FROM "atendentes" AS "Atendente" WHERE "Atendente"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Atendente"."status" = 'active' ORDER BY "Atendente"."name" ASC;
Executing (default): SELECT "askForAttendant" FROM "pesquisas" AS "Pesquisa" WHERE "Pesquisa"."id" = '87d63f62-4bb9-43e5-ab76-9eb004d4d2bb';
Executing (default): SELECT "Pesquisa"."id", "Pesquisa"."title", "Pesquisa"."description", "Pesquisa"."createdAt", "Pesquisa"."updatedAt", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."status", "Pesquisa"."recompensaId", "Pesquisa"."roletaId", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."text" AS "perguntas.text", "perguntas"."options" AS "perguntas.options", "perguntas"."order" AS "perguntas.order", "perguntas"."required" AS "perguntas.required", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."description" AS "tenant.description", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "roleta"."id" AS "roleta.id", "roleta"."nome" AS "roleta.nome", "roleta"."descricao" AS "roleta.descricao", "roleta"."active" AS "roleta.active" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" LEFT OUTER JOIN "tenants" AS "tenant" ON "Pesquisa"."tenantId" = "tenant"."id" LEFT OUTER JOIN "roletas" AS "roleta" ON "Pesquisa"."roletaId" = "roleta"."id" WHERE "Pesquisa"."id" = '87d63f62-4bb9-43e5-ab76-9eb004d4d2bb';
Executing (8f53be8f-73bd-4b41-bfab-f80f4d347b6f): SELECT "Pesquisa"."id", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."title", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."options" AS "perguntas.options", "perguntas"."required" AS "perguntas.required", "perguntas"."text" AS "perguntas.text" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" WHERE "Pesquisa"."id" = '87d63f62-4bb9-43e5-ab76-9eb004d4d2bb';
Executing (8f53be8f-73bd-4b41-bfab-f80f4d347b6f): INSERT INTO "respostas" ("id","perguntaId","pesquisaId","tenantId","atendenteId","respondentSessionId","ratingValue","textValue","createdAt","updatedAt") VALUES ('56eaaf85-dda6-40c2-9bf0-af4c2448de13','cc2c724c-3580-4f94-ab87-5822e4497770','87d63f62-4bb9-43e5-ab76-9eb004d4d2bb','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd','78b6809d-1ef3-4950-920c-ca4adfdbf114','1e6b174c-c5cb-47f0-a59e-8c7cd631402c',5,NULL,'2026-01-17 13:03:45.493 +00:00','2026-01-17 13:03:45.493 +00:00'),('8149f17d-1af9-4e9b-8bae-0cd2c85cc8bb','2ffb181f-141b-472d-9abd-3c51595c7f29','87d63f62-4bb9-43e5-ab76-9eb004d4d2bb','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd','78b6809d-1ef3-4950-920c-ca4adfdbf114','1e6b174c-c5cb-47f0-a59e-8c7cd631402c',5,NULL,'2026-01-17 13:03:45.493 +00:00','2026-01-17 13:03:45.493 +00:00'),('5f879d67-8f72-42c2-8f59-5608ef64a4ce','5f7acf91-90d6-44cd-963f-6f81effd5e1a','87d63f62-4bb9-43e5-ab76-9eb004d4d2bb','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd','78b6809d-1ef3-4950-920c-ca4adfdbf114','1e6b174c-c5cb-47f0-a59e-8c7cd631402c',5,NULL,'2026-01-17 13:03:45.493 +00:00','2026-01-17 13:03:45.493 +00:00'),('79cdd233-f372-48f2-86a3-093df0cc8b15','5e59c492-6d0c-41a4-ba3e-51e8310302ea','87d63f62-4bb9-43e5-ab76-9eb004d4d2bb','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd','78b6809d-1ef3-4950-920c-ca4adfdbf114','1e6b174c-c5cb-47f0-a59e-8c7cd631402c',NULL,'muito bom','2026-01-17 13:03:45.493 +00:00','2026-01-17 13:03:45.493 +00:00'),('ff00e13d-d806-469c-81d4-e67e0cb25986','d5938446-234d-40c3-967c-050cb336aa06','87d63f62-4bb9-43e5-ab76-9eb004d4d2bb','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd','78b6809d-1ef3-4950-920c-ca4adfdbf114','1e6b174c-c5cb-47f0-a59e-8c7cd631402c',10,NULL,'2026-01-17 13:03:45.493 +00:00','2026-01-17 13:03:45.493 +00:00') RETURNING "id","perguntaId","pesquisaId","tenantId","atendenteId","respondentSessionId","ratingValue","textValue","selectedOption","createdAt","updatedAt";
Executing (default): SELECT "gmb_link" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' LIMIT 1;
Executing (default): SELECT "Pesquisa"."id", "Pesquisa"."title", "Pesquisa"."description", "Pesquisa"."createdAt", "Pesquisa"."updatedAt", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."status", "Pesquisa"."recompensaId", "Pesquisa"."roletaId", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."text" AS "perguntas.text", "perguntas"."options" AS "perguntas.options", "perguntas"."order" AS "perguntas.order", "perguntas"."required" AS "perguntas.required", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."description" AS "tenant.description", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "roleta"."id" AS "roleta.id", "roleta"."nome" AS "roleta.nome", "roleta"."descricao" AS "roleta.descricao", "roleta"."active" AS "roleta.active" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" LEFT OUTER JOIN "tenants" AS "tenant" ON "Pesquisa"."tenantId" = "tenant"."id" LEFT OUTER JOIN "roletas" AS "roleta" ON "Pesquisa"."roletaId" = "roleta"."id" WHERE "Pesquisa"."id" = '87d63f62-4bb9-43e5-ab76-9eb004d4d2bb';
Executing (default): SELECT "id", "tenantId", "name", "email", "phone", "birthDate", "respondentSessionId", "gender", "createdAt", "updatedAt" FROM "clients" AS "Client" WHERE "Client"."phone" = '(35) 99837-4007' AND "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' LIMIT 1;
Executing (bf821232-f547-48ac-9458-9c9c47898a40): SELECT "Pesquisa"."id", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."title", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."options" AS "perguntas.options", "perguntas"."required" AS "perguntas.required", "perguntas"."text" AS "perguntas.text" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" WHERE "Pesquisa"."id" = '87d63f62-4bb9-43e5-ab76-9eb004d4d2bb';
Executing (bf821232-f547-48ac-9458-9c9c47898a40): INSERT INTO "respostas" ("id","perguntaId","pesquisaId","tenantId","atendenteId","respondentSessionId","ratingValue","textValue","createdAt","updatedAt") VALUES ('6bcad50c-bd46-4737-b3f0-268841e1d64f','cc2c724c-3580-4f94-ab87-5822e4497770','87d63f62-4bb9-43e5-ab76-9eb004d4d2bb','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd','78b6809d-1ef3-4950-920c-ca4adfdbf114','76027a89-f04f-48c8-a599-946060ce682b',5,NULL,'2026-01-17 13:03:48.711 +00:00','2026-01-17 13:03:48.711 +00:00'),('280530e7-738f-47cf-af1e-93ce09619cc6','2ffb181f-141b-472d-9abd-3c51595c7f29','87d63f62-4bb9-43e5-ab76-9eb004d4d2bb','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd','78b6809d-1ef3-4950-920c-ca4adfdbf114','76027a89-f04f-48c8-a599-946060ce682b',5,NULL,'2026-01-17 13:03:48.711 +00:00','2026-01-17 13:03:48.711 +00:00'),('82d6b003-a911-472d-9d06-41c2ab827492','5f7acf91-90d6-44cd-963f-6f81effd5e1a','87d63f62-4bb9-43e5-ab76-9eb004d4d2bb','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd','78b6809d-1ef3-4950-920c-ca4adfdbf114','76027a89-f04f-48c8-a599-946060ce682b',5,NULL,'2026-01-17 13:03:48.711 +00:00','2026-01-17 13:03:48.711 +00:00'),('9638e0cd-de71-45ae-acc4-c7886c3939cd','5e59c492-6d0c-41a4-ba3e-51e8310302ea','87d63f62-4bb9-43e5-ab76-9eb004d4d2bb','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd','78b6809d-1ef3-4950-920c-ca4adfdbf114','76027a89-f04f-48c8-a599-946060ce682b',NULL,'muito bom','2026-01-17 13:03:48.711 +00:00','2026-01-17 13:03:48.711 +00:00'),('a16fc620-9bb2-4c60-8c81-8877b25edd50','d5938446-234d-40c3-967c-050cb336aa06','87d63f62-4bb9-43e5-ab76-9eb004d4d2bb','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd','78b6809d-1ef3-4950-920c-ca4adfdbf114','76027a89-f04f-48c8-a599-946060ce682b',10,NULL,'2026-01-17 13:03:48.711 +00:00','2026-01-17 13:03:48.711 +00:00') RETURNING "id","perguntaId","pesquisaId","tenantId","atendenteId","respondentSessionId","ratingValue","textValue","selectedOption","createdAt","updatedAt";
Executing (default): SELECT "gmb_link" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' LIMIT 1;
Executing (default): SELECT "id", "tenantId", "name", "email", "phone", "birthDate", "respondentSessionId", "gender", "createdAt", "updatedAt" FROM "clients" AS "Client" WHERE "Client"."id" = '7809ef0d-14c0-47dd-bee2-09ebcc7c2150';
Executing (default): SELECT "id", "name", "logoUrl", "primaryColor", "secondaryColor", "description" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "Pesquisa"."id", "Pesquisa"."title", "Pesquisa"."description", "Pesquisa"."createdAt", "Pesquisa"."updatedAt", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."status", "Pesquisa"."recompensaId", "Pesquisa"."roletaId", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."text" AS "perguntas.text", "perguntas"."options" AS "perguntas.options", "perguntas"."order" AS "perguntas.order", "perguntas"."required" AS "perguntas.required", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."description" AS "tenant.description", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "roleta"."id" AS "roleta.id", "roleta"."nome" AS "roleta.nome", "roleta"."descricao" AS "roleta.descricao", "roleta"."active" AS "roleta.active" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" LEFT OUTER JOIN "tenants" AS "tenant" ON "Pesquisa"."tenantId" = "tenant"."id" LEFT OUTER JOIN "roletas" AS "roleta" ON "Pesquisa"."roletaId" = "roleta"."id" WHERE "Pesquisa"."id" = '87d63f62-4bb9-43e5-ab76-9eb004d4d2bb';
Executing (default): SELECT "id", "tenantId", "creatorId", "title", "description", "startDate", "endDate", "isOpen", "askForAttendant", "status", "expectedRespondents", "dueDate", "recompensaId", "roletaId", "createdAt", "updatedAt" FROM "pesquisas" AS "Pesquisa" WHERE "Pesquisa"."id" = '87d63f62-4bb9-43e5-ab76-9eb004d4d2bb';
Executing (default): SELECT "id", "pesquisaId", "campanhaId", "tenantId", "recompensaId", "codigo", "clienteId", "dataGeracao", "dataUtilizacao", "dataValidade", "status", "ultimoContato", "createdAt", "updatedAt" FROM "cupons" AS "Cupom" WHERE "Cupom"."clienteId" = '7809ef0d-14c0-47dd-bee2-09ebcc7c2150' AND "Cupom"."pesquisaId" = '87d63f62-4bb9-43e5-ab76-9eb004d4d2bb' ORDER BY "Cupom"."dataGeracao" DESC LIMIT 1;
Executing (default): SELECT "RoletaPremio"."id", "RoletaPremio"."tenantId", "RoletaPremio"."nome", "RoletaPremio"."descricao", "RoletaPremio"."porcentagem", "RoletaPremio"."cor", "RoletaPremio"."recompensaId", "RoletaPremio"."roletaId", "RoletaPremio"."imageUrl", "RoletaPremio"."active", "RoletaPremio"."isNoPrizeOption", "RoletaPremio"."createdAt", "RoletaPremio"."updatedAt", "recompensa"."id" AS "recompensa.id", "recompensa"."tenantId" AS "recompensa.tenantId", "recompensa"."name" AS "recompensa.name", "recompensa"."description" AS "recompensa.description", "recompensa"."pointsRequired" AS "recompensa.pointsRequired", "recompensa"."type" AS "recompensa.type", "recompensa"."value" AS "recompensa.value", "recompensa"."imageUrl" AS "recompensa.imageUrl", "recompensa"."active" AS "recompensa.active", "recompensa"."createdAt" AS "recompensa.createdAt", "recompensa"."updatedAt" AS "recompensa.updatedAt" FROM "roleta_premios" AS "RoletaPremio" LEFT OUTER JOIN "recompensas" AS "recompensa" ON "RoletaPremio"."recompensaId" = "recompensa"."id" WHERE "RoletaPremio"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "RoletaPremio"."roletaId" = 'f40e45de-fb16-477d-b385-85eb9d38304c' ORDER BY "RoletaPremio"."nome" ASC;
[Auth Middleware] Request: GET /api/dashboard/attendants-performance
[Auth Middleware] Request: GET /api/dashboard/attendant-responses-timeseries?period=day
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT "Atendente"."id", "Atendente"."tenantId", "Atendente"."name", "Atendente"."code", "Atendente"."status", "Atendente"."createdAt", "Atendente"."updatedAt", "meta"."id" AS "meta.id", "meta"."atendenteId" AS "meta.atendenteId", "meta"."tenantId" AS "meta.tenantId", "meta"."npsGoal" AS "meta.npsGoal", "meta"."responsesGoal" AS "meta.responsesGoal", "meta"."registrationsGoal" AS "meta.registrationsGoal", "meta"."period" AS "meta.period", "meta"."dias_trabalhados" AS "meta.dias_trabalhados", "meta"."nps_premio_valor" AS "meta.nps_premio_valor", "meta"."respostas_premio_valor" AS "meta.respostas_premio_valor", "meta"."cadastros_premio_valor" AS "meta.cadastros_premio_valor", "meta"."createdAt" AS "meta.createdAt", "meta"."updatedAt" AS "meta.updatedAt" FROM "atendentes" AS "Atendente" LEFT OUTER JOIN "atendente_metas" AS "meta" ON "Atendente"."id" = "meta"."atendenteId" WHERE "Atendente"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Atendente"."status" = 'active';
Executing (default): SELECT "Resposta"."atendenteId", date_trunc('day', "Resposta"."createdAt") AS "period", COUNT(DISTINCT("respondentSessionId")) AS "count", "atendente"."name" AS "atendente.name" FROM "respostas" AS "Resposta" INNER JOIN "atendentes" AS "atendente" ON "Resposta"."atendenteId" = "atendente"."id" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" IS NOT NULL GROUP BY "atendenteId", "atendente"."id", "period" ORDER BY "period" ASC;
Executing (default): SELECT "Resposta"."atendenteId", SUM(CASE WHEN "ratingValue" >= 9 THEN 1 ELSE 0 END) AS "promoters", SUM(CASE WHEN "ratingValue" <= 6 THEN 1 ELSE 0 END) AS "detractors", COUNT("Resposta"."id") AS "total" FROM "respostas" AS "Resposta" INNER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" AND "pergunta"."type" = 'rating_0_10' WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" IN ('f60c5a4d-1c9a-474c-89db-2abd95e8e06f', '49c162d2-fdde-448c-86f8-14b9c93be792', 'b13aa606-ae37-4d5b-8405-9610cbdffc25', 'ead2104c-7963-47ff-8336-852ad10d355f', '78b6809d-1ef3-4950-920c-ca4adfdbf114', '1c1b649b-a287-4430-84ba-3648a81a5001', '2a4fd6a3-c581-401d-ba65-9225b56cd850', '8b5efb23-f875-4ada-a3ae-e83e1f70e8cb', '2dbadb84-aafa-4c99-a50d-9b01d56ca921') AND "Resposta"."ratingValue" IS NOT NULL GROUP BY "atendenteId";
Executing (default): SELECT "atendenteId", COUNT(DISTINCT("respondentSessionId")) AS "surveyCount" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" IN ('f60c5a4d-1c9a-474c-89db-2abd95e8e06f', '49c162d2-fdde-448c-86f8-14b9c93be792', 'b13aa606-ae37-4d5b-8405-9610cbdffc25', 'ead2104c-7963-47ff-8336-852ad10d355f', '78b6809d-1ef3-4950-920c-ca4adfdbf114', '1c1b649b-a287-4430-84ba-3648a81a5001', '2a4fd6a3-c581-401d-ba65-9225b56cd850', '8b5efb23-f875-4ada-a3ae-e83e1f70e8cb', '2dbadb84-aafa-4c99-a50d-9b01d56ca921') GROUP BY "atendenteId";
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[iFood Polling Job] Starting iFood polling for all active tenants...
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt", "ifoodClientId", "ifoodClientSecret" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodClientId" IS NOT NULL AND "Tenant"."ifoodClientSecret" IS NOT NULL;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[iFood Polling Job] Finished iFood polling.
[SENDER_MONITOR] Verificação de status concluída.
[iFood Polling Job] Starting iFood polling for all active tenants...
[CAMPAIGN_MONITOR] Iniciando verificação de campanhas pausadas...
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt", "ifoodClientId", "ifoodClientSecret" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodClientId" IS NOT NULL AND "Tenant"."ifoodClientSecret" IS NOT NULL;
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."status" = 'paused';
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
[iFood Polling Job] Finished iFood polling.
[CAMPAIGN_MONITOR] Nenhuma campanha pausada encontrada.
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[iFood Polling Job] Starting iFood polling for all active tenants...
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt", "ifoodClientId", "ifoodClientSecret" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodClientId" IS NOT NULL AND "Tenant"."ifoodClientSecret" IS NOT NULL;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[iFood Polling Job] Finished iFood polling.
[SENDER_MONITOR] Verificação de status concluída.
[CAMPAIGN_MONITOR] Iniciando verificação de campanhas pausadas...
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[iFood Polling Job] Starting iFood polling for all active tenants...
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."status" = 'paused';
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt", "ifoodClientId", "ifoodClientSecret" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodClientId" IS NOT NULL AND "Tenant"."ifoodClientSecret" IS NOT NULL;
[CAMPAIGN_MONITOR] Nenhuma campanha pausada encontrada.
[iFood Polling Job] Finished iFood polling.
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
[Auth Middleware] Request: GET /api/atendentes
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = '77f853e9-deb2-4067-881e-71fa16d3054f';
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'atendentes' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT "id", "tenantId", "name", "code", "status", "createdAt", "updatedAt" FROM "atendentes" AS "Atendente" WHERE "Atendente"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' ORDER BY "Atendente"."name" ASC;
[Auth Middleware] Request: GET /api/dashboard/attendant-responses-timeseries?period=day
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = '77f853e9-deb2-4067-881e-71fa16d3054f';
[Auth Middleware] Request: GET /api/dashboard/attendants-performance
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = '77f853e9-deb2-4067-881e-71fa16d3054f';
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT "Resposta"."atendenteId", date_trunc('day', "Resposta"."createdAt") AS "period", COUNT(DISTINCT("respondentSessionId")) AS "count", "atendente"."name" AS "atendente.name" FROM "respostas" AS "Resposta" INNER JOIN "atendentes" AS "atendente" ON "Resposta"."atendenteId" = "atendente"."id" WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Resposta"."atendenteId" IS NOT NULL GROUP BY "atendenteId", "atendente"."id", "period" ORDER BY "period" ASC;
Executing (default): SELECT "Atendente"."id", "Atendente"."tenantId", "Atendente"."name", "Atendente"."code", "Atendente"."status", "Atendente"."createdAt", "Atendente"."updatedAt", "meta"."id" AS "meta.id", "meta"."atendenteId" AS "meta.atendenteId", "meta"."tenantId" AS "meta.tenantId", "meta"."npsGoal" AS "meta.npsGoal", "meta"."responsesGoal" AS "meta.responsesGoal", "meta"."registrationsGoal" AS "meta.registrationsGoal", "meta"."period" AS "meta.period", "meta"."dias_trabalhados" AS "meta.dias_trabalhados", "meta"."nps_premio_valor" AS "meta.nps_premio_valor", "meta"."respostas_premio_valor" AS "meta.respostas_premio_valor", "meta"."cadastros_premio_valor" AS "meta.cadastros_premio_valor", "meta"."createdAt" AS "meta.createdAt", "meta"."updatedAt" AS "meta.updatedAt" FROM "atendentes" AS "Atendente" LEFT OUTER JOIN "atendente_metas" AS "meta" ON "Atendente"."id" = "meta"."atendenteId" WHERE "Atendente"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Atendente"."status" = 'active';
Executing (default): SELECT "Resposta"."atendenteId", SUM(CASE WHEN "ratingValue" >= 9 THEN 1 ELSE 0 END) AS "promoters", SUM(CASE WHEN "ratingValue" <= 6 THEN 1 ELSE 0 END) AS "detractors", COUNT("Resposta"."id") AS "total" FROM "respostas" AS "Resposta" INNER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" AND "pergunta"."type" = 'rating_0_10' WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Resposta"."atendenteId" IN ('87ccfbbd-4e8c-41ec-afc9-b3e14aacfdb0', '67781806-855c-4e48-bf39-d1305176420a', '8ca6325c-8827-4cbf-982c-d734dcb66116', 'e1e57c66-5381-4734-a24c-ecddfa5d3d86', 'd1ec3ff8-81b0-4d89-9d7b-9da2f859fc07', '56d7b27f-9789-406c-b233-387395e14979', 'acdfd682-bf68-45d0-897a-84709d985ce9') AND "Resposta"."ratingValue" IS NOT NULL GROUP BY "atendenteId";
Executing (default): SELECT "atendenteId", COUNT(DISTINCT("respondentSessionId")) AS "surveyCount" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Resposta"."atendenteId" IN ('87ccfbbd-4e8c-41ec-afc9-b3e14aacfdb0', '67781806-855c-4e48-bf39-d1305176420a', '8ca6325c-8827-4cbf-982c-d734dcb66116', 'e1e57c66-5381-4734-a24c-ecddfa5d3d86', 'd1ec3ff8-81b0-4d89-9d7b-9da2f859fc07', '56d7b27f-9789-406c-b233-387395e14979', 'acdfd682-bf68-45d0-897a-84709d985ce9') GROUP BY "atendenteId";
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[iFood Polling Job] Starting iFood polling for all active tenants...
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt", "ifoodClientId", "ifoodClientSecret" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodClientId" IS NOT NULL AND "Tenant"."ifoodClientSecret" IS NOT NULL;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[iFood Polling Job] Finished iFood polling.
[SENDER_MONITOR] Verificação de status concluída.
[CAMPAIGN_MONITOR] Iniciando verificação de campanhas pausadas...
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[iFood Polling Job] Starting iFood polling for all active tenants...
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."status" = 'paused';
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt", "ifoodClientId", "ifoodClientSecret" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodClientId" IS NOT NULL AND "Tenant"."ifoodClientSecret" IS NOT NULL;
[CAMPAIGN_MONITOR] Nenhuma campanha pausada encontrada.
[iFood Polling Job] Finished iFood polling.
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
[iFood Polling Job] Starting iFood polling for all active tenants...
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt", "ifoodClientId", "ifoodClientSecret" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodClientId" IS NOT NULL AND "Tenant"."ifoodClientSecret" IS NOT NULL;
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
[iFood Polling Job] Finished iFood polling.
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
[Auth Middleware] Request: GET /api/dashboard/attendant-responses-timeseries?period=month
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = '77f853e9-deb2-4067-881e-71fa16d3054f';
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT "Resposta"."atendenteId", date_trunc('month', "Resposta"."createdAt") AS "period", COUNT(DISTINCT("respondentSessionId")) AS "count", "atendente"."name" AS "atendente.name" FROM "respostas" AS "Resposta" INNER JOIN "atendentes" AS "atendente" ON "Resposta"."atendenteId" = "atendente"."id" WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Resposta"."atendenteId" IS NOT NULL GROUP BY "atendenteId", "atendente"."id", "period" ORDER BY "period" ASC;
[Auth Middleware] Request: GET /api/atendentes
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = '77f853e9-deb2-4067-881e-71fa16d3054f';
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'atendentes' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT "id", "tenantId", "name", "code", "status", "createdAt", "updatedAt" FROM "atendentes" AS "Atendente" WHERE "Atendente"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' ORDER BY "Atendente"."name" ASC;
[Auth Middleware] Request: GET /api/dashboard/attendants-performance
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = '77f853e9-deb2-4067-881e-71fa16d3054f';
[Auth Middleware] Request: GET /api/dashboard/attendant-responses-timeseries?period=day
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = '77f853e9-deb2-4067-881e-71fa16d3054f';
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT "Atendente"."id", "Atendente"."tenantId", "Atendente"."name", "Atendente"."code", "Atendente"."status", "Atendente"."createdAt", "Atendente"."updatedAt", "meta"."id" AS "meta.id", "meta"."atendenteId" AS "meta.atendenteId", "meta"."tenantId" AS "meta.tenantId", "meta"."npsGoal" AS "meta.npsGoal", "meta"."responsesGoal" AS "meta.responsesGoal", "meta"."registrationsGoal" AS "meta.registrationsGoal", "meta"."period" AS "meta.period", "meta"."dias_trabalhados" AS "meta.dias_trabalhados", "meta"."nps_premio_valor" AS "meta.nps_premio_valor", "meta"."respostas_premio_valor" AS "meta.respostas_premio_valor", "meta"."cadastros_premio_valor" AS "meta.cadastros_premio_valor", "meta"."createdAt" AS "meta.createdAt", "meta"."updatedAt" AS "meta.updatedAt" FROM "atendentes" AS "Atendente" LEFT OUTER JOIN "atendente_metas" AS "meta" ON "Atendente"."id" = "meta"."atendenteId" WHERE "Atendente"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Atendente"."status" = 'active';
Executing (default): SELECT "Resposta"."atendenteId", date_trunc('day', "Resposta"."createdAt") AS "period", COUNT(DISTINCT("respondentSessionId")) AS "count", "atendente"."name" AS "atendente.name" FROM "respostas" AS "Resposta" INNER JOIN "atendentes" AS "atendente" ON "Resposta"."atendenteId" = "atendente"."id" WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Resposta"."atendenteId" IS NOT NULL GROUP BY "atendenteId", "atendente"."id", "period" ORDER BY "period" ASC;
Executing (default): SELECT "Resposta"."atendenteId", SUM(CASE WHEN "ratingValue" >= 9 THEN 1 ELSE 0 END) AS "promoters", SUM(CASE WHEN "ratingValue" <= 6 THEN 1 ELSE 0 END) AS "detractors", COUNT("Resposta"."id") AS "total" FROM "respostas" AS "Resposta" INNER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" AND "pergunta"."type" = 'rating_0_10' WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Resposta"."atendenteId" IN ('87ccfbbd-4e8c-41ec-afc9-b3e14aacfdb0', '67781806-855c-4e48-bf39-d1305176420a', '8ca6325c-8827-4cbf-982c-d734dcb66116', 'e1e57c66-5381-4734-a24c-ecddfa5d3d86', 'd1ec3ff8-81b0-4d89-9d7b-9da2f859fc07', '56d7b27f-9789-406c-b233-387395e14979', 'acdfd682-bf68-45d0-897a-84709d985ce9') AND "Resposta"."ratingValue" IS NOT NULL GROUP BY "atendenteId";
Executing (default): SELECT "atendenteId", COUNT(DISTINCT("respondentSessionId")) AS "surveyCount" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Resposta"."atendenteId" IN ('87ccfbbd-4e8c-41ec-afc9-b3e14aacfdb0', '67781806-855c-4e48-bf39-d1305176420a', '8ca6325c-8827-4cbf-982c-d734dcb66116', 'e1e57c66-5381-4734-a24c-ecddfa5d3d86', 'd1ec3ff8-81b0-4d89-9d7b-9da2f859fc07', '56d7b27f-9789-406c-b233-387395e14979', 'acdfd682-bf68-45d0-897a-84709d985ce9') GROUP BY "atendenteId";
[Auth Middleware] Request: GET /api/surveys/stats
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'surveys' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT count(*) AS "count" FROM "pesquisas" AS "Pesquisa" WHERE "Pesquisa"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Pesquisa"."status" = 'active';
Executing (default): SELECT count(DISTINCT("respondentSessionId")) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."createdAt" >= '2026-01-01 00:00:00.000 +00:00';
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT count(*) AS "count" FROM "pesquisas" AS "Pesquisa" WHERE "Pesquisa"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Pesquisa"."status" = 'pending';
[Auth Middleware] Request: GET /api/surveys/list?status=all
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'surveys' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT "Pesquisa"."id", "Pesquisa"."title", "Pesquisa"."description", "Pesquisa"."createdAt", "Pesquisa"."dueDate", "Pesquisa"."status", "Pesquisa"."isOpen", "Pesquisa"."expectedRespondents", "Pesquisa"."askForAttendant", "Pesquisa"."tenantId", "perguntas"."id" AS "perguntas.id", "perguntas"."text" AS "perguntas.text", "perguntas"."type" AS "perguntas.type", "perguntas"."options" AS "perguntas.options", "perguntas"."order" AS "perguntas.order" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" WHERE "Pesquisa"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' ORDER BY "Pesquisa"."createdAt" DESC;
Executing (default): SELECT "pesquisaId", COUNT(DISTINCT("respondentSessionId")) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."pesquisaId" IN ('53d96820-1ea1-4c5b-b033-78ed0aa3e4d0', '87d63f62-4bb9-43e5-ab76-9eb004d4d2bb') GROUP BY "pesquisaId";
Executing (default): SELECT "Pesquisa"."id", "Pesquisa"."title", "Pesquisa"."description", "Pesquisa"."createdAt", "Pesquisa"."updatedAt", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."status", "Pesquisa"."recompensaId", "Pesquisa"."roletaId", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."text" AS "perguntas.text", "perguntas"."options" AS "perguntas.options", "perguntas"."order" AS "perguntas.order", "perguntas"."required" AS "perguntas.required", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."description" AS "tenant.description", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "roleta"."id" AS "roleta.id", "roleta"."nome" AS "roleta.nome", "roleta"."descricao" AS "roleta.descricao", "roleta"."active" AS "roleta.active" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" LEFT OUTER JOIN "tenants" AS "tenant" ON "Pesquisa"."tenantId" = "tenant"."id" LEFT OUTER JOIN "roletas" AS "roleta" ON "Pesquisa"."roletaId" = "roleta"."id" WHERE "Pesquisa"."id" = '87d63f62-4bb9-43e5-ab76-9eb004d4d2bb';
[Auth Middleware] Request: POST /api/auth/verify-token
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
Executing (default): SELECT "id", "name" FROM "atendentes" AS "Atendente" WHERE "Atendente"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Atendente"."status" = 'active' ORDER BY "Atendente"."name" ASC;
Executing (default): SELECT "askForAttendant" FROM "pesquisas" AS "Pesquisa" WHERE "Pesquisa"."id" = '87d63f62-4bb9-43e5-ab76-9eb004d4d2bb';
Executing (default): SELECT "Pesquisa"."id", "Pesquisa"."title", "Pesquisa"."description", "Pesquisa"."createdAt", "Pesquisa"."updatedAt", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."status", "Pesquisa"."recompensaId", "Pesquisa"."roletaId", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."text" AS "perguntas.text", "perguntas"."options" AS "perguntas.options", "perguntas"."order" AS "perguntas.order", "perguntas"."required" AS "perguntas.required", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."description" AS "tenant.description", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "roleta"."id" AS "roleta.id", "roleta"."nome" AS "roleta.nome", "roleta"."descricao" AS "roleta.descricao", "roleta"."active" AS "roleta.active" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" LEFT OUTER JOIN "tenants" AS "tenant" ON "Pesquisa"."tenantId" = "tenant"."id" LEFT OUTER JOIN "roletas" AS "roleta" ON "Pesquisa"."roletaId" = "roleta"."id" WHERE "Pesquisa"."id" = '87d63f62-4bb9-43e5-ab76-9eb004d4d2bb';
Executing (21972b7d-6325-488f-8b7e-40b967bcc328): SELECT "Pesquisa"."id", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."title", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."options" AS "perguntas.options", "perguntas"."required" AS "perguntas.required", "perguntas"."text" AS "perguntas.text" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" WHERE "Pesquisa"."id" = '87d63f62-4bb9-43e5-ab76-9eb004d4d2bb';
Executing (21972b7d-6325-488f-8b7e-40b967bcc328): INSERT INTO "respostas" ("id","perguntaId","pesquisaId","tenantId","atendenteId","respondentSessionId","ratingValue","textValue","createdAt","updatedAt") VALUES ('638e7d54-1bb0-482d-8fbe-4910560517d2','cc2c724c-3580-4f94-ab87-5822e4497770','87d63f62-4bb9-43e5-ab76-9eb004d4d2bb','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd','ead2104c-7963-47ff-8336-852ad10d355f','8e72dd1e-e52c-4be4-87e6-ba6a2693a5eb',5,NULL,'2026-01-17 13:39:40.839 +00:00','2026-01-17 13:39:40.839 +00:00'),('89981c94-8e30-497b-ace2-8acde694b156','2ffb181f-141b-472d-9abd-3c51595c7f29','87d63f62-4bb9-43e5-ab76-9eb004d4d2bb','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd','ead2104c-7963-47ff-8336-852ad10d355f','8e72dd1e-e52c-4be4-87e6-ba6a2693a5eb',5,NULL,'2026-01-17 13:39:40.839 +00:00','2026-01-17 13:39:40.839 +00:00'),('132503a0-0af2-49a6-b42f-92adac3a7b1c','5f7acf91-90d6-44cd-963f-6f81effd5e1a','87d63f62-4bb9-43e5-ab76-9eb004d4d2bb','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd','ead2104c-7963-47ff-8336-852ad10d355f','8e72dd1e-e52c-4be4-87e6-ba6a2693a5eb',5,NULL,'2026-01-17 13:39:40.839 +00:00','2026-01-17 13:39:40.839 +00:00'),('438da9b0-2564-48d3-aba7-81cecc808ff8','d5938446-234d-40c3-967c-050cb336aa06','87d63f62-4bb9-43e5-ab76-9eb004d4d2bb','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd','ead2104c-7963-47ff-8336-852ad10d355f','8e72dd1e-e52c-4be4-87e6-ba6a2693a5eb',10,NULL,'2026-01-17 13:39:40.839 +00:00','2026-01-17 13:39:40.839 +00:00') RETURNING "id","perguntaId","pesquisaId","tenantId","atendenteId","respondentSessionId","ratingValue","textValue","selectedOption","createdAt","updatedAt";
Executing (default): SELECT "gmb_link" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' LIMIT 1;
Executing (default): SELECT "Pesquisa"."id", "Pesquisa"."title", "Pesquisa"."description", "Pesquisa"."createdAt", "Pesquisa"."updatedAt", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."status", "Pesquisa"."recompensaId", "Pesquisa"."roletaId", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."text" AS "perguntas.text", "perguntas"."options" AS "perguntas.options", "perguntas"."order" AS "perguntas.order", "perguntas"."required" AS "perguntas.required", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."description" AS "tenant.description", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "roleta"."id" AS "roleta.id", "roleta"."nome" AS "roleta.nome", "roleta"."descricao" AS "roleta.descricao", "roleta"."active" AS "roleta.active" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" LEFT OUTER JOIN "tenants" AS "tenant" ON "Pesquisa"."tenantId" = "tenant"."id" LEFT OUTER JOIN "roletas" AS "roleta" ON "Pesquisa"."roletaId" = "roleta"."id" WHERE "Pesquisa"."id" = '87d63f62-4bb9-43e5-ab76-9eb004d4d2bb';
Executing (default): SELECT "id", "tenantId", "name", "email", "phone", "birthDate", "respondentSessionId", "gender", "createdAt", "updatedAt" FROM "clients" AS "Client" WHERE "Client"."phone" = '(35) 99837-4007' AND "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' LIMIT 1;
Executing (858c8ca8-9421-432d-99bb-e26a3e36c7c9): SELECT "Pesquisa"."id", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."title", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."options" AS "perguntas.options", "perguntas"."required" AS "perguntas.required", "perguntas"."text" AS "perguntas.text" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" WHERE "Pesquisa"."id" = '87d63f62-4bb9-43e5-ab76-9eb004d4d2bb';
Executing (858c8ca8-9421-432d-99bb-e26a3e36c7c9): INSERT INTO "respostas" ("id","perguntaId","pesquisaId","tenantId","atendenteId","respondentSessionId","ratingValue","textValue","createdAt","updatedAt") VALUES ('f2eefe76-dc9e-4d11-b036-84855cc3d44f','cc2c724c-3580-4f94-ab87-5822e4497770','87d63f62-4bb9-43e5-ab76-9eb004d4d2bb','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd','ead2104c-7963-47ff-8336-852ad10d355f','76027a89-f04f-48c8-a599-946060ce682b',5,NULL,'2026-01-17 13:39:43.765 +00:00','2026-01-17 13:39:43.765 +00:00'),('4a9d1955-8ead-46f6-9b51-767a4c5ea053','2ffb181f-141b-472d-9abd-3c51595c7f29','87d63f62-4bb9-43e5-ab76-9eb004d4d2bb','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd','ead2104c-7963-47ff-8336-852ad10d355f','76027a89-f04f-48c8-a599-946060ce682b',5,NULL,'2026-01-17 13:39:43.765 +00:00','2026-01-17 13:39:43.765 +00:00'),('455f5ead-37c4-4f6c-ab73-96b3d4904923','5f7acf91-90d6-44cd-963f-6f81effd5e1a','87d63f62-4bb9-43e5-ab76-9eb004d4d2bb','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd','ead2104c-7963-47ff-8336-852ad10d355f','76027a89-f04f-48c8-a599-946060ce682b',5,NULL,'2026-01-17 13:39:43.765 +00:00','2026-01-17 13:39:43.765 +00:00'),('c4c1fbe0-b40a-4051-801b-12fec9e7c35a','d5938446-234d-40c3-967c-050cb336aa06','87d63f62-4bb9-43e5-ab76-9eb004d4d2bb','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd','ead2104c-7963-47ff-8336-852ad10d355f','76027a89-f04f-48c8-a599-946060ce682b',10,NULL,'2026-01-17 13:39:43.765 +00:00','2026-01-17 13:39:43.765 +00:00') RETURNING "id","perguntaId","pesquisaId","tenantId","atendenteId","respondentSessionId","ratingValue","textValue","selectedOption","createdAt","updatedAt";
Executing (default): SELECT "gmb_link" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' LIMIT 1;
Executing (default): SELECT "id", "tenantId", "name", "email", "phone", "birthDate", "respondentSessionId", "gender", "createdAt", "updatedAt" FROM "clients" AS "Client" WHERE "Client"."id" = '7809ef0d-14c0-47dd-bee2-09ebcc7c2150';
Executing (default): SELECT "Pesquisa"."id", "Pesquisa"."title", "Pesquisa"."description", "Pesquisa"."createdAt", "Pesquisa"."updatedAt", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."status", "Pesquisa"."recompensaId", "Pesquisa"."roletaId", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."text" AS "perguntas.text", "perguntas"."options" AS "perguntas.options", "perguntas"."order" AS "perguntas.order", "perguntas"."required" AS "perguntas.required", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."description" AS "tenant.description", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "roleta"."id" AS "roleta.id", "roleta"."nome" AS "roleta.nome", "roleta"."descricao" AS "roleta.descricao", "roleta"."active" AS "roleta.active" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" LEFT OUTER JOIN "tenants" AS "tenant" ON "Pesquisa"."tenantId" = "tenant"."id" LEFT OUTER JOIN "roletas" AS "roleta" ON "Pesquisa"."roletaId" = "roleta"."id" WHERE "Pesquisa"."id" = '87d63f62-4bb9-43e5-ab76-9eb004d4d2bb';
Executing (default): SELECT "id", "name", "logoUrl", "primaryColor", "secondaryColor", "description" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "tenantId", "creatorId", "title", "description", "startDate", "endDate", "isOpen", "askForAttendant", "status", "expectedRespondents", "dueDate", "recompensaId", "roletaId", "createdAt", "updatedAt" FROM "pesquisas" AS "Pesquisa" WHERE "Pesquisa"."id" = '87d63f62-4bb9-43e5-ab76-9eb004d4d2bb';
Executing (default): SELECT "id", "pesquisaId", "campanhaId", "tenantId", "recompensaId", "codigo", "clienteId", "dataGeracao", "dataUtilizacao", "dataValidade", "status", "ultimoContato", "createdAt", "updatedAt" FROM "cupons" AS "Cupom" WHERE "Cupom"."clienteId" = '7809ef0d-14c0-47dd-bee2-09ebcc7c2150' AND "Cupom"."pesquisaId" = '87d63f62-4bb9-43e5-ab76-9eb004d4d2bb' ORDER BY "Cupom"."dataGeracao" DESC LIMIT 1;
Executing (default): SELECT "RoletaPremio"."id", "RoletaPremio"."tenantId", "RoletaPremio"."nome", "RoletaPremio"."descricao", "RoletaPremio"."porcentagem", "RoletaPremio"."cor", "RoletaPremio"."recompensaId", "RoletaPremio"."roletaId", "RoletaPremio"."imageUrl", "RoletaPremio"."active", "RoletaPremio"."isNoPrizeOption", "RoletaPremio"."createdAt", "RoletaPremio"."updatedAt", "recompensa"."id" AS "recompensa.id", "recompensa"."tenantId" AS "recompensa.tenantId", "recompensa"."name" AS "recompensa.name", "recompensa"."description" AS "recompensa.description", "recompensa"."pointsRequired" AS "recompensa.pointsRequired", "recompensa"."type" AS "recompensa.type", "recompensa"."value" AS "recompensa.value", "recompensa"."imageUrl" AS "recompensa.imageUrl", "recompensa"."active" AS "recompensa.active", "recompensa"."createdAt" AS "recompensa.createdAt", "recompensa"."updatedAt" AS "recompensa.updatedAt" FROM "roleta_premios" AS "RoletaPremio" LEFT OUTER JOIN "recompensas" AS "recompensa" ON "RoletaPremio"."recompensaId" = "recompensa"."id" WHERE "RoletaPremio"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "RoletaPremio"."roletaId" = 'f40e45de-fb16-477d-b385-85eb9d38304c' ORDER BY "RoletaPremio"."nome" ASC;
[Auth Middleware] Request: GET /api/atendentes
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'atendentes' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT "id", "tenantId", "name", "code", "status", "createdAt", "updatedAt" FROM "atendentes" AS "Atendente" WHERE "Atendente"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' ORDER BY "Atendente"."name" ASC;
[Auth Middleware] Request: GET /api/dashboard/attendant-responses-timeseries?period=day
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
[Auth Middleware] Request: GET /api/dashboard/attendants-performance
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT "Resposta"."atendenteId", date_trunc('day', "Resposta"."createdAt") AS "period", COUNT(DISTINCT("respondentSessionId")) AS "count", "atendente"."name" AS "atendente.name" FROM "respostas" AS "Resposta" INNER JOIN "atendentes" AS "atendente" ON "Resposta"."atendenteId" = "atendente"."id" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" IS NOT NULL GROUP BY "atendenteId", "atendente"."id", "period" ORDER BY "period" ASC;
Executing (default): SELECT "Atendente"."id", "Atendente"."tenantId", "Atendente"."name", "Atendente"."code", "Atendente"."status", "Atendente"."createdAt", "Atendente"."updatedAt", "meta"."id" AS "meta.id", "meta"."atendenteId" AS "meta.atendenteId", "meta"."tenantId" AS "meta.tenantId", "meta"."npsGoal" AS "meta.npsGoal", "meta"."responsesGoal" AS "meta.responsesGoal", "meta"."registrationsGoal" AS "meta.registrationsGoal", "meta"."period" AS "meta.period", "meta"."dias_trabalhados" AS "meta.dias_trabalhados", "meta"."nps_premio_valor" AS "meta.nps_premio_valor", "meta"."respostas_premio_valor" AS "meta.respostas_premio_valor", "meta"."cadastros_premio_valor" AS "meta.cadastros_premio_valor", "meta"."createdAt" AS "meta.createdAt", "meta"."updatedAt" AS "meta.updatedAt" FROM "atendentes" AS "Atendente" LEFT OUTER JOIN "atendente_metas" AS "meta" ON "Atendente"."id" = "meta"."atendenteId" WHERE "Atendente"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Atendente"."status" = 'active';
Executing (default): SELECT "Resposta"."atendenteId", SUM(CASE WHEN "ratingValue" >= 9 THEN 1 ELSE 0 END) AS "promoters", SUM(CASE WHEN "ratingValue" <= 6 THEN 1 ELSE 0 END) AS "detractors", COUNT("Resposta"."id") AS "total" FROM "respostas" AS "Resposta" INNER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" AND "pergunta"."type" = 'rating_0_10' WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" IN ('f60c5a4d-1c9a-474c-89db-2abd95e8e06f', '49c162d2-fdde-448c-86f8-14b9c93be792', 'b13aa606-ae37-4d5b-8405-9610cbdffc25', 'ead2104c-7963-47ff-8336-852ad10d355f', '78b6809d-1ef3-4950-920c-ca4adfdbf114', '1c1b649b-a287-4430-84ba-3648a81a5001', '2a4fd6a3-c581-401d-ba65-9225b56cd850', '8b5efb23-f875-4ada-a3ae-e83e1f70e8cb', '2dbadb84-aafa-4c99-a50d-9b01d56ca921') AND "Resposta"."ratingValue" IS NOT NULL GROUP BY "atendenteId";
Executing (default): SELECT "atendenteId", COUNT(DISTINCT("respondentSessionId")) AS "surveyCount" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" IN ('f60c5a4d-1c9a-474c-89db-2abd95e8e06f', '49c162d2-fdde-448c-86f8-14b9c93be792', 'b13aa606-ae37-4d5b-8405-9610cbdffc25', 'ead2104c-7963-47ff-8336-852ad10d355f', '78b6809d-1ef3-4950-920c-ca4adfdbf114', '1c1b649b-a287-4430-84ba-3648a81a5001', '2a4fd6a3-c581-401d-ba65-9225b56cd850', '8b5efb23-f875-4ada-a3ae-e83e1f70e8cb', '2dbadb84-aafa-4c99-a50d-9b01d56ca921') GROUP BY "atendenteId";
[iFood Polling Job] Starting iFood polling for all active tenants...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt", "ifoodClientId", "ifoodClientSecret" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodClientId" IS NOT NULL AND "Tenant"."ifoodClientSecret" IS NOT NULL;
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
[CAMPAIGN_MONITOR] Iniciando verificação de campanhas pausadas...
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."status" = 'paused';
[iFood Polling Job] Finished iFood polling.
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[CAMPAIGN_MONITOR] Nenhuma campanha pausada encontrada.
[SENDER_MONITOR] Verificação de status concluída.