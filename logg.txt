Postgres is up - executing command
Server.js is being executed!
Conexão com o banco de dados estabelecida com sucesso (Sequelize).
Server is running on port 5000
Agendador de relatório diário iniciado. A tarefa será executada todos os dias às 8:00.
Agendador de lembrete de cupons iniciado. A tarefa será executada todos os dias às 9:00.
Agendador de expiração de cupons iniciado. A tarefa será executada todo dia à meia-noite.
[SenderMonitorJob] Job de monitoramento de disparadores inicializado para rodar a cada 5 minutos.
[WarmingUpProgressJob] Job de progressão de aquecimento inicializado para rodar diariamente à 1h.
[CampaignMonitorJob] Job de monitoramento de campanhas inicializado para rodar a cada 10 minutos.
[CampanhaService] Inicializando campanhas agendadas...
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."status" = 'scheduled' AND "Campanha"."startDate" IS NOT NULL;
[CampanhaService] 0 campanhas reagendadas.
[Auth Middleware] Request: POST /api/auth/verify-token
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = '77f853e9-deb2-4067-881e-71fa16d3054f';
[Auth Middleware] Request: GET /api/dashboard/evolution?tenantId=eb629ea8-7d69-47a1-b1f1-f9dcb33475f4&period=day
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = '77f853e9-deb2-4067-881e-71fa16d3054f';
Executing (default): SELECT "id", "name", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT date_trunc('day', "Resposta"."createdAt") AS "period", SUM(CASE WHEN "pergunta"."type" = 'rating_0_10' AND "ratingValue" >= 9 THEN 1 ELSE 0 END) AS "promoters", SUM(CASE WHEN "pergunta"."type" = 'rating_0_10' AND "ratingValue" <= 6 THEN 1 ELSE 0 END) AS "detractors", SUM(CASE WHEN "pergunta"."type" = 'rating_0_10' THEN 1 ELSE 0 END) AS "nps_total", SUM(CASE WHEN "pergunta"."type" IN ('rating_1_5', 'rating') AND "ratingValue" >= 4 THEN 1 ELSE 0 END) AS "satisfied", SUM(CASE WHEN "pergunta"."type" IN ('rating_1_5', 'rating') THEN 1 ELSE 0 END) AS "csat_total", COUNT("Resposta"."id") AS "responses" FROM "respostas" AS "Resposta" LEFT OUTER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' GROUP BY date_trunc('day', "Resposta"."createdAt") ORDER BY date_trunc('day', "Resposta"."createdAt") ASC;
Executing (default): SELECT date_trunc('day', "createdAt") AS "period", COUNT("id") AS "registrations" FROM "clients" AS "Client" WHERE "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' GROUP BY date_trunc('day', "createdAt") ORDER BY date_trunc('day', "createdAt") ASC;
[Auth Middleware] Request: GET /api/dashboard/evolution?tenantId=eb629ea8-7d69-47a1-b1f1-f9dcb33475f4&period=week
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = '77f853e9-deb2-4067-881e-71fa16d3054f';
Executing (default): SELECT "id", "name", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT date_trunc('week', "Resposta"."createdAt") AS "period", SUM(CASE WHEN "pergunta"."type" = 'rating_0_10' AND "ratingValue" >= 9 THEN 1 ELSE 0 END) AS "promoters", SUM(CASE WHEN "pergunta"."type" = 'rating_0_10' AND "ratingValue" <= 6 THEN 1 ELSE 0 END) AS "detractors", SUM(CASE WHEN "pergunta"."type" = 'rating_0_10' THEN 1 ELSE 0 END) AS "nps_total", SUM(CASE WHEN "pergunta"."type" IN ('rating_1_5', 'rating') AND "ratingValue" >= 4 THEN 1 ELSE 0 END) AS "satisfied", SUM(CASE WHEN "pergunta"."type" IN ('rating_1_5', 'rating') THEN 1 ELSE 0 END) AS "csat_total", COUNT("Resposta"."id") AS "responses" FROM "respostas" AS "Resposta" LEFT OUTER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' GROUP BY date_trunc('week', "Resposta"."createdAt") ORDER BY date_trunc('week', "Resposta"."createdAt") ASC;
Executing (default): SELECT date_trunc('week', "createdAt") AS "period", COUNT("id") AS "registrations" FROM "clients" AS "Client" WHERE "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' GROUP BY date_trunc('week', "createdAt") ORDER BY date_trunc('week', "createdAt") ASC;
[Auth Middleware] Request: GET /api/surveys/list?status=all
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = '77f853e9-deb2-4067-881e-71fa16d3054f';
Executing (default): SELECT "id", "name", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'surveys' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT "Pesquisa"."id", "Pesquisa"."title", "Pesquisa"."description", "Pesquisa"."createdAt", "Pesquisa"."dueDate", "Pesquisa"."status", "Pesquisa"."isOpen", "Pesquisa"."expectedRespondents", "Pesquisa"."askForAttendant", "Pesquisa"."tenantId", "perguntas"."id" AS "perguntas.id", "perguntas"."text" AS "perguntas.text", "perguntas"."type" AS "perguntas.type", "perguntas"."options" AS "perguntas.options", "perguntas"."order" AS "perguntas.order" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" WHERE "Pesquisa"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' ORDER BY "Pesquisa"."createdAt" DESC;
Executing (default): SELECT "pesquisaId", COUNT(DISTINCT("respondentSessionId")) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."pesquisaId" IN ('362bd09a-762a-49d4-9651-415955567e6a', '560e491d-aa5c-43fe-af72-87b12d362e7a', '70644ab0-f9a5-49e5-88cc-86773acfd2a4') GROUP BY "pesquisaId";
[Auth Middleware] Request: GET /api/dashboard/main?tenantId=eb629ea8-7d69-47a1-b1f1-f9dcb33475f4&surveyId=362bd09a-762a-49d4-9651-415955567e6a
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = '77f853e9-deb2-4067-881e-71fa16d3054f';
[Auth Middleware] Request: GET /api/dashboard/main?tenantId=eb629ea8-7d69-47a1-b1f1-f9dcb33475f4&surveyId=560e491d-aa5c-43fe-af72-87b12d362e7a
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = '77f853e9-deb2-4067-881e-71fa16d3054f';
Executing (default): SELECT "id", "name", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "id", "name", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
ReferenceError: getNpsTrendData is not defined
    at Object.getMainDashboard (/usr/src/app/src/repositories/dashboardRepository.js:899:5)
    at /usr/src/app/src/controllers/dashboardController.js:9:53
    at asyncUtilWrap (/usr/src/app/node_modules/express-async-handler/index.js:3:20)
    at Layer.handle [as handle_request] (/usr/src/app/node_modules/express/lib/router/layer.js:95:5)
    at next (/usr/src/app/node_modules/express/lib/router/route.js:149:13)
    at /usr/src/app/src/middlewares/authMiddleware.js:113:9
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
Executing (default): SELECT "Resposta"."id", "Resposta"."perguntaId", "Resposta"."pesquisaId", "Resposta"."tenantId", "Resposta"."atendenteId", "Resposta"."respondentSessionId", "Resposta"."ratingValue", "Resposta"."textValue", "Resposta"."selectedOption", "Resposta"."createdAt", "Resposta"."updatedAt", "pergunta"."id" AS "pergunta.id", "pergunta"."type" AS "pergunta.type" FROM "respostas" AS "Resposta" INNER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Resposta"."pesquisaId" = '362bd09a-762a-49d4-9651-415955567e6a' AND "Resposta"."ratingValue" IS NOT NULL;
ReferenceError: getNpsTrendData is not defined
    at Object.getMainDashboard (/usr/src/app/src/repositories/dashboardRepository.js:899:5)
    at /usr/src/app/src/controllers/dashboardController.js:9:53
    at asyncUtilWrap (/usr/src/app/node_modules/express-async-handler/index.js:3:20)
    at Layer.handle [as handle_request] (/usr/src/app/node_modules/express/lib/router/layer.js:95:5)
    at next (/usr/src/app/node_modules/express/lib/router/route.js:149:13)
    at /usr/src/app/src/middlewares/authMiddleware.js:113:9
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
Executing (default): SELECT date_trunc('day', "createdAt") AS "period", COUNT("id") AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' GROUP BY date_trunc('day', "createdAt") ORDER BY date_trunc('day', "createdAt") ASC;
Executing (default): SELECT "Resposta"."id", "Resposta"."perguntaId", "Resposta"."pesquisaId", "Resposta"."tenantId", "Resposta"."atendenteId", "Resposta"."respondentSessionId", "Resposta"."ratingValue", "Resposta"."textValue", "Resposta"."selectedOption", "Resposta"."createdAt", "Resposta"."updatedAt", "pergunta"."id" AS "pergunta.id", "pergunta"."type" AS "pergunta.type" FROM "respostas" AS "Resposta" INNER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Resposta"."pesquisaId" = '560e491d-aa5c-43fe-af72-87b12d362e7a' AND "Resposta"."ratingValue" IS NOT NULL;
Executing (default): SELECT date_trunc('day', "createdAt") AS "period", COUNT("id") AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' GROUP BY date_trunc('day', "createdAt") ORDER BY date_trunc('day', "createdAt") ASC;
Executing (default): SELECT count(DISTINCT("respondentSessionId")) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Resposta"."pesquisaId" = '362bd09a-762a-49d4-9651-415955567e6a' AND "Resposta"."ratingValue" >= 9 AND "Resposta"."respondentSessionId" IS NOT NULL;
Executing (default): SELECT count(DISTINCT("respondentSessionId")) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Resposta"."pesquisaId" = '560e491d-aa5c-43fe-af72-87b12d362e7a' AND "Resposta"."ratingValue" >= 9 AND "Resposta"."respondentSessionId" IS NOT NULL;
Executing (default): SELECT count(*) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Resposta"."pesquisaId" = '362bd09a-762a-49d4-9651-415955567e6a';
Executing (default): SELECT count(*) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Resposta"."pesquisaId" = '560e491d-aa5c-43fe-af72-87b12d362e7a';
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Client"."pesquisaId" = '362bd09a-762a-49d4-9651-415955567e6a';
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Client"."pesquisaId" = '560e491d-aa5c-43fe-af72-87b12d362e7a';
Unhandled Rejection at: Promise {
  <rejected> Error
      at Query.run (/usr/src/app/node_modules/sequelize/lib/dialects/postgres/query.js:50:25)
      at /usr/src/app/node_modules/sequelize/lib/sequelize.js:315:28
      at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
      at async PostgresQueryInterface.rawSelect (/usr/src/app/node_modules/sequelize/lib/dialects/abstract/query-interface.js:434:18)
      at async Client.aggregate (/usr/src/app/node_modules/sequelize/lib/model.js:1277:19)
      at async Client.count (/usr/src/app/node_modules/sequelize/lib/model.js:1306:20)
      at async getSummary (/usr/src/app/src/repositories/dashboardRepository.js:108:33) {
    name: 'SequelizeDatabaseError',
    parent: error: column Client.pesquisaId does not exist
        at Parser.parseErrorMessage (/usr/src/app/node_modules/pg-protocol/dist/parser.js:285:98)
        at Parser.handlePacket (/usr/src/app/node_modules/pg-protocol/dist/parser.js:122:29)
        at Parser.parse (/usr/src/app/node_modules/pg-protocol/dist/parser.js:35:38)
        at Socket.<anonymous> (/usr/src/app/node_modules/pg-protocol/dist/index.js:11:42)
        at Socket.emit (node:events:517:28)
        at addChunk (node:internal/streams/readable:368:12)
        at readableAddChunk (node:internal/streams/readable:341:9)
        at Readable.push (node:internal/streams/readable:278:10)
        at TCP.onStreamRead (node:internal/stream_base_commons:190:23) {
      length: 116,
      severity: 'ERROR',
      code: '42703',
      detail: undefined,
      hint: undefined,
      position: '126',
      internalPosition: undefined,
      internalQuery: undefined,
      where: undefined,
      schema: undefined,
      table: undefined,
      column: undefined,
      dataType: undefined,
      constraint: undefined,
      file: 'parse_relation.c',
      line: '3647',
      routine: 'errorMissingColumn',
      sql: `SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Client"."pesquisaId" = '560e491d-aa5c-43fe-af72-87b12d362e7a';`,
      parameters: undefined
    },
    original: error: column Client.pesquisaId does not exist
        at Parser.parseErrorMessage (/usr/src/app/node_modules/pg-protocol/dist/parser.js:285:98)
        at Parser.handlePacket (/usr/src/app/node_modules/pg-protocol/dist/parser.js:122:29)
        at Parser.parse (/usr/src/app/node_modules/pg-protocol/dist/parser.js:35:38)
        at Socket.<anonymous> (/usr/src/app/node_modules/pg-protocol/dist/index.js:11:42)
        at Socket.emit (node:events:517:28)
        at addChunk (node:internal/streams/readable:368:12)
        at readableAddChunk (node:internal/streams/readable:341:9)
        at Readable.push (node:internal/streams/readable:278:10)
        at TCP.onStreamRead (node:internal/stream_base_commons:190:23) {
      length: 116,
      severity: 'ERROR',
      code: '42703',
      detail: undefined,
      hint: undefined,
      position: '126',
      internalPosition: undefined,
      internalQuery: undefined,
      where: undefined,
      schema: undefined,
      table: undefined,
      column: undefined,
      dataType: undefined,
      constraint: undefined,
      file: 'parse_relation.c',
      line: '3647',
      routine: 'errorMissingColumn',
      sql: `SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Client"."pesquisaId" = '560e491d-aa5c-43fe-af72-87b12d362e7a';`,
      parameters: undefined
    },
    sql: `SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Client"."pesquisaId" = '560e491d-aa5c-43fe-af72-87b12d362e7a';`,
    parameters: {}
  }
} reason: Error
    at Query.run (/usr/src/app/node_modules/sequelize/lib/dialects/postgres/query.js:50:25)
    at /usr/src/app/node_modules/sequelize/lib/sequelize.js:315:28
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async PostgresQueryInterface.rawSelect (/usr/src/app/node_modules/sequelize/lib/dialects/abstract/query-interface.js:434:18)
    at async Client.aggregate (/usr/src/app/node_modules/sequelize/lib/model.js:1277:19)
    at async Client.count (/usr/src/app/node_modules/sequelize/lib/model.js:1306:20)
    at async getSummary (/usr/src/app/src/repositories/dashboardRepository.js:108:33) {
  name: 'SequelizeDatabaseError',
  parent: error: column Client.pesquisaId does not exist
      at Parser.parseErrorMessage (/usr/src/app/node_modules/pg-protocol/dist/parser.js:285:98)
      at Parser.handlePacket (/usr/src/app/node_modules/pg-protocol/dist/parser.js:122:29)
      at Parser.parse (/usr/src/app/node_modules/pg-protocol/dist/parser.js:35:38)
      at Socket.<anonymous> (/usr/src/app/node_modules/pg-protocol/dist/index.js:11:42)
      at Socket.emit (node:events:517:28)
      at addChunk (node:internal/streams/readable:368:12)
      at readableAddChunk (node:internal/streams/readable:341:9)
      at Readable.push (node:internal/streams/readable:278:10)
      at TCP.onStreamRead (node:internal/stream_base_commons:190:23) {
    length: 116,
    severity: 'ERROR',
    code: '42703',
    detail: undefined,
    hint: undefined,
    position: '126',
    internalPosition: undefined,
    internalQuery: undefined,
    where: undefined,
    schema: undefined,
    table: undefined,
    column: undefined,
    dataType: undefined,
    constraint: undefined,
    file: 'parse_relation.c',
    line: '3647',
    routine: 'errorMissingColumn',
    sql: `SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Client"."pesquisaId" = '560e491d-aa5c-43fe-af72-87b12d362e7a';`,
    parameters: undefined
  },
  original: error: column Client.pesquisaId does not exist
      at Parser.parseErrorMessage (/usr/src/app/node_modules/pg-protocol/dist/parser.js:285:98)
      at Parser.handlePacket (/usr/src/app/node_modules/pg-protocol/dist/parser.js:122:29)
      at Parser.parse (/usr/src/app/node_modules/pg-protocol/dist/parser.js:35:38)
      at Socket.<anonymous> (/usr/src/app/node_modules/pg-protocol/dist/index.js:11:42)
      at Socket.emit (node:events:517:28)
      at addChunk (node:internal/streams/readable:368:12)
      at readableAddChunk (node:internal/streams/readable:341:9)
      at Readable.push (node:internal/streams/readable:278:10)
      at TCP.onStreamRead (node:internal/stream_base_commons:190:23) {
    length: 116,
    severity: 'ERROR',
    code: '42703',
    detail: undefined,
    hint: undefined,
    position: '126',
    internalPosition: undefined,
    internalQuery: undefined,
    where: undefined,
    schema: undefined,
    table: undefined,
    column: undefined,
    dataType: undefined,
    constraint: undefined,
    file: 'parse_relation.c',
    line: '3647',
    routine: 'errorMissingColumn',
    sql: `SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Client"."pesquisaId" = '560e491d-aa5c-43fe-af72-87b12d362e7a';`,
    parameters: undefined
  },
  sql: `SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Client"."pesquisaId" = '560e491d-aa5c-43fe-af72-87b12d362e7a';`,
  parameters: {}
}
Unhandled Rejection at: Promise {
  <rejected> Error
      at Query.run (/usr/src/app/node_modules/sequelize/lib/dialects/postgres/query.js:50:25)
      at /usr/src/app/node_modules/sequelize/lib/sequelize.js:315:28
      at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
      at async PostgresQueryInterface.rawSelect (/usr/src/app/node_modules/sequelize/lib/dialects/abstract/query-interface.js:434:18)
      at async Client.aggregate (/usr/src/app/node_modules/sequelize/lib/model.js:1277:19)
      at async Client.count (/usr/src/app/node_modules/sequelize/lib/model.js:1306:20)
      at async getSummary (/usr/src/app/src/repositories/dashboardRepository.js:108:33) {
    name: 'SequelizeDatabaseError',
    parent: error: column Client.pesquisaId does not exist
        at Parser.parseErrorMessage (/usr/src/app/node_modules/pg-protocol/dist/parser.js:285:98)
        at Parser.handlePacket (/usr/src/app/node_modules/pg-protocol/dist/parser.js:122:29)
        at Parser.parse (/usr/src/app/node_modules/pg-protocol/dist/parser.js:35:38)
        at Socket.<anonymous> (/usr/src/app/node_modules/pg-protocol/dist/index.js:11:42)
        at Socket.emit (node:events:517:28)
        at addChunk (node:internal/streams/readable:368:12)
        at readableAddChunk (node:internal/streams/readable:341:9)
        at Readable.push (node:internal/streams/readable:278:10)
        at TCP.onStreamRead (node:internal/stream_base_commons:190:23) {
      length: 116,
      severity: 'ERROR',
      code: '42703',
      detail: undefined,
      hint: undefined,
      position: '126',
      internalPosition: undefined,
      internalQuery: undefined,
      where: undefined,
      schema: undefined,
      table: undefined,
      column: undefined,
      dataType: undefined,
      constraint: undefined,
      file: 'parse_relation.c',
      line: '3647',
      routine: 'errorMissingColumn',
      sql: `SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Client"."pesquisaId" = '362bd09a-762a-49d4-9651-415955567e6a';`,
      parameters: undefined
    },
    original: error: column Client.pesquisaId does not exist
        at Parser.parseErrorMessage (/usr/src/app/node_modules/pg-protocol/dist/parser.js:285:98)
        at Parser.handlePacket (/usr/src/app/node_modules/pg-protocol/dist/parser.js:122:29)
        at Parser.parse (/usr/src/app/node_modules/pg-protocol/dist/parser.js:35:38)
        at Socket.<anonymous> (/usr/src/app/node_modules/pg-protocol/dist/index.js:11:42)
        at Socket.emit (node:events:517:28)
        at addChunk (node:internal/streams/readable:368:12)
        at readableAddChunk (node:internal/streams/readable:341:9)
        at Readable.push (node:internal/streams/readable:278:10)
        at TCP.onStreamRead (node:internal/stream_base_commons:190:23) {
      length: 116,
      severity: 'ERROR',
      code: '42703',
      detail: undefined,
      hint: undefined,
      position: '126',
      internalPosition: undefined,
      internalQuery: undefined,
      where: undefined,
      schema: undefined,
      table: undefined,
      column: undefined,
      dataType: undefined,
      constraint: undefined,
      file: 'parse_relation.c',
      line: '3647',
      routine: 'errorMissingColumn',
      sql: `SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Client"."pesquisaId" = '362bd09a-762a-49d4-9651-415955567e6a';`,
      parameters: undefined
    },
    sql: `SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Client"."pesquisaId" = '362bd09a-762a-49d4-9651-415955567e6a';`,
    parameters: {}
  }
} reason: Error
    at Query.run (/usr/src/app/node_modules/sequelize/lib/dialects/postgres/query.js:50:25)
    at /usr/src/app/node_modules/sequelize/lib/sequelize.js:315:28
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async PostgresQueryInterface.rawSelect (/usr/src/app/node_modules/sequelize/lib/dialects/abstract/query-interface.js:434:18)
    at async Client.aggregate (/usr/src/app/node_modules/sequelize/lib/model.js:1277:19)
    at async Client.count (/usr/src/app/node_modules/sequelize/lib/model.js:1306:20)
    at async getSummary (/usr/src/app/src/repositories/dashboardRepository.js:108:33) {
  name: 'SequelizeDatabaseError',
  parent: error: column Client.pesquisaId does not exist
      at Parser.parseErrorMessage (/usr/src/app/node_modules/pg-protocol/dist/parser.js:285:98)
      at Parser.handlePacket (/usr/src/app/node_modules/pg-protocol/dist/parser.js:122:29)
      at Parser.parse (/usr/src/app/node_modules/pg-protocol/dist/parser.js:35:38)
      at Socket.<anonymous> (/usr/src/app/node_modules/pg-protocol/dist/index.js:11:42)
      at Socket.emit (node:events:517:28)
      at addChunk (node:internal/streams/readable:368:12)
      at readableAddChunk (node:internal/streams/readable:341:9)
      at Readable.push (node:internal/streams/readable:278:10)
      at TCP.onStreamRead (node:internal/stream_base_commons:190:23) {
    length: 116,
    severity: 'ERROR',
    code: '42703',
    detail: undefined,
    hint: undefined,
    position: '126',
    internalPosition: undefined,
    internalQuery: undefined,
    where: undefined,
    schema: undefined,
    table: undefined,
    column: undefined,
    dataType: undefined,
    constraint: undefined,
    file: 'parse_relation.c',
    line: '3647',
    routine: 'errorMissingColumn',
    sql: `SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Client"."pesquisaId" = '362bd09a-762a-49d4-9651-415955567e6a';`,
    parameters: undefined
  },
  original: error: column Client.pesquisaId does not exist
      at Parser.parseErrorMessage (/usr/src/app/node_modules/pg-protocol/dist/parser.js:285:98)
      at Parser.handlePacket (/usr/src/app/node_modules/pg-protocol/dist/parser.js:122:29)
      at Parser.parse (/usr/src/app/node_modules/pg-protocol/dist/parser.js:35:38)
      at Socket.<anonymous> (/usr/src/app/node_modules/pg-protocol/dist/index.js:11:42)
      at Socket.emit (node:events:517:28)
      at addChunk (node:internal/streams/readable:368:12)
      at readableAddChunk (node:internal/streams/readable:341:9)
      at Readable.push (node:internal/streams/readable:278:10)
      at TCP.onStreamRead (node:internal/stream_base_commons:190:23) {
    length: 116,
    severity: 'ERROR',
    code: '42703',
    detail: undefined,
    hint: undefined,
    position: '126',
    internalPosition: undefined,
    internalQuery: undefined,
    where: undefined,
    schema: undefined,
    table: undefined,
    column: undefined,
    dataType: undefined,
    constraint: undefined,
    file: 'parse_relation.c',
    line: '3647',
    routine: 'errorMissingColumn',
    sql: `SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Client"."pesquisaId" = '362bd09a-762a-49d4-9651-415955567e6a';`,
    parameters: undefined
  },
  sql: `SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Client"."pesquisaId" = '362bd09a-762a-49d4-9651-415955567e6a';`,
  parameters: {}
}
[Auth Middleware] Request: GET /api/dashboard/main?tenantId=eb629ea8-7d69-47a1-b1f1-f9dcb33475f4&surveyId=362bd09a-762a-49d4-9651-415955567e6a
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = '77f853e9-deb2-4067-881e-71fa16d3054f';
[Auth Middleware] Request: GET /api/dashboard/main?tenantId=eb629ea8-7d69-47a1-b1f1-f9dcb33475f4&surveyId=560e491d-aa5c-43fe-af72-87b12d362e7a
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = '77f853e9-deb2-4067-881e-71fa16d3054f';
Executing (default): SELECT "id", "name", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "id", "name", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
ReferenceError: getNpsTrendData is not defined
    at Object.getMainDashboard (/usr/src/app/src/repositories/dashboardRepository.js:899:5)
    at /usr/src/app/src/controllers/dashboardController.js:9:53
    at asyncUtilWrap (/usr/src/app/node_modules/express-async-handler/index.js:3:20)
    at Layer.handle [as handle_request] (/usr/src/app/node_modules/express/lib/router/layer.js:95:5)
    at next (/usr/src/app/node_modules/express/lib/router/route.js:149:13)
    at /usr/src/app/src/middlewares/authMiddleware.js:113:9
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
Executing (default): SELECT "Resposta"."id", "Resposta"."perguntaId", "Resposta"."pesquisaId", "Resposta"."tenantId", "Resposta"."atendenteId", "Resposta"."respondentSessionId", "Resposta"."ratingValue", "Resposta"."textValue", "Resposta"."selectedOption", "Resposta"."createdAt", "Resposta"."updatedAt", "pergunta"."id" AS "pergunta.id", "pergunta"."type" AS "pergunta.type" FROM "respostas" AS "Resposta" INNER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Resposta"."pesquisaId" = '560e491d-aa5c-43fe-af72-87b12d362e7a' AND "Resposta"."ratingValue" IS NOT NULL;
Executing (default): SELECT date_trunc('day', "createdAt") AS "period", COUNT("id") AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' GROUP BY date_trunc('day', "createdAt") ORDER BY date_trunc('day', "createdAt") ASC;
ReferenceError: getNpsTrendData is not defined
    at Object.getMainDashboard (/usr/src/app/src/repositories/dashboardRepository.js:899:5)
    at /usr/src/app/src/controllers/dashboardController.js:9:53
    at asyncUtilWrap (/usr/src/app/node_modules/express-async-handler/index.js:3:20)
    at Layer.handle [as handle_request] (/usr/src/app/node_modules/express/lib/router/layer.js:95:5)
    at next (/usr/src/app/node_modules/express/lib/router/route.js:149:13)
    at /usr/src/app/src/middlewares/authMiddleware.js:113:9
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
Executing (default): SELECT "Resposta"."id", "Resposta"."perguntaId", "Resposta"."pesquisaId", "Resposta"."tenantId", "Resposta"."atendenteId", "Resposta"."respondentSessionId", "Resposta"."ratingValue", "Resposta"."textValue", "Resposta"."selectedOption", "Resposta"."createdAt", "Resposta"."updatedAt", "pergunta"."id" AS "pergunta.id", "pergunta"."type" AS "pergunta.type" FROM "respostas" AS "Resposta" INNER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Resposta"."pesquisaId" = '362bd09a-762a-49d4-9651-415955567e6a' AND "Resposta"."ratingValue" IS NOT NULL;
Executing (default): SELECT date_trunc('day', "createdAt") AS "period", COUNT("id") AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' GROUP BY date_trunc('day', "createdAt") ORDER BY date_trunc('day', "createdAt") ASC;
Executing (default): SELECT count(DISTINCT("respondentSessionId")) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Resposta"."pesquisaId" = '560e491d-aa5c-43fe-af72-87b12d362e7a' AND "Resposta"."ratingValue" >= 9 AND "Resposta"."respondentSessionId" IS NOT NULL;
Executing (default): SELECT count(DISTINCT("respondentSessionId")) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Resposta"."pesquisaId" = '362bd09a-762a-49d4-9651-415955567e6a' AND "Resposta"."ratingValue" >= 9 AND "Resposta"."respondentSessionId" IS NOT NULL;
Executing (default): SELECT count(*) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Resposta"."pesquisaId" = '362bd09a-762a-49d4-9651-415955567e6a';
Executing (default): SELECT count(*) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Resposta"."pesquisaId" = '560e491d-aa5c-43fe-af72-87b12d362e7a';
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Client"."pesquisaId" = '362bd09a-762a-49d4-9651-415955567e6a';
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Client"."pesquisaId" = '560e491d-aa5c-43fe-af72-87b12d362e7a';
Unhandled Rejection at: Promise {
  <rejected> Error
      at Query.run (/usr/src/app/node_modules/sequelize/lib/dialects/postgres/query.js:50:25)
      at /usr/src/app/node_modules/sequelize/lib/sequelize.js:315:28
      at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
      at async PostgresQueryInterface.rawSelect (/usr/src/app/node_modules/sequelize/lib/dialects/abstract/query-interface.js:434:18)
      at async Client.aggregate (/usr/src/app/node_modules/sequelize/lib/model.js:1277:19)
      at async Client.count (/usr/src/app/node_modules/sequelize/lib/model.js:1306:20)
      at async getSummary (/usr/src/app/src/repositories/dashboardRepository.js:108:33) {
    name: 'SequelizeDatabaseError',
    parent: error: column Client.pesquisaId does not exist
        at Parser.parseErrorMessage (/usr/src/app/node_modules/pg-protocol/dist/parser.js:285:98)
        at Parser.handlePacket (/usr/src/app/node_modules/pg-protocol/dist/parser.js:122:29)
        at Parser.parse (/usr/src/app/node_modules/pg-protocol/dist/parser.js:35:38)
        at Socket.<anonymous> (/usr/src/app/node_modules/pg-protocol/dist/index.js:11:42)
        at Socket.emit (node:events:517:28)
        at addChunk (node:internal/streams/readable:368:12)
        at readableAddChunk (node:internal/streams/readable:341:9)
        at Readable.push (node:internal/streams/readable:278:10)
        at TCP.onStreamRead (node:internal/stream_base_commons:190:23) {
      length: 116,
      severity: 'ERROR',
      code: '42703',
      detail: undefined,
      hint: undefined,
      position: '126',
      internalPosition: undefined,
      internalQuery: undefined,
      where: undefined,
      schema: undefined,
      table: undefined,
      column: undefined,
      dataType: undefined,
      constraint: undefined,
      file: 'parse_relation.c',
      line: '3647',
      routine: 'errorMissingColumn',
      sql: `SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Client"."pesquisaId" = '362bd09a-762a-49d4-9651-415955567e6a';`,
      parameters: undefined
    },
    original: error: column Client.pesquisaId does not exist
        at Parser.parseErrorMessage (/usr/src/app/node_modules/pg-protocol/dist/parser.js:285:98)
        at Parser.handlePacket (/usr/src/app/node_modules/pg-protocol/dist/parser.js:122:29)
        at Parser.parse (/usr/src/app/node_modules/pg-protocol/dist/parser.js:35:38)
        at Socket.<anonymous> (/usr/src/app/node_modules/pg-protocol/dist/index.js:11:42)
        at Socket.emit (node:events:517:28)
        at addChunk (node:internal/streams/readable:368:12)
        at readableAddChunk (node:internal/streams/readable:341:9)
        at Readable.push (node:internal/streams/readable:278:10)
        at TCP.onStreamRead (node:internal/stream_base_commons:190:23) {
      length: 116,
      severity: 'ERROR',
      code: '42703',
      detail: undefined,
      hint: undefined,
      position: '126',
      internalPosition: undefined,
      internalQuery: undefined,
      where: undefined,
      schema: undefined,
      table: undefined,
      column: undefined,
      dataType: undefined,
      constraint: undefined,
      file: 'parse_relation.c',
      line: '3647',
      routine: 'errorMissingColumn',
      sql: `SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Client"."pesquisaId" = '362bd09a-762a-49d4-9651-415955567e6a';`,
      parameters: undefined
    },
    sql: `SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Client"."pesquisaId" = '362bd09a-762a-49d4-9651-415955567e6a';`,
    parameters: {}
  }
} reason: Error
    at Query.run (/usr/src/app/node_modules/sequelize/lib/dialects/postgres/query.js:50:25)
    at /usr/src/app/node_modules/sequelize/lib/sequelize.js:315:28
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async PostgresQueryInterface.rawSelect (/usr/src/app/node_modules/sequelize/lib/dialects/abstract/query-interface.js:434:18)
    at async Client.aggregate (/usr/src/app/node_modules/sequelize/lib/model.js:1277:19)
    at async Client.count (/usr/src/app/node_modules/sequelize/lib/model.js:1306:20)
    at async getSummary (/usr/src/app/src/repositories/dashboardRepository.js:108:33) {
  name: 'SequelizeDatabaseError',
  parent: error: column Client.pesquisaId does not exist
      at Parser.parseErrorMessage (/usr/src/app/node_modules/pg-protocol/dist/parser.js:285:98)
      at Parser.handlePacket (/usr/src/app/node_modules/pg-protocol/dist/parser.js:122:29)
      at Parser.parse (/usr/src/app/node_modules/pg-protocol/dist/parser.js:35:38)
      at Socket.<anonymous> (/usr/src/app/node_modules/pg-protocol/dist/index.js:11:42)
      at Socket.emit (node:events:517:28)
      at addChunk (node:internal/streams/readable:368:12)
      at readableAddChunk (node:internal/streams/readable:341:9)
      at Readable.push (node:internal/streams/readable:278:10)
      at TCP.onStreamRead (node:internal/stream_base_commons:190:23) {
    length: 116,
    severity: 'ERROR',
    code: '42703',
    detail: undefined,
    hint: undefined,
    position: '126',
    internalPosition: undefined,
    internalQuery: undefined,
    where: undefined,
    schema: undefined,
    table: undefined,
    column: undefined,
    dataType: undefined,
    constraint: undefined,
    file: 'parse_relation.c',
    line: '3647',
    routine: 'errorMissingColumn',
    sql: `SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Client"."pesquisaId" = '362bd09a-762a-49d4-9651-415955567e6a';`,
    parameters: undefined
  },
  original: error: column Client.pesquisaId does not exist
      at Parser.parseErrorMessage (/usr/src/app/node_modules/pg-protocol/dist/parser.js:285:98)
      at Parser.handlePacket (/usr/src/app/node_modules/pg-protocol/dist/parser.js:122:29)
      at Parser.parse (/usr/src/app/node_modules/pg-protocol/dist/parser.js:35:38)
      at Socket.<anonymous> (/usr/src/app/node_modules/pg-protocol/dist/index.js:11:42)
      at Socket.emit (node:events:517:28)
      at addChunk (node:internal/streams/readable:368:12)
      at readableAddChunk (node:internal/streams/readable:341:9)
      at Readable.push (node:internal/streams/readable:278:10)
      at TCP.onStreamRead (node:internal/stream_base_commons:190:23) {
    length: 116,
    severity: 'ERROR',
    code: '42703',
    detail: undefined,
    hint: undefined,
    position: '126',
    internalPosition: undefined,
    internalQuery: undefined,
    where: undefined,
    schema: undefined,
    table: undefined,
    column: undefined,
    dataType: undefined,
    constraint: undefined,
    file: 'parse_relation.c',
    line: '3647',
    routine: 'errorMissingColumn',
    sql: `SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Client"."pesquisaId" = '362bd09a-762a-49d4-9651-415955567e6a';`,
    parameters: undefined
  },
  sql: `SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Client"."pesquisaId" = '362bd09a-762a-49d4-9651-415955567e6a';`,
  parameters: {}
}
Unhandled Rejection at: Promise {
  <rejected> Error
      at Query.run (/usr/src/app/node_modules/sequelize/lib/dialects/postgres/query.js:50:25)
      at /usr/src/app/node_modules/sequelize/lib/sequelize.js:315:28
      at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
      at async PostgresQueryInterface.rawSelect (/usr/src/app/node_modules/sequelize/lib/dialects/abstract/query-interface.js:434:18)
      at async Client.aggregate (/usr/src/app/node_modules/sequelize/lib/model.js:1277:19)
      at async Client.count (/usr/src/app/node_modules/sequelize/lib/model.js:1306:20)
      at async getSummary (/usr/src/app/src/repositories/dashboardRepository.js:108:33) {
    name: 'SequelizeDatabaseError',
    parent: error: column Client.pesquisaId does not exist
        at Parser.parseErrorMessage (/usr/src/app/node_modules/pg-protocol/dist/parser.js:285:98)
        at Parser.handlePacket (/usr/src/app/node_modules/pg-protocol/dist/parser.js:122:29)
        at Parser.parse (/usr/src/app/node_modules/pg-protocol/dist/parser.js:35:38)
        at Socket.<anonymous> (/usr/src/app/node_modules/pg-protocol/dist/index.js:11:42)
        at Socket.emit (node:events:517:28)
        at addChunk (node:internal/streams/readable:368:12)
        at readableAddChunk (node:internal/streams/readable:341:9)
        at Readable.push (node:internal/streams/readable:278:10)
        at TCP.onStreamRead (node:internal/stream_base_commons:190:23) {
      length: 116,
      severity: 'ERROR',
      code: '42703',
      detail: undefined,
      hint: undefined,
      position: '126',
      internalPosition: undefined,
      internalQuery: undefined,
      where: undefined,
      schema: undefined,
      table: undefined,
      column: undefined,
      dataType: undefined,
      constraint: undefined,
      file: 'parse_relation.c',
      line: '3647',
      routine: 'errorMissingColumn',
      sql: `SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Client"."pesquisaId" = '560e491d-aa5c-43fe-af72-87b12d362e7a';`,
      parameters: undefined
    },
    original: error: column Client.pesquisaId does not exist
        at Parser.parseErrorMessage (/usr/src/app/node_modules/pg-protocol/dist/parser.js:285:98)
        at Parser.handlePacket (/usr/src/app/node_modules/pg-protocol/dist/parser.js:122:29)
        at Parser.parse (/usr/src/app/node_modules/pg-protocol/dist/parser.js:35:38)
        at Socket.<anonymous> (/usr/src/app/node_modules/pg-protocol/dist/index.js:11:42)
        at Socket.emit (node:events:517:28)
        at addChunk (node:internal/streams/readable:368:12)
        at readableAddChunk (node:internal/streams/readable:341:9)
        at Readable.push (node:internal/streams/readable:278:10)
        at TCP.onStreamRead (node:internal/stream_base_commons:190:23) {
      length: 116,
      severity: 'ERROR',
      code: '42703',
      detail: undefined,
      hint: undefined,
      position: '126',
      internalPosition: undefined,
      internalQuery: undefined,
      where: undefined,
      schema: undefined,
      table: undefined,
      column: undefined,
      dataType: undefined,
      constraint: undefined,
      file: 'parse_relation.c',
      line: '3647',
      routine: 'errorMissingColumn',
      sql: `SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Client"."pesquisaId" = '560e491d-aa5c-43fe-af72-87b12d362e7a';`,
      parameters: undefined
    },
    sql: `SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Client"."pesquisaId" = '560e491d-aa5c-43fe-af72-87b12d362e7a';`,
    parameters: {}
  }
} reason: Error
    at Query.run (/usr/src/app/node_modules/sequelize/lib/dialects/postgres/query.js:50:25)
    at /usr/src/app/node_modules/sequelize/lib/sequelize.js:315:28
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async PostgresQueryInterface.rawSelect (/usr/src/app/node_modules/sequelize/lib/dialects/abstract/query-interface.js:434:18)
    at async Client.aggregate (/usr/src/app/node_modules/sequelize/lib/model.js:1277:19)
    at async Client.count (/usr/src/app/node_modules/sequelize/lib/model.js:1306:20)
    at async getSummary (/usr/src/app/src/repositories/dashboardRepository.js:108:33) {
  name: 'SequelizeDatabaseError',
  parent: error: column Client.pesquisaId does not exist
      at Parser.parseErrorMessage (/usr/src/app/node_modules/pg-protocol/dist/parser.js:285:98)
      at Parser.handlePacket (/usr/src/app/node_modules/pg-protocol/dist/parser.js:122:29)
      at Parser.parse (/usr/src/app/node_modules/pg-protocol/dist/parser.js:35:38)
      at Socket.<anonymous> (/usr/src/app/node_modules/pg-protocol/dist/index.js:11:42)
      at Socket.emit (node:events:517:28)
      at addChunk (node:internal/streams/readable:368:12)
      at readableAddChunk (node:internal/streams/readable:341:9)
      at Readable.push (node:internal/streams/readable:278:10)
      at TCP.onStreamRead (node:internal/stream_base_commons:190:23) {
    length: 116,
    severity: 'ERROR',
    code: '42703',
    detail: undefined,
    hint: undefined,
    position: '126',
    internalPosition: undefined,
    internalQuery: undefined,
    where: undefined,
    schema: undefined,
    table: undefined,
    column: undefined,
    dataType: undefined,
    constraint: undefined,
    file: 'parse_relation.c',
    line: '3647',
    routine: 'errorMissingColumn',
    sql: `SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Client"."pesquisaId" = '560e491d-aa5c-43fe-af72-87b12d362e7a';`,
    parameters: undefined
  },
  original: error: column Client.pesquisaId does not exist
      at Parser.parseErrorMessage (/usr/src/app/node_modules/pg-protocol/dist/parser.js:285:98)
      at Parser.handlePacket (/usr/src/app/node_modules/pg-protocol/dist/parser.js:122:29)
      at Parser.parse (/usr/src/app/node_modules/pg-protocol/dist/parser.js:35:38)
      at Socket.<anonymous> (/usr/src/app/node_modules/pg-protocol/dist/index.js:11:42)
      at Socket.emit (node:events:517:28)
      at addChunk (node:internal/streams/readable:368:12)
      at readableAddChunk (node:internal/streams/readable:341:9)
      at Readable.push (node:internal/streams/readable:278:10)
      at TCP.onStreamRead (node:internal/stream_base_commons:190:23) {
    length: 116,
    severity: 'ERROR',
    code: '42703',
    detail: undefined,
    hint: undefined,
    position: '126',
    internalPosition: undefined,
    internalQuery: undefined,
    where: undefined,
    schema: undefined,
    table: undefined,
    column: undefined,
    dataType: undefined,
    constraint: undefined,
    file: 'parse_relation.c',
    line: '3647',
    routine: 'errorMissingColumn',
    sql: `SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Client"."pesquisaId" = '560e491d-aa5c-43fe-af72-87b12d362e7a';`,
    parameters: undefined
  },
  sql: `SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Client"."pesquisaId" = '560e491d-aa5c-43fe-af72-87b12d362e7a';`,
  parameters: {}
}
[Auth Middleware] Request: GET /api/dashboard/main?tenantId=eb629ea8-7d69-47a1-b1f1-f9dcb33475f4&surveyId=70644ab0-f9a5-49e5-88cc-86773acfd2a4
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = '77f853e9-deb2-4067-881e-71fa16d3054f';
Executing (default): SELECT "id", "name", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
ReferenceError: getNpsTrendData is not defined
    at Object.getMainDashboard (/usr/src/app/src/repositories/dashboardRepository.js:899:5)
    at /usr/src/app/src/controllers/dashboardController.js:9:53
    at asyncUtilWrap (/usr/src/app/node_modules/express-async-handler/index.js:3:20)
    at Layer.handle [as handle_request] (/usr/src/app/node_modules/express/lib/router/layer.js:95:5)
    at next (/usr/src/app/node_modules/express/lib/router/route.js:149:13)
    at /usr/src/app/src/middlewares/authMiddleware.js:113:9
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
Executing (default): SELECT "Resposta"."id", "Resposta"."perguntaId", "Resposta"."pesquisaId", "Resposta"."tenantId", "Resposta"."atendenteId", "Resposta"."respondentSessionId", "Resposta"."ratingValue", "Resposta"."textValue", "Resposta"."selectedOption", "Resposta"."createdAt", "Resposta"."updatedAt", "pergunta"."id" AS "pergunta.id", "pergunta"."type" AS "pergunta.type" FROM "respostas" AS "Resposta" INNER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Resposta"."pesquisaId" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4' AND "Resposta"."ratingValue" IS NOT NULL;
Executing (default): SELECT date_trunc('day', "createdAt") AS "period", COUNT("id") AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' GROUP BY date_trunc('day', "createdAt") ORDER BY date_trunc('day', "createdAt") ASC;
Executing (default): SELECT count(DISTINCT("respondentSessionId")) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Resposta"."pesquisaId" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4' AND "Resposta"."ratingValue" >= 9 AND "Resposta"."respondentSessionId" IS NOT NULL;
Executing (default): SELECT count(*) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Resposta"."pesquisaId" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Client"."pesquisaId" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Unhandled Rejection at: Promise {
  <rejected> Error
      at Query.run (/usr/src/app/node_modules/sequelize/lib/dialects/postgres/query.js:50:25)
      at /usr/src/app/node_modules/sequelize/lib/sequelize.js:315:28
      at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
      at async PostgresQueryInterface.rawSelect (/usr/src/app/node_modules/sequelize/lib/dialects/abstract/query-interface.js:434:18)
      at async Client.aggregate (/usr/src/app/node_modules/sequelize/lib/model.js:1277:19)
      at async Client.count (/usr/src/app/node_modules/sequelize/lib/model.js:1306:20)
      at async getSummary (/usr/src/app/src/repositories/dashboardRepository.js:108:33) {
    name: 'SequelizeDatabaseError',
    parent: error: column Client.pesquisaId does not exist
        at Parser.parseErrorMessage (/usr/src/app/node_modules/pg-protocol/dist/parser.js:285:98)
        at Parser.handlePacket (/usr/src/app/node_modules/pg-protocol/dist/parser.js:122:29)
        at Parser.parse (/usr/src/app/node_modules/pg-protocol/dist/parser.js:35:38)
        at Socket.<anonymous> (/usr/src/app/node_modules/pg-protocol/dist/index.js:11:42)
        at Socket.emit (node:events:517:28)
        at addChunk (node:internal/streams/readable:368:12)
        at readableAddChunk (node:internal/streams/readable:341:9)
        at Readable.push (node:internal/streams/readable:278:10)
        at TCP.onStreamRead (node:internal/stream_base_commons:190:23) {
      length: 116,
      severity: 'ERROR',
      code: '42703',
      detail: undefined,
      hint: undefined,
      position: '126',
      internalPosition: undefined,
      internalQuery: undefined,
      where: undefined,
      schema: undefined,
      table: undefined,
      column: undefined,
      dataType: undefined,
      constraint: undefined,
      file: 'parse_relation.c',
      line: '3647',
      routine: 'errorMissingColumn',
      sql: `SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Client"."pesquisaId" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';`,
      parameters: undefined
    },
    original: error: column Client.pesquisaId does not exist
        at Parser.parseErrorMessage (/usr/src/app/node_modules/pg-protocol/dist/parser.js:285:98)
        at Parser.handlePacket (/usr/src/app/node_modules/pg-protocol/dist/parser.js:122:29)
        at Parser.parse (/usr/src/app/node_modules/pg-protocol/dist/parser.js:35:38)
        at Socket.<anonymous> (/usr/src/app/node_modules/pg-protocol/dist/index.js:11:42)
        at Socket.emit (node:events:517:28)
        at addChunk (node:internal/streams/readable:368:12)
        at readableAddChunk (node:internal/streams/readable:341:9)
        at Readable.push (node:internal/streams/readable:278:10)
        at TCP.onStreamRead (node:internal/stream_base_commons:190:23) {
      length: 116,
      severity: 'ERROR',
      code: '42703',
      detail: undefined,
      hint: undefined,
      position: '126',
      internalPosition: undefined,
      internalQuery: undefined,
      where: undefined,
      schema: undefined,
      table: undefined,
      column: undefined,
      dataType: undefined,
      constraint: undefined,
      file: 'parse_relation.c',
      line: '3647',
      routine: 'errorMissingColumn',
      sql: `SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Client"."pesquisaId" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';`,
      parameters: undefined
    },
    sql: `SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Client"."pesquisaId" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';`,
    parameters: {}
  }
} reason: Error
    at Query.run (/usr/src/app/node_modules/sequelize/lib/dialects/postgres/query.js:50:25)
    at /usr/src/app/node_modules/sequelize/lib/sequelize.js:315:28
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async PostgresQueryInterface.rawSelect (/usr/src/app/node_modules/sequelize/lib/dialects/abstract/query-interface.js:434:18)
    at async Client.aggregate (/usr/src/app/node_modules/sequelize/lib/model.js:1277:19)
    at async Client.count (/usr/src/app/node_modules/sequelize/lib/model.js:1306:20)
    at async getSummary (/usr/src/app/src/repositories/dashboardRepository.js:108:33) {
  name: 'SequelizeDatabaseError',
  parent: error: column Client.pesquisaId does not exist
      at Parser.parseErrorMessage (/usr/src/app/node_modules/pg-protocol/dist/parser.js:285:98)
      at Parser.handlePacket (/usr/src/app/node_modules/pg-protocol/dist/parser.js:122:29)
      at Parser.parse (/usr/src/app/node_modules/pg-protocol/dist/parser.js:35:38)
      at Socket.<anonymous> (/usr/src/app/node_modules/pg-protocol/dist/index.js:11:42)
      at Socket.emit (node:events:517:28)
      at addChunk (node:internal/streams/readable:368:12)
      at readableAddChunk (node:internal/streams/readable:341:9)
      at Readable.push (node:internal/streams/readable:278:10)
      at TCP.onStreamRead (node:internal/stream_base_commons:190:23) {
    length: 116,
    severity: 'ERROR',
    code: '42703',
    detail: undefined,
    hint: undefined,
    position: '126',
    internalPosition: undefined,
    internalQuery: undefined,
    where: undefined,
    schema: undefined,
    table: undefined,
    column: undefined,
    dataType: undefined,
    constraint: undefined,
    file: 'parse_relation.c',
    line: '3647',
    routine: 'errorMissingColumn',
    sql: `SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Client"."pesquisaId" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';`,
    parameters: undefined
  },
  original: error: column Client.pesquisaId does not exist
      at Parser.parseErrorMessage (/usr/src/app/node_modules/pg-protocol/dist/parser.js:285:98)
      at Parser.handlePacket (/usr/src/app/node_modules/pg-protocol/dist/parser.js:122:29)
      at Parser.parse (/usr/src/app/node_modules/pg-protocol/dist/parser.js:35:38)
      at Socket.<anonymous> (/usr/src/app/node_modules/pg-protocol/dist/index.js:11:42)
      at Socket.emit (node:events:517:28)
      at addChunk (node:internal/streams/readable:368:12)
      at readableAddChunk (node:internal/streams/readable:341:9)
      at Readable.push (node:internal/streams/readable:278:10)
      at TCP.onStreamRead (node:internal/stream_base_commons:190:23) {
    length: 116,
    severity: 'ERROR',
    code: '42703',
    detail: undefined,
    hint: undefined,
    position: '126',
    internalPosition: undefined,
    internalQuery: undefined,
    where: undefined,
    schema: undefined,
    table: undefined,
    column: undefined,
    dataType: undefined,
    constraint: undefined,
    file: 'parse_relation.c',
    line: '3647',
    routine: 'errorMissingColumn',
    sql: `SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Client"."pesquisaId" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';`,
    parameters: undefined
  },
  sql: `SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Client"."pesquisaId" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';`,
  parameters: {}
}
[Auth Middleware] Request: GET /api/dashboard/month-summary?startDate=2025-11-01T03:00:00.000Z&endDate=2025-12-01T02:59:59.999Z
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = '77f853e9-deb2-4067-881e-71fa16d3054f';
Executing (default): SELECT "id", "name", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT "Resposta"."id", "Resposta"."createdAt", "Resposta"."respondentSessionId", "Resposta"."ratingValue", "pergunta"."id" AS "pergunta.id", "pergunta"."type" AS "pergunta.type" FROM "respostas" AS "Resposta" LEFT OUTER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' ORDER BY "Resposta"."createdAt" ASC;
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Client"."respondentSessionId" IN ('8bc27afd-e2ae-4d6a-9e31-fc5e8a51a482', 'f7607999-8854-4c15-90cb-4f377ecba01e', '3885cd4a-5034-49d8-b5ed-0ff98e34b564', 'c2913fd9-3676-4d78-b9ee-d4dac0204339', '0ccc02ce-e588-4c4c-ad4c-81370869e723', 'bbe4d90c-bad3-4b7a-a09e-da33347825d7', '2b771ab0-0226-4326-b11a-f1eefead9051', '85606c3c-250e-470d-8823-69e6bad4f0bc', '2f0c9c14-0f13-4e22-90cf-2ec15a1a52c6', '3cdf234c-e245-4af1-91da-e8c88fef4ea0', '11968cb9-871c-44ae-927b-2f3ffd6bed8f', '4a741aa5-0449-4a1c-9fcc-278af48a1533', 'fa627fdf-8a1c-4eab-9cc4-8ff026fa76e7', '6957ceb0-199a-484d-9d83-72f87f1e692b', '6df55449-be51-4a8f-a640-fe8e02bc449a', 'bc9767ef-2809-4d78-a64c-679ccd205dd9', 'eceff808-15b8-4fa4-ad6c-7604291390c4', '329dd730-db21-46e5-a38c-152f6226df64', 'c99ef391-509e-4221-b2b4-f70abff86345', '22fdb609-7c06-4071-9183-8165f4b3444c', 'e65f5162-592f-4ac8-ac97-8960f9e7933a', 'c185cf94-35f1-4059-8ef5-0fed9ff4dd7f', 'c913e5be-f7c1-4023-b057-6df788260cc7', '4d81defc-d342-48dc-b1a0-b395743b7921', 'd7acc025-e9ca-4cb3-b1fc-d98f56a82358', '7a734629-24ed-47f2-92e0-8ed48f1f8672', '52518ca3-3beb-4901-b8f8-c46663c95025', 'ee5778f9-0e11-4b80-ad95-51dd60cc80d1', 'f7ee26b7-32d7-4947-9bd3-6656619cd324', '29d3c414-bb6a-45e9-9455-6a4659a684c8', '0b3f31b9-a499-4359-8d4b-09657ed5f688', 'befc9545-51d5-4f6b-83a6-38f3864c5493', '417a89ee-9c8f-4311-b7c2-08fafd2d5e5f', 'e4cd7956-6f89-4b09-a0d7-13aa12152606', '1a3a2773-446b-4fcb-8cc6-0afc2fc3c907', '62439ab5-84ad-4e49-b599-6b8e5e4a8c75', 'd2b22566-cd0a-4537-a460-e63424e25c51', '6ec0b31f-c38d-4907-9bd4-053af95a2014', '8a21321e-ff7e-41a0-a8f0-fd3a877e1e76', 'cf949a76-a492-4125-bacc-8f052fc2f93f', 'e3c3a293-e65b-4241-945f-e39b938a9a78', 'a9670f8d-b15d-4628-b78c-96996a370625', '4672b014-d200-4abd-b9a3-46198c2aa9ae', '117c73f2-7341-44f1-b949-0cb771dc288d', '00689359-908c-40b4-87f6-3962408bfa15', 'cf601d5e-24a1-4585-9b29-07850b869312', 'd575097b-9906-4cb0-a81c-5f9fe85c9b2f', '01bd76cf-c1bf-4f62-95a8-407dc05af7fb', 'c02ac936-579d-464a-82c7-8f5e420ff2dc', '5bc127b3-8c65-4c04-ab21-a60a9ff33650', 'e968f4e6-0764-45a1-a816-aee0d203af08', '5162efa3-a04f-4210-825c-f2a9c1f0b077', 'abd842be-0580-465c-bfe9-8967e5bfb19e', '16ed0449-6d61-4639-8f51-c7c03b0b5c54', '27a1f6a2-65b6-4741-8eb2-5215bf332bf5', '9605b025-d559-4a97-a8a0-3e1bd85cb6ac', 'd53b89ed-3848-4b25-af6e-8cce74295adf', 'db3bbe46-31ec-4022-96a0-b2a1eec66ba1', '48632fe0-00dd-42a5-808a-8d48a703c1db', 'a3c75a65-5063-4054-9414-c6a6a22fe6f0', 'e4ca54cf-3239-4268-af94-b488158783a4', '7913b552-9a51-4db9-9f3c-10506f88e51a', 'd9faee2d-998d-4c52-abcd-5f77bee496d5', '197d1cca-c153-4045-86fd-eb1887e62ac3', '69607e17-573e-45d6-972e-8d9abaf34a28', 'c8c242b4-0656-42e4-a093-4a192199bee8', 'f5b3cf02-bd06-4185-9f7a-822e456c4741', '7904e65e-0c93-4a2a-af8d-cf889a1fbdf6', 'd0764a8e-d7dd-4b1a-a323-c161b7f30a35', '1d440f73-2958-43c9-b40d-e68c99426d8b', '406f8d11-499c-474e-91f0-f094be48572c', 'a551aa99-1c57-4ddd-8a84-1085eeab03f7', 'f2c88f84-3b8e-42ef-ad52-28416880fafd', '262fb018-4bb2-420f-b0b8-c04ef770e3de', '929cb8a6-f93b-4772-82da-bc367277b339', '41800ed4-e309-4493-bbcf-767173d91286', 'afe6407b-e3de-4dbb-a43e-47ed57cb9c02', 'a3276677-fb1c-4791-82c3-f6a8a472d3a5', 'e6591a6e-6957-4282-8514-5daa480937d4', '1317d55b-87dc-4dac-9883-856850e51b55', 'b178a2de-254c-4785-9d0c-af8565d393cd', '95709e21-36dd-4393-9626-f653eee73cd1', '8314b33b-ca86-48fc-9d40-c08f6b6f5d37', '613e57e2-6fb8-488b-afbe-7e08da62e3fa', '6e03572a-467f-4eaa-bd18-41351b1bc0b9', '52503e65-d4dc-4435-85fa-192dc9b3c754', 'b7159aed-572b-46be-a5a2-631a278912a2', '22b2ac2d-5eb8-4c4d-a8d3-64069e78ed2e', '79f63c5a-38bf-4a2c-9158-ace6c99ecc95', 'cff1e0e8-5e6b-4944-95f6-da5d77226389', '90a69cca-f652-4811-af08-5a0a3295927f', '096524a6-ef04-4e25-8b5d-81946405d000', '7d290f58-3a69-4c90-9bce-b30f98e2fbdc', '38628237-f695-4b65-be35-29fa85b52620', '811f0b7d-b67c-44c1-b251-7001a4b99684', 'b3403ffb-b609-4603-b6a1-3b7371046fbd', '53cdca7c-b5d0-4331-b175-9b08ca62dbd3', '3cef1377-99cc-4404-8118-1179ede46c8e', 'f844fd6d-57a9-43c0-979e-6f32282fb951', 'a416c475-2dd9-4831-bd50-7e688f61087d', 'b9e493d5-3c0a-4597-b2c6-7931b8696c35', 'f9364347-c72f-4ca2-8145-2c9de0b83447', '48f976b1-1c5e-46c4-aaa3-1531fc0b166b', '26d01ba1-b929-4ae3-b73a-30722e4af47d', '7e8d3b2f-9874-4642-a4aa-93ff6ab9f807', '972f120f-2833-41b2-81a0-b436818db9a2', '09ffbd21-e4ca-4b0c-8348-35190899d463', '7aa91597-55f3-4384-9a9a-f0fce999a30f', '80b0c5e9-26f5-452a-b294-c1c02d815d3a', 'ac9d79f8-e78d-4f6a-85f6-aeaf9c788533', '483b774d-e703-4cf9-8aad-3a7bce0a8f4a', 'b56afd85-4fba-4401-9123-351cfd178d23', '82a5951b-ced4-4b99-a844-f48d2a08d43d', '6775d873-01e2-47e9-a5b4-fe7465030ab2', '806048b9-459c-40e3-bf15-02840c7bbb14', '4803e9e5-853d-4340-9dcc-f4332294c388', '1f54b6b2-92b3-494c-a6c9-e8e653f6e841', '53756038-c913-4ca5-af89-df9d2a299a14', '3dbd7642-a1aa-4c77-8eb1-2082b2e95aa4', '6017ca7b-5583-4c27-aeab-dce00f1e58fa', '0b900695-122c-4878-ab98-ca2ea5833d03', '297eec8e-b42c-45fc-b60b-673d07a6f02b', '9cf05be7-001c-458c-ab92-62ae56b9b7b2', '1004d272-791a-4098-a977-197267971914', '6826d4b1-6bc0-476b-907a-21bbdfaf5681', 'aee8f029-a33f-490e-a4e7-f812bc393543', 'bc60616d-e3a7-4d30-b4bb-1c67d18b8011', '76170f95-b602-4173-b107-3157d9b2689d', 'a5a99a18-1321-42d1-935f-a368fc49b42a', '62807fd1-65ec-4e62-8d62-2f8cece08880', '459b0996-4844-48bf-b6b3-b572979947c1', '2203cc3d-014e-4a7f-a858-6be6a37cbcb8', 'a1c770fa-0174-4dca-93de-cc32d25fbd70', '6343810b-2d8f-4b82-bc5b-1a271733e692', '8493fe27-6b2d-493f-bd16-3f33f89b98ce', 'babd8c73-d17b-4415-b2b6-0bda1d11e3d7', 'da101099-f723-40ef-ab0a-7b0ce13764d1', 'a5d95010-bf23-45cc-870f-9788e0719717', '425735b1-9702-4d2d-97c8-017ca6c70a96', 'b77bed78-5a2d-4712-b476-4d75b28be80b', 'c9efe342-5773-457b-8713-b25aae2b0e4b', 'a19d9f48-fa18-40b8-8507-9a7e3a41fbdf', 'b30975d6-0796-4a1f-be6b-56bcdf88f225', '4835d391-7c03-4ec0-a152-36ee21431dc8', '3f4494bf-ed73-4607-b822-e86944e70c1d', 'c196533d-0e6e-411d-bd75-9c623f2ec70a', '663258f8-8aba-498e-a798-fbb1113a518a', '35b7c175-1942-4d8b-a07e-d0159192bdf6', '6574d1ad-9237-4ca7-8607-8191c69ad00e', '30bf5cd8-1c3b-4f3b-b3c8-6668d3c127d3', 'db0ca8ff-5fef-4b8e-8d17-e2e69804d0e1', '098a13cd-d9b6-400a-b92d-8366d2c62579', '8872ff3d-9957-4db2-ae5d-5a64f1de07b4', '6d0b3194-d879-4694-a2fe-839b9bbf8370', 'e50058aa-88e0-4d14-b97b-96d2846ed1d0', '94cec447-73df-4c22-bd95-69bbbe8f70e9', '32476920-4cc7-44e9-92d8-0a6466898e66', '32b6eed0-e9a2-454c-afcc-91f4bc940843', '6e9480ff-9017-40b9-b049-e2c8edd3add1', '72cc0695-fa5a-45e0-8739-a9eceeecb9df', '90ccfafc-86a8-4b3d-8297-a3f83da548af', 'eb3745ef-e9a3-4bde-9003-44b65d5b0c58', '6a72e749-33e5-4ff2-83f1-e8e09b7a004f', 'b336867d-65ef-4ab4-944e-b232fe678a56', 'a9b38c78-6d80-40d8-833e-f5477eab534b', '25bfeffa-328b-41c7-8928-a700cf4d69ab', '110d105f-d45a-4513-ae71-e2bd2b83ba23', 'bf22bbd2-af57-49fc-adcd-6351d7a97477', '6235198e-3bd4-40c3-82e5-124f2231e0b8', '06ec9700-3c18-402b-a928-445944f35b92', 'd7f7b3cc-a0b3-4100-88ea-c7a7641da99f', '681d2f95-33c0-4d68-8658-22562afd62f7', 'f78bf8a7-982f-44d5-83da-68c66d65e446', '2b81ca8c-cfa4-49fd-9147-1bc2334019d8', 'ee5e2612-669a-4a38-a8b9-cc465f693094', 'b382e234-cc60-4c70-8fbb-17308969b799', '6592b11c-4ed6-4c32-81ff-9de280a34da2', '993dfda3-0b3a-45a7-9da6-d6c43d2b3ba4', '92c99113-37ce-4b2a-86a6-e7c98559ff02', '4517be8c-b914-46a0-9b72-6d130c6d3f07', 'edaa5a3c-9db8-4bef-b5f4-0c5fa1139bb2', '8a6f4fee-f2f2-41b2-a796-cb590340c147', 'f33d0a49-cb4a-49a0-b362-5e09047a02f9', '5774d1e9-a6d0-4248-87d0-add29b8aabbc', '7db2e5a0-9beb-4630-a273-e7ea6634f8cf', 'd6688271-f8f3-43fa-869f-4652574eb617', '9028b85b-4b82-4a68-a468-04a5766be506', 'e5905fc0-69ff-4383-8b14-2528d6f8f453', 'b289b8b4-f6ea-41f4-802d-79ffc1d8c40a', 'dd82cdcc-0feb-4939-b55a-5267c2244e5e', '2f52231d-7df2-4494-96f3-4422167f7718', 'd0e2da94-1ac3-4548-82f9-45c17f97cd78', '9f35e371-3640-4390-ba94-e011870c61d0', 'ee51179c-ed27-410f-bdc3-903c69b61e20', '9cebc958-eddb-4c43-b385-7986635967cb', 'c5e84000-0d63-4ee5-af2d-1416ff438c47', '445f8542-31a0-4702-9ece-200ffe738d4b', '67415d20-b535-45d4-b9cc-18cfbd2a18f5', '010a1014-f53f-4562-ba0d-6eb6209bf9f0', 'c0c57c5b-48ae-4911-bc6f-4fb29f75b6e2', 'ef2c6bd6-5908-4462-9981-98206857e48a', 'f6027256-b8a3-4503-ac40-aadb2fc9fe71', '269002d1-7c29-4010-8efc-30c46f3feccc', '28265baa-c323-43ac-bc49-ffee525ecaba', 'f12da24b-3b55-426a-b07e-aa6048ea6c85', '1829600f-a928-4bf6-9d47-cbf29d375e88', '31752df0-f572-4b58-aa81-a8f063abc01c', '7511bf21-2408-4371-89be-513d8a0bd7b4', '16173c89-8798-4e3a-8aec-62fe0d3829db', 'e6f69f60-fd56-46a3-8a00-6fa9d47a9121', '107ad96d-bbd8-4b6d-9bd5-c2f178d44b07', '7a605376-1411-4845-80c7-ea0ecec4e5c4', '3e4f4843-a584-4517-82ad-27e459adffec', '69619a11-609b-4c8b-8b60-9d51ebb0c646', 'c9063f79-6c8a-46b1-ac14-d697b0bb95c4', 'fdf0d8ee-303d-4e91-af89-f292bf30f40e', '89b9b637-e21e-4d71-8c8e-c4af655a22ac', '7af64d89-8e77-43df-b0cf-dbcdfbbf04a2', 'a60c9d30-9731-421e-8538-23cf28144cc9', 'c59b271e-d2fc-4bef-b9c4-c109e40ca341', '935d6049-fa1c-49bf-82dc-2f9c1619ab14', 'b1679934-550c-4b07-a17f-5e7d02dae25c', 'f3c23d09-0e87-4741-8c4f-7b7fb5da9d6b', 'e020f45b-a101-4095-b839-01dd80ea9f7f', '07850011-6af5-488e-a5e2-40b271dcc40c', 'cddde956-e1da-4129-bc8a-6a68fa7ce4cf', '22776945-d051-49d9-9647-178cfc4de1e3', '28880d5b-9091-4f35-9d19-f086c2dc619c', 'a8fad6a6-0a90-4df5-a9e6-d5768d9e73b0', '4944a88e-09b2-44ac-a31d-1e26e9b7010a', 'bcf86146-d4d9-4a4a-b09d-1abff8b3bbc7', 'a6194cc3-e497-4114-bcb2-ab7e77552d6f', 'b8facf9f-0ca5-427c-9eec-5962b476f693', '9dd5ec1e-8243-492f-98c9-dedb3202c83d');
[Auth Middleware] Request: GET /api/dashboard/main?tenantId=eb629ea8-7d69-47a1-b1f1-f9dcb33475f4&startDate=2025-11-01T03:00:00.000Z&endDate=2025-12-01T02:59:59.999Z
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = '77f853e9-deb2-4067-881e-71fa16d3054f';
Executing (default): SELECT "id", "name", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
ReferenceError: getNpsTrendData is not defined
    at Object.getMainDashboard (/usr/src/app/src/repositories/dashboardRepository.js:899:5)
    at /usr/src/app/src/controllers/dashboardController.js:9:53
    at asyncUtilWrap (/usr/src/app/node_modules/express-async-handler/index.js:3:20)
    at Layer.handle [as handle_request] (/usr/src/app/node_modules/express/lib/router/layer.js:95:5)
    at next (/usr/src/app/node_modules/express/lib/router/route.js:149:13)
    at /usr/src/app/src/middlewares/authMiddleware.js:113:9
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
Executing (default): SELECT "Resposta"."id", "Resposta"."perguntaId", "Resposta"."pesquisaId", "Resposta"."tenantId", "Resposta"."atendenteId", "Resposta"."respondentSessionId", "Resposta"."ratingValue", "Resposta"."textValue", "Resposta"."selectedOption", "Resposta"."createdAt", "Resposta"."updatedAt", "pergunta"."id" AS "pergunta.id", "pergunta"."type" AS "pergunta.type" FROM "respostas" AS "Resposta" INNER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Resposta"."ratingValue" IS NOT NULL;
Executing (default): SELECT date_trunc('day', "createdAt") AS "period", COUNT("id") AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' GROUP BY date_trunc('day', "createdAt") ORDER BY date_trunc('day', "createdAt") ASC;
Executing (default): SELECT count(DISTINCT("respondentSessionId")) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Resposta"."ratingValue" >= 9 AND "Resposta"."respondentSessionId" IS NOT NULL;
Executing (default): SELECT count(*) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Cupom"."status" = 'used';
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
[Auth Middleware] Request: GET /api/dashboard/main?tenantId=eb629ea8-7d69-47a1-b1f1-f9dcb33475f4&startDate=2025-11-17T03:00:00.000Z&endDate=2025-11-24T02:59:59.999Z
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = '77f853e9-deb2-4067-881e-71fa16d3054f';
Executing (default): SELECT "id", "name", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
ReferenceError: getNpsTrendData is not defined
    at Object.getMainDashboard (/usr/src/app/src/repositories/dashboardRepository.js:899:5)
    at /usr/src/app/src/controllers/dashboardController.js:9:53
    at asyncUtilWrap (/usr/src/app/node_modules/express-async-handler/index.js:3:20)
    at Layer.handle [as handle_request] (/usr/src/app/node_modules/express/lib/router/layer.js:95:5)
    at next (/usr/src/app/node_modules/express/lib/router/route.js:149:13)
    at /usr/src/app/src/middlewares/authMiddleware.js:113:9
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
Executing (default): SELECT "Resposta"."id", "Resposta"."perguntaId", "Resposta"."pesquisaId", "Resposta"."tenantId", "Resposta"."atendenteId", "Resposta"."respondentSessionId", "Resposta"."ratingValue", "Resposta"."textValue", "Resposta"."selectedOption", "Resposta"."createdAt", "Resposta"."updatedAt", "pergunta"."id" AS "pergunta.id", "pergunta"."type" AS "pergunta.type" FROM "respostas" AS "Resposta" INNER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Resposta"."ratingValue" IS NOT NULL;
Executing (default): SELECT date_trunc('day', "createdAt") AS "period", COUNT("id") AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' GROUP BY date_trunc('day', "createdAt") ORDER BY date_trunc('day', "createdAt") ASC;
Executing (default): SELECT count(DISTINCT("respondentSessionId")) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Resposta"."ratingValue" >= 9 AND "Resposta"."respondentSessionId" IS NOT NULL;
Executing (default): SELECT count(*) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Cupom"."status" = 'used';
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
[Auth Middleware] Request: GET /api/dashboard/main
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = '77f853e9-deb2-4067-881e-71fa16d3054f';
Executing (default): SELECT "id", "name", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
ReferenceError: getNpsTrendData is not defined
    at Object.getMainDashboard (/usr/src/app/src/repositories/dashboardRepository.js:899:5)
    at /usr/src/app/src/controllers/dashboardController.js:9:53
    at asyncUtilWrap (/usr/src/app/node_modules/express-async-handler/index.js:3:20)
    at Layer.handle [as handle_request] (/usr/src/app/node_modules/express/lib/router/layer.js:95:5)
    at next (/usr/src/app/node_modules/express/lib/router/route.js:149:13)
    at /usr/src/app/src/middlewares/authMiddleware.js:113:9
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
Executing (default): SELECT "Resposta"."id", "Resposta"."perguntaId", "Resposta"."pesquisaId", "Resposta"."tenantId", "Resposta"."atendenteId", "Resposta"."respondentSessionId", "Resposta"."ratingValue", "Resposta"."textValue", "Resposta"."selectedOption", "Resposta"."createdAt", "Resposta"."updatedAt", "pergunta"."id" AS "pergunta.id", "pergunta"."type" AS "pergunta.type" FROM "respostas" AS "Resposta" INNER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Resposta"."ratingValue" IS NOT NULL;
Executing (default): SELECT date_trunc('day', "createdAt") AS "period", COUNT("id") AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' GROUP BY date_trunc('day', "createdAt") ORDER BY date_trunc('day', "createdAt") ASC;
Executing (default): SELECT count(DISTINCT("respondentSessionId")) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Resposta"."ratingValue" >= 9 AND "Resposta"."respondentSessionId" IS NOT NULL;
Executing (default): SELECT count(*) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Cupom"."status" = 'used';
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
[Auth Middleware] Request: GET /api/dashboard/main?tenantId=eb629ea8-7d69-47a1-b1f1-f9dcb33475f4&startDate=2025-10-24T03:00:00.000Z&endDate=2025-11-24T02:59:59.999Z
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = '77f853e9-deb2-4067-881e-71fa16d3054f';
Executing (default): SELECT "id", "name", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
ReferenceError: getNpsTrendData is not defined
    at Object.getMainDashboard (/usr/src/app/src/repositories/dashboardRepository.js:899:5)
    at /usr/src/app/src/controllers/dashboardController.js:9:53
    at asyncUtilWrap (/usr/src/app/node_modules/express-async-handler/index.js:3:20)
    at Layer.handle [as handle_request] (/usr/src/app/node_modules/express/lib/router/layer.js:95:5)
    at next (/usr/src/app/node_modules/express/lib/router/route.js:149:13)
    at /usr/src/app/src/middlewares/authMiddleware.js:113:9
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
Executing (default): SELECT "Resposta"."id", "Resposta"."perguntaId", "Resposta"."pesquisaId", "Resposta"."tenantId", "Resposta"."atendenteId", "Resposta"."respondentSessionId", "Resposta"."ratingValue", "Resposta"."textValue", "Resposta"."selectedOption", "Resposta"."createdAt", "Resposta"."updatedAt", "pergunta"."id" AS "pergunta.id", "pergunta"."type" AS "pergunta.type" FROM "respostas" AS "Resposta" INNER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Resposta"."ratingValue" IS NOT NULL;
Executing (default): SELECT date_trunc('day', "createdAt") AS "period", COUNT("id") AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' GROUP BY date_trunc('day', "createdAt") ORDER BY date_trunc('day', "createdAt") ASC;
Executing (default): SELECT count(DISTINCT("respondentSessionId")) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Resposta"."ratingValue" >= 9 AND "Resposta"."respondentSessionId" IS NOT NULL;
Executing (default): SELECT count(*) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Cupom"."status" = 'used';
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
[Auth Middleware] Request: GET /api/dashboard/daily-report?tenantId=eb629ea8-7d69-47a1-b1f1-f9dcb33475f4&startDate=2025-11-23T03:00:00.000Z&endDate=2025-11-24T02:59:59.999Z
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = '77f853e9-deb2-4067-881e-71fa16d3054f';
Executing (default): SELECT "id", "name", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT "Resposta"."id", "Resposta"."perguntaId", "Resposta"."pesquisaId", "Resposta"."tenantId", "Resposta"."atendenteId", "Resposta"."respondentSessionId", "Resposta"."ratingValue", "Resposta"."textValue", "Resposta"."selectedOption", "Resposta"."createdAt", "Resposta"."updatedAt", "pergunta"."id" AS "pergunta.id", "pergunta"."type" AS "pergunta.type" FROM "respostas" AS "Resposta" INNER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Resposta"."ratingValue" IS NOT NULL;
Executing (default): SELECT "Resposta"."id", "Resposta"."createdAt", "Resposta"."textValue", "Resposta"."ratingValue", "Resposta"."respondentSessionId", "client"."id" AS "client.id", "client"."name" AS "client.name" FROM "respostas" AS "Resposta" LEFT OUTER JOIN "clients" AS "client" ON "Resposta"."respondentSessionId" = "client"."respondentSessionId" WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Resposta"."textValue" != '' ORDER BY "Resposta"."createdAt" DESC LIMIT 7;
Executing (default): SELECT count(DISTINCT("respondentSessionId")) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Resposta"."ratingValue" >= 9 AND "Resposta"."respondentSessionId" IS NOT NULL;
Executing (default): SELECT count(*) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Cupom"."status" = 'used';
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';