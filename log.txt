nc: getaddrinfo for host "postgres" port 5432: Name or service not known
Postgres is unavailable - sleeping
Postgres is up - executing command
Server.js is being executed!
JWT Secret loaded: ********
JWT Secret length: 32
Conexão com o banco de dados estabelecida com sucesso (Sequelize).
Server is running on port 5000
Agendador de relatório diário iniciado. A tarefa será executada todos os dias às 8:00.
Agendador de relatório semanal iniciado. A tarefa será executada toda segunda-feira às 8:00.
Agendador de relatório mensal iniciado. A tarefa será executada todo dia 1º, às 8:00.
Agendador de lembrete de cupons iniciado. A tarefa será executada todos os dias às 9:00.
Agendador de automação de aniversário iniciado. A tarefa será executada todos os dias às 9:00.
Agendador de expiração de cupons iniciado. A tarefa será executada todo dia à meia-noite.
[SenderMonitorJob] Job de monitoramento de disparadores inicializado para rodar a cada 5 minutos.
[WarmingUpProgressJob] Job de progressão de aquecimento inicializado para rodar diariamente à 1h.
[CampaignMonitorJob] Job de monitoramento de campanhas inicializado para rodar a cada 10 minutos.
Agendador de processamento de premiações iniciado. A tarefa será executada todo dia às 2h.
[iFood Polling Job] Scheduling iFood polling to run every 30 seconds
[Delivery Much Polling Job] Scheduling polling to run every */5 * * * *
[Post-Sale Survey Job] Iniciando agendamento de pesquisas...
[CampanhaService] Inicializando campanhas agendadas...
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."status" = 'scheduled' AND "Campanha"."startDate" IS NOT NULL;
[CampanhaService] 0 campanhas reagendadas.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-01-22 14:06:00.068 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-01-22 14:07:00.088 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-01-22 14:08:00.042 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-01-22 14:09:00.026 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[CAMPAIGN_MONITOR] Iniciando verificação de campanhas pausadas...
[iFood Job] Starting Polling...
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[Delivery Much Job] Starting Polling...
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."status" = 'paused';
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-01-22 14:10:00.104 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
[CAMPAIGN_MONITOR] Nenhuma campanha pausada encontrada.
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-01-22 14:11:00.048 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-01-22 14:12:00.036 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-01-22 14:13:00.036 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-01-22 14:14:00.038 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[Delivery Much Job] Starting Polling...
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-01-22 14:15:00.081 +00:00' LIMIT 50;
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-01-22 14:16:00.056 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-01-22 14:17:00.035 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-01-22 14:18:00.040 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-01-22 14:19:00.037 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[CAMPAIGN_MONITOR] Iniciando verificação de campanhas pausadas...
[Delivery Much Job] Starting Polling...
[iFood Job] Starting Polling...
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."status" = 'paused';
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
[CAMPAIGN_MONITOR] Nenhuma campanha pausada encontrada.
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-01-22 14:20:00.119 +00:00' LIMIT 50;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
[Auth Middleware] Request: POST /api/auth/verify-token
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."ifoodAuthVerifier" AS "tenant.ifoodAuthVerifier", "tenant"."deliveryMuchClientId" AS "tenant.deliveryMuchClientId", "tenant"."deliveryMuchClientSecret" AS "tenant.deliveryMuchClientSecret", "tenant"."deliveryMuchUsername" AS "tenant.deliveryMuchUsername", "tenant"."deliveryMuchPassword" AS "tenant.deliveryMuchPassword", "tenant"."deliveryMuchToken" AS "tenant.deliveryMuchToken", "tenant"."deliveryMuchTokenExpiresAt" AS "tenant.deliveryMuchTokenExpiresAt", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."plan" AS "tenant.plan", "tenant"."planExpiresAt" AS "tenant.planExpiresAt", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = '77f853e9-deb2-4067-881e-71fa16d3054f';
[Auth Middleware] Request: GET /api/tenants/me
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."ifoodAuthVerifier" AS "tenant.ifoodAuthVerifier", "tenant"."deliveryMuchClientId" AS "tenant.deliveryMuchClientId", "tenant"."deliveryMuchClientSecret" AS "tenant.deliveryMuchClientSecret", "tenant"."deliveryMuchUsername" AS "tenant.deliveryMuchUsername", "tenant"."deliveryMuchPassword" AS "tenant.deliveryMuchPassword", "tenant"."deliveryMuchToken" AS "tenant.deliveryMuchToken", "tenant"."deliveryMuchTokenExpiresAt" AS "tenant.deliveryMuchTokenExpiresAt", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."plan" AS "tenant.plan", "tenant"."planExpiresAt" AS "tenant.planExpiresAt", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = '77f853e9-deb2-4067-881e-71fa16d3054f';
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'tenants' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT "id", "name", "address", "phone", "email", "cnpj", "description", "logoUrl", "createdAt", "reportPhoneNumber", "uairangoEstablishmentId", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt", "ifoodClientId", "ifoodClientSecret", "ifoodAuthVerifier", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
[Auth Middleware] Request: GET /api/dashboard/summary
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."ifoodAuthVerifier" AS "tenant.ifoodAuthVerifier", "tenant"."deliveryMuchClientId" AS "tenant.deliveryMuchClientId", "tenant"."deliveryMuchClientSecret" AS "tenant.deliveryMuchClientSecret", "tenant"."deliveryMuchUsername" AS "tenant.deliveryMuchUsername", "tenant"."deliveryMuchPassword" AS "tenant.deliveryMuchPassword", "tenant"."deliveryMuchToken" AS "tenant.deliveryMuchToken", "tenant"."deliveryMuchTokenExpiresAt" AS "tenant.deliveryMuchTokenExpiresAt", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."plan" AS "tenant.plan", "tenant"."planExpiresAt" AS "tenant.planExpiresAt", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = '77f853e9-deb2-4067-881e-71fa16d3054f';
[Auth Middleware] Request: GET /api/dashboard/attendants-performance
[Auth Middleware] Request: GET /api/dashboard/response-chart
[Auth Middleware] Request: GET /api/dashboard/surveys-responded-chart
[Auth Middleware] Request: GET /api/dashboard/recent-feedbacks?page=1&limit=10
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."ifoodAuthVerifier" AS "tenant.ifoodAuthVerifier", "tenant"."deliveryMuchClientId" AS "tenant.deliveryMuchClientId", "tenant"."deliveryMuchClientSecret" AS "tenant.deliveryMuchClientSecret", "tenant"."deliveryMuchUsername" AS "tenant.deliveryMuchUsername", "tenant"."deliveryMuchPassword" AS "tenant.deliveryMuchPassword", "tenant"."deliveryMuchToken" AS "tenant.deliveryMuchToken", "tenant"."deliveryMuchTokenExpiresAt" AS "tenant.deliveryMuchTokenExpiresAt", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."plan" AS "tenant.plan", "tenant"."planExpiresAt" AS "tenant.planExpiresAt", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = '77f853e9-deb2-4067-881e-71fa16d3054f';
[Auth Middleware] Request: GET /api/dashboard/criteria-scores
[Auth Middleware] Request: GET /api/dashboard/conversion-chart
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."ifoodAuthVerifier" AS "tenant.ifoodAuthVerifier", "tenant"."deliveryMuchClientId" AS "tenant.deliveryMuchClientId", "tenant"."deliveryMuchClientSecret" AS "tenant.deliveryMuchClientSecret", "tenant"."deliveryMuchUsername" AS "tenant.deliveryMuchUsername", "tenant"."deliveryMuchPassword" AS "tenant.deliveryMuchPassword", "tenant"."deliveryMuchToken" AS "tenant.deliveryMuchToken", "tenant"."deliveryMuchTokenExpiresAt" AS "tenant.deliveryMuchTokenExpiresAt", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."plan" AS "tenant.plan", "tenant"."planExpiresAt" AS "tenant.planExpiresAt", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = '77f853e9-deb2-4067-881e-71fa16d3054f';
[Auth Middleware] Request: GET /api/dashboard/nps-trend?period=day
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."ifoodAuthVerifier" AS "tenant.ifoodAuthVerifier", "tenant"."deliveryMuchClientId" AS "tenant.deliveryMuchClientId", "tenant"."deliveryMuchClientSecret" AS "tenant.deliveryMuchClientSecret", "tenant"."deliveryMuchUsername" AS "tenant.deliveryMuchUsername", "tenant"."deliveryMuchPassword" AS "tenant.deliveryMuchPassword", "tenant"."deliveryMuchToken" AS "tenant.deliveryMuchToken", "tenant"."deliveryMuchTokenExpiresAt" AS "tenant.deliveryMuchTokenExpiresAt", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."plan" AS "tenant.plan", "tenant"."planExpiresAt" AS "tenant.planExpiresAt", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = '77f853e9-deb2-4067-881e-71fa16d3054f';
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."ifoodAuthVerifier" AS "tenant.ifoodAuthVerifier", "tenant"."deliveryMuchClientId" AS "tenant.deliveryMuchClientId", "tenant"."deliveryMuchClientSecret" AS "tenant.deliveryMuchClientSecret", "tenant"."deliveryMuchUsername" AS "tenant.deliveryMuchUsername", "tenant"."deliveryMuchPassword" AS "tenant.deliveryMuchPassword", "tenant"."deliveryMuchToken" AS "tenant.deliveryMuchToken", "tenant"."deliveryMuchTokenExpiresAt" AS "tenant.deliveryMuchTokenExpiresAt", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."plan" AS "tenant.plan", "tenant"."planExpiresAt" AS "tenant.planExpiresAt", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = '77f853e9-deb2-4067-881e-71fa16d3054f';
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."ifoodAuthVerifier" AS "tenant.ifoodAuthVerifier", "tenant"."deliveryMuchClientId" AS "tenant.deliveryMuchClientId", "tenant"."deliveryMuchClientSecret" AS "tenant.deliveryMuchClientSecret", "tenant"."deliveryMuchUsername" AS "tenant.deliveryMuchUsername", "tenant"."deliveryMuchPassword" AS "tenant.deliveryMuchPassword", "tenant"."deliveryMuchToken" AS "tenant.deliveryMuchToken", "tenant"."deliveryMuchTokenExpiresAt" AS "tenant.deliveryMuchTokenExpiresAt", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."plan" AS "tenant.plan", "tenant"."planExpiresAt" AS "tenant.planExpiresAt", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = '77f853e9-deb2-4067-881e-71fa16d3054f';
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."ifoodAuthVerifier" AS "tenant.ifoodAuthVerifier", "tenant"."deliveryMuchClientId" AS "tenant.deliveryMuchClientId", "tenant"."deliveryMuchClientSecret" AS "tenant.deliveryMuchClientSecret", "tenant"."deliveryMuchUsername" AS "tenant.deliveryMuchUsername", "tenant"."deliveryMuchPassword" AS "tenant.deliveryMuchPassword", "tenant"."deliveryMuchToken" AS "tenant.deliveryMuchToken", "tenant"."deliveryMuchTokenExpiresAt" AS "tenant.deliveryMuchTokenExpiresAt", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."plan" AS "tenant.plan", "tenant"."planExpiresAt" AS "tenant.planExpiresAt", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = '77f853e9-deb2-4067-881e-71fa16d3054f';
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."ifoodAuthVerifier" AS "tenant.ifoodAuthVerifier", "tenant"."deliveryMuchClientId" AS "tenant.deliveryMuchClientId", "tenant"."deliveryMuchClientSecret" AS "tenant.deliveryMuchClientSecret", "tenant"."deliveryMuchUsername" AS "tenant.deliveryMuchUsername", "tenant"."deliveryMuchPassword" AS "tenant.deliveryMuchPassword", "tenant"."deliveryMuchToken" AS "tenant.deliveryMuchToken", "tenant"."deliveryMuchTokenExpiresAt" AS "tenant.deliveryMuchTokenExpiresAt", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."plan" AS "tenant.plan", "tenant"."planExpiresAt" AS "tenant.planExpiresAt", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = '77f853e9-deb2-4067-881e-71fa16d3054f';
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT "Resposta"."id", "Resposta"."perguntaId", "Resposta"."pesquisaId", "Resposta"."tenantId", "Resposta"."atendenteId", "Resposta"."respondentSessionId", "Resposta"."ratingValue", "Resposta"."textValue", "Resposta"."selectedOption", "Resposta"."createdAt", "Resposta"."updatedAt", "pergunta"."id" AS "pergunta.id", "pergunta"."type" AS "pergunta.type", "pergunta"."criterioId" AS "pergunta.criterioId" FROM "respostas" AS "Resposta" INNER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Resposta"."ratingValue" IS NOT NULL;
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT "Atendente"."id", "Atendente"."tenantId", "Atendente"."name", "Atendente"."code", "Atendente"."status", "Atendente"."createdAt", "Atendente"."updatedAt", "meta"."id" AS "meta.id", "meta"."atendenteId" AS "meta.atendenteId", "meta"."tenantId" AS "meta.tenantId", "meta"."npsGoal" AS "meta.npsGoal", "meta"."responsesGoal" AS "meta.responsesGoal", "meta"."registrationsGoal" AS "meta.registrationsGoal", "meta"."period" AS "meta.period", "meta"."dias_trabalhados" AS "meta.dias_trabalhados", "meta"."nps_premio_valor" AS "meta.nps_premio_valor", "meta"."respostas_premio_valor" AS "meta.respostas_premio_valor", "meta"."cadastros_premio_valor" AS "meta.cadastros_premio_valor", "meta"."createdAt" AS "meta.createdAt", "meta"."updatedAt" AS "meta.updatedAt" FROM "atendentes" AS "Atendente" LEFT OUTER JOIN "atendente_metas" AS "meta" ON "Atendente"."id" = "meta"."atendenteId" WHERE "Atendente"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Atendente"."status" = 'active';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT date_trunc('day', "createdAt" AT TIME ZONE 'America/Sao_Paulo') AS "period", COUNT(DISTINCT("respondentSessionId")) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Resposta"."respondentSessionId" IS NOT NULL GROUP BY date_trunc('day', "createdAt" AT TIME ZONE 'America/Sao_Paulo') ORDER BY date_trunc('day', "createdAt" AT TIME ZONE 'America/Sao_Paulo') ASC;
Executing (default): SELECT date_trunc('day', "createdAt" AT TIME ZONE 'America/Sao_Paulo') AS "period", COUNT("id") AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' GROUP BY date_trunc('day', "createdAt" AT TIME ZONE 'America/Sao_Paulo') ORDER BY date_trunc('day', "createdAt" AT TIME ZONE 'America/Sao_Paulo') ASC;
Executing (default): SELECT count(*) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT DISTINCT("respondentSessionId") AS "respondentSessionId", MIN("createdAt") AS "firstResponseAt" FROM "respostas" AS "Resposta" WHERE ("Resposta"."ratingValue" IS NOT NULL OR "Resposta"."textValue" != '') AND "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' GROUP BY "respondentSessionId" ORDER BY "firstResponseAt" DESC LIMIT 10 OFFSET 0;
Executing (default): SELECT "Criterio"."id", "Criterio"."tenantId", "Criterio"."name", "Criterio"."description", "Criterio"."type", "Criterio"."createdAt", "Criterio"."updatedAt", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas->respostas"."id" AS "perguntas.respostas.id", "perguntas->respostas"."ratingValue" AS "perguntas.respostas.ratingValue" FROM "criterios" AS "Criterio" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Criterio"."id" = "perguntas"."criterioId" LEFT OUTER JOIN "respostas" AS "perguntas->respostas" ON "perguntas"."id" = "perguntas->respostas"."perguntaId" AND "perguntas->respostas"."ratingValue" IS NOT NULL AND "perguntas->respostas"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' WHERE "Criterio"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' ORDER BY "Criterio"."name" ASC;
Executing (default): SELECT date_trunc('day', "Resposta"."createdAt" AT TIME ZONE 'America/Sao_Paulo') AS "period", SUM(CASE WHEN "ratingValue" >= 9 THEN 1 ELSE 0 END) AS "promoters", SUM(CASE WHEN "ratingValue" <= 6 THEN 1 ELSE 0 END) AS "detractors", COUNT("Resposta"."id") AS "total" FROM "respostas" AS "Resposta" INNER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" AND "pergunta"."type" = 'rating_0_10' WHERE "Resposta"."ratingValue" IS NOT NULL AND "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' GROUP BY date_trunc('day', "Resposta"."createdAt" AT TIME ZONE 'America/Sao_Paulo') ORDER BY date_trunc('day', "Resposta"."createdAt" AT TIME ZONE 'America/Sao_Paulo') ASC;
Executing (default): SELECT "Resposta"."atendenteId", SUM(CASE WHEN "ratingValue" >= 9 THEN 1 ELSE 0 END) AS "promoters", SUM(CASE WHEN "ratingValue" <= 6 THEN 1 ELSE 0 END) AS "detractors", COUNT("Resposta"."id") AS "total" FROM "respostas" AS "Resposta" INNER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" AND "pergunta"."type" = 'rating_0_10' WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Resposta"."atendenteId" IN ('87ccfbbd-4e8c-41ec-afc9-b3e14aacfdb0', '67781806-855c-4e48-bf39-d1305176420a', '8ca6325c-8827-4cbf-982c-d734dcb66116', 'e1e57c66-5381-4734-a24c-ecddfa5d3d86', 'd1ec3ff8-81b0-4d89-9d7b-9da2f859fc07', '56d7b27f-9789-406c-b233-387395e14979', 'acdfd682-bf68-45d0-897a-84709d985ce9', 'ea4a3a3f-b4a1-4656-ae4e-1fee3feb89f7') AND "Resposta"."ratingValue" IS NOT NULL GROUP BY "atendenteId";
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT count(DISTINCT("respondentSessionId")) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Resposta"."ratingValue" >= 9 AND "Resposta"."respondentSessionId" IS NOT NULL;
Executing (default): SELECT "atendenteId", COUNT(DISTINCT("respondentSessionId")) AS "surveyCount" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Resposta"."atendenteId" IN ('87ccfbbd-4e8c-41ec-afc9-b3e14aacfdb0', '67781806-855c-4e48-bf39-d1305176420a', '8ca6325c-8827-4cbf-982c-d734dcb66116', 'e1e57c66-5381-4734-a24c-ecddfa5d3d86', 'd1ec3ff8-81b0-4d89-9d7b-9da2f859fc07', '56d7b27f-9789-406c-b233-387395e14979', 'acdfd682-bf68-45d0-897a-84709d985ce9', 'ea4a3a3f-b4a1-4656-ae4e-1fee3feb89f7') GROUP BY "atendenteId";
Executing (default): SELECT "Resposta"."id", "Resposta"."perguntaId", "Resposta"."pesquisaId", "Resposta"."tenantId", "Resposta"."atendenteId", "Resposta"."respondentSessionId", "Resposta"."ratingValue", "Resposta"."textValue", "Resposta"."selectedOption", "Resposta"."createdAt", "Resposta"."updatedAt", "pergunta"."id" AS "pergunta.id", "pergunta"."text" AS "pergunta.text", "pergunta"."type" AS "pergunta.type", "client"."id" AS "client.id", "client"."name" AS "client.name", "client"."phone" AS "client.phone", "client"."email" AS "client.email", "tratativa"."id" AS "tratativa.id", "tratativa"."respondentSessionId" AS "tratativa.respondentSessionId", "tratativa"."tenantId" AS "tratativa.tenantId", "tratativa"."status" AS "tratativa.status", "tratativa"."notes" AS "tratativa.notes", "tratativa"."createdAt" AS "tratativa.createdAt", "tratativa"."updatedAt" AS "tratativa.updatedAt" FROM "respostas" AS "Resposta" LEFT OUTER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" LEFT OUTER JOIN "clients" AS "client" ON "Resposta"."respondentSessionId" = "client"."respondentSessionId" LEFT OUTER JOIN "tratativas" AS "tratativa" ON "tratativa"."respondentSessionId" = "Resposta"."respondentSessionId" WHERE "Resposta"."respondentSessionId" IN ('82d61318-55b8-4638-94fb-33712aa248f9', '4596b1dc-890b-4c4f-b0aa-b0bea686848a', '867a06d8-c6bc-4d0a-86bb-aded99864ac5', '97856703-caf3-4819-8e81-8d3b1038b424', '58509c9d-d9d4-4fd3-8103-710c19c329b5', '72e94f71-f2d1-4977-87cf-8f659493549c', '2c60506f-5e72-46c0-a26c-4d7c15a67511', '7cd0d9ad-5f65-4d28-94f7-a087bb90e8c9', '9615d2a3-2c33-4c0d-a785-026a2408775c', 'b026cb95-b3e4-4d15-adab-e59b4a0d935c') ORDER BY "Resposta"."createdAt" ASC;
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT "atendenteId", "respondentSessionId" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Resposta"."atendenteId" IN ('87ccfbbd-4e8c-41ec-afc9-b3e14aacfdb0', '67781806-855c-4e48-bf39-d1305176420a', '8ca6325c-8827-4cbf-982c-d734dcb66116', 'e1e57c66-5381-4734-a24c-ecddfa5d3d86', 'd1ec3ff8-81b0-4d89-9d7b-9da2f859fc07', '56d7b27f-9789-406c-b233-387395e14979', 'acdfd682-bf68-45d0-897a-84709d985ce9', 'ea4a3a3f-b4a1-4656-ae4e-1fee3feb89f7') AND "Resposta"."respondentSessionId" IS NOT NULL GROUP BY "atendenteId", "respondentSessionId";
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT count(DISTINCT("respondentSessionId")) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Resposta"."respondentSessionId" IS NOT NULL;
Executing (default): SELECT "id", "respondentSessionId" FROM "clients" AS "Client" WHERE "Client"."respondentSessionId" IN ('e88be516-c716-4b79-ae7d-53535ee787eb', '0b3f31b9-a499-4359-8d4b-09657ed5f688', 'cd0e1f53-dd27-4265-b5e7-bf01730bba9c', 'a4fff74b-3edb-49e4-b6d5-9133755bd251', '425735b1-9702-4d2d-97c8-017ca6c70a96', 'a6194cc3-e497-4114-bcb2-ab7e77552d6f', '92f7444a-beac-4f10-9f05-c7dfb6d668ba', '975a0795-7f85-4adb-ad50-41b60b57f345', 'b026d8ac-bec1-4294-9911-5b7734d29177', '4835d391-7c03-4ec0-a152-36ee21431dc8', '39e6ec28-7b90-4ef4-bf6d-fe9ee0032e2a', '522f418b-ed41-46b5-b088-52e22c8e489a', 'c6284f47-86cd-42da-9c9b-74d18d7c1832', '1d1bf877-5ac9-409f-a772-29750eeeee4f', '08dc49c4-a608-4770-8fa3-29d3d53e3efe', '80b0c5e9-26f5-452a-b294-c1c02d815d3a', '85467cf4-a7c0-4e42-9539-2f06654ef673', 'dcc9491e-fa84-4fff-aa77-d3501c22bf81', 'cc51f4b0-a9e2-4afd-8b73-93b2f7b1794d', 'bcf86146-d4d9-4a4a-b09d-1abff8b3bbc7', 'e760050e-3c16-4f09-836a-163a7819f3b5', '6447d7ab-570c-4b58-9103-14c9b3b4a5bf', '7c74149c-ab4c-45f0-8c9d-8ef8b5434f43', '537c2470-3fbc-41aa-afd5-ba5f65c3a87d', '192eef6d-f252-44f7-b516-4e6b0f7a5af1', '9e1747d6-10b5-4194-bfb9-2af9716f2552', 'bc60616d-e3a7-4d30-b4bb-1c67d18b8011', '7af45ed7-3ab9-4851-a699-3885cbed5c19', '905eed12-659c-4d0e-afaa-14095bd74943', 'fc813115-b85c-49f7-8d44-ab0e49c4d9c0', '24549ec3-3279-43ea-b74e-513c31e92132', '3f6c65e7-248d-4301-b705-aa435f9f6851', '40e1b67e-304c-44ce-8b47-ca86d302cf47', '8b7bc56c-2698-4080-8f3f-4371e49387c0', '3f764ac1-e868-4003-abfb-77a8a77d7476', 'b39917d0-425a-4077-a162-ee65f67fef33', 'e6145a85-30d9-4f25-bad2-9cf1862be049', '24ad3ceb-a88e-4698-8ece-4e122a460250', 'b30975d6-0796-4a1f-be6b-56bcdf88f225', 'b7b9d1ce-6db0-473d-baec-de54d8c55bb0', '26598efc-3f88-4189-a6bf-616210b890f4', 'e7237234-e899-4789-b296-bdefa65fc0ef', '8bc27afd-e2ae-4d6a-9e31-fc5e8a51a482', 'd34c0875-9dc0-47b5-8af7-168a7f75dc02', '8cc834a7-6e1c-4cab-a165-4dfa6614391c', '0f01b866-5266-4752-a4a5-d5f8629d2cf0', 'c913e5be-f7c1-4023-b057-6df788260cc7', '92c99113-37ce-4b2a-86a6-e7c98559ff02', '0745119a-c1ad-4fad-96a7-9df277d76dce', 'ee257a6d-a2af-416f-b4ac-8c471d66a0da', '96d87b5e-39d6-4bab-8957-e51d69f126df', '9bcaca1c-8538-4422-938c-d5f53fc1a9c4', '027b0997-ecfb-44a1-8804-05156cc862d0', '5a99b98a-b3ae-4b97-a5a3-d911e0097c18', 'c17d2b6f-d725-4320-85ae-cd65502ba9fa', '3f4494bf-ed73-4607-b822-e86944e70c1d', '68882c2f-8b9a-4e2a-965c-78ebd7ce2d1f', '3dbd7642-a1aa-4c77-8eb1-2082b2e95aa4', 'd1907094-5c53-4348-9b18-cfee5415a3d1', '5e82b493-7c47-4b20-b59b-2568ea9c8546', '28880d5b-9091-4f35-9d19-f086c2dc619c', 'e33c0d07-a2ca-4f30-bd8e-dc0eee547939', 'cd0e1f53-dd27-4265-b5e7-bf01730bba9c', '852da06a-47c1-499b-ada2-df76e774eed3', '695ab278-7535-4826-ae7b-af3c844c443c', '72dc4f44-8a81-4e1c-b88a-f134cdb8e731', '27a1f6a2-65b6-4741-8eb2-5215bf332bf5', 'e659f32a-d442-4293-b3e1-c60059c977f4', 'a9670f8d-b15d-4628-b78c-96996a370625', '922a9b36-a01e-4a90-82d5-2db6c17f75b7', '18cae750-a206-437d-928f-a83c501ec1ae', 'befc9545-51d5-4f6b-83a6-38f3864c5493', '747d5e8d-dc13-4d1f-8f2e-6348377f21ee', '867a06d8-c6bc-4d0a-86bb-aded99864ac5', 'bb1368ea-38a6-4a91-afc5-da17ebd123fa', '03b06e2a-fab5-4969-8d7e-e95051da9e02', '719fde9f-0e04-44db-b42d-3c372bc4c1dd', 'bb1368ea-38a6-4a91-afc5-da17ebd123fa', '2d82dbae-c9a7-438a-97d0-2dc6ab1cb2e5', '657d4c4a-08ce-431b-a526-f31286907ca5', '9bf823c6-ac0d-4971-a41f-eda339505024', 'ebc3121a-6fef-4191-9d27-ce7fa4f1ebcb', '09ffbd21-e4ca-4b0c-8348-35190899d463', '50c4434e-4030-47c3-b7b6-14eee6c578c9', '22776945-d051-49d9-9647-178cfc4de1e3', '1d24dd0a-e82c-42b7-aa04-bea6be1a3d51', '934a7943-92b9-4fea-8107-84b7cfbfa81c', 'c9efe342-5773-457b-8713-b25aae2b0e4b', 'a2aa69ea-0ce6-4d10-be1d-f8f53f9b08fe', '269002d1-7c29-4010-8efc-30c46f3feccc', '3cddea8c-4f62-48d9-9357-633ca2885e0c', 'e4cd7956-6f89-4b09-a0d7-13aa12152606', '3d6920f2-f812-4d16-aaab-5737609903f4', '442f79da-844f-4486-8e4e-fa422a8bed68', '5d270c9e-b9f8-4c93-9c12-189ad5c9cea5', '7831e47d-cd1a-4605-80f4-2b0dddde58fd', '0b900695-122c-4878-ab98-ca2ea5833d03', '6eae4459-1606-407f-aa8e-5405cd3504a1', '044b0ecc-c452-4d99-9afd-9a7f9e7709d7', '217206a5-ea4d-4c79-af80-23e973e4898a', 'f6abcd20-37c2-441a-b2db-26e0de5a9ce6', '2d82dbae-c9a7-438a-97d0-2dc6ab1cb2e5', 'dfbe332c-82a1-4dcf-86b1-5f3adb25235a', 'a9b1d107-a408-4725-8bdc-a197ca9f6a30', '454d7ee8-1396-4cb2-860a-19b1289f5d25', 'b178a2de-254c-4785-9d0c-af8565d393cd', '107ad96d-bbd8-4b6d-9bd5-c2f178d44b07', '16afd7a0-6740-4fe3-bc8b-c172e6673eed', '1f54b6b2-92b3-494c-a6c9-e8e653f6e841', '69fcfd43-98c4-4ac8-abcc-fcdc4c23fa84', 'c1483cca-89ae-40d0-b685-540139354884', '2c62ea25-5d41-411f-a5e6-af34371e8048', '8ebcd5da-55e7-4ba3-86f6-0c1ec0263989', '6eae4459-1606-407f-aa8e-5405cd3504a1', 'ab0439fb-29ca-4436-8715-c83f503c6728', 'af2058ba-b02f-4a67-9142-f59e97d76188', '999eafbe-4cc7-4360-af36-56f33f582c32', '7284af6d-0345-4ec3-8433-4d35cdb9a046', '0b3a7d41-49d5-4bc5-8d15-924711d6be22', '36fd2215-9ff0-4d77-bdc7-a722bc5e1a2e', 'e020f45b-a101-4095-b839-01dd80ea9f7f', '62c2b4ed-fee5-4c71-8e80-d7ce31155f02', '1eeacccc-98ad-453b-904f-ce0454fb83a0', '97856703-caf3-4819-8e81-8d3b1038b424', 'a62cb1fa-397f-460a-8f37-438db230777f', 'ae3beebe-894a-42eb-81ef-fc7c2a13a21f', 'a416c475-2dd9-4831-bd50-7e688f61087d', 'db0ca8ff-5fef-4b8e-8d17-e2e69804d0e1', '8a21321e-ff7e-41a0-a8f0-fd3a877e1e76', 'e33adaf3-04ef-4e8c-a4b1-f9b2a49bb80f', '286bfe23-d70f-47e8-8e04-0ec4b97bc33a', 'fdf0d8ee-303d-4e91-af89-f292bf30f40e', '71da8826-ca56-4a5a-b501-b202d41260d6', '4a1415f1-fe5c-4542-9426-4b8997cc0419', 'cddde956-e1da-4129-bc8a-6a68fa7ce4cf', 'f20a370c-4cb2-4002-8882-602b1f41edcb', 'f7e5bec1-c090-4d5d-93c3-1e157d604cec', 'aea98f2a-82b9-481b-864b-81249707b348', '1a3a2773-446b-4fcb-8cc6-0afc2fc3c907', '6058f3b1-bfdf-46e9-baf9-d76656374d9a', '2be07358-5750-40b4-88d1-cbc9a7170e4b', '2c7d98e8-cbab-4202-9762-d757fd189f79', 'aee8f029-a33f-490e-a4e7-f812bc393543', '6c6bab5e-1264-4272-9d56-375356ecb59c', '94cec447-73df-4c22-bd95-69bbbe8f70e9', 'd24f501b-5153-4189-8c4c-4f9020c58543', 'c185cf94-35f1-4059-8ef5-0fed9ff4dd7f', 'fedb2116-37c0-41dc-b327-13ab15ab2d1e', '3cc04a51-eeab-4359-ab4e-fbfff8327ffd', 'ef30c400-5952-4a4b-9131-6445d7a9e3d2', 'a069bbc0-a39d-43a4-8dfb-1ceb6b7ed5cf', 'af3eb5d0-69ff-40ec-b043-d9cd8cb30e47', '53756038-c913-4ca5-af89-df9d2a299a14', '7511bf21-2408-4371-89be-513d8a0bd7b4', 'b70cd96c-c966-45b5-b55d-8681e239a0d2', '76681a89-b9bb-49e3-a8f1-1147a8a75450', 'a9816a80-af99-4043-96d7-16f075a55643', '7a333ab9-fd99-413c-a338-873e56a79e40', '4a741aa5-0449-4a1c-9fcc-278af48a1533', '28d6dfe7-bbd8-477a-b3f2-98eb167596ae', '395d6e10-49b9-4b12-be81-8fb98ef58f9f', 'a8fad6a6-0a90-4df5-a9e6-d5768d9e73b0', 'abb755b9-8a6a-4399-a1e4-03219e443be7', 'e17ee1df-0c70-428b-abb7-d5dcaaf061b9', '7e977eff-b563-4aca-a290-90ee764dfdb0', '151ab8b6-12f4-4d35-a9ba-94c89064fca7', '07850011-6af5-488e-a5e2-40b271dcc40c', 'f10fd34a-5394-4b53-961a-a5f99a678e26', '993dfda3-0b3a-45a7-9da6-d6c43d2b3ba4', 'cef1af15-5723-455a-a16b-5c5937c21622', '97ca9654-b016-4462-9742-014d1b3a7dc6', '6e03572a-467f-4eaa-bd18-41351b1bc0b9', '2c8b1ac9-8385-4348-ad80-789543f77b07', '58509c9d-d9d4-4fd3-8103-710c19c329b5', '9d75f10f-b905-41c5-9fa2-757a9c660757', '6017ca7b-5583-4c27-aeab-dce00f1e58fa', 'e6f69f60-fd56-46a3-8a00-6fa9d47a9121', '52503e65-d4dc-4435-85fa-192dc9b3c754', 'f741a138-4766-4b05-a603-2264086a361b', 'd9d391d2-8ec4-4ead-b75e-2856918d8560', 'a19d9f48-fa18-40b8-8507-9a7e3a41fbdf', '62439ab5-84ad-4e49-b599-6b8e5e4a8c75', '1a2dd0bc-5d82-4a37-ac78-0d2c0b79deae', 'da101099-f723-40ef-ab0a-7b0ce13764d1', '69cb06bc-d461-4b0c-a172-f23df77ce3db', '1507f90d-d277-4e09-b9a8-fe5040c2d041', '878ac016-174a-4bca-9ceb-d73340f397ee', '765bad30-bdff-4770-9b94-96ac8e6adf69', 'e6b1f418-634a-493b-9433-978a61f40695', '72306e5d-bfde-4c25-a0bb-9c4ce9a41ac0', '9dd5ec1e-8243-492f-98c9-dedb3202c83d', '7cd0d9ad-5f65-4d28-94f7-a087bb90e8c9', '4803e9e5-853d-4340-9dcc-f4332294c388', '0ca33c28-7419-4c15-8f62-5e620cc5eeea', 'd0b70ee5-d5ae-418b-8331-d2343d5109ea', '1644ff77-7263-4061-8223-c257b7ad0169', '9899de26-8f7d-4853-a8e4-5c6c99dc2c5d', 'acec7351-4b95-41eb-ae9b-cb4adcaddd42', 'c196533d-0e6e-411d-bd75-9c623f2ec70a', '6826d4b1-6bc0-476b-907a-21bbdfaf5681', '48632fe0-00dd-42a5-808a-8d48a703c1db', '3b59e55c-ef6c-49a2-be06-f8ceac62cc16', 'f8e54c14-9d86-45b0-a311-aa75c4374f00', '1c2274c8-e4e9-40d1-8983-64a9226f386a', 'a76df34b-64bb-40f4-8c03-15c2110bae7b', '7ea302d7-2d9f-4bec-b9d3-82144191fc37', '8c2d972d-1d93-43a8-af8f-bd89352e4bed', '57a0c481-60f0-4e83-a7a8-cb599b2107e5', 'f7607999-8854-4c15-90cb-4f377ecba01e', '4672b014-d200-4abd-b9a3-46198c2aa9ae', 'cf949a76-a492-4125-bacc-8f052fc2f93f', '57a0c481-60f0-4e83-a7a8-cb599b2107e5', 'f8419277-0c6a-4d2a-9d92-215be859aeb8', '1666a060-63fc-4ca5-ac1e-74847090aa05', '4944a88e-09b2-44ac-a31d-1e26e9b7010a', '28265baa-c323-43ac-bc49-ffee525ecaba', '11968cb9-871c-44ae-927b-2f3ffd6bed8f', 'e65f5162-592f-4ac8-ac97-8960f9e7933a', 'fd73b28e-c953-40d0-94b5-9a0585630588', '29d3c414-bb6a-45e9-9455-6a4659a684c8', '73426b59-04ba-4942-842f-8e05611d974b', 'ec618092-83ae-4870-a4b5-7dbb113b576f', '5aa5ee73-68c7-4cce-ae96-f940ff310904', '2c60506f-5e72-46c0-a26c-4d7c15a67511', 'b8facf9f-0ca5-427c-9eec-5962b476f693', 'e3c3a293-e65b-4241-945f-e39b938a9a78', 'b7b07b23-a918-4615-be9d-054e6b81e99e', '9851868d-12ce-44ab-8ee5-e4f8c0854a88', '85606c3c-250e-470d-8823-69e6bad4f0bc', '9615d2a3-2c33-4c0d-a785-026a2408775c', '806048b9-459c-40e3-bf15-02840c7bbb14', '72e94f71-f2d1-4977-87cf-8f659493549c', '564cd5ef-f1d7-4d51-a3d0-37124e43d3b2', '117c73f2-7341-44f1-b949-0cb771dc288d', '103ee52f-21da-4ac5-af45-517b6696286e', '53926950-26b8-4904-ba32-e3925af02cf1', 'f6bdfb97-b2e5-4e0b-9a2d-7b019c4c7789', 'b6334fd0-b239-4ec4-b770-619bcf80ec8b', '0f024323-480d-4eee-bbda-b782a2050e7d', 'e0e0078b-d25d-41c3-849b-de48b9f73d30', 'a5d95010-bf23-45cc-870f-9788e0719717', '539372e4-ce47-43ee-9d2b-222f8bbe14e3', '096524a6-ef04-4e25-8b5d-81946405d000', '89530b7e-fc8f-4b73-a783-726a19daa3c8', '04e6b8ff-00fe-4786-ad13-02dca118490d', '9bfd8d9c-22d1-4e73-9c0d-485861cc7ff5', '663258f8-8aba-498e-a798-fbb1113a518a', 'cea3b774-ded3-48fd-832d-19ee89b73541', '7aa91597-55f3-4384-9a9a-f0fce999a30f', 'e9450708-c8c7-4891-a61b-b394fe8bdf64', '92f7444a-beac-4f10-9f05-c7dfb6d668ba', 'db3bbe46-31ec-4022-96a0-b2a1eec66ba1', 'b77bed78-5a2d-4712-b476-4d75b28be80b', 'c44db12b-d799-47b1-8d41-ded2e78087f6', 'bafaa4c8-0830-4b79-a271-a85b2e7566ff', '1004d272-791a-4098-a977-197267971914', '64913604-8ac4-4654-be07-d49a4e95f397', '417a89ee-9c8f-4311-b7c2-08fafd2d5e5f') AND "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Cupom"."status" = 'used';
Executing (default): SELECT count(DISTINCT("respondentSessionId")) AS "count" FROM "respostas" AS "Resposta" WHERE ("Resposta"."ratingValue" IS NOT NULL OR "Resposta"."textValue" != '') AND "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."status" = 'used' AND "Cupom"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
[Auth Middleware] Request: GET /api/whatsapp-config/instance
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."ifoodAuthVerifier" AS "tenant.ifoodAuthVerifier", "tenant"."deliveryMuchClientId" AS "tenant.deliveryMuchClientId", "tenant"."deliveryMuchClientSecret" AS "tenant.deliveryMuchClientSecret", "tenant"."deliveryMuchUsername" AS "tenant.deliveryMuchUsername", "tenant"."deliveryMuchPassword" AS "tenant.deliveryMuchPassword", "tenant"."deliveryMuchToken" AS "tenant.deliveryMuchToken", "tenant"."deliveryMuchTokenExpiresAt" AS "tenant.deliveryMuchTokenExpiresAt", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."plan" AS "tenant.plan", "tenant"."planExpiresAt" AS "tenant.planExpiresAt", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = '77f853e9-deb2-4067-881e-71fa16d3054f';
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "postSaleDelayMinutes", "postSaleMessageTemplate", "postSaleSurveyId", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
Executing (default): SELECT "id", "tenantId", "type", "isEnabled", "daysBefore", "message", "createdAt", "updatedAt" FROM "whatsapp_templates" AS "WhatsappTemplate" WHERE "WhatsappTemplate"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "WhatsappTemplate"."type" = 'COUPON_REMINDER' LIMIT 1;
Executing (default): SELECT "id", "tenantId", "name", "description", "conditionDescription", "pointsRequired", "type", "value", "imageUrl", "active", "createdAt", "updatedAt" FROM "recompensas" AS "Recompensa" WHERE "Recompensa"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Recompensa"."active" = true ORDER BY "Recompensa"."name" ASC;
Executing (default): SELECT "Roleta"."id", "Roleta"."tenantId", "Roleta"."nome", "Roleta"."descricao", "Roleta"."active", "Roleta"."createdAt", "Roleta"."updatedAt", "premios"."id" AS "premios.id", "premios"."tenantId" AS "premios.tenantId", "premios"."nome" AS "premios.nome", "premios"."descricao" AS "premios.descricao", "premios"."porcentagem" AS "premios.porcentagem", "premios"."cor" AS "premios.cor", "premios"."recompensaId" AS "premios.recompensaId", "premios"."roletaId" AS "premios.roletaId", "premios"."imageUrl" AS "premios.imageUrl", "premios"."active" AS "premios.active", "premios"."isNoPrizeOption" AS "premios.isNoPrizeOption", "premios"."createdAt" AS "premios.createdAt", "premios"."updatedAt" AS "premios.updatedAt" FROM "roletas" AS "Roleta" LEFT OUTER JOIN "roleta_premios" AS "premios" ON "Roleta"."id" = "premios"."roletaId" WHERE "Roleta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "postSaleDelayMinutes", "postSaleMessageTemplate", "postSaleSurveyId", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
[WhatsappService] Resposta da API de status da instância: {
  "instance": {
    "instanceName": "roma-pizzaria--chopperia",
    "state": "open"
  }
}
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "Usuario"."id", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."tenantId", "Usuario"."roleId", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."email" = 'superadmin@loyalfood.com';
Executing (default): SELECT "name" FROM "roles" AS "Role" WHERE "Role"."id" = 'a25c47d4-75c6-4f17-865e-68f551b4c035';
[Auth Middleware] Request: POST /api/auth/verify-token
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."ifoodAuthVerifier" AS "tenant.ifoodAuthVerifier", "tenant"."deliveryMuchClientId" AS "tenant.deliveryMuchClientId", "tenant"."deliveryMuchClientSecret" AS "tenant.deliveryMuchClientSecret", "tenant"."deliveryMuchUsername" AS "tenant.deliveryMuchUsername", "tenant"."deliveryMuchPassword" AS "tenant.deliveryMuchPassword", "tenant"."deliveryMuchToken" AS "tenant.deliveryMuchToken", "tenant"."deliveryMuchTokenExpiresAt" AS "tenant.deliveryMuchTokenExpiresAt", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."plan" AS "tenant.plan", "tenant"."planExpiresAt" AS "tenant.planExpiresAt", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'd6b790f2-474f-442b-934b-731898c6c795';
[Auth Middleware] Request: GET /api/superadmin/reports/dashboard
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."ifoodAuthVerifier" AS "tenant.ifoodAuthVerifier", "tenant"."deliveryMuchClientId" AS "tenant.deliveryMuchClientId", "tenant"."deliveryMuchClientSecret" AS "tenant.deliveryMuchClientSecret", "tenant"."deliveryMuchUsername" AS "tenant.deliveryMuchUsername", "tenant"."deliveryMuchPassword" AS "tenant.deliveryMuchPassword", "tenant"."deliveryMuchToken" AS "tenant.deliveryMuchToken", "tenant"."deliveryMuchTokenExpiresAt" AS "tenant.deliveryMuchTokenExpiresAt", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."plan" AS "tenant.plan", "tenant"."planExpiresAt" AS "tenant.planExpiresAt", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'd6b790f2-474f-442b-934b-731898c6c795';
Executing (default): SELECT count(*) AS "count" FROM "tenants" AS "Tenant";
Executing (default): SELECT count(*) AS "count" FROM "usuarios" AS "Usuario";
Executing (default): SELECT count(*) AS "count" FROM "pesquisas" AS "Pesquisa";
Executing (default): SELECT count(*) AS "count" FROM "franchisors" AS "Franchisor";
Executing (default): SELECT DATE_TRUNC('month', "createdAt") AS "month", COUNT("id") AS "count" FROM "usuarios" AS "Usuario" GROUP BY "month" ORDER BY DATE_TRUNC('month', "createdAt") ASC;
[Auth Middleware] Request: GET /api/tenants
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."ifoodAuthVerifier" AS "tenant.ifoodAuthVerifier", "tenant"."deliveryMuchClientId" AS "tenant.deliveryMuchClientId", "tenant"."deliveryMuchClientSecret" AS "tenant.deliveryMuchClientSecret", "tenant"."deliveryMuchUsername" AS "tenant.deliveryMuchUsername", "tenant"."deliveryMuchPassword" AS "tenant.deliveryMuchPassword", "tenant"."deliveryMuchToken" AS "tenant.deliveryMuchToken", "tenant"."deliveryMuchTokenExpiresAt" AS "tenant.deliveryMuchTokenExpiresAt", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."plan" AS "tenant.plan", "tenant"."planExpiresAt" AS "tenant.planExpiresAt", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'd6b790f2-474f-442b-934b-731898c6c795';
Executing (default): SELECT "id", "name", "address", "phone", "email", "cnpj", "description", "createdAt" FROM "tenants" AS "Tenant" ORDER BY "Tenant"."createdAt" DESC;
[Auth Middleware] Request: GET /api/superadmin/franchisors
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."ifoodAuthVerifier" AS "tenant.ifoodAuthVerifier", "tenant"."deliveryMuchClientId" AS "tenant.deliveryMuchClientId", "tenant"."deliveryMuchClientSecret" AS "tenant.deliveryMuchClientSecret", "tenant"."deliveryMuchUsername" AS "tenant.deliveryMuchUsername", "tenant"."deliveryMuchPassword" AS "tenant.deliveryMuchPassword", "tenant"."deliveryMuchToken" AS "tenant.deliveryMuchToken", "tenant"."deliveryMuchTokenExpiresAt" AS "tenant.deliveryMuchTokenExpiresAt", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."plan" AS "tenant.plan", "tenant"."planExpiresAt" AS "tenant.planExpiresAt", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'd6b790f2-474f-442b-934b-731898c6c795';
TypeError: franchisorRepository.findAll is not a function
    at /usr/src/app/src/controllers/superadmin/franchisorAdminController.js:28:52
    at asyncUtilWrap (/usr/src/app/node_modules/express-async-handler/index.js:3:20)
    at Layer.handle [as handle_request] (/usr/src/app/node_modules/express/lib/router/layer.js:95:5)
    at next (/usr/src/app/node_modules/express/lib/router/route.js:149:13)
    at Route.dispatch (/usr/src/app/node_modules/express/lib/router/route.js:119:3)
    at Layer.handle [as handle_request] (/usr/src/app/node_modules/express/lib/router/layer.js:95:5)
    at /usr/src/app/node_modules/express/lib/router/index.js:284:15
    at Function.process_params (/usr/src/app/node_modules/express/lib/router/index.js:346:12)
    at next (/usr/src/app/node_modules/express/lib/router/index.js:280:10)
    at /usr/src/app/src/middlewares/authMiddleware.js:69:16
[Auth Middleware] Request: GET /api/superadmin/reports/dashboard
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."ifoodAuthVerifier" AS "tenant.ifoodAuthVerifier", "tenant"."deliveryMuchClientId" AS "tenant.deliveryMuchClientId", "tenant"."deliveryMuchClientSecret" AS "tenant.deliveryMuchClientSecret", "tenant"."deliveryMuchUsername" AS "tenant.deliveryMuchUsername", "tenant"."deliveryMuchPassword" AS "tenant.deliveryMuchPassword", "tenant"."deliveryMuchToken" AS "tenant.deliveryMuchToken", "tenant"."deliveryMuchTokenExpiresAt" AS "tenant.deliveryMuchTokenExpiresAt", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."plan" AS "tenant.plan", "tenant"."planExpiresAt" AS "tenant.planExpiresAt", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'd6b790f2-474f-442b-934b-731898c6c795';
Executing (default): SELECT count(*) AS "count" FROM "tenants" AS "Tenant";
Executing (default): SELECT count(*) AS "count" FROM "usuarios" AS "Usuario";
Executing (default): SELECT count(*) AS "count" FROM "pesquisas" AS "Pesquisa";
Executing (default): SELECT count(*) AS "count" FROM "franchisors" AS "Franchisor";
Executing (default): SELECT DATE_TRUNC('month', "createdAt") AS "month", COUNT("id") AS "count" FROM "usuarios" AS "Usuario" GROUP BY "month" ORDER BY DATE_TRUNC('month', "createdAt") ASC;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-01-22 14:21:00.037 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[Auth Middleware] Request: POST /api/auth/verify-token
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."ifoodAuthVerifier" AS "tenant.ifoodAuthVerifier", "tenant"."deliveryMuchClientId" AS "tenant.deliveryMuchClientId", "tenant"."deliveryMuchClientSecret" AS "tenant.deliveryMuchClientSecret", "tenant"."deliveryMuchUsername" AS "tenant.deliveryMuchUsername", "tenant"."deliveryMuchPassword" AS "tenant.deliveryMuchPassword", "tenant"."deliveryMuchToken" AS "tenant.deliveryMuchToken", "tenant"."deliveryMuchTokenExpiresAt" AS "tenant.deliveryMuchTokenExpiresAt", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."plan" AS "tenant.plan", "tenant"."planExpiresAt" AS "tenant.planExpiresAt", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'd6b790f2-474f-442b-934b-731898c6c795';
[Auth Middleware] Request: GET /api/superadmin/reports/dashboard
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."ifoodAuthVerifier" AS "tenant.ifoodAuthVerifier", "tenant"."deliveryMuchClientId" AS "tenant.deliveryMuchClientId", "tenant"."deliveryMuchClientSecret" AS "tenant.deliveryMuchClientSecret", "tenant"."deliveryMuchUsername" AS "tenant.deliveryMuchUsername", "tenant"."deliveryMuchPassword" AS "tenant.deliveryMuchPassword", "tenant"."deliveryMuchToken" AS "tenant.deliveryMuchToken", "tenant"."deliveryMuchTokenExpiresAt" AS "tenant.deliveryMuchTokenExpiresAt", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."plan" AS "tenant.plan", "tenant"."planExpiresAt" AS "tenant.planExpiresAt", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'd6b790f2-474f-442b-934b-731898c6c795';
Executing (default): SELECT count(*) AS "count" FROM "tenants" AS "Tenant";
Executing (default): SELECT count(*) AS "count" FROM "usuarios" AS "Usuario";
Executing (default): SELECT count(*) AS "count" FROM "pesquisas" AS "Pesquisa";
Executing (default): SELECT count(*) AS "count" FROM "franchisors" AS "Franchisor";
Executing (default): SELECT DATE_TRUNC('month', "createdAt") AS "month", COUNT("id") AS "count" FROM "usuarios" AS "Usuario" GROUP BY "month" ORDER BY DATE_TRUNC('month', "createdAt") ASC;
[Auth Middleware] Request: GET /api/tenants
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."ifoodAuthVerifier" AS "tenant.ifoodAuthVerifier", "tenant"."deliveryMuchClientId" AS "tenant.deliveryMuchClientId", "tenant"."deliveryMuchClientSecret" AS "tenant.deliveryMuchClientSecret", "tenant"."deliveryMuchUsername" AS "tenant.deliveryMuchUsername", "tenant"."deliveryMuchPassword" AS "tenant.deliveryMuchPassword", "tenant"."deliveryMuchToken" AS "tenant.deliveryMuchToken", "tenant"."deliveryMuchTokenExpiresAt" AS "tenant.deliveryMuchTokenExpiresAt", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."plan" AS "tenant.plan", "tenant"."planExpiresAt" AS "tenant.planExpiresAt", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'd6b790f2-474f-442b-934b-731898c6c795';
Executing (default): SELECT "id", "name", "address", "phone", "email", "cnpj", "description", "createdAt" FROM "tenants" AS "Tenant" ORDER BY "Tenant"."createdAt" DESC;
[Auth Middleware] Request: POST /api/superadmin/login-as-tenant/eb629ea8-7d69-47a1-b1f1-f9dcb33475f4
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."ifoodAuthVerifier" AS "tenant.ifoodAuthVerifier", "tenant"."deliveryMuchClientId" AS "tenant.deliveryMuchClientId", "tenant"."deliveryMuchClientSecret" AS "tenant.deliveryMuchClientSecret", "tenant"."deliveryMuchUsername" AS "tenant.deliveryMuchUsername", "tenant"."deliveryMuchPassword" AS "tenant.deliveryMuchPassword", "tenant"."deliveryMuchToken" AS "tenant.deliveryMuchToken", "tenant"."deliveryMuchTokenExpiresAt" AS "tenant.deliveryMuchTokenExpiresAt", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."plan" AS "tenant.plan", "tenant"."planExpiresAt" AS "tenant.planExpiresAt", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'd6b790f2-474f-442b-934b-731898c6c795';
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt" FROM "usuarios" AS "Usuario" INNER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" AND "role"."name" = 'Admin' WHERE "Usuario"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' ORDER BY "Usuario"."createdAt" ASC LIMIT 1;
Executing (default): INSERT INTO "ImpersonationLogs" ("id","superAdminId","impersonatedUserId","tenantId","createdAt","updatedAt") VALUES ($1,$2,$3,$4,$5,$6) RETURNING "id","superAdminId","impersonatedUserId","tenantId","createdAt","updatedAt";
[Auth Middleware] Request: GET /api/superadmin/franchisors
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."ifoodAuthVerifier" AS "tenant.ifoodAuthVerifier", "tenant"."deliveryMuchClientId" AS "tenant.deliveryMuchClientId", "tenant"."deliveryMuchClientSecret" AS "tenant.deliveryMuchClientSecret", "tenant"."deliveryMuchUsername" AS "tenant.deliveryMuchUsername", "tenant"."deliveryMuchPassword" AS "tenant.deliveryMuchPassword", "tenant"."deliveryMuchToken" AS "tenant.deliveryMuchToken", "tenant"."deliveryMuchTokenExpiresAt" AS "tenant.deliveryMuchTokenExpiresAt", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."plan" AS "tenant.plan", "tenant"."planExpiresAt" AS "tenant.planExpiresAt", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'd6b790f2-474f-442b-934b-731898c6c795';
TypeError: franchisorRepository.findAll is not a function
    at /usr/src/app/src/controllers/superadmin/franchisorAdminController.js:28:52
    at asyncUtilWrap (/usr/src/app/node_modules/express-async-handler/index.js:3:20)
    at Layer.handle [as handle_request] (/usr/src/app/node_modules/express/lib/router/layer.js:95:5)
    at next (/usr/src/app/node_modules/express/lib/router/route.js:149:13)
    at Route.dispatch (/usr/src/app/node_modules/express/lib/router/route.js:119:3)
    at Layer.handle [as handle_request] (/usr/src/app/node_modules/express/lib/router/layer.js:95:5)
    at /usr/src/app/node_modules/express/lib/router/index.js:284:15
    at Function.process_params (/usr/src/app/node_modules/express/lib/router/index.js:346:12)
    at next (/usr/src/app/node_modules/express/lib/router/index.js:280:10)
    at /usr/src/app/src/middlewares/authMiddleware.js:69:16
[Auth Middleware] Request: GET /api/superadmin/reports/system-overview
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."ifoodAuthVerifier" AS "tenant.ifoodAuthVerifier", "tenant"."deliveryMuchClientId" AS "tenant.deliveryMuchClientId", "tenant"."deliveryMuchClientSecret" AS "tenant.deliveryMuchClientSecret", "tenant"."deliveryMuchUsername" AS "tenant.deliveryMuchUsername", "tenant"."deliveryMuchPassword" AS "tenant.deliveryMuchPassword", "tenant"."deliveryMuchToken" AS "tenant.deliveryMuchToken", "tenant"."deliveryMuchTokenExpiresAt" AS "tenant.deliveryMuchTokenExpiresAt", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."plan" AS "tenant.plan", "tenant"."planExpiresAt" AS "tenant.planExpiresAt", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'd6b790f2-474f-442b-934b-731898c6c795';
Executing (default): SELECT count(*) AS "count" FROM "tenants" AS "Tenant";
Executing (default): SELECT count(*) AS "count" FROM "usuarios" AS "Usuario";
Executing (default): SELECT count(*) AS "count" FROM "campanhas" AS "Campanha";
Executing (default): SELECT "status", COUNT("status") AS "count" FROM "WhatsappSenders" AS "WhatsappSender" GROUP BY "status";
[Auth Middleware] Request: GET /api/superadmin/reports/tenant-reports
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."ifoodAuthVerifier" AS "tenant.ifoodAuthVerifier", "tenant"."deliveryMuchClientId" AS "tenant.deliveryMuchClientId", "tenant"."deliveryMuchClientSecret" AS "tenant.deliveryMuchClientSecret", "tenant"."deliveryMuchUsername" AS "tenant.deliveryMuchUsername", "tenant"."deliveryMuchPassword" AS "tenant.deliveryMuchPassword", "tenant"."deliveryMuchToken" AS "tenant.deliveryMuchToken", "tenant"."deliveryMuchTokenExpiresAt" AS "tenant.deliveryMuchTokenExpiresAt", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."plan" AS "tenant.plan", "tenant"."planExpiresAt" AS "tenant.planExpiresAt", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'd6b790f2-474f-442b-934b-731898c6c795';
Executing (default): SELECT "id", "name" FROM "tenants" AS "Tenant";
Executing (default): SELECT "tenantId", count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" IN ('00055233-b221-4eaa-8e8b-7c14d02d221c', '839e61fb-e67a-40c5-a46a-5473a9be3207', 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4', 'dc201352-d94a-443c-ad20-28687baff329', '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd') GROUP BY "tenantId";
Executing (default): SELECT "tenantId", count(*) AS "count" FROM "campanhas" AS "Campanha" WHERE "Campanha"."tenantId" IN ('00055233-b221-4eaa-8e8b-7c14d02d221c', '839e61fb-e67a-40c5-a46a-5473a9be3207', 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4', 'dc201352-d94a-443c-ad20-28687baff329', '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd') AND "Campanha"."status" IN ('processing', 'scheduled') GROUP BY "tenantId";
Executing (default): SELECT "tenantId", count(*) AS "count" FROM "pesquisas" AS "Pesquisa" WHERE "Pesquisa"."tenantId" IN ('00055233-b221-4eaa-8e8b-7c14d02d221c', '839e61fb-e67a-40c5-a46a-5473a9be3207', 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4', 'dc201352-d94a-443c-ad20-28687baff329', '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd') GROUP BY "tenantId";
Executing (default): SELECT "tenantId", count(*) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" IN ('00055233-b221-4eaa-8e8b-7c14d02d221c', '839e61fb-e67a-40c5-a46a-5473a9be3207', 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4', 'dc201352-d94a-443c-ad20-28687baff329', '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd') GROUP BY "tenantId";
[Auth Middleware] Request: GET /api/superadmin/reports/dashboard
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."ifoodAuthVerifier" AS "tenant.ifoodAuthVerifier", "tenant"."deliveryMuchClientId" AS "tenant.deliveryMuchClientId", "tenant"."deliveryMuchClientSecret" AS "tenant.deliveryMuchClientSecret", "tenant"."deliveryMuchUsername" AS "tenant.deliveryMuchUsername", "tenant"."deliveryMuchPassword" AS "tenant.deliveryMuchPassword", "tenant"."deliveryMuchToken" AS "tenant.deliveryMuchToken", "tenant"."deliveryMuchTokenExpiresAt" AS "tenant.deliveryMuchTokenExpiresAt", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."plan" AS "tenant.plan", "tenant"."planExpiresAt" AS "tenant.planExpiresAt", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'd6b790f2-474f-442b-934b-731898c6c795';
Executing (default): SELECT count(*) AS "count" FROM "tenants" AS "Tenant";
Executing (default): SELECT count(*) AS "count" FROM "usuarios" AS "Usuario";
Executing (default): SELECT count(*) AS "count" FROM "pesquisas" AS "Pesquisa";
Executing (default): SELECT count(*) AS "count" FROM "franchisors" AS "Franchisor";
Executing (default): SELECT DATE_TRUNC('month', "createdAt") AS "month", COUNT("id") AS "count" FROM "usuarios" AS "Usuario" GROUP BY "month" ORDER BY DATE_TRUNC('month', "createdAt") ASC;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;