Postgres is up - executing command
Server.js is being executed!
Conexão com o banco de dados estabelecida com sucesso (Sequelize).
Server is running on port 5000
Agendador de relatório diário iniciado. A tarefa será executada todos os dias às 8:00.
[Auth Middleware] Request: POST /auth/verify-token
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: GET /criterios
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "name", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
[Auth Middleware] Request: GET /atendentes
[Auth Middleware] Request: GET /roletas
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Authorize Debug] User Role: Admin, Required: criterios:read
[Authorize Debug] Role ID: ce609d07-d83f-4002-a892-e17c91b767d3, Module: criterios, Action: read
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: GET /surveys/11b589b2-8c7b-45cf-b278-b0fb6efa966b
[Auth Middleware] Request: GET /recompensas
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'criterios' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT "id", "name", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
[Authorize Debug] Has Permission Result: true
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Authorize Debug] User Role: Admin, Required: atendentes:read
[Authorize Debug] Role ID: ce609d07-d83f-4002-a892-e17c91b767d3, Module: atendentes, Action: read
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "name", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "id", "tenantId", "name", "description", "type", "createdAt", "updatedAt" FROM "criterios" AS "Criterio" WHERE "Criterio"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' ORDER BY "Criterio"."name" ASC;
[Authorize Debug] User Role: Admin, Required: roletas:read
[Authorize Debug] Role ID: ce609d07-d83f-4002-a892-e17c91b767d3, Module: roletas, Action: read
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'atendentes' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT "id", "name", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
[Authorize Debug] Has Permission Result: true
Executing (default): SELECT "id", "name", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
[Authorize Debug] User Role: Admin, Required: surveys:read
[Authorize Debug] Role ID: ce609d07-d83f-4002-a892-e17c91b767d3, Module: surveys, Action: read
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'roletas' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
[Authorize Debug] User Role: Admin, Required: recompensas:read
[Authorize Debug] Role ID: ce609d07-d83f-4002-a892-e17c91b767d3, Module: recompensas, Action: read
Executing (default): SELECT "id", "tenantId", "name", "email", "code", "status", "createdAt", "updatedAt" FROM "atendentes" AS "Atendente" WHERE "Atendente"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' ORDER BY "Atendente"."name" ASC;
[Authorize Debug] Has Permission Result: true
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'surveys' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'recompensas' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
[Authorize Debug] Has Permission Result: true
Executing (default): SELECT "id", "tenantId", "nome", "descricao", "active", "createdAt", "updatedAt" FROM "roletas" AS "Roleta" WHERE "Roleta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Authorize Debug] Has Permission Result: true
Executing (default): SELECT "Pesquisa"."id", "Pesquisa"."title", "Pesquisa"."description", "Pesquisa"."createdAt", "Pesquisa"."tenantId", "Pesquisa"."isOpen", "Pesquisa"."askForAttendant", "Pesquisa"."expectedRespondents", "Pesquisa"."startDate", "Pesquisa"."endDate", "Pesquisa"."dueDate", "Pesquisa"."status", "Pesquisa"."creatorId", "creator"."id" AS "creator.id", "creator"."name" AS "creator.name", "perguntas"."id" AS "perguntas.id", "perguntas"."text" AS "perguntas.text", "perguntas"."type" AS "perguntas.type", "perguntas"."options" AS "perguntas.options", "perguntas"."order" AS "perguntas.order", "perguntas"."criterioId" AS "perguntas.criterioId" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "usuarios" AS "creator" ON "Pesquisa"."creatorId" = "creator"."id" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" WHERE "Pesquisa"."id" = '11b589b2-8c7b-45cf-b278-b0fb6efa966b';
Executing (default): SELECT "id", "tenantId", "name", "description", "pointsRequired", "type", "value", "imageUrl", "active", "createdAt", "updatedAt" FROM "recompensas" AS "Recompensa" WHERE "Recompensa"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' ORDER BY "Recompensa"."name" ASC;
[Auth Middleware] Request: PUT /surveys/11b589b2-8c7b-45cf-b278-b0fb6efa966b
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "name", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
[Authorize Debug] User Role: Admin, Required: surveys:update
[Authorize Debug] Role ID: ce609d07-d83f-4002-a892-e17c91b767d3, Module: surveys, Action: update
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'surveys' AND "permissao"."action" = 'update' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
[Authorize Debug] Has Permission Result: true
[surveyController] Updating survey with ID: 11b589b2-8c7b-45cf-b278-b0fb6efa966b, Tenant ID: 3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd
[surveyController] Request Body: {"id":"11b589b2-8c7b-45cf-b278-b0fb6efa966b","title":"Pesquisa de Satisfação ","description":"Conte como foi sua experiencia aqui com a gente.","createdAt":"2025-09-27T18:06:12.097Z","tenantId":"3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd","creatorName":"Rafael","isOpen":true,"askForAttendant":true,"expectedRespondents":500,"startDate":"2025-11-27T00:00:00.000Z","endDate":"2025-11-27T00:00:00.000Z","dueDate":"2025-11-27T00:00:00.000Z","status":"active","creatorId":"d3612499-43d8-4af4-914f-c6ebeb4e3996","questions":[{"id":"67c4ab60-76dc-42c1-91c8-8fd7e8fea874","text":"Em uma escala de 0 a 10 o quanto você indicaria a Roma Pizzaria & Choperia para um amigo ou familiar?","type":"rating_0_10","options":[],"order":1,"criterioId":"0b84a4e4-8c30-4ff8-9038-19fdd4a8584f"},{"id":"c20344dd-1602-47e0-b13e-a3e5710f1837","text":"Como você avalia o nosso AMBIENTE?","type":"rating_1_5","options":[],"order":2,"criterioId":"ecf49413-8217-4362-b569-bf2ff9795a26"},{"id":"4b9d4534-174a-4f67-9e90-3f2f7240c36a","text":"Como você avalia o nosso ATENDIMENTO?","type":"rating_1_5","options":[],"order":3,"criterioId":"9f46663a-21be-4de7-bd97-15d99cca9bb1"},{"id":"c70a6a40-a3a3-428e-9280-15dc6e070d65","text":"Como você avalia a QUALIDADE DOS NOSSOS PRODUTOS?","type":"rating_1_5","options":[],"order":4,"criterioId":"ad626c00-f34d-4339-80a1-a8ed6a10aae4"},{"id":"90faf75b-9902-4ab2-8202-9a2fd52b582e","text":"Como você avalia o nosso TEMPO DE ESPERA?","type":"rating_1_5","options":[],"order":5,"criterioId":"3c1f6e73-7505-409f-990e-9de756bb3ef2"},{"id":"85f1d3e7-809e-4aa1-bbb2-aaf54b7912cf","text":"Como você avalia as nossas OPÇÕES E VARIEDADES DE PRODUTOS?","type":"rating_1_5","options":[],"order":6,"criterioId":"c98d2b78-fd5e-455b-aeb7-1ca3a8c9ddfd"},{"id":"abdf0bdc-3717-408c-8807-48a5942836de","text":"Como você avalia o nosso CUSTO-BENEFÍCIO?","type":"rating_1_5","options":[],"order":7,"criterioId":"a5a2c30a-82aa-4392-86a0-a8464fa1b2a3"},{"id":"50de8556-fe92-4bfc-b135-2982942211cd","text":"Como você avalia a QUALIDADE DOS NOSSOS PRODUTOS?","type":"rating_1_5","options":[],"order":8,"criterioId":"ad626c00-f34d-4339-80a1-a8ed6a10aae4"},{"id":"2f73aebd-cc83-4981-889b-af0f65e5da4f","text":"O que você acredita que FALTA na Roma Pizzaria & Choperia?","type":"free_text","options":[],"order":9,"criterioId":"0b84a4e4-8c30-4ff8-9038-19fdd4a8584f"}],"recompensaId":null,"roletaId":"f40e45de-fb16-477d-b385-85eb9d38304c"}