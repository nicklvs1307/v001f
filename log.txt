Postgres is up - executing command
Server.js is being executed!
JWT Secret loaded: ********
JWT Secret length: 32
Conexão com o banco de dados estabelecida com sucesso (Sequelize).
Server is running on port 5000
Agendador de relatório diário iniciado. A tarefa será executada todos os dias às 8:00.
Agendador de relatório semanal iniciado. A tarefa será executada toda segunda-feira às 8:00.
Agendador de relatório mensal iniciado. A tarefa será executada todo dia 1º, às 8:00.
Agendador de lembrete de cupons iniciado. A tarefa será executada todos os dias às 9:00.
Agendador de automação de aniversário iniciado. A tarefa será executada todos os dias às 9:00.
Agendador de expiração de cupons iniciado. A tarefa será executada todo dia à meia-noite.
[SenderMonitorJob] Job de monitoramento de disparadores inicializado para rodar a cada 5 minutos.
[WarmingUpProgressJob] Job de progressão de aquecimento inicializado para rodar diariamente à 1h.
[CampaignMonitorJob] Job de monitoramento de campanhas inicializado para rodar a cada 10 minutos.
Agendador de processamento de premiações iniciado. A tarefa será executada todo dia às 2h.
[iFood Polling Job] Scheduling iFood polling to run every */5 * * * *
[CampanhaService] Inicializando campanhas agendadas...
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."status" = 'scheduled' AND "Campanha"."startDate" IS NOT NULL;
[CampanhaService] 0 campanhas reagendadas.
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[CAMPAIGN_MONITOR] Iniciando verificação de campanhas pausadas...
[iFood Polling Job] Starting iFood polling for all active tenants...
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."status" = 'paused';
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt", "ifoodClientId", "ifoodClientSecret" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodClientId" IS NOT NULL AND "Tenant"."ifoodClientSecret" IS NOT NULL;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[iFood Polling Job] Finished iFood polling.
[CAMPAIGN_MONITOR] Nenhuma campanha pausada encontrada.
[SENDER_MONITOR] Verificação de status concluída.
[Auth Middleware] Request: POST /api/auth/verify-token
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = '77f853e9-deb2-4067-881e-71fa16d3054f';
[Auth Middleware] Request: GET /api/dashboard/summary
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = '77f853e9-deb2-4067-881e-71fa16d3054f';
[Auth Middleware] Request: GET /api/dashboard/nps-trend?period=day
[Auth Middleware] Request: GET /api/dashboard/criteria-scores
[Auth Middleware] Request: GET /api/dashboard/response-chart
[Auth Middleware] Request: GET /api/dashboard/surveys-responded-chart
[Auth Middleware] Request: GET /api/dashboard/attendants-performance
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = '77f853e9-deb2-4067-881e-71fa16d3054f';
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = '77f853e9-deb2-4067-881e-71fa16d3054f';
[Auth Middleware] Request: GET /api/dashboard/recent-feedbacks?page=1&limit=10
[Auth Middleware] Request: GET /api/dashboard/conversion-chart
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = '77f853e9-deb2-4067-881e-71fa16d3054f';
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = '77f853e9-deb2-4067-881e-71fa16d3054f';
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = '77f853e9-deb2-4067-881e-71fa16d3054f';
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = '77f853e9-deb2-4067-881e-71fa16d3054f';
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = '77f853e9-deb2-4067-881e-71fa16d3054f';
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT "Resposta"."id", "Resposta"."perguntaId", "Resposta"."pesquisaId", "Resposta"."tenantId", "Resposta"."atendenteId", "Resposta"."respondentSessionId", "Resposta"."ratingValue", "Resposta"."textValue", "Resposta"."selectedOption", "Resposta"."createdAt", "Resposta"."updatedAt", "pergunta"."id" AS "pergunta.id", "pergunta"."type" AS "pergunta.type", "pergunta"."criterioId" AS "pergunta.criterioId" FROM "respostas" AS "Resposta" INNER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Resposta"."ratingValue" IS NOT NULL;
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT date_trunc('day', "Resposta"."createdAt" AT TIME ZONE 'America/Sao_Paulo') AS "period", SUM(CASE WHEN "ratingValue" >= 9 THEN 1 ELSE 0 END) AS "promoters", SUM(CASE WHEN "ratingValue" <= 6 THEN 1 ELSE 0 END) AS "detractors", COUNT("Resposta"."id") AS "total" FROM "respostas" AS "Resposta" INNER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" AND "pergunta"."type" = 'rating_0_10' WHERE "Resposta"."ratingValue" IS NOT NULL AND "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' GROUP BY date_trunc('day', "Resposta"."createdAt" AT TIME ZONE 'America/Sao_Paulo') ORDER BY date_trunc('day', "Resposta"."createdAt" AT TIME ZONE 'America/Sao_Paulo') ASC;
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT "Criterio"."id", "Criterio"."tenantId", "Criterio"."name", "Criterio"."description", "Criterio"."type", "Criterio"."createdAt", "Criterio"."updatedAt", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas->respostas"."id" AS "perguntas.respostas.id", "perguntas->respostas"."ratingValue" AS "perguntas.respostas.ratingValue" FROM "criterios" AS "Criterio" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Criterio"."id" = "perguntas"."criterioId" LEFT OUTER JOIN "respostas" AS "perguntas->respostas" ON "perguntas"."id" = "perguntas->respostas"."perguntaId" AND "perguntas->respostas"."ratingValue" IS NOT NULL AND "perguntas->respostas"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' WHERE "Criterio"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' ORDER BY "Criterio"."name" ASC;
Executing (default): SELECT date_trunc('day', "createdAt" AT TIME ZONE 'America/Sao_Paulo') AS "period", COUNT("id") AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' GROUP BY date_trunc('day', "createdAt" AT TIME ZONE 'America/Sao_Paulo') ORDER BY date_trunc('day', "createdAt" AT TIME ZONE 'America/Sao_Paulo') ASC;
Executing (default): SELECT "Atendente"."id", "Atendente"."tenantId", "Atendente"."name", "Atendente"."code", "Atendente"."status", "Atendente"."createdAt", "Atendente"."updatedAt", "meta"."id" AS "meta.id", "meta"."atendenteId" AS "meta.atendenteId", "meta"."tenantId" AS "meta.tenantId", "meta"."npsGoal" AS "meta.npsGoal", "meta"."responsesGoal" AS "meta.responsesGoal", "meta"."registrationsGoal" AS "meta.registrationsGoal", "meta"."period" AS "meta.period", "meta"."dias_trabalhados" AS "meta.dias_trabalhados", "meta"."nps_premio_valor" AS "meta.nps_premio_valor", "meta"."respostas_premio_valor" AS "meta.respostas_premio_valor", "meta"."cadastros_premio_valor" AS "meta.cadastros_premio_valor", "meta"."createdAt" AS "meta.createdAt", "meta"."updatedAt" AS "meta.updatedAt" FROM "atendentes" AS "Atendente" LEFT OUTER JOIN "atendente_metas" AS "meta" ON "Atendente"."id" = "meta"."atendenteId" WHERE "Atendente"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Atendente"."status" = 'active';
Executing (default): SELECT date_trunc('day', "createdAt" AT TIME ZONE 'America/Sao_Paulo') AS "period", COUNT(DISTINCT("respondentSessionId")) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Resposta"."respondentSessionId" IS NOT NULL GROUP BY date_trunc('day', "createdAt" AT TIME ZONE 'America/Sao_Paulo') ORDER BY date_trunc('day', "createdAt" AT TIME ZONE 'America/Sao_Paulo') ASC;
Executing (default): SELECT count(*) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT DISTINCT("respondentSessionId") AS "respondentSessionId", MIN("createdAt") AS "firstResponseAt" FROM "respostas" AS "Resposta" WHERE ("Resposta"."ratingValue" IS NOT NULL OR "Resposta"."textValue" != '') AND "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' GROUP BY "respondentSessionId" ORDER BY "firstResponseAt" DESC LIMIT 10 OFFSET 0;
Executing (default): SELECT count(DISTINCT("respondentSessionId")) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Resposta"."ratingValue" >= 9 AND "Resposta"."respondentSessionId" IS NOT NULL;
Executing (default): SELECT "Resposta"."atendenteId", SUM(CASE WHEN "ratingValue" >= 9 THEN 1 ELSE 0 END) AS "promoters", SUM(CASE WHEN "ratingValue" <= 6 THEN 1 ELSE 0 END) AS "detractors", COUNT("Resposta"."id") AS "total" FROM "respostas" AS "Resposta" INNER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" AND "pergunta"."type" = 'rating_0_10' WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Resposta"."atendenteId" IN ('87ccfbbd-4e8c-41ec-afc9-b3e14aacfdb0', '67781806-855c-4e48-bf39-d1305176420a', '8ca6325c-8827-4cbf-982c-d734dcb66116', 'e1e57c66-5381-4734-a24c-ecddfa5d3d86', 'd1ec3ff8-81b0-4d89-9d7b-9da2f859fc07', '56d7b27f-9789-406c-b233-387395e14979', 'acdfd682-bf68-45d0-897a-84709d985ce9') AND "Resposta"."ratingValue" IS NOT NULL GROUP BY "atendenteId";
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT "Resposta"."id", "Resposta"."perguntaId", "Resposta"."pesquisaId", "Resposta"."tenantId", "Resposta"."atendenteId", "Resposta"."respondentSessionId", "Resposta"."ratingValue", "Resposta"."textValue", "Resposta"."selectedOption", "Resposta"."createdAt", "Resposta"."updatedAt", "pergunta"."id" AS "pergunta.id", "pergunta"."text" AS "pergunta.text", "pergunta"."type" AS "pergunta.type", "client"."id" AS "client.id", "client"."name" AS "client.name" FROM "respostas" AS "Resposta" LEFT OUTER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" LEFT OUTER JOIN "clients" AS "client" ON "Resposta"."respondentSessionId" = "client"."respondentSessionId" WHERE "Resposta"."respondentSessionId" IN ('bb1368ea-38a6-4a91-afc5-da17ebd123fa', '7a333ab9-fd99-413c-a338-873e56a79e40', '24ad3ceb-a88e-4698-8ece-4e122a460250', '1c2274c8-e4e9-40d1-8983-64a9226f386a', '934a7943-92b9-4fea-8107-84b7cfbfa81c', '151ab8b6-12f4-4d35-a9ba-94c89064fca7', '0f01b866-5266-4752-a4a5-d5f8629d2cf0', 'cef1af15-5723-455a-a16b-5c5937c21622', '69cb06bc-d461-4b0c-a172-f23df77ce3db', 'aea98f2a-82b9-481b-864b-81249707b348') ORDER BY "Resposta"."createdAt" ASC;
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT "atendenteId", COUNT(DISTINCT("respondentSessionId")) AS "surveyCount" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Resposta"."atendenteId" IN ('87ccfbbd-4e8c-41ec-afc9-b3e14aacfdb0', '67781806-855c-4e48-bf39-d1305176420a', '8ca6325c-8827-4cbf-982c-d734dcb66116', 'e1e57c66-5381-4734-a24c-ecddfa5d3d86', 'd1ec3ff8-81b0-4d89-9d7b-9da2f859fc07', '56d7b27f-9789-406c-b233-387395e14979', 'acdfd682-bf68-45d0-897a-84709d985ce9') GROUP BY "atendenteId";
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT count(DISTINCT("respondentSessionId")) AS "count" FROM "respostas" AS "Resposta" WHERE ("Resposta"."ratingValue" IS NOT NULL OR "Resposta"."textValue" != '') AND "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT count(DISTINCT("respondentSessionId")) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Resposta"."respondentSessionId" IS NOT NULL;
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Cupom"."status" = 'used';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."status" = 'used' AND "Cupom"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
[Auth Middleware] Request: POST /api/auth/verify-token
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = '77f853e9-deb2-4067-881e-71fa16d3054f';
[Auth Middleware] Request: GET /api/dashboard/summary
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = '77f853e9-deb2-4067-881e-71fa16d3054f';
[Auth Middleware] Request: GET /api/dashboard/surveys-responded-chart
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = '77f853e9-deb2-4067-881e-71fa16d3054f';
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
[Auth Middleware] Request: GET /api/dashboard/criteria-scores
[Auth Middleware] Request: GET /api/dashboard/response-chart
[Auth Middleware] Request: GET /api/dashboard/conversion-chart
[Auth Middleware] Request: GET /api/dashboard/attendants-performance
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
[Auth Middleware] Request: GET /api/dashboard/recent-feedbacks?page=1&limit=10
[Auth Middleware] Request: GET /api/dashboard/nps-trend?period=day
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = '77f853e9-deb2-4067-881e-71fa16d3054f';
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = '77f853e9-deb2-4067-881e-71fa16d3054f';
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = '77f853e9-deb2-4067-881e-71fa16d3054f';
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = '77f853e9-deb2-4067-881e-71fa16d3054f';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = '77f853e9-deb2-4067-881e-71fa16d3054f';
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = '77f853e9-deb2-4067-881e-71fa16d3054f';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "Resposta"."id", "Resposta"."perguntaId", "Resposta"."pesquisaId", "Resposta"."tenantId", "Resposta"."atendenteId", "Resposta"."respondentSessionId", "Resposta"."ratingValue", "Resposta"."textValue", "Resposta"."selectedOption", "Resposta"."createdAt", "Resposta"."updatedAt", "pergunta"."id" AS "pergunta.id", "pergunta"."type" AS "pergunta.type", "pergunta"."criterioId" AS "pergunta.criterioId" FROM "respostas" AS "Resposta" INNER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Resposta"."ratingValue" IS NOT NULL;
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT date_trunc('day', "createdAt" AT TIME ZONE 'America/Sao_Paulo') AS "period", COUNT(DISTINCT("respondentSessionId")) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Resposta"."respondentSessionId" IS NOT NULL GROUP BY date_trunc('day', "createdAt" AT TIME ZONE 'America/Sao_Paulo') ORDER BY date_trunc('day', "createdAt" AT TIME ZONE 'America/Sao_Paulo') ASC;
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT date_trunc('day', "createdAt" AT TIME ZONE 'America/Sao_Paulo') AS "period", COUNT("id") AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' GROUP BY date_trunc('day', "createdAt" AT TIME ZONE 'America/Sao_Paulo') ORDER BY date_trunc('day', "createdAt" AT TIME ZONE 'America/Sao_Paulo') ASC;
Executing (default): SELECT count(DISTINCT("respondentSessionId")) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Resposta"."ratingValue" >= 9 AND "Resposta"."respondentSessionId" IS NOT NULL;
Executing (default): SELECT "Criterio"."id", "Criterio"."tenantId", "Criterio"."name", "Criterio"."description", "Criterio"."type", "Criterio"."createdAt", "Criterio"."updatedAt", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas->respostas"."id" AS "perguntas.respostas.id", "perguntas->respostas"."ratingValue" AS "perguntas.respostas.ratingValue" FROM "criterios" AS "Criterio" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Criterio"."id" = "perguntas"."criterioId" LEFT OUTER JOIN "respostas" AS "perguntas->respostas" ON "perguntas"."id" = "perguntas->respostas"."perguntaId" AND "perguntas->respostas"."ratingValue" IS NOT NULL AND "perguntas->respostas"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' WHERE "Criterio"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' ORDER BY "Criterio"."name" ASC;
Executing (default): SELECT DISTINCT("respondentSessionId") AS "respondentSessionId", MIN("createdAt") AS "firstResponseAt" FROM "respostas" AS "Resposta" WHERE ("Resposta"."ratingValue" IS NOT NULL OR "Resposta"."textValue" != '') AND "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' GROUP BY "respondentSessionId" ORDER BY "firstResponseAt" DESC LIMIT 10 OFFSET 0;
Executing (default): SELECT date_trunc('day', "Resposta"."createdAt" AT TIME ZONE 'America/Sao_Paulo') AS "period", SUM(CASE WHEN "ratingValue" >= 9 THEN 1 ELSE 0 END) AS "promoters", SUM(CASE WHEN "ratingValue" <= 6 THEN 1 ELSE 0 END) AS "detractors", COUNT("Resposta"."id") AS "total" FROM "respostas" AS "Resposta" INNER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" AND "pergunta"."type" = 'rating_0_10' WHERE "Resposta"."ratingValue" IS NOT NULL AND "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' GROUP BY date_trunc('day', "Resposta"."createdAt" AT TIME ZONE 'America/Sao_Paulo') ORDER BY date_trunc('day', "Resposta"."createdAt" AT TIME ZONE 'America/Sao_Paulo') ASC;
Executing (default): SELECT "Atendente"."id", "Atendente"."tenantId", "Atendente"."name", "Atendente"."code", "Atendente"."status", "Atendente"."createdAt", "Atendente"."updatedAt", "meta"."id" AS "meta.id", "meta"."atendenteId" AS "meta.atendenteId", "meta"."tenantId" AS "meta.tenantId", "meta"."npsGoal" AS "meta.npsGoal", "meta"."responsesGoal" AS "meta.responsesGoal", "meta"."registrationsGoal" AS "meta.registrationsGoal", "meta"."period" AS "meta.period", "meta"."dias_trabalhados" AS "meta.dias_trabalhados", "meta"."nps_premio_valor" AS "meta.nps_premio_valor", "meta"."respostas_premio_valor" AS "meta.respostas_premio_valor", "meta"."cadastros_premio_valor" AS "meta.cadastros_premio_valor", "meta"."createdAt" AS "meta.createdAt", "meta"."updatedAt" AS "meta.updatedAt" FROM "atendentes" AS "Atendente" LEFT OUTER JOIN "atendente_metas" AS "meta" ON "Atendente"."id" = "meta"."atendenteId" WHERE "Atendente"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Atendente"."status" = 'active';
Executing (default): SELECT count(*) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT "Resposta"."id", "Resposta"."perguntaId", "Resposta"."pesquisaId", "Resposta"."tenantId", "Resposta"."atendenteId", "Resposta"."respondentSessionId", "Resposta"."ratingValue", "Resposta"."textValue", "Resposta"."selectedOption", "Resposta"."createdAt", "Resposta"."updatedAt", "pergunta"."id" AS "pergunta.id", "pergunta"."text" AS "pergunta.text", "pergunta"."type" AS "pergunta.type", "client"."id" AS "client.id", "client"."name" AS "client.name" FROM "respostas" AS "Resposta" LEFT OUTER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" LEFT OUTER JOIN "clients" AS "client" ON "Resposta"."respondentSessionId" = "client"."respondentSessionId" WHERE "Resposta"."respondentSessionId" IN ('bb1368ea-38a6-4a91-afc5-da17ebd123fa', '7a333ab9-fd99-413c-a338-873e56a79e40', '24ad3ceb-a88e-4698-8ece-4e122a460250', '1c2274c8-e4e9-40d1-8983-64a9226f386a', '934a7943-92b9-4fea-8107-84b7cfbfa81c', '151ab8b6-12f4-4d35-a9ba-94c89064fca7', '0f01b866-5266-4752-a4a5-d5f8629d2cf0', 'cef1af15-5723-455a-a16b-5c5937c21622', '69cb06bc-d461-4b0c-a172-f23df77ce3db', 'aea98f2a-82b9-481b-864b-81249707b348') ORDER BY "Resposta"."createdAt" ASC;
Executing (default): SELECT "Resposta"."atendenteId", SUM(CASE WHEN "ratingValue" >= 9 THEN 1 ELSE 0 END) AS "promoters", SUM(CASE WHEN "ratingValue" <= 6 THEN 1 ELSE 0 END) AS "detractors", COUNT("Resposta"."id") AS "total" FROM "respostas" AS "Resposta" INNER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" AND "pergunta"."type" = 'rating_0_10' WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Resposta"."atendenteId" IN ('87ccfbbd-4e8c-41ec-afc9-b3e14aacfdb0', '67781806-855c-4e48-bf39-d1305176420a', '8ca6325c-8827-4cbf-982c-d734dcb66116', 'e1e57c66-5381-4734-a24c-ecddfa5d3d86', 'd1ec3ff8-81b0-4d89-9d7b-9da2f859fc07', '56d7b27f-9789-406c-b233-387395e14979', 'acdfd682-bf68-45d0-897a-84709d985ce9') AND "Resposta"."ratingValue" IS NOT NULL GROUP BY "atendenteId";
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT count(DISTINCT("respondentSessionId")) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Resposta"."respondentSessionId" IS NOT NULL;
Executing (default): SELECT count(DISTINCT("respondentSessionId")) AS "count" FROM "respostas" AS "Resposta" WHERE ("Resposta"."ratingValue" IS NOT NULL OR "Resposta"."textValue" != '') AND "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT "atendenteId", COUNT(DISTINCT("respondentSessionId")) AS "surveyCount" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Resposta"."atendenteId" IN ('87ccfbbd-4e8c-41ec-afc9-b3e14aacfdb0', '67781806-855c-4e48-bf39-d1305176420a', '8ca6325c-8827-4cbf-982c-d734dcb66116', 'e1e57c66-5381-4734-a24c-ecddfa5d3d86', 'd1ec3ff8-81b0-4d89-9d7b-9da2f859fc07', '56d7b27f-9789-406c-b233-387395e14979', 'acdfd682-bf68-45d0-897a-84709d985ce9') GROUP BY "atendenteId";
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Cupom"."status" = 'used';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."status" = 'used' AND "Cupom"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
[Auth Middleware] Request: GET /api/dashboard/attendants-performance
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = '77f853e9-deb2-4067-881e-71fa16d3054f';
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
[Auth Middleware] Request: GET /api/dashboard/attendant-responses-timeseries?period=day
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = '77f853e9-deb2-4067-881e-71fa16d3054f';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "Atendente"."id", "Atendente"."tenantId", "Atendente"."name", "Atendente"."code", "Atendente"."status", "Atendente"."createdAt", "Atendente"."updatedAt", "meta"."id" AS "meta.id", "meta"."atendenteId" AS "meta.atendenteId", "meta"."tenantId" AS "meta.tenantId", "meta"."npsGoal" AS "meta.npsGoal", "meta"."responsesGoal" AS "meta.responsesGoal", "meta"."registrationsGoal" AS "meta.registrationsGoal", "meta"."period" AS "meta.period", "meta"."dias_trabalhados" AS "meta.dias_trabalhados", "meta"."nps_premio_valor" AS "meta.nps_premio_valor", "meta"."respostas_premio_valor" AS "meta.respostas_premio_valor", "meta"."cadastros_premio_valor" AS "meta.cadastros_premio_valor", "meta"."createdAt" AS "meta.createdAt", "meta"."updatedAt" AS "meta.updatedAt" FROM "atendentes" AS "Atendente" LEFT OUTER JOIN "atendente_metas" AS "meta" ON "Atendente"."id" = "meta"."atendenteId" WHERE "Atendente"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Atendente"."status" = 'active';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT "Resposta"."atendenteId", SUM(CASE WHEN "ratingValue" >= 9 THEN 1 ELSE 0 END) AS "promoters", SUM(CASE WHEN "ratingValue" <= 6 THEN 1 ELSE 0 END) AS "detractors", COUNT("Resposta"."id") AS "total" FROM "respostas" AS "Resposta" INNER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" AND "pergunta"."type" = 'rating_0_10' WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Resposta"."atendenteId" IN ('87ccfbbd-4e8c-41ec-afc9-b3e14aacfdb0', '67781806-855c-4e48-bf39-d1305176420a', '8ca6325c-8827-4cbf-982c-d734dcb66116', 'e1e57c66-5381-4734-a24c-ecddfa5d3d86', 'd1ec3ff8-81b0-4d89-9d7b-9da2f859fc07', '56d7b27f-9789-406c-b233-387395e14979', 'acdfd682-bf68-45d0-897a-84709d985ce9') AND "Resposta"."ratingValue" IS NOT NULL GROUP BY "atendenteId";
Executing (default): SELECT "Resposta"."atendenteId", date_trunc('day', "Resposta"."createdAt") AS "period", COUNT(DISTINCT("respondentSessionId")) AS "count", "atendente"."name" AS "atendente.name" FROM "respostas" AS "Resposta" INNER JOIN "atendentes" AS "atendente" ON "Resposta"."atendenteId" = "atendente"."id" WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Resposta"."atendenteId" IS NOT NULL GROUP BY "atendenteId", "atendente"."id", "atendente"."name", "period" ORDER BY "period" ASC;
Executing (default): SELECT "atendenteId", COUNT(DISTINCT("respondentSessionId")) AS "surveyCount" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Resposta"."atendenteId" IN ('87ccfbbd-4e8c-41ec-afc9-b3e14aacfdb0', '67781806-855c-4e48-bf39-d1305176420a', '8ca6325c-8827-4cbf-982c-d734dcb66116', 'e1e57c66-5381-4734-a24c-ecddfa5d3d86', 'd1ec3ff8-81b0-4d89-9d7b-9da2f859fc07', '56d7b27f-9789-406c-b233-387395e14979', 'acdfd682-bf68-45d0-897a-84709d985ce9') GROUP BY "atendenteId";
[Auth Middleware] Request: POST /api/auth/verify-token
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
[Auth Middleware] Request: GET /api/dashboard/summary
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
[Auth Middleware] Request: GET /api/dashboard/response-chart
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
[Auth Middleware] Request: GET /api/dashboard/surveys-responded-chart
[Auth Middleware] Request: GET /api/dashboard/criteria-scores
[Auth Middleware] Request: GET /api/dashboard/attendants-performance
[Auth Middleware] Request: GET /api/dashboard/nps-trend?period=day
[Auth Middleware] Request: GET /api/dashboard/conversion-chart
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
[Auth Middleware] Request: GET /api/dashboard/recent-feedbacks?page=1&limit=10
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "Resposta"."id", "Resposta"."perguntaId", "Resposta"."pesquisaId", "Resposta"."tenantId", "Resposta"."atendenteId", "Resposta"."respondentSessionId", "Resposta"."ratingValue", "Resposta"."textValue", "Resposta"."selectedOption", "Resposta"."createdAt", "Resposta"."updatedAt", "pergunta"."id" AS "pergunta.id", "pergunta"."type" AS "pergunta.type", "pergunta"."criterioId" AS "pergunta.criterioId" FROM "respostas" AS "Resposta" INNER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."ratingValue" IS NOT NULL;
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT date_trunc('day', "createdAt" AT TIME ZONE 'America/Sao_Paulo') AS "period", COUNT(DISTINCT("respondentSessionId")) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."respondentSessionId" IS NOT NULL GROUP BY date_trunc('day', "createdAt" AT TIME ZONE 'America/Sao_Paulo') ORDER BY date_trunc('day', "createdAt" AT TIME ZONE 'America/Sao_Paulo') ASC;
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT date_trunc('day', "createdAt" AT TIME ZONE 'America/Sao_Paulo') AS "period", COUNT("id") AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' GROUP BY date_trunc('day', "createdAt" AT TIME ZONE 'America/Sao_Paulo') ORDER BY date_trunc('day', "createdAt" AT TIME ZONE 'America/Sao_Paulo') ASC;
Executing (default): SELECT "Criterio"."id", "Criterio"."tenantId", "Criterio"."name", "Criterio"."description", "Criterio"."type", "Criterio"."createdAt", "Criterio"."updatedAt", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas->respostas"."id" AS "perguntas.respostas.id", "perguntas->respostas"."ratingValue" AS "perguntas.respostas.ratingValue" FROM "criterios" AS "Criterio" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Criterio"."id" = "perguntas"."criterioId" LEFT OUTER JOIN "respostas" AS "perguntas->respostas" ON "perguntas"."id" = "perguntas->respostas"."perguntaId" AND "perguntas->respostas"."ratingValue" IS NOT NULL AND "perguntas->respostas"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' WHERE "Criterio"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' ORDER BY "Criterio"."name" ASC;
Executing (default): SELECT "Atendente"."id", "Atendente"."tenantId", "Atendente"."name", "Atendente"."code", "Atendente"."status", "Atendente"."createdAt", "Atendente"."updatedAt", "meta"."id" AS "meta.id", "meta"."atendenteId" AS "meta.atendenteId", "meta"."tenantId" AS "meta.tenantId", "meta"."npsGoal" AS "meta.npsGoal", "meta"."responsesGoal" AS "meta.responsesGoal", "meta"."registrationsGoal" AS "meta.registrationsGoal", "meta"."period" AS "meta.period", "meta"."dias_trabalhados" AS "meta.dias_trabalhados", "meta"."nps_premio_valor" AS "meta.nps_premio_valor", "meta"."respostas_premio_valor" AS "meta.respostas_premio_valor", "meta"."cadastros_premio_valor" AS "meta.cadastros_premio_valor", "meta"."createdAt" AS "meta.createdAt", "meta"."updatedAt" AS "meta.updatedAt" FROM "atendentes" AS "Atendente" LEFT OUTER JOIN "atendente_metas" AS "meta" ON "Atendente"."id" = "meta"."atendenteId" WHERE "Atendente"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Atendente"."status" = 'active';
Executing (default): SELECT count(DISTINCT("respondentSessionId")) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."ratingValue" >= 9 AND "Resposta"."respondentSessionId" IS NOT NULL;
Executing (default): SELECT count(*) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT date_trunc('day', "Resposta"."createdAt" AT TIME ZONE 'America/Sao_Paulo') AS "period", SUM(CASE WHEN "ratingValue" >= 9 THEN 1 ELSE 0 END) AS "promoters", SUM(CASE WHEN "ratingValue" <= 6 THEN 1 ELSE 0 END) AS "detractors", COUNT("Resposta"."id") AS "total" FROM "respostas" AS "Resposta" INNER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" AND "pergunta"."type" = 'rating_0_10' WHERE "Resposta"."ratingValue" IS NOT NULL AND "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' GROUP BY date_trunc('day', "Resposta"."createdAt" AT TIME ZONE 'America/Sao_Paulo') ORDER BY date_trunc('day', "Resposta"."createdAt" AT TIME ZONE 'America/Sao_Paulo') ASC;
Executing (default): SELECT "Resposta"."atendenteId", SUM(CASE WHEN "ratingValue" >= 9 THEN 1 ELSE 0 END) AS "promoters", SUM(CASE WHEN "ratingValue" <= 6 THEN 1 ELSE 0 END) AS "detractors", COUNT("Resposta"."id") AS "total" FROM "respostas" AS "Resposta" INNER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" AND "pergunta"."type" = 'rating_0_10' WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" IN ('f60c5a4d-1c9a-474c-89db-2abd95e8e06f', '49c162d2-fdde-448c-86f8-14b9c93be792', 'b13aa606-ae37-4d5b-8405-9610cbdffc25', 'ead2104c-7963-47ff-8336-852ad10d355f', '78b6809d-1ef3-4950-920c-ca4adfdbf114', '1c1b649b-a287-4430-84ba-3648a81a5001', '2a4fd6a3-c581-401d-ba65-9225b56cd850', '8b5efb23-f875-4ada-a3ae-e83e1f70e8cb', '2dbadb84-aafa-4c99-a50d-9b01d56ca921') AND "Resposta"."ratingValue" IS NOT NULL GROUP BY "atendenteId";
Executing (default): SELECT DISTINCT("respondentSessionId") AS "respondentSessionId", MIN("createdAt") AS "firstResponseAt" FROM "respostas" AS "Resposta" WHERE ("Resposta"."ratingValue" IS NOT NULL OR "Resposta"."textValue" != '') AND "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' GROUP BY "respondentSessionId" ORDER BY "firstResponseAt" DESC LIMIT 10 OFFSET 0;
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "atendenteId", COUNT(DISTINCT("respondentSessionId")) AS "surveyCount" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" IN ('f60c5a4d-1c9a-474c-89db-2abd95e8e06f', '49c162d2-fdde-448c-86f8-14b9c93be792', 'b13aa606-ae37-4d5b-8405-9610cbdffc25', 'ead2104c-7963-47ff-8336-852ad10d355f', '78b6809d-1ef3-4950-920c-ca4adfdbf114', '1c1b649b-a287-4430-84ba-3648a81a5001', '2a4fd6a3-c581-401d-ba65-9225b56cd850', '8b5efb23-f875-4ada-a3ae-e83e1f70e8cb', '2dbadb84-aafa-4c99-a50d-9b01d56ca921') GROUP BY "atendenteId";
Executing (default): SELECT "Resposta"."id", "Resposta"."perguntaId", "Resposta"."pesquisaId", "Resposta"."tenantId", "Resposta"."atendenteId", "Resposta"."respondentSessionId", "Resposta"."ratingValue", "Resposta"."textValue", "Resposta"."selectedOption", "Resposta"."createdAt", "Resposta"."updatedAt", "pergunta"."id" AS "pergunta.id", "pergunta"."text" AS "pergunta.text", "pergunta"."type" AS "pergunta.type", "client"."id" AS "client.id", "client"."name" AS "client.name" FROM "respostas" AS "Resposta" LEFT OUTER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" LEFT OUTER JOIN "clients" AS "client" ON "Resposta"."respondentSessionId" = "client"."respondentSessionId" WHERE "Resposta"."respondentSessionId" IN ('4b7834fa-453c-426f-8d01-c721cc3503f7', '536faee7-59ff-45ce-a647-afa2d90e12e6', 'fdfc5974-a4d9-4558-b387-c3062a864f48', '429b8cdf-532c-4dca-96c8-d5cd15268a8e', '340cdc68-f8fc-43bc-90dd-c40db90aa89e', '80ae00cb-f38e-4014-b7ca-20cd1267c006', '670c0468-6f68-4564-b810-13a350596fac', '5bbc0aeb-f490-4c04-983a-df1a1355213d', '6f1266ea-365d-4760-bc0c-80e420e9b1de', '6ac9767b-7254-440a-9d91-ba945b4bab21') ORDER BY "Resposta"."createdAt" ASC;
Executing (default): SELECT count(DISTINCT("respondentSessionId")) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."respondentSessionId" IS NOT NULL;
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Cupom"."status" = 'used';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT count(DISTINCT("respondentSessionId")) AS "count" FROM "respostas" AS "Resposta" WHERE ("Resposta"."ratingValue" IS NOT NULL OR "Resposta"."textValue" != '') AND "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."status" = 'used' AND "Cupom"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: GET /api/dashboard/attendants-performance
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
[Auth Middleware] Request: GET /api/dashboard/attendant-responses-timeseries?period=day
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT "Resposta"."atendenteId", date_trunc('day', "Resposta"."createdAt") AS "period", COUNT(DISTINCT("respondentSessionId")) AS "count", "atendente"."name" AS "atendente.name" FROM "respostas" AS "Resposta" INNER JOIN "atendentes" AS "atendente" ON "Resposta"."atendenteId" = "atendente"."id" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" IS NOT NULL GROUP BY "atendenteId", "atendente"."id", "atendente"."name", "period" ORDER BY "period" ASC;
Executing (default): SELECT "Atendente"."id", "Atendente"."tenantId", "Atendente"."name", "Atendente"."code", "Atendente"."status", "Atendente"."createdAt", "Atendente"."updatedAt", "meta"."id" AS "meta.id", "meta"."atendenteId" AS "meta.atendenteId", "meta"."tenantId" AS "meta.tenantId", "meta"."npsGoal" AS "meta.npsGoal", "meta"."responsesGoal" AS "meta.responsesGoal", "meta"."registrationsGoal" AS "meta.registrationsGoal", "meta"."period" AS "meta.period", "meta"."dias_trabalhados" AS "meta.dias_trabalhados", "meta"."nps_premio_valor" AS "meta.nps_premio_valor", "meta"."respostas_premio_valor" AS "meta.respostas_premio_valor", "meta"."cadastros_premio_valor" AS "meta.cadastros_premio_valor", "meta"."createdAt" AS "meta.createdAt", "meta"."updatedAt" AS "meta.updatedAt" FROM "atendentes" AS "Atendente" LEFT OUTER JOIN "atendente_metas" AS "meta" ON "Atendente"."id" = "meta"."atendenteId" WHERE "Atendente"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Atendente"."status" = 'active';
Executing (default): SELECT "Resposta"."atendenteId", SUM(CASE WHEN "ratingValue" >= 9 THEN 1 ELSE 0 END) AS "promoters", SUM(CASE WHEN "ratingValue" <= 6 THEN 1 ELSE 0 END) AS "detractors", COUNT("Resposta"."id") AS "total" FROM "respostas" AS "Resposta" INNER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" AND "pergunta"."type" = 'rating_0_10' WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" IN ('f60c5a4d-1c9a-474c-89db-2abd95e8e06f', '49c162d2-fdde-448c-86f8-14b9c93be792', 'b13aa606-ae37-4d5b-8405-9610cbdffc25', 'ead2104c-7963-47ff-8336-852ad10d355f', '78b6809d-1ef3-4950-920c-ca4adfdbf114', '1c1b649b-a287-4430-84ba-3648a81a5001', '2a4fd6a3-c581-401d-ba65-9225b56cd850', '8b5efb23-f875-4ada-a3ae-e83e1f70e8cb', '2dbadb84-aafa-4c99-a50d-9b01d56ca921') AND "Resposta"."ratingValue" IS NOT NULL GROUP BY "atendenteId";
Executing (default): SELECT "atendenteId", COUNT(DISTINCT("respondentSessionId")) AS "surveyCount" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" IN ('f60c5a4d-1c9a-474c-89db-2abd95e8e06f', '49c162d2-fdde-448c-86f8-14b9c93be792', 'b13aa606-ae37-4d5b-8405-9610cbdffc25', 'ead2104c-7963-47ff-8336-852ad10d355f', '78b6809d-1ef3-4950-920c-ca4adfdbf114', '1c1b649b-a287-4430-84ba-3648a81a5001', '2a4fd6a3-c581-401d-ba65-9225b56cd850', '8b5efb23-f875-4ada-a3ae-e83e1f70e8cb', '2dbadb84-aafa-4c99-a50d-9b01d56ca921') GROUP BY "atendenteId";
Executing (default): SELECT "Pesquisa"."id", "Pesquisa"."title", "Pesquisa"."description", "Pesquisa"."createdAt", "Pesquisa"."updatedAt", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."status", "Pesquisa"."recompensaId", "Pesquisa"."roletaId", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."text" AS "perguntas.text", "perguntas"."options" AS "perguntas.options", "perguntas"."order" AS "perguntas.order", "perguntas"."required" AS "perguntas.required", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."description" AS "tenant.description", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "roleta"."id" AS "roleta.id", "roleta"."nome" AS "roleta.nome", "roleta"."descricao" AS "roleta.descricao", "roleta"."active" AS "roleta.active" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" LEFT OUTER JOIN "tenants" AS "tenant" ON "Pesquisa"."tenantId" = "tenant"."id" LEFT OUTER JOIN "roletas" AS "roleta" ON "Pesquisa"."roletaId" = "roleta"."id" WHERE "Pesquisa"."id" = '87d63f62-4bb9-43e5-ab76-9eb004d4d2bb';
[Auth Middleware] Request: POST /api/auth/verify-token
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
Executing (default): SELECT "id", "name" FROM "atendentes" AS "Atendente" WHERE "Atendente"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Atendente"."status" = 'active' ORDER BY "Atendente"."name" ASC;
Executing (default): SELECT "askForAttendant" FROM "pesquisas" AS "Pesquisa" WHERE "Pesquisa"."id" = '87d63f62-4bb9-43e5-ab76-9eb004d4d2bb';
Executing (default): SELECT "Pesquisa"."id", "Pesquisa"."title", "Pesquisa"."description", "Pesquisa"."createdAt", "Pesquisa"."updatedAt", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."status", "Pesquisa"."recompensaId", "Pesquisa"."roletaId", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."text" AS "perguntas.text", "perguntas"."options" AS "perguntas.options", "perguntas"."order" AS "perguntas.order", "perguntas"."required" AS "perguntas.required", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."description" AS "tenant.description", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "roleta"."id" AS "roleta.id", "roleta"."nome" AS "roleta.nome", "roleta"."descricao" AS "roleta.descricao", "roleta"."active" AS "roleta.active" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" LEFT OUTER JOIN "tenants" AS "tenant" ON "Pesquisa"."tenantId" = "tenant"."id" LEFT OUTER JOIN "roletas" AS "roleta" ON "Pesquisa"."roletaId" = "roleta"."id" WHERE "Pesquisa"."id" = '87d63f62-4bb9-43e5-ab76-9eb004d4d2bb';
Executing (027914c8-296a-4a08-870e-8a02053f4995): SELECT "Pesquisa"."id", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."title", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."options" AS "perguntas.options", "perguntas"."required" AS "perguntas.required", "perguntas"."text" AS "perguntas.text" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" WHERE "Pesquisa"."id" = '87d63f62-4bb9-43e5-ab76-9eb004d4d2bb';
Executing (027914c8-296a-4a08-870e-8a02053f4995): INSERT INTO "respostas" ("id","perguntaId","pesquisaId","tenantId","atendenteId","respondentSessionId","ratingValue","textValue","createdAt","updatedAt") VALUES ('bc691288-95f0-45e1-aa36-feed4ba6d249','cc2c724c-3580-4f94-ab87-5822e4497770','87d63f62-4bb9-43e5-ab76-9eb004d4d2bb','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd','b13aa606-ae37-4d5b-8405-9610cbdffc25','1901f579-5fd3-4c78-84af-70948a765733',5,NULL,'2026-01-17 11:52:23.273 +00:00','2026-01-17 11:52:23.273 +00:00'),('fb4e01d4-3dc3-4750-8973-017191ddb5c3','2ffb181f-141b-472d-9abd-3c51595c7f29','87d63f62-4bb9-43e5-ab76-9eb004d4d2bb','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd','b13aa606-ae37-4d5b-8405-9610cbdffc25','1901f579-5fd3-4c78-84af-70948a765733',5,NULL,'2026-01-17 11:52:23.273 +00:00','2026-01-17 11:52:23.273 +00:00'),('76580914-8b47-440d-82c0-69295faa42d3','5f7acf91-90d6-44cd-963f-6f81effd5e1a','87d63f62-4bb9-43e5-ab76-9eb004d4d2bb','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd','b13aa606-ae37-4d5b-8405-9610cbdffc25','1901f579-5fd3-4c78-84af-70948a765733',5,NULL,'2026-01-17 11:52:23.273 +00:00','2026-01-17 11:52:23.273 +00:00'),('a9b5b7b0-623c-4f0c-b5a1-ff79b3664f09','d5938446-234d-40c3-967c-050cb336aa06','87d63f62-4bb9-43e5-ab76-9eb004d4d2bb','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd','b13aa606-ae37-4d5b-8405-9610cbdffc25','1901f579-5fd3-4c78-84af-70948a765733',10,NULL,'2026-01-17 11:52:23.273 +00:00','2026-01-17 11:52:23.273 +00:00') RETURNING "id","perguntaId","pesquisaId","tenantId","atendenteId","respondentSessionId","ratingValue","textValue","selectedOption","createdAt","updatedAt";
Executing (default): SELECT "gmb_link" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' LIMIT 1;
Executing (default): SELECT "Pesquisa"."id", "Pesquisa"."title", "Pesquisa"."description", "Pesquisa"."createdAt", "Pesquisa"."updatedAt", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."status", "Pesquisa"."recompensaId", "Pesquisa"."roletaId", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."text" AS "perguntas.text", "perguntas"."options" AS "perguntas.options", "perguntas"."order" AS "perguntas.order", "perguntas"."required" AS "perguntas.required", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."description" AS "tenant.description", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "roleta"."id" AS "roleta.id", "roleta"."nome" AS "roleta.nome", "roleta"."descricao" AS "roleta.descricao", "roleta"."active" AS "roleta.active" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" LEFT OUTER JOIN "tenants" AS "tenant" ON "Pesquisa"."tenantId" = "tenant"."id" LEFT OUTER JOIN "roletas" AS "roleta" ON "Pesquisa"."roletaId" = "roleta"."id" WHERE "Pesquisa"."id" = '87d63f62-4bb9-43e5-ab76-9eb004d4d2bb';
Executing (default): SELECT "id", "tenantId", "name", "email", "phone", "birthDate", "respondentSessionId", "gender", "createdAt", "updatedAt" FROM "clients" AS "Client" WHERE "Client"."phone" = '(35) 99837-4007' AND "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' LIMIT 1;
Executing (e35e1a02-577e-4773-9fe4-6a708a5b6c9e): SELECT "Pesquisa"."id", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."title", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."options" AS "perguntas.options", "perguntas"."required" AS "perguntas.required", "perguntas"."text" AS "perguntas.text" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" WHERE "Pesquisa"."id" = '87d63f62-4bb9-43e5-ab76-9eb004d4d2bb';
Executing (e35e1a02-577e-4773-9fe4-6a708a5b6c9e): INSERT INTO "respostas" ("id","perguntaId","pesquisaId","tenantId","atendenteId","respondentSessionId","ratingValue","textValue","createdAt","updatedAt") VALUES ('a133c4f0-e9c8-42ea-b9fd-549286c80261','cc2c724c-3580-4f94-ab87-5822e4497770','87d63f62-4bb9-43e5-ab76-9eb004d4d2bb','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd','b13aa606-ae37-4d5b-8405-9610cbdffc25','76027a89-f04f-48c8-a599-946060ce682b',5,NULL,'2026-01-17 11:52:27.608 +00:00','2026-01-17 11:52:27.608 +00:00'),('e9a74fb4-cf61-4e2a-ac3b-47b1ecabb9b7','2ffb181f-141b-472d-9abd-3c51595c7f29','87d63f62-4bb9-43e5-ab76-9eb004d4d2bb','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd','b13aa606-ae37-4d5b-8405-9610cbdffc25','76027a89-f04f-48c8-a599-946060ce682b',5,NULL,'2026-01-17 11:52:27.608 +00:00','2026-01-17 11:52:27.608 +00:00'),('d8812922-0e5b-47a6-b359-f4df501b7720','5f7acf91-90d6-44cd-963f-6f81effd5e1a','87d63f62-4bb9-43e5-ab76-9eb004d4d2bb','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd','b13aa606-ae37-4d5b-8405-9610cbdffc25','76027a89-f04f-48c8-a599-946060ce682b',5,NULL,'2026-01-17 11:52:27.608 +00:00','2026-01-17 11:52:27.608 +00:00'),('9ba832ac-1756-4649-940e-4888105abf80','d5938446-234d-40c3-967c-050cb336aa06','87d63f62-4bb9-43e5-ab76-9eb004d4d2bb','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd','b13aa606-ae37-4d5b-8405-9610cbdffc25','76027a89-f04f-48c8-a599-946060ce682b',10,NULL,'2026-01-17 11:52:27.608 +00:00','2026-01-17 11:52:27.608 +00:00') RETURNING "id","perguntaId","pesquisaId","tenantId","atendenteId","respondentSessionId","ratingValue","textValue","selectedOption","createdAt","updatedAt";
Executing (default): SELECT "gmb_link" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' LIMIT 1;
Executing (default): SELECT "id", "tenantId", "name", "email", "phone", "birthDate", "respondentSessionId", "gender", "createdAt", "updatedAt" FROM "clients" AS "Client" WHERE "Client"."id" = '7809ef0d-14c0-47dd-bee2-09ebcc7c2150';
Executing (default): SELECT "Pesquisa"."id", "Pesquisa"."title", "Pesquisa"."description", "Pesquisa"."createdAt", "Pesquisa"."updatedAt", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."status", "Pesquisa"."recompensaId", "Pesquisa"."roletaId", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."text" AS "perguntas.text", "perguntas"."options" AS "perguntas.options", "perguntas"."order" AS "perguntas.order", "perguntas"."required" AS "perguntas.required", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."description" AS "tenant.description", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "roleta"."id" AS "roleta.id", "roleta"."nome" AS "roleta.nome", "roleta"."descricao" AS "roleta.descricao", "roleta"."active" AS "roleta.active" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" LEFT OUTER JOIN "tenants" AS "tenant" ON "Pesquisa"."tenantId" = "tenant"."id" LEFT OUTER JOIN "roletas" AS "roleta" ON "Pesquisa"."roletaId" = "roleta"."id" WHERE "Pesquisa"."id" = '87d63f62-4bb9-43e5-ab76-9eb004d4d2bb';
Executing (default): SELECT "id", "name", "logoUrl", "primaryColor", "secondaryColor", "description" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "tenantId", "creatorId", "title", "description", "startDate", "endDate", "isOpen", "askForAttendant", "status", "expectedRespondents", "dueDate", "recompensaId", "roletaId", "createdAt", "updatedAt" FROM "pesquisas" AS "Pesquisa" WHERE "Pesquisa"."id" = '87d63f62-4bb9-43e5-ab76-9eb004d4d2bb';
Executing (default): SELECT "id", "pesquisaId", "campanhaId", "tenantId", "recompensaId", "codigo", "clienteId", "dataGeracao", "dataUtilizacao", "dataValidade", "status", "ultimoContato", "createdAt", "updatedAt" FROM "cupons" AS "Cupom" WHERE "Cupom"."clienteId" = '7809ef0d-14c0-47dd-bee2-09ebcc7c2150' AND "Cupom"."pesquisaId" = '87d63f62-4bb9-43e5-ab76-9eb004d4d2bb' ORDER BY "Cupom"."dataGeracao" DESC LIMIT 1;
Executing (default): SELECT "RoletaPremio"."id", "RoletaPremio"."tenantId", "RoletaPremio"."nome", "RoletaPremio"."descricao", "RoletaPremio"."porcentagem", "RoletaPremio"."cor", "RoletaPremio"."recompensaId", "RoletaPremio"."roletaId", "RoletaPremio"."imageUrl", "RoletaPremio"."active", "RoletaPremio"."isNoPrizeOption", "RoletaPremio"."createdAt", "RoletaPremio"."updatedAt", "recompensa"."id" AS "recompensa.id", "recompensa"."tenantId" AS "recompensa.tenantId", "recompensa"."name" AS "recompensa.name", "recompensa"."description" AS "recompensa.description", "recompensa"."pointsRequired" AS "recompensa.pointsRequired", "recompensa"."type" AS "recompensa.type", "recompensa"."value" AS "recompensa.value", "recompensa"."imageUrl" AS "recompensa.imageUrl", "recompensa"."active" AS "recompensa.active", "recompensa"."createdAt" AS "recompensa.createdAt", "recompensa"."updatedAt" AS "recompensa.updatedAt" FROM "roleta_premios" AS "RoletaPremio" LEFT OUTER JOIN "recompensas" AS "recompensa" ON "RoletaPremio"."recompensaId" = "recompensa"."id" WHERE "RoletaPremio"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "RoletaPremio"."roletaId" = 'f40e45de-fb16-477d-b385-85eb9d38304c' ORDER BY "RoletaPremio"."nome" ASC;
[Auth Middleware] Request: POST /api/auth/verify-token
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
[Auth Middleware] Request: GET /api/dashboard/attendants-performance
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
[Auth Middleware] Request: GET /api/dashboard/attendant-responses-timeseries?period=day
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT "Atendente"."id", "Atendente"."tenantId", "Atendente"."name", "Atendente"."code", "Atendente"."status", "Atendente"."createdAt", "Atendente"."updatedAt", "meta"."id" AS "meta.id", "meta"."atendenteId" AS "meta.atendenteId", "meta"."tenantId" AS "meta.tenantId", "meta"."npsGoal" AS "meta.npsGoal", "meta"."responsesGoal" AS "meta.responsesGoal", "meta"."registrationsGoal" AS "meta.registrationsGoal", "meta"."period" AS "meta.period", "meta"."dias_trabalhados" AS "meta.dias_trabalhados", "meta"."nps_premio_valor" AS "meta.nps_premio_valor", "meta"."respostas_premio_valor" AS "meta.respostas_premio_valor", "meta"."cadastros_premio_valor" AS "meta.cadastros_premio_valor", "meta"."createdAt" AS "meta.createdAt", "meta"."updatedAt" AS "meta.updatedAt" FROM "atendentes" AS "Atendente" LEFT OUTER JOIN "atendente_metas" AS "meta" ON "Atendente"."id" = "meta"."atendenteId" WHERE "Atendente"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Atendente"."status" = 'active';
Executing (default): SELECT "Resposta"."atendenteId", date_trunc('day', "Resposta"."createdAt") AS "period", COUNT(DISTINCT("respondentSessionId")) AS "count", "atendente"."name" AS "atendente.name" FROM "respostas" AS "Resposta" INNER JOIN "atendentes" AS "atendente" ON "Resposta"."atendenteId" = "atendente"."id" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" IS NOT NULL GROUP BY "atendenteId", "atendente"."id", "atendente"."name", "period" ORDER BY "period" ASC;
Executing (default): SELECT "Resposta"."atendenteId", SUM(CASE WHEN "ratingValue" >= 9 THEN 1 ELSE 0 END) AS "promoters", SUM(CASE WHEN "ratingValue" <= 6 THEN 1 ELSE 0 END) AS "detractors", COUNT("Resposta"."id") AS "total" FROM "respostas" AS "Resposta" INNER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" AND "pergunta"."type" = 'rating_0_10' WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" IN ('f60c5a4d-1c9a-474c-89db-2abd95e8e06f', '49c162d2-fdde-448c-86f8-14b9c93be792', 'b13aa606-ae37-4d5b-8405-9610cbdffc25', 'ead2104c-7963-47ff-8336-852ad10d355f', '78b6809d-1ef3-4950-920c-ca4adfdbf114', '1c1b649b-a287-4430-84ba-3648a81a5001', '2a4fd6a3-c581-401d-ba65-9225b56cd850', '8b5efb23-f875-4ada-a3ae-e83e1f70e8cb', '2dbadb84-aafa-4c99-a50d-9b01d56ca921') AND "Resposta"."ratingValue" IS NOT NULL GROUP BY "atendenteId";
Executing (default): SELECT "atendenteId", COUNT(DISTINCT("respondentSessionId")) AS "surveyCount" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" IN ('f60c5a4d-1c9a-474c-89db-2abd95e8e06f', '49c162d2-fdde-448c-86f8-14b9c93be792', 'b13aa606-ae37-4d5b-8405-9610cbdffc25', 'ead2104c-7963-47ff-8336-852ad10d355f', '78b6809d-1ef3-4950-920c-ca4adfdbf114', '1c1b649b-a287-4430-84ba-3648a81a5001', '2a4fd6a3-c581-401d-ba65-9225b56cd850', '8b5efb23-f875-4ada-a3ae-e83e1f70e8cb', '2dbadb84-aafa-4c99-a50d-9b01d56ca921') GROUP BY "atendenteId";
[Auth Middleware] Request: GET /api/dashboard/summary
[Auth Middleware] Request: GET /api/dashboard/response-chart
[Auth Middleware] Request: GET /api/dashboard/surveys-responded-chart
[Auth Middleware] Request: GET /api/dashboard/attendants-performance
[Auth Middleware] Request: GET /api/dashboard/nps-trend?period=day
[Auth Middleware] Request: GET /api/dashboard/criteria-scores
[Auth Middleware] Request: GET /api/dashboard/recent-feedbacks?page=1&limit=10
[Auth Middleware] Request: GET /api/dashboard/conversion-chart
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT "Resposta"."id", "Resposta"."perguntaId", "Resposta"."pesquisaId", "Resposta"."tenantId", "Resposta"."atendenteId", "Resposta"."respondentSessionId", "Resposta"."ratingValue", "Resposta"."textValue", "Resposta"."selectedOption", "Resposta"."createdAt", "Resposta"."updatedAt", "pergunta"."id" AS "pergunta.id", "pergunta"."type" AS "pergunta.type", "pergunta"."criterioId" AS "pergunta.criterioId" FROM "respostas" AS "Resposta" INNER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."ratingValue" IS NOT NULL;
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT date_trunc('day', "createdAt" AT TIME ZONE 'America/Sao_Paulo') AS "period", COUNT("id") AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' GROUP BY date_trunc('day', "createdAt" AT TIME ZONE 'America/Sao_Paulo') ORDER BY date_trunc('day', "createdAt" AT TIME ZONE 'America/Sao_Paulo') ASC;
Executing (default): SELECT "Atendente"."id", "Atendente"."tenantId", "Atendente"."name", "Atendente"."code", "Atendente"."status", "Atendente"."createdAt", "Atendente"."updatedAt", "meta"."id" AS "meta.id", "meta"."atendenteId" AS "meta.atendenteId", "meta"."tenantId" AS "meta.tenantId", "meta"."npsGoal" AS "meta.npsGoal", "meta"."responsesGoal" AS "meta.responsesGoal", "meta"."registrationsGoal" AS "meta.registrationsGoal", "meta"."period" AS "meta.period", "meta"."dias_trabalhados" AS "meta.dias_trabalhados", "meta"."nps_premio_valor" AS "meta.nps_premio_valor", "meta"."respostas_premio_valor" AS "meta.respostas_premio_valor", "meta"."cadastros_premio_valor" AS "meta.cadastros_premio_valor", "meta"."createdAt" AS "meta.createdAt", "meta"."updatedAt" AS "meta.updatedAt" FROM "atendentes" AS "Atendente" LEFT OUTER JOIN "atendente_metas" AS "meta" ON "Atendente"."id" = "meta"."atendenteId" WHERE "Atendente"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Atendente"."status" = 'active';
Executing (default): SELECT "Criterio"."id", "Criterio"."tenantId", "Criterio"."name", "Criterio"."description", "Criterio"."type", "Criterio"."createdAt", "Criterio"."updatedAt", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas->respostas"."id" AS "perguntas.respostas.id", "perguntas->respostas"."ratingValue" AS "perguntas.respostas.ratingValue" FROM "criterios" AS "Criterio" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Criterio"."id" = "perguntas"."criterioId" LEFT OUTER JOIN "respostas" AS "perguntas->respostas" ON "perguntas"."id" = "perguntas->respostas"."perguntaId" AND "perguntas->respostas"."ratingValue" IS NOT NULL AND "perguntas->respostas"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' WHERE "Criterio"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' ORDER BY "Criterio"."name" ASC;
Executing (default): SELECT date_trunc('day', "Resposta"."createdAt" AT TIME ZONE 'America/Sao_Paulo') AS "period", SUM(CASE WHEN "ratingValue" >= 9 THEN 1 ELSE 0 END) AS "promoters", SUM(CASE WHEN "ratingValue" <= 6 THEN 1 ELSE 0 END) AS "detractors", COUNT("Resposta"."id") AS "total" FROM "respostas" AS "Resposta" INNER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" AND "pergunta"."type" = 'rating_0_10' WHERE "Resposta"."ratingValue" IS NOT NULL AND "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' GROUP BY date_trunc('day', "Resposta"."createdAt" AT TIME ZONE 'America/Sao_Paulo') ORDER BY date_trunc('day', "Resposta"."createdAt" AT TIME ZONE 'America/Sao_Paulo') ASC;
Executing (default): SELECT DISTINCT("respondentSessionId") AS "respondentSessionId", MIN("createdAt") AS "firstResponseAt" FROM "respostas" AS "Resposta" WHERE ("Resposta"."ratingValue" IS NOT NULL OR "Resposta"."textValue" != '') AND "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' GROUP BY "respondentSessionId" ORDER BY "firstResponseAt" DESC LIMIT 10 OFFSET 0;
Executing (default): SELECT count(*) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "Resposta"."atendenteId", SUM(CASE WHEN "ratingValue" >= 9 THEN 1 ELSE 0 END) AS "promoters", SUM(CASE WHEN "ratingValue" <= 6 THEN 1 ELSE 0 END) AS "detractors", COUNT("Resposta"."id") AS "total" FROM "respostas" AS "Resposta" INNER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" AND "pergunta"."type" = 'rating_0_10' WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" IN ('f60c5a4d-1c9a-474c-89db-2abd95e8e06f', '49c162d2-fdde-448c-86f8-14b9c93be792', 'b13aa606-ae37-4d5b-8405-9610cbdffc25', 'ead2104c-7963-47ff-8336-852ad10d355f', '78b6809d-1ef3-4950-920c-ca4adfdbf114', '1c1b649b-a287-4430-84ba-3648a81a5001', '2a4fd6a3-c581-401d-ba65-9225b56cd850', '8b5efb23-f875-4ada-a3ae-e83e1f70e8cb', '2dbadb84-aafa-4c99-a50d-9b01d56ca921') AND "Resposta"."ratingValue" IS NOT NULL GROUP BY "atendenteId";
Executing (default): SELECT count(DISTINCT("respondentSessionId")) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."ratingValue" >= 9 AND "Resposta"."respondentSessionId" IS NOT NULL;
Executing (default): SELECT date_trunc('day', "createdAt" AT TIME ZONE 'America/Sao_Paulo') AS "period", COUNT(DISTINCT("respondentSessionId")) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."respondentSessionId" IS NOT NULL GROUP BY date_trunc('day', "createdAt" AT TIME ZONE 'America/Sao_Paulo') ORDER BY date_trunc('day', "createdAt" AT TIME ZONE 'America/Sao_Paulo') ASC;
Executing (default): SELECT "Resposta"."id", "Resposta"."perguntaId", "Resposta"."pesquisaId", "Resposta"."tenantId", "Resposta"."atendenteId", "Resposta"."respondentSessionId", "Resposta"."ratingValue", "Resposta"."textValue", "Resposta"."selectedOption", "Resposta"."createdAt", "Resposta"."updatedAt", "pergunta"."id" AS "pergunta.id", "pergunta"."text" AS "pergunta.text", "pergunta"."type" AS "pergunta.type", "client"."id" AS "client.id", "client"."name" AS "client.name" FROM "respostas" AS "Resposta" LEFT OUTER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" LEFT OUTER JOIN "clients" AS "client" ON "Resposta"."respondentSessionId" = "client"."respondentSessionId" WHERE "Resposta"."respondentSessionId" IN ('1901f579-5fd3-4c78-84af-70948a765733', '4b7834fa-453c-426f-8d01-c721cc3503f7', '536faee7-59ff-45ce-a647-afa2d90e12e6', 'fdfc5974-a4d9-4558-b387-c3062a864f48', '429b8cdf-532c-4dca-96c8-d5cd15268a8e', '340cdc68-f8fc-43bc-90dd-c40db90aa89e', '80ae00cb-f38e-4014-b7ca-20cd1267c006', '670c0468-6f68-4564-b810-13a350596fac', '5bbc0aeb-f490-4c04-983a-df1a1355213d', '6f1266ea-365d-4760-bc0c-80e420e9b1de') ORDER BY "Resposta"."createdAt" ASC;
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT count(DISTINCT("respondentSessionId")) AS "count" FROM "respostas" AS "Resposta" WHERE ("Resposta"."ratingValue" IS NOT NULL OR "Resposta"."textValue" != '') AND "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "atendenteId", COUNT(DISTINCT("respondentSessionId")) AS "surveyCount" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" IN ('f60c5a4d-1c9a-474c-89db-2abd95e8e06f', '49c162d2-fdde-448c-86f8-14b9c93be792', 'b13aa606-ae37-4d5b-8405-9610cbdffc25', 'ead2104c-7963-47ff-8336-852ad10d355f', '78b6809d-1ef3-4950-920c-ca4adfdbf114', '1c1b649b-a287-4430-84ba-3648a81a5001', '2a4fd6a3-c581-401d-ba65-9225b56cd850', '8b5efb23-f875-4ada-a3ae-e83e1f70e8cb', '2dbadb84-aafa-4c99-a50d-9b01d56ca921') GROUP BY "atendenteId";
Executing (default): SELECT count(DISTINCT("respondentSessionId")) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."respondentSessionId" IS NOT NULL;
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Cupom"."status" = 'used';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."status" = 'used' AND "Cupom"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: GET /api/dashboard/attendants-performance
[Auth Middleware] Request: GET /api/dashboard/attendant-responses-timeseries?period=day
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT "Atendente"."id", "Atendente"."tenantId", "Atendente"."name", "Atendente"."code", "Atendente"."status", "Atendente"."createdAt", "Atendente"."updatedAt", "meta"."id" AS "meta.id", "meta"."atendenteId" AS "meta.atendenteId", "meta"."tenantId" AS "meta.tenantId", "meta"."npsGoal" AS "meta.npsGoal", "meta"."responsesGoal" AS "meta.responsesGoal", "meta"."registrationsGoal" AS "meta.registrationsGoal", "meta"."period" AS "meta.period", "meta"."dias_trabalhados" AS "meta.dias_trabalhados", "meta"."nps_premio_valor" AS "meta.nps_premio_valor", "meta"."respostas_premio_valor" AS "meta.respostas_premio_valor", "meta"."cadastros_premio_valor" AS "meta.cadastros_premio_valor", "meta"."createdAt" AS "meta.createdAt", "meta"."updatedAt" AS "meta.updatedAt" FROM "atendentes" AS "Atendente" LEFT OUTER JOIN "atendente_metas" AS "meta" ON "Atendente"."id" = "meta"."atendenteId" WHERE "Atendente"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Atendente"."status" = 'active';
Executing (default): SELECT "Resposta"."atendenteId", date_trunc('day', "Resposta"."createdAt") AS "period", COUNT(DISTINCT("respondentSessionId")) AS "count", "atendente"."name" AS "atendente.name" FROM "respostas" AS "Resposta" INNER JOIN "atendentes" AS "atendente" ON "Resposta"."atendenteId" = "atendente"."id" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" IS NOT NULL GROUP BY "atendenteId", "atendente"."id", "atendente"."name", "period" ORDER BY "period" ASC;
Executing (default): SELECT "Resposta"."atendenteId", SUM(CASE WHEN "ratingValue" >= 9 THEN 1 ELSE 0 END) AS "promoters", SUM(CASE WHEN "ratingValue" <= 6 THEN 1 ELSE 0 END) AS "detractors", COUNT("Resposta"."id") AS "total" FROM "respostas" AS "Resposta" INNER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" AND "pergunta"."type" = 'rating_0_10' WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" IN ('f60c5a4d-1c9a-474c-89db-2abd95e8e06f', '49c162d2-fdde-448c-86f8-14b9c93be792', 'b13aa606-ae37-4d5b-8405-9610cbdffc25', 'ead2104c-7963-47ff-8336-852ad10d355f', '78b6809d-1ef3-4950-920c-ca4adfdbf114', '1c1b649b-a287-4430-84ba-3648a81a5001', '2a4fd6a3-c581-401d-ba65-9225b56cd850', '8b5efb23-f875-4ada-a3ae-e83e1f70e8cb', '2dbadb84-aafa-4c99-a50d-9b01d56ca921') AND "Resposta"."ratingValue" IS NOT NULL GROUP BY "atendenteId";
Executing (default): SELECT "atendenteId", COUNT(DISTINCT("respondentSessionId")) AS "surveyCount" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" IN ('f60c5a4d-1c9a-474c-89db-2abd95e8e06f', '49c162d2-fdde-448c-86f8-14b9c93be792', 'b13aa606-ae37-4d5b-8405-9610cbdffc25', 'ead2104c-7963-47ff-8336-852ad10d355f', '78b6809d-1ef3-4950-920c-ca4adfdbf114', '1c1b649b-a287-4430-84ba-3648a81a5001', '2a4fd6a3-c581-401d-ba65-9225b56cd850', '8b5efb23-f875-4ada-a3ae-e83e1f70e8cb', '2dbadb84-aafa-4c99-a50d-9b01d56ca921') GROUP BY "atendenteId";