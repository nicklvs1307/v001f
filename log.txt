Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 19:07:00.050 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 19:08:00.044 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 19:09:00.036 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[iFood Job] Starting Polling...
[CAMPAIGN_MONITOR] Iniciando verificação de campanhas pausadas...
[Delivery Much Job] Starting Polling...
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 19:10:00.091 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."status" = 'paused';
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[CAMPAIGN_MONITOR] Nenhuma campanha pausada encontrada.
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 19:11:00.036 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 19:12:00.045 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 19:13:00.029 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 19:14:00.045 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[Delivery Much Job] Starting Polling...
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 19:15:00.067 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 19:16:00.054 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 19:17:00.052 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 19:18:00.043 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 19:19:00.043 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[Delivery Much Job] Starting Polling...
[CAMPAIGN_MONITOR] Iniciando verificação de campanhas pausadas...
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 19:20:00.136 +00:00' LIMIT 50;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."status" = 'paused';
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[CAMPAIGN_MONITOR] Nenhuma campanha pausada encontrada.
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 19:21:00.034 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 19:22:00.032 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 19:23:00.036 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 19:24:00.039 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[Delivery Much Job] Starting Polling...
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 19:25:00.064 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 19:26:00.059 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 19:27:00.037 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 19:28:00.042 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 19:29:00.038 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[CAMPAIGN_MONITOR] Iniciando verificação de campanhas pausadas...
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[Delivery Much Job] Starting Polling...
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."status" = 'paused';
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 19:30:00.082 +00:00' LIMIT 50;
[CAMPAIGN_MONITOR] Nenhuma campanha pausada encontrada.
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 19:31:00.037 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 19:32:00.031 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 19:33:00.033 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 19:34:00.030 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[iFood Job] Starting Polling...
[Delivery Much Job] Starting Polling...
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 19:35:00.071 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 19:36:00.040 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 19:37:00.033 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 19:38:00.025 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 19:39:00.036 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[CAMPAIGN_MONITOR] Iniciando verificação de campanhas pausadas...
[Delivery Much Job] Starting Polling...
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."status" = 'paused';
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
[CAMPAIGN_MONITOR] Nenhuma campanha pausada encontrada.
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 19:40:00.080 +00:00' LIMIT 50;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 19:41:00.035 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 19:42:00.046 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 19:43:00.028 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 19:44:00.036 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[iFood Job] Starting Polling...
[Delivery Much Job] Starting Polling...
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 19:45:00.072 +00:00' LIMIT 50;
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 19:46:00.035 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 19:47:00.032 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 19:48:00.032 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 19:49:00.034 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[CAMPAIGN_MONITOR] Iniciando verificação de campanhas pausadas...
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[Delivery Much Job] Starting Polling...
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."status" = 'paused';
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
[CAMPAIGN_MONITOR] Nenhuma campanha pausada encontrada.
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 19:50:00.076 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 19:51:00.035 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 19:52:00.052 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 19:53:00.040 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 19:54:00.032 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[Delivery Much Job] Starting Polling...
[iFood Job] Starting Polling...
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 19:55:00.066 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 19:56:00.047 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 19:57:00.032 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 19:58:00.033 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 19:59:00.038 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[CAMPAIGN_MONITOR] Iniciando verificação de campanhas pausadas...
[Delivery Much Job] Starting Polling...
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."status" = 'paused';
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 20:00:00.082 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[CAMPAIGN_MONITOR] Nenhuma campanha pausada encontrada.
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 20:01:00.033 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 20:02:00.034 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 20:03:00.030 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 20:04:00.025 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[Delivery Much Job] Starting Polling...
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 20:05:00.084 +00:00' LIMIT 50;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 20:06:00.030 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 20:07:00.024 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 20:08:00.026 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 20:09:00.037 +00:00' LIMIT 50;
[Auth Middleware] Request: POST /api/auth/verify-token
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."ifoodAuthVerifier" AS "tenant.ifoodAuthVerifier", "tenant"."deliveryMuchClientId" AS "tenant.deliveryMuchClientId", "tenant"."deliveryMuchClientSecret" AS "tenant.deliveryMuchClientSecret", "tenant"."deliveryMuchUsername" AS "tenant.deliveryMuchUsername", "tenant"."deliveryMuchPassword" AS "tenant.deliveryMuchPassword", "tenant"."deliveryMuchToken" AS "tenant.deliveryMuchToken", "tenant"."deliveryMuchTokenExpiresAt" AS "tenant.deliveryMuchTokenExpiresAt", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."plan" AS "tenant.plan", "tenant"."planExpiresAt" AS "tenant.planExpiresAt", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = '77f853e9-deb2-4067-881e-71fa16d3054f';
[Auth Middleware] Request: GET /api/recompensas
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."ifoodAuthVerifier" AS "tenant.ifoodAuthVerifier", "tenant"."deliveryMuchClientId" AS "tenant.deliveryMuchClientId", "tenant"."deliveryMuchClientSecret" AS "tenant.deliveryMuchClientSecret", "tenant"."deliveryMuchUsername" AS "tenant.deliveryMuchUsername", "tenant"."deliveryMuchPassword" AS "tenant.deliveryMuchPassword", "tenant"."deliveryMuchToken" AS "tenant.deliveryMuchToken", "tenant"."deliveryMuchTokenExpiresAt" AS "tenant.deliveryMuchTokenExpiresAt", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."plan" AS "tenant.plan", "tenant"."planExpiresAt" AS "tenant.planExpiresAt", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = '77f853e9-deb2-4067-881e-71fa16d3054f';
[Auth Middleware] Request: GET /api/cupons?search=&status=&recompensaId=
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."ifoodAuthVerifier" AS "tenant.ifoodAuthVerifier", "tenant"."deliveryMuchClientId" AS "tenant.deliveryMuchClientId", "tenant"."deliveryMuchClientSecret" AS "tenant.deliveryMuchClientSecret", "tenant"."deliveryMuchUsername" AS "tenant.deliveryMuchUsername", "tenant"."deliveryMuchPassword" AS "tenant.deliveryMuchPassword", "tenant"."deliveryMuchToken" AS "tenant.deliveryMuchToken", "tenant"."deliveryMuchTokenExpiresAt" AS "tenant.deliveryMuchTokenExpiresAt", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."plan" AS "tenant.plan", "tenant"."planExpiresAt" AS "tenant.planExpiresAt", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = '77f853e9-deb2-4067-881e-71fa16d3054f';
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'cupons' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'recompensas' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';

oExecuting (default): SELECT "Cupom"."id", "Cupom"."pesquisaId", "Cupom"."campanhaId", "Cupom"."tenantId", "Cupom"."recompensaId", "Cupom"."codigo", "Cupom"."clienteId", "Cupom"."dataGeracao", "Cupom"."dataUtilizacao", "Cupom"."dataValidade", "Cupom"."status", "Cupom"."ultimoContato", "Cupom"."createdAt", "Cupom"."updatedAt", "recompensa"."id" AS "recompensa.id", "recompensa"."tenantId" AS "recompensa.tenantId", "recompensa"."name" AS "recompensa.name", "recompensa"."description" AS "recompensa.description", "recompensa"."conditionDescription" AS "recompensa.conditionDescription", "recompensa"."pointsRequired" AS "recompensa.pointsRequired", "recompensa"."type" AS "recompensa.type", "recompensa"."value" AS "recompensa.value", "recompensa"."imageUrl" AS "recompensa.imageUrl", "recompensa"."active" AS "recompensa.active", "recompensa"."createdAt" AS "recompensa.createdAt", "recompensa"."updatedAt" AS "recompensa.updatedAt", "client"."id" AS "client.id", "client"."tenantId" AS "client.tenantId", "client"."name" AS "client.name", "client"."email" AS "client.email", "client"."phone" AS "client.phone", "client"."birthDate" AS "client.birthDate", "client"."respondentSessionId" AS "client.respondentSessionId", "client"."gender" AS "client.gender", "client"."createdAt" AS "client.createdAt", "client"."updatedAt" AS "client.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."ifoodAuthVerifier" AS "tenant.ifoodAuthVerifier", "tenant"."deliveryMuchClientId" AS "tenant.deliveryMuchClientId", "tenant"."deliveryMuchClientSecret" AS "tenant.deliveryMuchClientSecret", "tenant"."deliveryMuchUsername" AS "tenant.deliveryMuchUsername", "tenant"."deliveryMuchPassword" AS "tenant.deliveryMuchPassword", "tenant"."deliveryMuchToken" AS "tenant.deliveryMuchToken", "tenant"."deliveryMuchTokenExpiresAt" AS "tenant.deliveryMuchTokenExpiresAt", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."plan" AS "tenant.plan", "tenant"."planExpiresAt" AS "tenant.planExpiresAt", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "cupons" AS "Cupom" LEFT OUTER JOIN "recompensas" AS "recompensa" ON "Cupom"."recompensaId" = "recompensa"."id" LEFT OUTER JOIN "clients" AS "client" ON "Cupom"."clienteId" = "client"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Cupom"."tenantId" = "tenant"."id" WHERE "Cupom"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' ORDER BY "Cupom"."dataGeracao" DESC;
Executing (default): SELECT "id", "tenantId", "name", "description", "conditionDescription", "pointsRequired", "type", "value", "imageUrl", "active", "createdAt", "updatedAt" FROM "recompensas" AS "Recompensa" WHERE "Recompensa"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' ORDER BY "Recompensa"."name" ASC;
[Auth Middleware] Request: GET /api/cupons?search=&status=&recompensaId=
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."ifoodAuthVerifier" AS "tenant.ifoodAuthVerifier", "tenant"."deliveryMuchClientId" AS "tenant.deliveryMuchClientId", "tenant"."deliveryMuchClientSecret" AS "tenant.deliveryMuchClientSecret", "tenant"."deliveryMuchUsername" AS "tenant.deliveryMuchUsername", "tenant"."deliveryMuchPassword" AS "tenant.deliveryMuchPassword", "tenant"."deliveryMuchToken" AS "tenant.deliveryMuchToken", "tenant"."deliveryMuchTokenExpiresAt" AS "tenant.deliveryMuchTokenExpiresAt", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."plan" AS "tenant.plan", "tenant"."planExpiresAt" AS "tenant.planExpiresAt", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = '77f853e9-deb2-4067-881e-71fa16d3054f';
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'cupons' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';

oExecuting (default): SELECT "Cupom"."id", "Cupom"."pesquisaId", "Cupom"."campanhaId", "Cupom"."tenantId", "Cupom"."recompensaId", "Cupom"."codigo", "Cupom"."clienteId", "Cupom"."dataGeracao", "Cupom"."dataUtilizacao", "Cupom"."dataValidade", "Cupom"."status", "Cupom"."ultimoContato", "Cupom"."createdAt", "Cupom"."updatedAt", "recompensa"."id" AS "recompensa.id", "recompensa"."tenantId" AS "recompensa.tenantId", "recompensa"."name" AS "recompensa.name", "recompensa"."description" AS "recompensa.description", "recompensa"."conditionDescription" AS "recompensa.conditionDescription", "recompensa"."pointsRequired" AS "recompensa.pointsRequired", "recompensa"."type" AS "recompensa.type", "recompensa"."value" AS "recompensa.value", "recompensa"."imageUrl" AS "recompensa.imageUrl", "recompensa"."active" AS "recompensa.active", "recompensa"."createdAt" AS "recompensa.createdAt", "recompensa"."updatedAt" AS "recompensa.updatedAt", "client"."id" AS "client.id", "client"."tenantId" AS "client.tenantId", "client"."name" AS "client.name", "client"."email" AS "client.email", "client"."phone" AS "client.phone", "client"."birthDate" AS "client.birthDate", "client"."respondentSessionId" AS "client.respondentSessionId", "client"."gender" AS "client.gender", "client"."createdAt" AS "client.createdAt", "client"."updatedAt" AS "client.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."ifoodAuthVerifier" AS "tenant.ifoodAuthVerifier", "tenant"."deliveryMuchClientId" AS "tenant.deliveryMuchClientId", "tenant"."deliveryMuchClientSecret" AS "tenant.deliveryMuchClientSecret", "tenant"."deliveryMuchUsername" AS "tenant.deliveryMuchUsername", "tenant"."deliveryMuchPassword" AS "tenant.deliveryMuchPassword", "tenant"."deliveryMuchToken" AS "tenant.deliveryMuchToken", "tenant"."deliveryMuchTokenExpiresAt" AS "tenant.deliveryMuchTokenExpiresAt", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."plan" AS "tenant.plan", "tenant"."planExpiresAt" AS "tenant.planExpiresAt", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "cupons" AS "Cupom" LEFT OUTER JOIN "recompensas" AS "recompensa" ON "Cupom"."recompensaId" = "recompensa"."id" LEFT OUTER JOIN "clients" AS "client" ON "Cupom"."clienteId" = "client"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Cupom"."tenantId" = "tenant"."id" WHERE "Cupom"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' ORDER BY "Cupom"."dataGeracao" DESC;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[CAMPAIGN_MONITOR] Iniciando verificação de campanhas pausadas...
[Delivery Much Job] Starting Polling...
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."status" = 'paused';
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
[CAMPAIGN_MONITOR] Nenhuma campanha pausada encontrada.
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 20:10:00.096 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 20:11:00.029 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 20:12:00.026 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 20:13:00.024 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 20:14:00.028 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[iFood Job] Starting Polling...
[Delivery Much Job] Starting Polling...
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 20:15:00.074 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 20:16:00.035 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 20:17:00.046 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 20:18:00.035 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 20:19:00.046 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[CAMPAIGN_MONITOR] Iniciando verificação de campanhas pausadas...
[Delivery Much Job] Starting Polling...
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 20:20:00.071 +00:00' LIMIT 50;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."status" = 'paused';
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[CAMPAIGN_MONITOR] Nenhuma campanha pausada encontrada.
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 20:21:00.028 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 20:22:00.033 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 20:23:00.047 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 20:24:00.050 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[Delivery Much Job] Starting Polling...
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 20:25:00.071 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 20:26:00.045 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 20:27:00.044 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 20:28:00.047 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 20:29:00.039 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[CAMPAIGN_MONITOR] Iniciando verificação de campanhas pausadas...
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[Delivery Much Job] Starting Polling...
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."status" = 'paused';
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 20:30:00.100 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[CAMPAIGN_MONITOR] Nenhuma campanha pausada encontrada.
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 20:31:00.043 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 20:32:00.042 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 20:33:00.037 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 20:34:00.038 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[Delivery Much Job] Starting Polling...
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 20:35:00.071 +00:00' LIMIT 50;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 20:36:00.045 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 20:37:00.032 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 20:38:00.029 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 20:39:00.042 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[Delivery Much Job] Starting Polling...
[CAMPAIGN_MONITOR] Iniciando verificação de campanhas pausadas...
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."status" = 'paused';
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
[CAMPAIGN_MONITOR] Nenhuma campanha pausada encontrada.
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 20:40:00.087 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 20:41:00.049 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 20:42:00.036 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 20:43:00.042 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 20:44:00.038 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[Delivery Much Job] Starting Polling...
[iFood Job] Starting Polling...
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 20:45:00.077 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 20:46:00.058 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 20:47:00.049 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 20:48:00.043 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 20:49:00.046 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[CAMPAIGN_MONITOR] Iniciando verificação de campanhas pausadas...
[Delivery Much Job] Starting Polling...
[iFood Job] Starting Polling...
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."status" = 'paused';
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 20:50:00.075 +00:00' LIMIT 50;
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
[CAMPAIGN_MONITOR] Nenhuma campanha pausada encontrada.
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 20:51:00.036 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 20:52:00.039 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 20:53:00.048 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 20:54:00.039 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
[Delivery Much Job] Starting Polling...
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 20:55:00.067 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 20:56:00.035 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 20:57:00.040 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 20:58:00.029 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 20:59:00.039 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
[CAMPAIGN_MONITOR] Iniciando verificação de campanhas pausadas...
[Delivery Much Job] Starting Polling...
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 21:00:00.083 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."status" = 'paused';
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
[CAMPAIGN_MONITOR] Nenhuma campanha pausada encontrada.
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 21:01:00.032 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 21:02:00.041 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 21:03:00.039 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 21:04:00.036 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[Delivery Much Job] Starting Polling...
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 21:05:00.068 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 21:06:00.043 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 21:07:00.028 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 21:08:00.036 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 21:09:00.040 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[iFood Job] Starting Polling...
[CAMPAIGN_MONITOR] Iniciando verificação de campanhas pausadas...
[Delivery Much Job] Starting Polling...
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."status" = 'paused';
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 21:10:00.076 +00:00' LIMIT 50;
[CAMPAIGN_MONITOR] Nenhuma campanha pausada encontrada.
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 21:11:00.036 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 21:12:00.041 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 21:13:00.035 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 21:14:00.033 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[Delivery Much Job] Starting Polling...
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 21:15:00.067 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 21:16:00.035 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 21:17:00.034 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 21:18:00.025 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 21:19:00.028 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[CAMPAIGN_MONITOR] Iniciando verificação de campanhas pausadas...
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[Delivery Much Job] Starting Polling...
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."status" = 'paused';
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 21:20:00.087 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[CAMPAIGN_MONITOR] Nenhuma campanha pausada encontrada.
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 21:21:00.031 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 21:22:00.041 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 21:23:00.048 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 21:24:00.047 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[Delivery Much Job] Starting Polling...
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 21:25:00.068 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 21:26:00.037 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 21:27:00.027 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 21:28:00.047 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 21:29:00.027 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[Delivery Much Job] Starting Polling...
[iFood Job] Starting Polling...
[CAMPAIGN_MONITOR] Iniciando verificação de campanhas pausadas...
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 21:30:00.071 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."status" = 'paused';
[CAMPAIGN_MONITOR] Nenhuma campanha pausada encontrada.
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 21:31:00.029 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 21:32:00.023 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 21:33:00.019 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 21:34:00.030 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[Delivery Much Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 21:35:00.054 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 21:36:00.035 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 21:37:00.030 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 21:38:00.033 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 21:39:00.043 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[CAMPAIGN_MONITOR] Iniciando verificação de campanhas pausadas...
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[Delivery Much Job] Starting Polling...
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."status" = 'paused';
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
[CAMPAIGN_MONITOR] Nenhuma campanha pausada encontrada.
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 21:40:00.086 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 21:41:00.034 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 21:42:00.029 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 21:43:00.047 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 21:44:00.043 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[Delivery Much Job] Starting Polling...
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 21:45:00.065 +00:00' LIMIT 50;
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 21:46:00.035 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 21:47:00.052 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 21:48:00.038 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 21:49:00.040 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[CAMPAIGN_MONITOR] Iniciando verificação de campanhas pausadas...
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[Delivery Much Job] Starting Polling...
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."status" = 'paused';
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 21:50:00.089 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[CAMPAIGN_MONITOR] Nenhuma campanha pausada encontrada.
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 21:51:00.038 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Iniciando processamento do webhook do Uai Rango: {
  "id_estabelecimento": 4659,
  "cod_pedido": "83F7F1D78",
  "data": "2026-02-06 18:51:01",
  "pedido_pronto": 0,
  "data_pedido_pronto": null,
  "cupom": null,
  "tipo_entrega": "Delivery",
  "prazo": null,
  "prazo_min": 30,
  "prazo_max": 50,
  "categoria_pagamento": "Pagamento Online",
  "forma_pagamento": "Pagamento Online",
  "valor_total": 42.99,
  "observacao": "",
  "taxa_entrega": 3,
  "nome_taxa_entrega": "Bairros",
  "status": {

    "id": 0,
    "status": "Pendente"
  },
  "produtos": [
    {
      "id_categoria": 31809,
      "codigo_categoria": "",
      "categoria": "Combo Esfiha",
      "id_opcao": 62307,
      "opcao": "10 Unidades",
      "id_produto": 247952,
      "codigo": "",
      "produto": "Combo de Esfihas",
      "id_produto_2": null,
      "codigo_2": "",
      "produto_2": null,
      "obs": "",
      "valor": 42.99,
      "quantidade": 1,
      "adicionais": [

{
          "id_tipo": 23167,
          "id_adicional": 185637,
          "codigo": "",
          "nome": "Mussarela",
          "valor": 0,
          "quantidade": 1
        },

{
          "id_tipo": 23167,
          "id_adicional": 185638,
          "codigo": "",
          "nome": "Mussarela",
          "valor": 0,
          "quantidade": 1
        },

{
          "id_tipo": 23167,
          "id_adicional": 185640,
          "codigo": "",
          "nome": "Carne",
          "valor": 0,
          "quantidade": 1
        },

{
          "id_tipo": 23167,
          "id_adicional": 185641,
          "codigo": "",
          "nome": "Carne",
          "valor": 0,
          "quantidade": 1
        },

{
          "id_tipo": 23167,
          "id_adicional": 185642,
          "codigo": "",
          "nome": "Carne",
          "valor": 0,
          "quantidade": 1
        },

{
          "id_tipo": 23167,
          "id_adicional": 185643,
          "codigo": "",
          "nome": "Carne",
          "valor": 0,
          "quantidade": 1
        },

{
          "id_tipo": 23167,
          "id_adicional": 185645,
          "codigo": "",
          "nome": "Calabresa",
          "valor": 0,
          "quantidade": 1
        },

{
          "id_tipo": 23167,
          "id_adicional": 185646,
          "codigo": "",
          "nome": "Calabresa",
          "valor": 0,
          "quantidade": 1
        },

{
          "id_tipo": 23167,
          "id_adicional": 185647,
          "codigo": "",
          "nome": "Calabresa",
          "valor": 0,
          "quantidade": 1
        },

{
          "id_tipo": 23167,
          "id_adicional": 185648,
          "codigo": "",
          "nome": "Calabresa",
          "valor": 0,
          "quantidade": 1

}
      ]
    }
  ],
  "usuario": {
    "id": "5f4ff58dc1f8914a",
    "nome": "Gabriela Silvestre",
    "tel1": "35991272060"
  },
  "endereco": {
    "id": 2046187,
    "uf": "MG",
    "cidade": "Andradas",
    "bairro": "mirante ",
    "rua": "sebastiao Barbosa ",
    "num": "462",
    "complemento": "casa ",
    "ponto_referencia": "primeiro casa da rua "
  }
}
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "gmb_link", "uairangoEstablishmentId", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt", "ifoodClientId", "ifoodClientSecret", "ifoodAuthVerifier", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt", "franchisorId", "plan", "planExpiresAt", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."uairangoEstablishmentId" = '4659';
[UaiRango Webhook] Tenant encontrado: eb629ea8-7d69-47a1-b1f1-f9dcb33475f4 para o pedido 83F7F1D78
Executing (default): SELECT "id", "tenantId", "name", "email", "phone", "birthDate", "respondentSessionId", "gender", "createdAt", "updatedAt" FROM "clients" AS "Client" WHERE "Client"."phone" = '35991272060' AND "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
Executing (default): INSERT INTO "clients" ("id","tenantId","name","phone","createdAt","updatedAt") VALUES ($1,$2,$3,$4,$5,$6) RETURNING "id","tenantId","name","email","phone","birthDate","respondentSessionId","gender","createdAt","updatedAt";
[UaiRango Webhook] Novo cliente criado: 761ab141-0667-4409-bd74-64ce65d89f8e para o pedido 83F7F1D78
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."platform" = 'UaiRango' AND "DeliveryOrder"."orderIdPlatform" = '83F7F1D78';
Executing (default): INSERT INTO "delivery_orders" ("id","platform","orderIdPlatform","totalAmount","orderDate","payload","clientId","tenantId","surveyStatus","createdAt","updatedAt") VALUES ($1,$2,$3,$4,$5,$6,$7,$8,$9,$10,$11) RETURNING "id","platform","orderIdPlatform","totalAmount","orderDate","payload","clientId","tenantId","surveyStatus","surveyScheduledAt","surveySentAt","createdAt","updatedAt";
[UaiRango Webhook] DeliveryOrder criado: 9e513e46-a3bd-4893-99ba-603104b3424e para o pedido 83F7F1D78
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "postSaleDelayMinutes", "postSaleMessageTemplate", "postSaleSurveyId", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
Executing (default): UPDATE "delivery_orders" SET "surveyStatus"=$1,"surveyScheduledAt"=$2,"updatedAt"=$3 WHERE "id" = $4
Pesquisa agendada para o pedido 9e513e46-a3bd-4893-99ba-603104b3424e. Delay: 90 min. Envio em: Fri Feb 06 2026 23:21:32 GMT+0000 (Coordinated Universal Time)
[UaiRango Webhook] Pesquisa de satisfação agendada para cliente 761ab141-0667-4409-bd74-64ce65d89f8e, pedido 9e513e46-a3bd-4893-99ba-603104b3424e.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 21:52:00.036 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 21:53:00.049 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 21:54:00.038 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[iFood Job] Starting Polling...
[Delivery Much Job] Starting Polling...
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 21:55:00.076 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 21:56:00.033 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 21:57:00.047 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 21:58:00.032 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 21:59:00.042 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[CAMPAIGN_MONITOR] Iniciando verificação de campanhas pausadas...
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[Delivery Much Job] Starting Polling...
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."status" = 'paused';
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 22:00:00.077 +00:00' LIMIT 50;
[CAMPAIGN_MONITOR] Nenhuma campanha pausada encontrada.
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 22:01:00.070 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 22:02:00.040 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 22:03:00.043 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 22:04:00.038 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[Delivery Much Job] Starting Polling...
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 22:05:00.075 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 22:06:00.045 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 22:07:00.048 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 22:08:00.048 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 22:09:00.041 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[CAMPAIGN_MONITOR] Iniciando verificação de campanhas pausadas...
[Delivery Much Job] Starting Polling...
[iFood Job] Starting Polling...
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."status" = 'paused';
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[CAMPAIGN_MONITOR] Nenhuma campanha pausada encontrada.
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 22:10:00.107 +00:00' LIMIT 50;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 22:11:00.040 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 22:12:00.032 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 22:13:00.038 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 22:14:00.042 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[iFood Job] Starting Polling...
[Delivery Much Job] Starting Polling...
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 22:15:00.076 +00:00' LIMIT 50;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
[SENDER_MONITOR] Verificação de status concluída.
Executing (default): SELECT "Pesquisa"."id", "Pesquisa"."title", "Pesquisa"."description", "Pesquisa"."createdAt", "Pesquisa"."updatedAt", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."status", "Pesquisa"."recompensaId", "Pesquisa"."roletaId", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."text" AS "perguntas.text", "perguntas"."options" AS "perguntas.options", "perguntas"."order" AS "perguntas.order", "perguntas"."required" AS "perguntas.required", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."description" AS "tenant.description", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "roleta"."id" AS "roleta.id", "roleta"."nome" AS "roleta.nome", "roleta"."descricao" AS "roleta.descricao", "roleta"."active" AS "roleta.active" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" LEFT OUTER JOIN "tenants" AS "tenant" ON "Pesquisa"."tenantId" = "tenant"."id" LEFT OUTER JOIN "roletas" AS "roleta" ON "Pesquisa"."roletaId" = "roleta"."id" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (default): SELECT "id", "name" FROM "atendentes" AS "Atendente" WHERE "Atendente"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Atendente"."status" = 'active' ORDER BY "Atendente"."name" ASC;
Executing (default): SELECT "Pesquisa"."id", "Pesquisa"."title", "Pesquisa"."description", "Pesquisa"."createdAt", "Pesquisa"."updatedAt", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."status", "Pesquisa"."recompensaId", "Pesquisa"."roletaId", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."text" AS "perguntas.text", "perguntas"."options" AS "perguntas.options", "perguntas"."order" AS "perguntas.order", "perguntas"."required" AS "perguntas.required", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."description" AS "tenant.description", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "roleta"."id" AS "roleta.id", "roleta"."nome" AS "roleta.nome", "roleta"."descricao" AS "roleta.descricao", "roleta"."active" AS "roleta.active" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" LEFT OUTER JOIN "tenants" AS "tenant" ON "Pesquisa"."tenantId" = "tenant"."id" LEFT OUTER JOIN "roletas" AS "roleta" ON "Pesquisa"."roletaId" = "roleta"."id" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (default): SELECT "id", "name" FROM "atendentes" AS "Atendente" WHERE "Atendente"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Atendente"."status" = 'active' ORDER BY "Atendente"."name" ASC;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 22:16:00.039 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 22:17:00.037 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 22:18:00.030 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "askForAttendant" FROM "pesquisas" AS "Pesquisa" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (default): SELECT "Pesquisa"."id", "Pesquisa"."title", "Pesquisa"."description", "Pesquisa"."createdAt", "Pesquisa"."updatedAt", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."status", "Pesquisa"."recompensaId", "Pesquisa"."roletaId", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."text" AS "perguntas.text", "perguntas"."options" AS "perguntas.options", "perguntas"."order" AS "perguntas.order", "perguntas"."required" AS "perguntas.required", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."description" AS "tenant.description", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "roleta"."id" AS "roleta.id", "roleta"."nome" AS "roleta.nome", "roleta"."descricao" AS "roleta.descricao", "roleta"."active" AS "roleta.active" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" LEFT OUTER JOIN "tenants" AS "tenant" ON "Pesquisa"."tenantId" = "tenant"."id" LEFT OUTER JOIN "roletas" AS "roleta" ON "Pesquisa"."roletaId" = "roleta"."id" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (0606ea82-a770-4b3b-95d6-2297973516bc): SELECT "Pesquisa"."id", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."title", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."options" AS "perguntas.options", "perguntas"."required" AS "perguntas.required", "perguntas"."text" AS "perguntas.text" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (0606ea82-a770-4b3b-95d6-2297973516bc): INSERT INTO "respostas" ("id","perguntaId","pesquisaId","tenantId","atendenteId","respondentSessionId","textValue","createdAt","updatedAt","ratingValue") VALUES ('314c5ba4-fd7f-46d2-aa75-614f8e6558d5','3bcaef44-8ad1-4a95-a377-7fae3148fa97','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','d1ec3ff8-81b0-4d89-9d7b-9da2f859fc07','842756bc-8ee5-4458-bc9e-5e6b40aa6d09','Anéis de cebola ','2026-02-06 22:18:14.465 +00:00','2026-02-06 22:18:14.465 +00:00',NULL),('748de478-89fc-47a8-9280-3e6010320e71','19f1cec2-90b3-4223-b412-3c1d860e20a6','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','d1ec3ff8-81b0-4d89-9d7b-9da2f859fc07','842756bc-8ee5-4458-bc9e-5e6b40aa6d09',NULL,'2026-02-06 22:18:14.465 +00:00','2026-02-06 22:18:14.465 +00:00',7),('0347a245-44b0-4f77-b9e0-babd85fd4392','305b7330-b4c3-41b1-8fd1-0f3f91e7e936','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','d1ec3ff8-81b0-4d89-9d7b-9da2f859fc07','842756bc-8ee5-4458-bc9e-5e6b40aa6d09',NULL,'2026-02-06 22:18:14.465 +00:00','2026-02-06 22:18:14.465 +00:00',4),('ca251963-235d-461a-a450-6f20cdcdc895','d91a3ab3-65e2-40d0-acfa-35133ed4a7d4','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','d1ec3ff8-81b0-4d89-9d7b-9da2f859fc07','842756bc-8ee5-4458-bc9e-5e6b40aa6d09',NULL,'2026-02-06 22:18:14.465 +00:00','2026-02-06 22:18:14.465 +00:00',4),('0c51d950-c33f-4e74-86b0-86e45942fc72','635f7a66-33fd-40f4-89b4-3c7c83f003aa','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','d1ec3ff8-81b0-4d89-9d7b-9da2f859fc07','842756bc-8ee5-4458-bc9e-5e6b40aa6d09',NULL,'2026-02-06 22:18:14.465 +00:00','2026-02-06 22:18:14.465 +00:00',4),('7237325b-38c4-4202-a982-3617f5b60333','9e5e541a-1930-47da-81a5-e53892d8337a','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','d1ec3ff8-81b0-4d89-9d7b-9da2f859fc07','842756bc-8ee5-4458-bc9e-5e6b40aa6d09',NULL,'2026-02-06 22:18:14.465 +00:00','2026-02-06 22:18:14.465 +00:00',4),('025cb5ee-5472-4df4-88f6-08d4bed9bcca','f3480c2b-6f71-4b2e-bd3b-ac407d1c56dc','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','d1ec3ff8-81b0-4d89-9d7b-9da2f859fc07','842756bc-8ee5-4458-bc9e-5e6b40aa6d09','Muito boa ','2026-02-06 22:18:14.465 +00:00','2026-02-06 22:18:14.465 +00:00',NULL),('f99f2980-072a-491e-ab45-2b1bd6d4c4e9','2cbd96fb-faa2-495d-99dd-c57af8623c9d','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','d1ec3ff8-81b0-4d89-9d7b-9da2f859fc07','842756bc-8ee5-4458-bc9e-5e6b40aa6d09',NULL,'2026-02-06 22:18:14.465 +00:00','2026-02-06 22:18:14.465 +00:00',5),('3b391ead-512f-440f-b10c-309a94852b12','89c2b3ed-7104-4a41-991d-565b70294215','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','d1ec3ff8-81b0-4d89-9d7b-9da2f859fc07','842756bc-8ee5-4458-bc9e-5e6b40aa6d09',NULL,'2026-02-06 22:18:14.465 +00:00','2026-02-06 22:18:14.465 +00:00',2) RETURNING "id","perguntaId","pesquisaId","tenantId","atendenteId","respondentSessionId","ratingValue","textValue","selectedOption","createdAt","updatedAt";
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "postSaleDelayMinutes", "postSaleMessageTemplate", "postSaleSurveyId", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "postSaleDelayMinutes", "postSaleMessageTemplate", "postSaleSurveyId", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "postSaleDelayMinutes", "postSaleMessageTemplate", "postSaleSurveyId", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
[WhatsappService] Resposta da API de status da instância: {
  "instance": {
    "instanceName": "roma-pizzaria--chopperia",
    "state": "close"
  }
}
Falha ao enviar notificação de detrator para o admin 5535991090766: Error: A instância do WhatsApp desta loja não está conectada.
    at getTenantWhatsappConfig (/usr/src/app/src/services/whatsappService.js:169:11)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async Object.sendTenantMessage (/usr/src/app/src/services/whatsappService.js:176:18)
    at async /usr/src/app/src/repositories/publicSurveyRepository.js:325:19
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "postSaleDelayMinutes", "postSaleMessageTemplate", "postSaleSurveyId", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "postSaleDelayMinutes", "postSaleMessageTemplate", "postSaleSurveyId", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
Falha ao enviar notificação de detrator para o admin 553591523297: Error: A instância do WhatsApp desta loja não está conectada.
    at getTenantWhatsappConfig (/usr/src/app/src/services/whatsappService.js:169:11)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async Object.sendTenantMessage (/usr/src/app/src/services/whatsappService.js:176:18)
    at async /usr/src/app/src/repositories/publicSurveyRepository.js:325:19
[WhatsappService] Resposta da API de status da instância: {
  "instance": {
    "instanceName": "roma-pizzaria--chopperia",
    "state": "close"
  }
}
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "postSaleDelayMinutes", "postSaleMessageTemplate", "postSaleSurveyId", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "postSaleDelayMinutes", "postSaleMessageTemplate", "postSaleSurveyId", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
Falha ao enviar notificação de detrator para o admin 553598374007: Error: A instância do WhatsApp desta loja não está conectada.
    at getTenantWhatsappConfig (/usr/src/app/src/services/whatsappService.js:169:11)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async Object.sendTenantMessage (/usr/src/app/src/services/whatsappService.js:176:18)
    at async /usr/src/app/src/repositories/publicSurveyRepository.js:325:19
[WhatsappService] Resposta da API de status da instância: {
  "instance": {
    "instanceName": "roma-pizzaria--chopperia",
    "state": "close"
  }
}
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 22:19:00.028 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "askForAttendant" FROM "pesquisas" AS "Pesquisa" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (default): SELECT "Pesquisa"."id", "Pesquisa"."title", "Pesquisa"."description", "Pesquisa"."createdAt", "Pesquisa"."updatedAt", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."status", "Pesquisa"."recompensaId", "Pesquisa"."roletaId", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."text" AS "perguntas.text", "perguntas"."options" AS "perguntas.options", "perguntas"."order" AS "perguntas.order", "perguntas"."required" AS "perguntas.required", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."description" AS "tenant.description", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "roleta"."id" AS "roleta.id", "roleta"."nome" AS "roleta.nome", "roleta"."descricao" AS "roleta.descricao", "roleta"."active" AS "roleta.active" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" LEFT OUTER JOIN "tenants" AS "tenant" ON "Pesquisa"."tenantId" = "tenant"."id" LEFT OUTER JOIN "roletas" AS "roleta" ON "Pesquisa"."roletaId" = "roleta"."id" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (e48ee7b8-ec94-4a82-a4ea-857e8e2b738d): SELECT "Pesquisa"."id", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."title", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."options" AS "perguntas.options", "perguntas"."required" AS "perguntas.required", "perguntas"."text" AS "perguntas.text" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (e48ee7b8-ec94-4a82-a4ea-857e8e2b738d): INSERT INTO "respostas" ("id","perguntaId","pesquisaId","tenantId","atendenteId","respondentSessionId","textValue","createdAt","updatedAt","ratingValue") VALUES ('536607de-e427-48b6-ac7a-afe922160592','3bcaef44-8ad1-4a95-a377-7fae3148fa97','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','56d7b27f-9789-406c-b233-387395e14979','509e6343-ad8e-429e-892b-4e91598fc87a','Porção de anéis de cebola ','2026-02-06 22:19:34.671 +00:00','2026-02-06 22:19:34.671 +00:00',NULL),('a88e3759-07be-410e-ae85-d4c76f0f49a5','19f1cec2-90b3-4223-b412-3c1d860e20a6','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','56d7b27f-9789-406c-b233-387395e14979','509e6343-ad8e-429e-892b-4e91598fc87a',NULL,'2026-02-06 22:19:34.671 +00:00','2026-02-06 22:19:34.671 +00:00',10),('e9b7eddf-4c30-4b4b-bd2e-e3801b5945c4','305b7330-b4c3-41b1-8fd1-0f3f91e7e936','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','56d7b27f-9789-406c-b233-387395e14979','509e6343-ad8e-429e-892b-4e91598fc87a',NULL,'2026-02-06 22:19:34.671 +00:00','2026-02-06 22:19:34.671 +00:00',5),('11d1f895-7d70-4b69-a255-3d5a4fec88c0','d91a3ab3-65e2-40d0-acfa-35133ed4a7d4','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','56d7b27f-9789-406c-b233-387395e14979','509e6343-ad8e-429e-892b-4e91598fc87a',NULL,'2026-02-06 22:19:34.671 +00:00','2026-02-06 22:19:34.671 +00:00',5),('c063967e-8ba0-4990-9a1b-a9d4a1fbaaea','635f7a66-33fd-40f4-89b4-3c7c83f003aa','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','56d7b27f-9789-406c-b233-387395e14979','509e6343-ad8e-429e-892b-4e91598fc87a',NULL,'2026-02-06 22:19:34.671 +00:00','2026-02-06 22:19:34.671 +00:00',5),('dba7d9c1-c83a-4a2e-9e60-f4b2f80a7d7c','9e5e541a-1930-47da-81a5-e53892d8337a','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','56d7b27f-9789-406c-b233-387395e14979','509e6343-ad8e-429e-892b-4e91598fc87a',NULL,'2026-02-06 22:19:34.671 +00:00','2026-02-06 22:19:34.671 +00:00',3),('6b8b0969-642f-46f1-8c50-4dcb6583c907','f3480c2b-6f71-4b2e-bd3b-ac407d1c56dc','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','56d7b27f-9789-406c-b233-387395e14979','509e6343-ad8e-429e-892b-4e91598fc87a','Parabéns pelo atendimento ','2026-02-06 22:19:34.671 +00:00','2026-02-06 22:19:34.671 +00:00',NULL),('48b5f06b-b007-478d-88f9-f9508e561364','2cbd96fb-faa2-495d-99dd-c57af8623c9d','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','56d7b27f-9789-406c-b233-387395e14979','509e6343-ad8e-429e-892b-4e91598fc87a',NULL,'2026-02-06 22:19:34.671 +00:00','2026-02-06 22:19:34.671 +00:00',3),('9c492a03-b8ea-41bb-be0d-96465cf71aea','89c2b3ed-7104-4a41-991d-565b70294215','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','56d7b27f-9789-406c-b233-387395e14979','509e6343-ad8e-429e-892b-4e91598fc87a',NULL,'2026-02-06 22:19:34.671 +00:00','2026-02-06 22:19:34.671 +00:00',3) RETURNING "id","perguntaId","pesquisaId","tenantId","atendenteId","respondentSessionId","ratingValue","textValue","selectedOption","createdAt","updatedAt";
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "postSaleDelayMinutes", "postSaleMessageTemplate", "postSaleSurveyId", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
[Delivery Much Job] Starting Polling...
[CAMPAIGN_MONITOR] Iniciando verificação de campanhas pausadas...
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."status" = 'paused';
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
[CAMPAIGN_MONITOR] Nenhuma campanha pausada encontrada.
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 22:20:00.082 +00:00' LIMIT 50;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 22:21:00.041 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[Auth Middleware] Request: GET /api/cupons?search=ALINE&status=&recompensaId=
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."ifoodAuthVerifier" AS "tenant.ifoodAuthVerifier", "tenant"."deliveryMuchClientId" AS "tenant.deliveryMuchClientId", "tenant"."deliveryMuchClientSecret" AS "tenant.deliveryMuchClientSecret", "tenant"."deliveryMuchUsername" AS "tenant.deliveryMuchUsername", "tenant"."deliveryMuchPassword" AS "tenant.deliveryMuchPassword", "tenant"."deliveryMuchToken" AS "tenant.deliveryMuchToken", "tenant"."deliveryMuchTokenExpiresAt" AS "tenant.deliveryMuchTokenExpiresAt", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."plan" AS "tenant.plan", "tenant"."planExpiresAt" AS "tenant.planExpiresAt", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = '77f853e9-deb2-4067-881e-71fa16d3054f';
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'cupons' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';

�Executing (default): SELECT "Cupom"."id", "Cupom"."pesquisaId", "Cupom"."campanhaId", "Cupom"."tenantId", "Cupom"."recompensaId", "Cupom"."codigo", "Cupom"."clienteId", "Cupom"."dataGeracao", "Cupom"."dataUtilizacao", "Cupom"."dataValidade", "Cupom"."status", "Cupom"."ultimoContato", "Cupom"."createdAt", "Cupom"."updatedAt", "recompensa"."id" AS "recompensa.id", "recompensa"."tenantId" AS "recompensa.tenantId", "recompensa"."name" AS "recompensa.name", "recompensa"."description" AS "recompensa.description", "recompensa"."conditionDescription" AS "recompensa.conditionDescription", "recompensa"."pointsRequired" AS "recompensa.pointsRequired", "recompensa"."type" AS "recompensa.type", "recompensa"."value" AS "recompensa.value", "recompensa"."imageUrl" AS "recompensa.imageUrl", "recompensa"."active" AS "recompensa.active", "recompensa"."createdAt" AS "recompensa.createdAt", "recompensa"."updatedAt" AS "recompensa.updatedAt", "client"."id" AS "client.id", "client"."tenantId" AS "client.tenantId", "client"."name" AS "client.name", "client"."email" AS "client.email", "client"."phone" AS "client.phone", "client"."birthDate" AS "client.birthDate", "client"."respondentSessionId" AS "client.respondentSessionId", "client"."gender" AS "client.gender", "client"."createdAt" AS "client.createdAt", "client"."updatedAt" AS "client.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."ifoodAuthVerifier" AS "tenant.ifoodAuthVerifier", "tenant"."deliveryMuchClientId" AS "tenant.deliveryMuchClientId", "tenant"."deliveryMuchClientSecret" AS "tenant.deliveryMuchClientSecret", "tenant"."deliveryMuchUsername" AS "tenant.deliveryMuchUsername", "tenant"."deliveryMuchPassword" AS "tenant.deliveryMuchPassword", "tenant"."deliveryMuchToken" AS "tenant.deliveryMuchToken", "tenant"."deliveryMuchTokenExpiresAt" AS "tenant.deliveryMuchTokenExpiresAt", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."plan" AS "tenant.plan", "tenant"."planExpiresAt" AS "tenant.planExpiresAt", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "cupons" AS "Cupom" LEFT OUTER JOIN "recompensas" AS "recompensa" ON "Cupom"."recompensaId" = "recompensa"."id" LEFT OUTER JOIN "clients" AS "client" ON "Cupom"."clienteId" = "client"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Cupom"."tenantId" = "tenant"."id" WHERE ("recompensa"."name" ILIKE '%ALINE%' OR "client"."name" ILIKE '%ALINE%' OR "Cupom"."codigo" ILIKE '%ALINE%') AND "Cupom"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' ORDER BY "Cupom"."dataGeracao" DESC;
[Auth Middleware] Request: POST /api/cupons/validate
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."ifoodAuthVerifier" AS "tenant.ifoodAuthVerifier", "tenant"."deliveryMuchClientId" AS "tenant.deliveryMuchClientId", "tenant"."deliveryMuchClientSecret" AS "tenant.deliveryMuchClientSecret", "tenant"."deliveryMuchUsername" AS "tenant.deliveryMuchUsername", "tenant"."deliveryMuchPassword" AS "tenant.deliveryMuchPassword", "tenant"."deliveryMuchToken" AS "tenant.deliveryMuchToken", "tenant"."deliveryMuchTokenExpiresAt" AS "tenant.deliveryMuchTokenExpiresAt", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."plan" AS "tenant.plan", "tenant"."planExpiresAt" AS "tenant.planExpiresAt", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = '77f853e9-deb2-4067-881e-71fa16d3054f';
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'cupons' AND "permissao"."action" = 'validate' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT "Cupom"."id", "Cupom"."pesquisaId", "Cupom"."campanhaId", "Cupom"."tenantId", "Cupom"."recompensaId", "Cupom"."codigo", "Cupom"."clienteId", "Cupom"."dataGeracao", "Cupom"."dataUtilizacao", "Cupom"."dataValidade", "Cupom"."status", "Cupom"."ultimoContato", "Cupom"."createdAt", "Cupom"."updatedAt", "recompensa"."id" AS "recompensa.id", "recompensa"."tenantId" AS "recompensa.tenantId", "recompensa"."name" AS "recompensa.name", "recompensa"."description" AS "recompensa.description", "recompensa"."conditionDescription" AS "recompensa.conditionDescription", "recompensa"."pointsRequired" AS "recompensa.pointsRequired", "recompensa"."type" AS "recompensa.type", "recompensa"."value" AS "recompensa.value", "recompensa"."imageUrl" AS "recompensa.imageUrl", "recompensa"."active" AS "recompensa.active", "recompensa"."createdAt" AS "recompensa.createdAt", "recompensa"."updatedAt" AS "recompensa.updatedAt", "client"."id" AS "client.id", "client"."tenantId" AS "client.tenantId", "client"."name" AS "client.name", "client"."email" AS "client.email", "client"."phone" AS "client.phone", "client"."birthDate" AS "client.birthDate", "client"."respondentSessionId" AS "client.respondentSessionId", "client"."gender" AS "client.gender", "client"."createdAt" AS "client.createdAt", "client"."updatedAt" AS "client.updatedAt" FROM "cupons" AS "Cupom" LEFT OUTER JOIN "recompensas" AS "recompensa" ON "Cupom"."recompensaId" = "recompensa"."id" LEFT OUTER JOIN "clients" AS "client" ON "Cupom"."clienteId" = "client"."id" WHERE "Cupom"."codigo" = 'ALINE1977' AND "Cupom"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): UPDATE "cupons" SET "status"=$1,"dataUtilizacao"=$2,"updatedAt"=$3 WHERE "id" = $4 AND "tenantId" = $5 RETURNING "id","pesquisaId","campanhaId","tenantId","recompensaId","codigo","clienteId","dataGeracao","dataUtilizacao","dataValidade","status","ultimoContato","createdAt","updatedAt"
Executing (default): SELECT "Cupom"."id", "Cupom"."pesquisaId", "Cupom"."campanhaId", "Cupom"."tenantId", "Cupom"."recompensaId", "Cupom"."codigo", "Cupom"."clienteId", "Cupom"."dataGeracao", "Cupom"."dataUtilizacao", "Cupom"."dataValidade", "Cupom"."status", "Cupom"."ultimoContato", "Cupom"."createdAt", "Cupom"."updatedAt", "recompensa"."id" AS "recompensa.id", "recompensa"."tenantId" AS "recompensa.tenantId", "recompensa"."name" AS "recompensa.name", "recompensa"."description" AS "recompensa.description", "recompensa"."conditionDescription" AS "recompensa.conditionDescription", "recompensa"."pointsRequired" AS "recompensa.pointsRequired", "recompensa"."type" AS "recompensa.type", "recompensa"."value" AS "recompensa.value", "recompensa"."imageUrl" AS "recompensa.imageUrl", "recompensa"."active" AS "recompensa.active", "recompensa"."createdAt" AS "recompensa.createdAt", "recompensa"."updatedAt" AS "recompensa.updatedAt", "client"."id" AS "client.id", "client"."tenantId" AS "client.tenantId", "client"."name" AS "client.name", "client"."email" AS "client.email", "client"."phone" AS "client.phone", "client"."birthDate" AS "client.birthDate", "client"."respondentSessionId" AS "client.respondentSessionId", "client"."gender" AS "client.gender", "client"."createdAt" AS "client.createdAt", "client"."updatedAt" AS "client.updatedAt" FROM "cupons" AS "Cupom" LEFT OUTER JOIN "recompensas" AS "recompensa" ON "Cupom"."recompensaId" = "recompensa"."id" LEFT OUTER JOIN "clients" AS "client" ON "Cupom"."clienteId" = "client"."id" WHERE "Cupom"."id" = '8f3784d8-f07e-48e3-ab3f-02c6a5325534' AND "Cupom"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
[Auth Middleware] Request: GET /api/cupons?search=ALINE&status=&recompensaId=
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."ifoodAuthVerifier" AS "tenant.ifoodAuthVerifier", "tenant"."deliveryMuchClientId" AS "tenant.deliveryMuchClientId", "tenant"."deliveryMuchClientSecret" AS "tenant.deliveryMuchClientSecret", "tenant"."deliveryMuchUsername" AS "tenant.deliveryMuchUsername", "tenant"."deliveryMuchPassword" AS "tenant.deliveryMuchPassword", "tenant"."deliveryMuchToken" AS "tenant.deliveryMuchToken", "tenant"."deliveryMuchTokenExpiresAt" AS "tenant.deliveryMuchTokenExpiresAt", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."plan" AS "tenant.plan", "tenant"."planExpiresAt" AS "tenant.planExpiresAt", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = '77f853e9-deb2-4067-881e-71fa16d3054f';
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'cupons' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';

�Executing (default): SELECT "Cupom"."id", "Cupom"."pesquisaId", "Cupom"."campanhaId", "Cupom"."tenantId", "Cupom"."recompensaId", "Cupom"."codigo", "Cupom"."clienteId", "Cupom"."dataGeracao", "Cupom"."dataUtilizacao", "Cupom"."dataValidade", "Cupom"."status", "Cupom"."ultimoContato", "Cupom"."createdAt", "Cupom"."updatedAt", "recompensa"."id" AS "recompensa.id", "recompensa"."tenantId" AS "recompensa.tenantId", "recompensa"."name" AS "recompensa.name", "recompensa"."description" AS "recompensa.description", "recompensa"."conditionDescription" AS "recompensa.conditionDescription", "recompensa"."pointsRequired" AS "recompensa.pointsRequired", "recompensa"."type" AS "recompensa.type", "recompensa"."value" AS "recompensa.value", "recompensa"."imageUrl" AS "recompensa.imageUrl", "recompensa"."active" AS "recompensa.active", "recompensa"."createdAt" AS "recompensa.createdAt", "recompensa"."updatedAt" AS "recompensa.updatedAt", "client"."id" AS "client.id", "client"."tenantId" AS "client.tenantId", "client"."name" AS "client.name", "client"."email" AS "client.email", "client"."phone" AS "client.phone", "client"."birthDate" AS "client.birthDate", "client"."respondentSessionId" AS "client.respondentSessionId", "client"."gender" AS "client.gender", "client"."createdAt" AS "client.createdAt", "client"."updatedAt" AS "client.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."ifoodAuthVerifier" AS "tenant.ifoodAuthVerifier", "tenant"."deliveryMuchClientId" AS "tenant.deliveryMuchClientId", "tenant"."deliveryMuchClientSecret" AS "tenant.deliveryMuchClientSecret", "tenant"."deliveryMuchUsername" AS "tenant.deliveryMuchUsername", "tenant"."deliveryMuchPassword" AS "tenant.deliveryMuchPassword", "tenant"."deliveryMuchToken" AS "tenant.deliveryMuchToken", "tenant"."deliveryMuchTokenExpiresAt" AS "tenant.deliveryMuchTokenExpiresAt", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."plan" AS "tenant.plan", "tenant"."planExpiresAt" AS "tenant.planExpiresAt", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "cupons" AS "Cupom" LEFT OUTER JOIN "recompensas" AS "recompensa" ON "Cupom"."recompensaId" = "recompensa"."id" LEFT OUTER JOIN "clients" AS "client" ON "Cupom"."clienteId" = "client"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Cupom"."tenantId" = "tenant"."id" WHERE ("recompensa"."name" ILIKE '%ALINE%' OR "client"."name" ILIKE '%ALINE%' OR "Cupom"."codigo" ILIKE '%ALINE%') AND "Cupom"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' ORDER BY "Cupom"."dataGeracao" DESC;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 22:22:00.034 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 22:23:00.038 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "name", "logoUrl", "primaryColor", "secondaryColor", "description" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT "id", "name", "logoUrl", "primaryColor", "secondaryColor", "description" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "name", "logoUrl", "primaryColor", "secondaryColor", "description" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT "tenantId" FROM "respostas" AS "Resposta" WHERE "Resposta"."respondentSessionId" = '842756bc-8ee5-4458-bc9e-5e6b40aa6d09' LIMIT 1;
Executing (cb0f5463-7534-4bbd-9e11-0ba4f78efe31): SELECT "id", "tenantId", "name", "email", "phone", "birthDate", "respondentSessionId", "gender", "createdAt", "updatedAt" FROM "clients" AS "Client" WHERE "Client"."phone" = '(35) 99943-6643' AND "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
Executing (cb0f5463-7534-4bbd-9e11-0ba4f78efe31): SELECT "id", "tenantId", "name", "email", "phone", "birthDate", "respondentSessionId", "gender", "createdAt", "updatedAt" FROM "clients" AS "Client" WHERE "Client"."respondentSessionId" = '842756bc-8ee5-4458-bc9e-5e6b40aa6d09';
Executing (cb0f5463-7534-4bbd-9e11-0ba4f78efe31): INSERT INTO "clients" ("id","tenantId","name","email","phone","birthDate","respondentSessionId","gender","createdAt","updatedAt") VALUES ($1,$2,$3,$4,$5,$6,$7,$8,$9,$10) RETURNING "id","tenantId","name","email","phone","birthDate","respondentSessionId","gender","createdAt","updatedAt";
Executing (cb0f5463-7534-4bbd-9e11-0ba4f78efe31): SELECT "pesquisaId", "tenantId" FROM "respostas" AS "Resposta" WHERE "Resposta"."respondentSessionId" = '842756bc-8ee5-4458-bc9e-5e6b40aa6d09' LIMIT 1;
Executing (cb0f5463-7534-4bbd-9e11-0ba4f78efe31): SELECT "recompensaId" FROM "pesquisas" AS "Pesquisa" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 22:24:00.037 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "logoUrl", "primaryColor", "secondaryColor", "description" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT "Pesquisa"."id", "Pesquisa"."title", "Pesquisa"."description", "Pesquisa"."createdAt", "Pesquisa"."updatedAt", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."status", "Pesquisa"."recompensaId", "Pesquisa"."roletaId", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."text" AS "perguntas.text", "perguntas"."options" AS "perguntas.options", "perguntas"."order" AS "perguntas.order", "perguntas"."required" AS "perguntas.required", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."description" AS "tenant.description", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "roleta"."id" AS "roleta.id", "roleta"."nome" AS "roleta.nome", "roleta"."descricao" AS "roleta.descricao", "roleta"."active" AS "roleta.active" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" LEFT OUTER JOIN "tenants" AS "tenant" ON "Pesquisa"."tenantId" = "tenant"."id" LEFT OUTER JOIN "roletas" AS "roleta" ON "Pesquisa"."roletaId" = "roleta"."id" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (default): SELECT "id", "tenantId", "creatorId", "title", "description", "startDate", "endDate", "isOpen", "askForAttendant", "status", "expectedRespondents", "dueDate", "recompensaId", "roletaId", "roletaPrizeMessage", "createdAt", "updatedAt" FROM "pesquisas" AS "Pesquisa" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (default): SELECT "id", "pesquisaId", "campanhaId", "tenantId", "recompensaId", "codigo", "clienteId", "dataGeracao", "dataUtilizacao", "dataValidade", "status", "ultimoContato", "createdAt", "updatedAt" FROM "cupons" AS "Cupom" WHERE "Cupom"."clienteId" = '55818fa2-06ac-4bc2-b6d1-f584785b9c5a' AND "Cupom"."pesquisaId" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4' ORDER BY "Cupom"."dataGeracao" DESC LIMIT 1;
Executing (default): SELECT "RoletaPremio"."id", "RoletaPremio"."tenantId", "RoletaPremio"."nome", "RoletaPremio"."descricao", "RoletaPremio"."porcentagem", "RoletaPremio"."cor", "RoletaPremio"."recompensaId", "RoletaPremio"."roletaId", "RoletaPremio"."imageUrl", "RoletaPremio"."active", "RoletaPremio"."isNoPrizeOption", "RoletaPremio"."createdAt", "RoletaPremio"."updatedAt", "recompensa"."id" AS "recompensa.id", "recompensa"."tenantId" AS "recompensa.tenantId", "recompensa"."name" AS "recompensa.name", "recompensa"."description" AS "recompensa.description", "recompensa"."conditionDescription" AS "recompensa.conditionDescription", "recompensa"."pointsRequired" AS "recompensa.pointsRequired", "recompensa"."type" AS "recompensa.type", "recompensa"."value" AS "recompensa.value", "recompensa"."imageUrl" AS "recompensa.imageUrl", "recompensa"."active" AS "recompensa.active", "recompensa"."createdAt" AS "recompensa.createdAt", "recompensa"."updatedAt" AS "recompensa.updatedAt" FROM "roleta_premios" AS "RoletaPremio" LEFT OUTER JOIN "recompensas" AS "recompensa" ON "RoletaPremio"."recompensaId" = "recompensa"."id" WHERE "RoletaPremio"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "RoletaPremio"."roletaId" = 'f4da8c53-db4f-4452-8c7d-505be5e99657' ORDER BY "RoletaPremio"."nome" ASC;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[Delivery Much Job] Starting Polling...
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 22:25:00.065 +00:00' LIMIT 50;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
Executing (default): SELECT "id", "tenantId", "creatorId", "title", "description", "startDate", "endDate", "isOpen", "askForAttendant", "status", "expectedRespondents", "dueDate", "recompensaId", "roletaId", "roletaPrizeMessage", "createdAt", "updatedAt" FROM "pesquisas" AS "Pesquisa" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (default): SELECT "id", "tenantId", "name", "email", "phone", "birthDate", "respondentSessionId", "gender", "createdAt", "updatedAt" FROM "clients" AS "Client" WHERE "Client"."id" = '55818fa2-06ac-4bc2-b6d1-f584785b9c5a';
Executing (default): SELECT "id", "pesquisaId", "campanhaId", "tenantId", "recompensaId", "codigo", "clienteId", "dataGeracao", "dataUtilizacao", "dataValidade", "status", "ultimoContato", "createdAt", "updatedAt" FROM "cupons" AS "Cupom" WHERE "Cupom"."clienteId" = '55818fa2-06ac-4bc2-b6d1-f584785b9c5a' AND "Cupom"."pesquisaId" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4' ORDER BY "Cupom"."dataGeracao" DESC LIMIT 1;
Executing (default): SELECT "RoletaPremio"."id", "RoletaPremio"."tenantId", "RoletaPremio"."nome", "RoletaPremio"."descricao", "RoletaPremio"."porcentagem", "RoletaPremio"."cor", "RoletaPremio"."recompensaId", "RoletaPremio"."roletaId", "RoletaPremio"."imageUrl", "RoletaPremio"."active", "RoletaPremio"."isNoPrizeOption", "RoletaPremio"."createdAt", "RoletaPremio"."updatedAt", "recompensa"."id" AS "recompensa.id", "recompensa"."tenantId" AS "recompensa.tenantId", "recompensa"."name" AS "recompensa.name", "recompensa"."description" AS "recompensa.description", "recompensa"."conditionDescription" AS "recompensa.conditionDescription", "recompensa"."pointsRequired" AS "recompensa.pointsRequired", "recompensa"."type" AS "recompensa.type", "recompensa"."value" AS "recompensa.value", "recompensa"."imageUrl" AS "recompensa.imageUrl", "recompensa"."active" AS "recompensa.active", "recompensa"."createdAt" AS "recompensa.createdAt", "recompensa"."updatedAt" AS "recompensa.updatedAt" FROM "roleta_premios" AS "RoletaPremio" LEFT OUTER JOIN "recompensas" AS "recompensa" ON "RoletaPremio"."recompensaId" = "recompensa"."id" WHERE "RoletaPremio"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "RoletaPremio"."roletaId" = 'f4da8c53-db4f-4452-8c7d-505be5e99657' ORDER BY "RoletaPremio"."nome" ASC;
Executing (default): INSERT INTO "cupons" ("id","pesquisaId","tenantId","recompensaId","codigo","clienteId","dataGeracao","dataValidade","status","createdAt","updatedAt") VALUES ($1,$2,$3,$4,$5,$6,$7,$8,$9,$10,$11) RETURNING "id","pesquisaId","campanhaId","tenantId","recompensaId","codigo","clienteId","dataGeracao","dataUtilizacao","dataValidade","status","ultimoContato","createdAt","updatedAt";
[RoletaController] Iniciando envio de mensagem de prêmio para o tenant eb629ea8-7d69-47a1-b1f1-f9dcb33475f4.
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "postSaleDelayMinutes", "postSaleMessageTemplate", "postSaleSurveyId", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
[RoletaController] Config do WhatsApp para o tenant eb629ea8-7d69-47a1-b1f1-f9dcb33475f4: {
  apiKey: '9df82dcbee60ce08f6ca93aa4024ca6c',
  instanceApiKey: '1EF60F67-BF10-4F82-9BB8-80124CCB17AC',
  id: 'b9d07194-31e9-49e7-bdb8-55d6b3596ef9',
  url: 'https://evolution2.towersfy.com',
  instanceName: 'roma-pizzaria--chopperia',
  instanceStatus: 'disconnected',
  tenantId: 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4',
  sendPrizeMessage: true,
  prizeMessageTemplate: '🎰 *UAAAU, {{cliente}}!* 😍  \n' +
    'Você acabou de girar a *Roleta Premiada da Roma* e saiu com sorte grande! 🍀🔥 \n' +
    '\n' +
    'Você recebeu para usar na sua proxima visita:\n' +
    '🎁 *Prêmio:* *{{premio}}*\n' +
    'Pra resgatar, é só mostrar o cupom 👉 *{{cupom}}* aqui no salão da **Roma Pizzaria & Chopperia** 🍕✨  \n' +
    '\n' +
    'Vem curtir seu prêmio com a galera e comemorar essa sorte toda! 🎉  \n' +
    '📍 *Roma Pizzaria* — diversão, sabor e prêmios te esperando! 😋\n',
  dailyReportEnabled: true,
  reportPhoneNumbers: '5535991090766,553591523297,553598374007',
  weeklyReportEnabled: true,
  monthlyReportEnabled: true,
  birthdayAutomationEnabled: true,
  birthdayMessageTemplate: '🎉 *Seu aniversário tá chegando, {{cliente}}!* 🥳  \n' +
    'E a *Roma Pizzaria* já separou um presente de respeito pra você 🍕🔥  \n' +
    '\n' +
    '🎁 *RODIZIO GRÁTIS* pra você comemorar do jeito certo!  \n' +
    'É só vir até o salão, aproveitar o rodízio e apresentar o cupom 👉 *{{cupom}}* \n' +
    '\n' +
    '📅 Valido para *semana do seu aniversário*,  \n' +
    'lembrando que o *rodízio acontece toda quarta, quinta e sexta* 😉  \n' +
    '\n' +
    '📍 *Válido exclusivamente no salão*  \n' +
    'Chama a galera, escolhe o dia e vem aproveitar! 🎂🍻  \n' +
    '\n' +
    '**Roma Pizzaria** 😍🍕',
  birthdayDaysBefore: 7,
  birthdayRewardType: 'recompensa',
  birthdayRewardId: '17ea8117-07e1-4fca-944b-8454f78079ad',
  birthdayCouponValidityDays: 30,
  sendDetractorMessageToClient: true,
  detractorMessageTemplate: 'Olá, {{cliente}}! 👋\n' +
    '\n' +
    'Recebemos sua avaliação com a nota **{{nota}}** e queremos agradecer por compartilhar sua experiência.  \n' +
    'Lamentamos muito que algo não tenha saído como esperado. 😔\n' +
    '\n' +
    'Seu comentário: _"{{comentario}}"_\n' +
    '\n' +
    'Estamos aqui para resolver isso o mais rápido possível.  \n' +
    'Poderia nos contar um pouco mais sobre o que aconteceu? Seu retorno é essencial para que possamos melhorar e garantir uma próxima experiência muito melhor. 🙏\n' +
    '\n' +
    'Obrigado por nos ajudar a evoluir!  \n' +
    'Nossa equipe está à disposição.\n',
  notifyDetractorToOwner: true,
  detractorOwnerMessageTemplate: '## 🚨 **Alerta de Detrator**\n' +
    '\n' +
    'O cliente **{{cliente}}** registrou uma avaliação **baixa**:\n' +
    '\n' +
    '- **Nota:** **{{nota}}**\n' +
    '- **Comentário:** _"{{comentario}}"_',
  detractorOwnerPhoneNumbers: '5535991090766,553591523297,553598374007',
  postSaleDelayMinutes: 90,
  postSaleMessageTemplate: '🍕 **Olá, {{cliente}}!**  \n' +
    '\n' +
    'Esperamos que você tenha curtido seu pedido da **Roma Pizzaria** 😍  \n' +
    '\n' +
    'Sua opinião é *muito importante* pra gente — é com ela que conseguimos melhorar sabores, atendimento e experiência a cada pedido.\n' +
    '\n' +
    '📝 **Leva menos de 1 minuto:**  \n' +
    '👉 {{link_pesquisa}}\n' +
    '\n' +
    'Como agradecimento, você pode receber **vantagens especiais** nos próximos pedidos 😉\n' +
    '\n' +
    'Obrigado por escolher a Roma ❤️  \n' +
    '*Tradição, sabor e respeito por cada cliente.*',
  postSaleSurveyId: '362bd09a-762a-49d4-9651-415955567e6a',
  createdAt: 2025-11-28T21:25:29.661Z,
  updatedAt: 2026-02-05T22:49:26.315Z
}
[RoletaController] Todas as condições para enviar a mensagem de prêmio foram atendidas para o tenant eb629ea8-7d69-47a1-b1f1-f9dcb33475f4.
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "postSaleDelayMinutes", "postSaleMessageTemplate", "postSaleSurveyId", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "postSaleDelayMinutes", "postSaleMessageTemplate", "postSaleSurveyId", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
[WhatsappService] Resposta da API de status da instância: {
  "instance": {
    "instanceName": "roma-pizzaria--chopperia",
    "state": "close"
  }
}
[RoletaController] Falha ao tentar enviar mensagem de prêmio via WhatsApp para o tenant eb629ea8-7d69-47a1-b1f1-f9dcb33475f4. Erro: A instância do WhatsApp desta loja não está conectada.
Executing (default): SELECT "Pesquisa"."id", "Pesquisa"."title", "Pesquisa"."description", "Pesquisa"."createdAt", "Pesquisa"."updatedAt", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."status", "Pesquisa"."recompensaId", "Pesquisa"."roletaId", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."text" AS "perguntas.text", "perguntas"."options" AS "perguntas.options", "perguntas"."order" AS "perguntas.order", "perguntas"."required" AS "perguntas.required", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."description" AS "tenant.description", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "roleta"."id" AS "roleta.id", "roleta"."nome" AS "roleta.nome", "roleta"."descricao" AS "roleta.descricao", "roleta"."active" AS "roleta.active" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" LEFT OUTER JOIN "tenants" AS "tenant" ON "Pesquisa"."tenantId" = "tenant"."id" LEFT OUTER JOIN "roletas" AS "roleta" ON "Pesquisa"."roletaId" = "roleta"."id" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (default): SELECT "id", "name", "logoUrl", "primaryColor", "secondaryColor", "description" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT "id", "tenantId", "creatorId", "title", "description", "startDate", "endDate", "isOpen", "askForAttendant", "status", "expectedRespondents", "dueDate", "recompensaId", "roletaId", "roletaPrizeMessage", "createdAt", "updatedAt" FROM "pesquisas" AS "Pesquisa" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (default): SELECT "id", "pesquisaId", "campanhaId", "tenantId", "recompensaId", "codigo", "clienteId", "dataGeracao", "dataUtilizacao", "dataValidade", "status", "ultimoContato", "createdAt", "updatedAt" FROM "cupons" AS "Cupom" WHERE "Cupom"."clienteId" = '55818fa2-06ac-4bc2-b6d1-f584785b9c5a' AND "Cupom"."pesquisaId" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4' ORDER BY "Cupom"."dataGeracao" DESC LIMIT 1;
Executing (default): SELECT "RoletaPremio"."id", "RoletaPremio"."tenantId", "RoletaPremio"."nome", "RoletaPremio"."descricao", "RoletaPremio"."porcentagem", "RoletaPremio"."cor", "RoletaPremio"."recompensaId", "RoletaPremio"."roletaId", "RoletaPremio"."imageUrl", "RoletaPremio"."active", "RoletaPremio"."isNoPrizeOption", "RoletaPremio"."createdAt", "RoletaPremio"."updatedAt", "recompensa"."id" AS "recompensa.id", "recompensa"."tenantId" AS "recompensa.tenantId", "recompensa"."name" AS "recompensa.name", "recompensa"."description" AS "recompensa.description", "recompensa"."conditionDescription" AS "recompensa.conditionDescription", "recompensa"."pointsRequired" AS "recompensa.pointsRequired", "recompensa"."type" AS "recompensa.type", "recompensa"."value" AS "recompensa.value", "recompensa"."imageUrl" AS "recompensa.imageUrl", "recompensa"."active" AS "recompensa.active", "recompensa"."createdAt" AS "recompensa.createdAt", "recompensa"."updatedAt" AS "recompensa.updatedAt" FROM "roleta_premios" AS "RoletaPremio" LEFT OUTER JOIN "recompensas" AS "recompensa" ON "RoletaPremio"."recompensaId" = "recompensa"."id" WHERE "RoletaPremio"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "RoletaPremio"."roletaId" = 'f4da8c53-db4f-4452-8c7d-505be5e99657' ORDER BY "RoletaPremio"."nome" ASC;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 22:26:00.035 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 22:27:00.043 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "Pesquisa"."id", "Pesquisa"."title", "Pesquisa"."description", "Pesquisa"."createdAt", "Pesquisa"."updatedAt", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."status", "Pesquisa"."recompensaId", "Pesquisa"."roletaId", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."text" AS "perguntas.text", "perguntas"."options" AS "perguntas.options", "perguntas"."order" AS "perguntas.order", "perguntas"."required" AS "perguntas.required", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."description" AS "tenant.description", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "roleta"."id" AS "roleta.id", "roleta"."nome" AS "roleta.nome", "roleta"."descricao" AS "roleta.descricao", "roleta"."active" AS "roleta.active" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" LEFT OUTER JOIN "tenants" AS "tenant" ON "Pesquisa"."tenantId" = "tenant"."id" LEFT OUTER JOIN "roletas" AS "roleta" ON "Pesquisa"."roletaId" = "roleta"."id" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (default): SELECT "id", "name" FROM "atendentes" AS "Atendente" WHERE "Atendente"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Atendente"."status" = 'active' ORDER BY "Atendente"."name" ASC;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 22:28:00.034 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[Auth Middleware] Request: GET /api/cupons?search=&status=&recompensaId=
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."ifoodAuthVerifier" AS "tenant.ifoodAuthVerifier", "tenant"."deliveryMuchClientId" AS "tenant.deliveryMuchClientId", "tenant"."deliveryMuchClientSecret" AS "tenant.deliveryMuchClientSecret", "tenant"."deliveryMuchUsername" AS "tenant.deliveryMuchUsername", "tenant"."deliveryMuchPassword" AS "tenant.deliveryMuchPassword", "tenant"."deliveryMuchToken" AS "tenant.deliveryMuchToken", "tenant"."deliveryMuchTokenExpiresAt" AS "tenant.deliveryMuchTokenExpiresAt", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."plan" AS "tenant.plan", "tenant"."planExpiresAt" AS "tenant.planExpiresAt", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = '77f853e9-deb2-4067-881e-71fa16d3054f';
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'cupons' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';

oExecuting (default): SELECT "Cupom"."id", "Cupom"."pesquisaId", "Cupom"."campanhaId", "Cupom"."tenantId", "Cupom"."recompensaId", "Cupom"."codigo", "Cupom"."clienteId", "Cupom"."dataGeracao", "Cupom"."dataUtilizacao", "Cupom"."dataValidade", "Cupom"."status", "Cupom"."ultimoContato", "Cupom"."createdAt", "Cupom"."updatedAt", "recompensa"."id" AS "recompensa.id", "recompensa"."tenantId" AS "recompensa.tenantId", "recompensa"."name" AS "recompensa.name", "recompensa"."description" AS "recompensa.description", "recompensa"."conditionDescription" AS "recompensa.conditionDescription", "recompensa"."pointsRequired" AS "recompensa.pointsRequired", "recompensa"."type" AS "recompensa.type", "recompensa"."value" AS "recompensa.value", "recompensa"."imageUrl" AS "recompensa.imageUrl", "recompensa"."active" AS "recompensa.active", "recompensa"."createdAt" AS "recompensa.createdAt", "recompensa"."updatedAt" AS "recompensa.updatedAt", "client"."id" AS "client.id", "client"."tenantId" AS "client.tenantId", "client"."name" AS "client.name", "client"."email" AS "client.email", "client"."phone" AS "client.phone", "client"."birthDate" AS "client.birthDate", "client"."respondentSessionId" AS "client.respondentSessionId", "client"."gender" AS "client.gender", "client"."createdAt" AS "client.createdAt", "client"."updatedAt" AS "client.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."ifoodAuthVerifier" AS "tenant.ifoodAuthVerifier", "tenant"."deliveryMuchClientId" AS "tenant.deliveryMuchClientId", "tenant"."deliveryMuchClientSecret" AS "tenant.deliveryMuchClientSecret", "tenant"."deliveryMuchUsername" AS "tenant.deliveryMuchUsername", "tenant"."deliveryMuchPassword" AS "tenant.deliveryMuchPassword", "tenant"."deliveryMuchToken" AS "tenant.deliveryMuchToken", "tenant"."deliveryMuchTokenExpiresAt" AS "tenant.deliveryMuchTokenExpiresAt", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."plan" AS "tenant.plan", "tenant"."planExpiresAt" AS "tenant.planExpiresAt", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "cupons" AS "Cupom" LEFT OUTER JOIN "recompensas" AS "recompensa" ON "Cupom"."recompensaId" = "recompensa"."id" LEFT OUTER JOIN "clients" AS "client" ON "Cupom"."clienteId" = "client"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Cupom"."tenantId" = "tenant"."id" WHERE "Cupom"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' ORDER BY "Cupom"."dataGeracao" DESC;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 22:29:00.035 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "askForAttendant" FROM "pesquisas" AS "Pesquisa" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (default): SELECT "Pesquisa"."id", "Pesquisa"."title", "Pesquisa"."description", "Pesquisa"."createdAt", "Pesquisa"."updatedAt", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."status", "Pesquisa"."recompensaId", "Pesquisa"."roletaId", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."text" AS "perguntas.text", "perguntas"."options" AS "perguntas.options", "perguntas"."order" AS "perguntas.order", "perguntas"."required" AS "perguntas.required", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."description" AS "tenant.description", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "roleta"."id" AS "roleta.id", "roleta"."nome" AS "roleta.nome", "roleta"."descricao" AS "roleta.descricao", "roleta"."active" AS "roleta.active" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" LEFT OUTER JOIN "tenants" AS "tenant" ON "Pesquisa"."tenantId" = "tenant"."id" LEFT OUTER JOIN "roletas" AS "roleta" ON "Pesquisa"."roletaId" = "roleta"."id" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (d25d5ab1-350c-4f17-8809-5bda12d76b3b): SELECT "Pesquisa"."id", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."title", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."options" AS "perguntas.options", "perguntas"."required" AS "perguntas.required", "perguntas"."text" AS "perguntas.text" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (d25d5ab1-350c-4f17-8809-5bda12d76b3b): INSERT INTO "respostas" ("id","perguntaId","pesquisaId","tenantId","atendenteId","respondentSessionId","textValue","createdAt","updatedAt","ratingValue") VALUES ('6580ad04-929e-4667-87cd-932326c9ac8e','3bcaef44-8ad1-4a95-a377-7fae3148fa97','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','67781806-855c-4e48-bf39-d1305176420a','c1afa9c2-1c8e-4edf-929e-50003c58f7f1','Porção de anéis de cebola ','2026-02-06 22:29:00.524 +00:00','2026-02-06 22:29:00.524 +00:00',NULL),('cc695716-1a5c-47b2-8897-19e3b6745552','19f1cec2-90b3-4223-b412-3c1d860e20a6','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','67781806-855c-4e48-bf39-d1305176420a','c1afa9c2-1c8e-4edf-929e-50003c58f7f1',NULL,'2026-02-06 22:29:00.524 +00:00','2026-02-06 22:29:00.524 +00:00',10),('8c151d56-b833-4d3f-829c-9880499b7d6f','305b7330-b4c3-41b1-8fd1-0f3f91e7e936','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','67781806-855c-4e48-bf39-d1305176420a','c1afa9c2-1c8e-4edf-929e-50003c58f7f1',NULL,'2026-02-06 22:29:00.524 +00:00','2026-02-06 22:29:00.524 +00:00',5),('d0378a34-d20d-41f2-808f-a09590a0105f','d91a3ab3-65e2-40d0-acfa-35133ed4a7d4','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','67781806-855c-4e48-bf39-d1305176420a','c1afa9c2-1c8e-4edf-929e-50003c58f7f1',NULL,'2026-02-06 22:29:00.524 +00:00','2026-02-06 22:29:00.524 +00:00',5),('737a59db-fc38-4816-a166-30b9e51ca996','635f7a66-33fd-40f4-89b4-3c7c83f003aa','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','67781806-855c-4e48-bf39-d1305176420a','c1afa9c2-1c8e-4edf-929e-50003c58f7f1',NULL,'2026-02-06 22:29:00.524 +00:00','2026-02-06 22:29:00.524 +00:00',5),('eb6537c3-2e53-445d-afbc-2b03df9976b0','9e5e541a-1930-47da-81a5-e53892d8337a','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','67781806-855c-4e48-bf39-d1305176420a','c1afa9c2-1c8e-4edf-929e-50003c58f7f1',NULL,'2026-02-06 22:29:00.524 +00:00','2026-02-06 22:29:00.524 +00:00',4),('a71ea730-ff9e-49e4-8829-e8e0a82f6b56','f3480c2b-6f71-4b2e-bd3b-ac407d1c56dc','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','67781806-855c-4e48-bf39-d1305176420a','c1afa9c2-1c8e-4edf-929e-50003c58f7f1','Parabéns pelo atendimento ','2026-02-06 22:29:00.524 +00:00','2026-02-06 22:29:00.524 +00:00',NULL),('a12854fa-1935-4fa2-b7fb-28b16fc2fe12','2cbd96fb-faa2-495d-99dd-c57af8623c9d','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','67781806-855c-4e48-bf39-d1305176420a','c1afa9c2-1c8e-4edf-929e-50003c58f7f1',NULL,'2026-02-06 22:29:00.524 +00:00','2026-02-06 22:29:00.524 +00:00',3),('7b524073-a1b4-4316-8b3a-6ceefc54b5c5','89c2b3ed-7104-4a41-991d-565b70294215','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','67781806-855c-4e48-bf39-d1305176420a','c1afa9c2-1c8e-4edf-929e-50003c58f7f1',NULL,'2026-02-06 22:29:00.524 +00:00','2026-02-06 22:29:00.524 +00:00',4) RETURNING "id","perguntaId","pesquisaId","tenantId","atendenteId","respondentSessionId","ratingValue","textValue","selectedOption","createdAt","updatedAt";
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "postSaleDelayMinutes", "postSaleMessageTemplate", "postSaleSurveyId", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
Executing (default): SELECT "id", "name", "logoUrl", "primaryColor", "secondaryColor", "description" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT "id", "name", "logoUrl", "primaryColor", "secondaryColor", "description" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[CAMPAIGN_MONITOR] Iniciando verificação de campanhas pausadas...
[iFood Job] Starting Polling...
[Delivery Much Job] Starting Polling...
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."status" = 'paused';
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 22:30:00.082 +00:00' LIMIT 50;
[CAMPAIGN_MONITOR] Nenhuma campanha pausada encontrada.
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
Executing (default): SELECT "tenantId" FROM "respostas" AS "Resposta" WHERE "Resposta"."respondentSessionId" = 'c1afa9c2-1c8e-4edf-929e-50003c58f7f1' LIMIT 1;
Executing (3ca313a0-bc72-40e0-8c12-88b96e79f3fc): SELECT "id", "tenantId", "name", "email", "phone", "birthDate", "respondentSessionId", "gender", "createdAt", "updatedAt" FROM "clients" AS "Client" WHERE "Client"."phone" = '(35) 99185-8216' AND "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
Executing (3ca313a0-bc72-40e0-8c12-88b96e79f3fc): SELECT "id", "tenantId", "name", "email", "phone", "birthDate", "respondentSessionId", "gender", "createdAt", "updatedAt" FROM "clients" AS "Client" WHERE "Client"."respondentSessionId" = 'c1afa9c2-1c8e-4edf-929e-50003c58f7f1';
Executing (3ca313a0-bc72-40e0-8c12-88b96e79f3fc): INSERT INTO "clients" ("id","tenantId","name","email","phone","birthDate","respondentSessionId","gender","createdAt","updatedAt") VALUES ($1,$2,$3,$4,$5,$6,$7,$8,$9,$10) RETURNING "id","tenantId","name","email","phone","birthDate","respondentSessionId","gender","createdAt","updatedAt";
Executing (3ca313a0-bc72-40e0-8c12-88b96e79f3fc): SELECT "pesquisaId", "tenantId" FROM "respostas" AS "Resposta" WHERE "Resposta"."respondentSessionId" = 'c1afa9c2-1c8e-4edf-929e-50003c58f7f1' LIMIT 1;
Executing (3ca313a0-bc72-40e0-8c12-88b96e79f3fc): SELECT "recompensaId" FROM "pesquisas" AS "Pesquisa" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (default): SELECT "Pesquisa"."id", "Pesquisa"."title", "Pesquisa"."description", "Pesquisa"."createdAt", "Pesquisa"."updatedAt", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."status", "Pesquisa"."recompensaId", "Pesquisa"."roletaId", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."text" AS "perguntas.text", "perguntas"."options" AS "perguntas.options", "perguntas"."order" AS "perguntas.order", "perguntas"."required" AS "perguntas.required", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."description" AS "tenant.description", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "roleta"."id" AS "roleta.id", "roleta"."nome" AS "roleta.nome", "roleta"."descricao" AS "roleta.descricao", "roleta"."active" AS "roleta.active" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" LEFT OUTER JOIN "tenants" AS "tenant" ON "Pesquisa"."tenantId" = "tenant"."id" LEFT OUTER JOIN "roletas" AS "roleta" ON "Pesquisa"."roletaId" = "roleta"."id" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (default): SELECT "id", "name", "logoUrl", "primaryColor", "secondaryColor", "description" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT "id", "tenantId", "creatorId", "title", "description", "startDate", "endDate", "isOpen", "askForAttendant", "status", "expectedRespondents", "dueDate", "recompensaId", "roletaId", "roletaPrizeMessage", "createdAt", "updatedAt" FROM "pesquisas" AS "Pesquisa" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (default): SELECT "id", "pesquisaId", "campanhaId", "tenantId", "recompensaId", "codigo", "clienteId", "dataGeracao", "dataUtilizacao", "dataValidade", "status", "ultimoContato", "createdAt", "updatedAt" FROM "cupons" AS "Cupom" WHERE "Cupom"."clienteId" = 'd6e7e74e-b829-4525-85f0-c31e981ee022' AND "Cupom"."pesquisaId" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4' ORDER BY "Cupom"."dataGeracao" DESC LIMIT 1;
Executing (default): SELECT "RoletaPremio"."id", "RoletaPremio"."tenantId", "RoletaPremio"."nome", "RoletaPremio"."descricao", "RoletaPremio"."porcentagem", "RoletaPremio"."cor", "RoletaPremio"."recompensaId", "RoletaPremio"."roletaId", "RoletaPremio"."imageUrl", "RoletaPremio"."active", "RoletaPremio"."isNoPrizeOption", "RoletaPremio"."createdAt", "RoletaPremio"."updatedAt", "recompensa"."id" AS "recompensa.id", "recompensa"."tenantId" AS "recompensa.tenantId", "recompensa"."name" AS "recompensa.name", "recompensa"."description" AS "recompensa.description", "recompensa"."conditionDescription" AS "recompensa.conditionDescription", "recompensa"."pointsRequired" AS "recompensa.pointsRequired", "recompensa"."type" AS "recompensa.type", "recompensa"."value" AS "recompensa.value", "recompensa"."imageUrl" AS "recompensa.imageUrl", "recompensa"."active" AS "recompensa.active", "recompensa"."createdAt" AS "recompensa.createdAt", "recompensa"."updatedAt" AS "recompensa.updatedAt" FROM "roleta_premios" AS "RoletaPremio" LEFT OUTER JOIN "recompensas" AS "recompensa" ON "RoletaPremio"."recompensaId" = "recompensa"."id" WHERE "RoletaPremio"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "RoletaPremio"."roletaId" = 'f4da8c53-db4f-4452-8c7d-505be5e99657' ORDER BY "RoletaPremio"."nome" ASC;
Executing (default): SELECT "id", "tenantId", "creatorId", "title", "description", "startDate", "endDate", "isOpen", "askForAttendant", "status", "expectedRespondents", "dueDate", "recompensaId", "roletaId", "roletaPrizeMessage", "createdAt", "updatedAt" FROM "pesquisas" AS "Pesquisa" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (default): SELECT "id", "tenantId", "name", "email", "phone", "birthDate", "respondentSessionId", "gender", "createdAt", "updatedAt" FROM "clients" AS "Client" WHERE "Client"."id" = 'd6e7e74e-b829-4525-85f0-c31e981ee022';
Executing (default): SELECT "id", "pesquisaId", "campanhaId", "tenantId", "recompensaId", "codigo", "clienteId", "dataGeracao", "dataUtilizacao", "dataValidade", "status", "ultimoContato", "createdAt", "updatedAt" FROM "cupons" AS "Cupom" WHERE "Cupom"."clienteId" = 'd6e7e74e-b829-4525-85f0-c31e981ee022' AND "Cupom"."pesquisaId" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4' ORDER BY "Cupom"."dataGeracao" DESC LIMIT 1;
Executing (default): SELECT "RoletaPremio"."id", "RoletaPremio"."tenantId", "RoletaPremio"."nome", "RoletaPremio"."descricao", "RoletaPremio"."porcentagem", "RoletaPremio"."cor", "RoletaPremio"."recompensaId", "RoletaPremio"."roletaId", "RoletaPremio"."imageUrl", "RoletaPremio"."active", "RoletaPremio"."isNoPrizeOption", "RoletaPremio"."createdAt", "RoletaPremio"."updatedAt", "recompensa"."id" AS "recompensa.id", "recompensa"."tenantId" AS "recompensa.tenantId", "recompensa"."name" AS "recompensa.name", "recompensa"."description" AS "recompensa.description", "recompensa"."conditionDescription" AS "recompensa.conditionDescription", "recompensa"."pointsRequired" AS "recompensa.pointsRequired", "recompensa"."type" AS "recompensa.type", "recompensa"."value" AS "recompensa.value", "recompensa"."imageUrl" AS "recompensa.imageUrl", "recompensa"."active" AS "recompensa.active", "recompensa"."createdAt" AS "recompensa.createdAt", "recompensa"."updatedAt" AS "recompensa.updatedAt" FROM "roleta_premios" AS "RoletaPremio" LEFT OUTER JOIN "recompensas" AS "recompensa" ON "RoletaPremio"."recompensaId" = "recompensa"."id" WHERE "RoletaPremio"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "RoletaPremio"."roletaId" = 'f4da8c53-db4f-4452-8c7d-505be5e99657' ORDER BY "RoletaPremio"."nome" ASC;
Executing (default): INSERT INTO "cupons" ("id","pesquisaId","tenantId","recompensaId","codigo","clienteId","dataGeracao","dataValidade","status","createdAt","updatedAt") VALUES ($1,$2,$3,$4,$5,$6,$7,$8,$9,$10,$11) RETURNING "id","pesquisaId","campanhaId","tenantId","recompensaId","codigo","clienteId","dataGeracao","dataUtilizacao","dataValidade","status","ultimoContato","createdAt","updatedAt";
[RoletaController] Iniciando envio de mensagem de prêmio para o tenant eb629ea8-7d69-47a1-b1f1-f9dcb33475f4.
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "postSaleDelayMinutes", "postSaleMessageTemplate", "postSaleSurveyId", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
[RoletaController] Config do WhatsApp para o tenant eb629ea8-7d69-47a1-b1f1-f9dcb33475f4: {
  apiKey: '9df82dcbee60ce08f6ca93aa4024ca6c',
  instanceApiKey: '1EF60F67-BF10-4F82-9BB8-80124CCB17AC',
  id: 'b9d07194-31e9-49e7-bdb8-55d6b3596ef9',
  url: 'https://evolution2.towersfy.com',
  instanceName: 'roma-pizzaria--chopperia',
  instanceStatus: 'disconnected',
  tenantId: 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4',
  sendPrizeMessage: true,
  prizeMessageTemplate: '🎰 *UAAAU, {{cliente}}!* 😍  \n' +
    'Você acabou de girar a *Roleta Premiada da Roma* e saiu com sorte grande! 🍀🔥 \n' +
    '\n' +
    'Você recebeu para usar na sua proxima visita:\n' +
    '🎁 *Prêmio:* *{{premio}}*\n' +
    'Pra resgatar, é só mostrar o cupom 👉 *{{cupom}}* aqui no salão da **Roma Pizzaria & Chopperia** 🍕✨  \n' +
    '\n' +
    'Vem curtir seu prêmio com a galera e comemorar essa sorte toda! 🎉  \n' +
    '📍 *Roma Pizzaria* — diversão, sabor e prêmios te esperando! 😋\n',
  dailyReportEnabled: true,
  reportPhoneNumbers: '5535991090766,553591523297,553598374007',
  weeklyReportEnabled: true,
  monthlyReportEnabled: true,
  birthdayAutomationEnabled: true,
  birthdayMessageTemplate: '🎉 *Seu aniversário tá chegando, {{cliente}}!* 🥳  \n' +
    'E a *Roma Pizzaria* já separou um presente de respeito pra você 🍕🔥  \n' +
    '\n' +
    '🎁 *RODIZIO GRÁTIS* pra você comemorar do jeito certo!  \n' +
    'É só vir até o salão, aproveitar o rodízio e apresentar o cupom 👉 *{{cupom}}* \n' +
    '\n' +
    '📅 Valido para *semana do seu aniversário*,  \n' +
    'lembrando que o *rodízio acontece toda quarta, quinta e sexta* 😉  \n' +
    '\n' +
    '📍 *Válido exclusivamente no salão*  \n' +
    'Chama a galera, escolhe o dia e vem aproveitar! 🎂🍻  \n' +
    '\n' +
    '**Roma Pizzaria** 😍🍕',
  birthdayDaysBefore: 7,
  birthdayRewardType: 'recompensa',
  birthdayRewardId: '17ea8117-07e1-4fca-944b-8454f78079ad',
  birthdayCouponValidityDays: 30,
  sendDetractorMessageToClient: true,
  detractorMessageTemplate: 'Olá, {{cliente}}! 👋\n' +
    '\n' +
    'Recebemos sua avaliação com a nota **{{nota}}** e queremos agradecer por compartilhar sua experiência.  \n' +
    'Lamentamos muito que algo não tenha saído como esperado. 😔\n' +
    '\n' +
    'Seu comentário: _"{{comentario}}"_\n' +
    '\n' +
    'Estamos aqui para resolver isso o mais rápido possível.  \n' +
    'Poderia nos contar um pouco mais sobre o que aconteceu? Seu retorno é essencial para que possamos melhorar e garantir uma próxima experiência muito melhor. 🙏\n' +
    '\n' +
    'Obrigado por nos ajudar a evoluir!  \n' +
    'Nossa equipe está à disposição.\n',
  notifyDetractorToOwner: true,
  detractorOwnerMessageTemplate: '## 🚨 **Alerta de Detrator**\n' +
    '\n' +
    'O cliente **{{cliente}}** registrou uma avaliação **baixa**:\n' +
    '\n' +
    '- **Nota:** **{{nota}}**\n' +
    '- **Comentário:** _"{{comentario}}"_',
  detractorOwnerPhoneNumbers: '5535991090766,553591523297,553598374007',
  postSaleDelayMinutes: 90,
  postSaleMessageTemplate: '🍕 **Olá, {{cliente}}!**  \n' +
    '\n' +
    'Esperamos que você tenha curtido seu pedido da **Roma Pizzaria** 😍  \n' +
    '\n' +
    'Sua opinião é *muito importante* pra gente — é com ela que conseguimos melhorar sabores, atendimento e experiência a cada pedido.\n' +
    '\n' +
    '📝 **Leva menos de 1 minuto:**  \n' +
    '👉 {{link_pesquisa}}\n' +
    '\n' +
    'Como agradecimento, você pode receber **vantagens especiais** nos próximos pedidos 😉\n' +
    '\n' +
    'Obrigado por escolher a Roma ❤️  \n' +
    '*Tradição, sabor e respeito por cada cliente.*',
  postSaleSurveyId: '362bd09a-762a-49d4-9651-415955567e6a',
  createdAt: 2025-11-28T21:25:29.661Z,
  updatedAt: 2026-02-05T22:49:26.315Z
}
[RoletaController] Todas as condições para enviar a mensagem de prêmio foram atendidas para o tenant eb629ea8-7d69-47a1-b1f1-f9dcb33475f4.
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "postSaleDelayMinutes", "postSaleMessageTemplate", "postSaleSurveyId", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "postSaleDelayMinutes", "postSaleMessageTemplate", "postSaleSurveyId", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
[RoletaController] Falha ao tentar enviar mensagem de prêmio via WhatsApp para o tenant eb629ea8-7d69-47a1-b1f1-f9dcb33475f4. Erro: A instância do WhatsApp desta loja não está conectada.
[WhatsappService] Resposta da API de status da instância: {
  "instance": {
    "instanceName": "roma-pizzaria--chopperia",
    "state": "close"
  }
}
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 22:31:00.037 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 22:32:00.039 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "name", "logoUrl", "primaryColor", "secondaryColor", "description" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT "Pesquisa"."id", "Pesquisa"."title", "Pesquisa"."description", "Pesquisa"."createdAt", "Pesquisa"."updatedAt", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."status", "Pesquisa"."recompensaId", "Pesquisa"."roletaId", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."text" AS "perguntas.text", "perguntas"."options" AS "perguntas.options", "perguntas"."order" AS "perguntas.order", "perguntas"."required" AS "perguntas.required", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."description" AS "tenant.description", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "roleta"."id" AS "roleta.id", "roleta"."nome" AS "roleta.nome", "roleta"."descricao" AS "roleta.descricao", "roleta"."active" AS "roleta.active" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" LEFT OUTER JOIN "tenants" AS "tenant" ON "Pesquisa"."tenantId" = "tenant"."id" LEFT OUTER JOIN "roletas" AS "roleta" ON "Pesquisa"."roletaId" = "roleta"."id" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (default): SELECT "id", "tenantId", "creatorId", "title", "description", "startDate", "endDate", "isOpen", "askForAttendant", "status", "expectedRespondents", "dueDate", "recompensaId", "roletaId", "roletaPrizeMessage", "createdAt", "updatedAt" FROM "pesquisas" AS "Pesquisa" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (default): SELECT "id", "pesquisaId", "campanhaId", "tenantId", "recompensaId", "codigo", "clienteId", "dataGeracao", "dataUtilizacao", "dataValidade", "status", "ultimoContato", "createdAt", "updatedAt" FROM "cupons" AS "Cupom" WHERE "Cupom"."clienteId" = 'd6e7e74e-b829-4525-85f0-c31e981ee022' AND "Cupom"."pesquisaId" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4' ORDER BY "Cupom"."dataGeracao" DESC LIMIT 1;
Executing (default): SELECT "RoletaPremio"."id", "RoletaPremio"."tenantId", "RoletaPremio"."nome", "RoletaPremio"."descricao", "RoletaPremio"."porcentagem", "RoletaPremio"."cor", "RoletaPremio"."recompensaId", "RoletaPremio"."roletaId", "RoletaPremio"."imageUrl", "RoletaPremio"."active", "RoletaPremio"."isNoPrizeOption", "RoletaPremio"."createdAt", "RoletaPremio"."updatedAt", "recompensa"."id" AS "recompensa.id", "recompensa"."tenantId" AS "recompensa.tenantId", "recompensa"."name" AS "recompensa.name", "recompensa"."description" AS "recompensa.description", "recompensa"."conditionDescription" AS "recompensa.conditionDescription", "recompensa"."pointsRequired" AS "recompensa.pointsRequired", "recompensa"."type" AS "recompensa.type", "recompensa"."value" AS "recompensa.value", "recompensa"."imageUrl" AS "recompensa.imageUrl", "recompensa"."active" AS "recompensa.active", "recompensa"."createdAt" AS "recompensa.createdAt", "recompensa"."updatedAt" AS "recompensa.updatedAt" FROM "roleta_premios" AS "RoletaPremio" LEFT OUTER JOIN "recompensas" AS "recompensa" ON "RoletaPremio"."recompensaId" = "recompensa"."id" WHERE "RoletaPremio"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "RoletaPremio"."roletaId" = 'f4da8c53-db4f-4452-8c7d-505be5e99657' ORDER BY "RoletaPremio"."nome" ASC;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 22:33:00.032 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "logoUrl", "primaryColor", "secondaryColor", "description" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT "id", "name", "logoUrl", "primaryColor", "secondaryColor", "description" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT "Pesquisa"."id", "Pesquisa"."title", "Pesquisa"."description", "Pesquisa"."createdAt", "Pesquisa"."updatedAt", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."status", "Pesquisa"."recompensaId", "Pesquisa"."roletaId", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."text" AS "perguntas.text", "perguntas"."options" AS "perguntas.options", "perguntas"."order" AS "perguntas.order", "perguntas"."required" AS "perguntas.required", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."description" AS "tenant.description", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "roleta"."id" AS "roleta.id", "roleta"."nome" AS "roleta.nome", "roleta"."descricao" AS "roleta.descricao", "roleta"."active" AS "roleta.active" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" LEFT OUTER JOIN "tenants" AS "tenant" ON "Pesquisa"."tenantId" = "tenant"."id" LEFT OUTER JOIN "roletas" AS "roleta" ON "Pesquisa"."roletaId" = "roleta"."id" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 22:34:00.044 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[Delivery Much Job] Starting Polling...
[iFood Job] Starting Polling...
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 22:35:00.091 +00:00' LIMIT 50;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
Iniciando processamento do webhook do Uai Rango: {
  "id_estabelecimento": 4659,
  "cod_pedido": "ABD35B312",
  "data": "2026-02-06 19:34:50",
  "pedido_pronto": 0,
  "data_pedido_pronto": null,

  "cupom": {
    "codigo": "ESQUENTA",
    "tipo": "Porcentagem",
    "valor": "20",
    "desconto_maximo": 10,
    "desconto_valor": 8.598
  },
  "tipo_entrega": "Delivery",
  "prazo": null,
  "prazo_min": 30,
  "prazo_max": 50,
  "categoria_pagamento": "Pagamento Online",
  "forma_pagamento": "Pagamento Online",
  "valor_total": 42.99,
  "observacao": "",
  "taxa_entrega": 3,
  "nome_taxa_entrega": "Bairros",
  "status": {

    "id": 0,
    "status": "Pendente"
  },
  "produtos": [
    {
      "id_categoria": 307609,
      "codigo_categoria": "",
      "categoria": "Novos Combos de Esfiha",
      "id_opcao": 595325,
      "opcao": "Combo",
      "id_produto": 2277723,
      "codigo": "",
      "produto": "Combo 06",
      "id_produto_2": null,
      "codigo_2": "",
      "produto_2": null,
      "obs": "",
      "valor": 42.99,
      "quantidade": 1,
      "adicionais": []
    }
  ],
  "usuario": {
    "id": "b1a2ae16831eb2a4",
    "nome": "João Gabriel Salvi Martins",
    "tel1": "35991679759"
  },
  "endereco": {
    "id": 1035235,
    "uf": "MG",
    "cidade": "Andradas",
    "bairro": "Alto Alegre",
    "rua": "Étore Trevisan",
    "num": "45",
    "complemento": "",
    "ponto_referencia": "morro da cava. Próximo ao bar bressanin, desce o morro primeira casa a esquerda."
  }
}
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "gmb_link", "uairangoEstablishmentId", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt", "ifoodClientId", "ifoodClientSecret", "ifoodAuthVerifier", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt", "franchisorId", "plan", "planExpiresAt", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."uairangoEstablishmentId" = '4659';
[UaiRango Webhook] Tenant encontrado: eb629ea8-7d69-47a1-b1f1-f9dcb33475f4 para o pedido ABD35B312
Executing (default): SELECT "id", "tenantId", "name", "email", "phone", "birthDate", "respondentSessionId", "gender", "createdAt", "updatedAt" FROM "clients" AS "Client" WHERE "Client"."phone" = '35991679759' AND "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
[UaiRango Webhook] Cliente existente encontrado: 64ac41d3-c3b6-49a1-8211-8776bbd2bccd para o pedido ABD35B312
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."platform" = 'UaiRango' AND "DeliveryOrder"."orderIdPlatform" = 'ABD35B312';
Executing (default): INSERT INTO "delivery_orders" ("id","platform","orderIdPlatform","totalAmount","orderDate","payload","clientId","tenantId","surveyStatus","createdAt","updatedAt") VALUES ($1,$2,$3,$4,$5,$6,$7,$8,$9,$10,$11) RETURNING "id","platform","orderIdPlatform","totalAmount","orderDate","payload","clientId","tenantId","surveyStatus","surveyScheduledAt","surveySentAt","createdAt","updatedAt";
[UaiRango Webhook] DeliveryOrder criado: 212421ed-5082-422b-9436-72e32d766327 para o pedido ABD35B312
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "postSaleDelayMinutes", "postSaleMessageTemplate", "postSaleSurveyId", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
Executing (default): UPDATE "delivery_orders" SET "surveyStatus"=$1,"surveyScheduledAt"=$2,"updatedAt"=$3 WHERE "id" = $4
Pesquisa agendada para o pedido 212421ed-5082-422b-9436-72e32d766327. Delay: 90 min. Envio em: Sat Feb 07 2026 00:05:01 GMT+0000 (Coordinated Universal Time)
[UaiRango Webhook] Pesquisa de satisfação agendada para cliente 64ac41d3-c3b6-49a1-8211-8776bbd2bccd, pedido 212421ed-5082-422b-9436-72e32d766327.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 22:36:00.047 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 22:37:00.049 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 22:38:00.026 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 22:39:00.033 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[Delivery Much Job] Starting Polling...
[iFood Job] Starting Polling...
[CAMPAIGN_MONITOR] Iniciando verificação de campanhas pausadas...
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."status" = 'paused';
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
[CAMPAIGN_MONITOR] Nenhuma campanha pausada encontrada.
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 22:40:00.088 +00:00' LIMIT 50;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 22:41:00.032 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 22:42:00.031 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 22:43:00.025 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 22:44:00.043 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[Delivery Much Job] Starting Polling...
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 22:45:00.071 +00:00' LIMIT 50;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 22:46:00.025 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 22:47:00.029 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 22:48:00.031 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 22:49:00.033 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[Delivery Much Job] Starting Polling...
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[iFood Job] Starting Polling...
[CAMPAIGN_MONITOR] Iniciando verificação de campanhas pausadas...
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."status" = 'paused';
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 22:50:00.093 +00:00' LIMIT 50;
[CAMPAIGN_MONITOR] Nenhuma campanha pausada encontrada.
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 22:51:00.028 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 22:52:00.027 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 22:53:00.036 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 22:54:00.021 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
[Delivery Much Job] Starting Polling...
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 22:55:00.062 +00:00' LIMIT 50;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 22:56:00.021 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 22:57:00.026 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 22:58:00.037 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 22:59:00.059 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[Delivery Much Job] Starting Polling...
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[CAMPAIGN_MONITOR] Iniciando verificação de campanhas pausadas...
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."status" = 'paused';
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 23:00:00.083 +00:00' LIMIT 50;
[CAMPAIGN_MONITOR] Nenhuma campanha pausada encontrada.
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 23:01:00.035 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 23:02:00.039 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 23:03:00.056 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 23:04:00.034 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[Delivery Much Job] Starting Polling...
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 23:05:00.068 +00:00' LIMIT 50;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 23:06:00.048 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 23:07:00.033 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 23:08:00.043 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "Pesquisa"."id", "Pesquisa"."title", "Pesquisa"."description", "Pesquisa"."createdAt", "Pesquisa"."updatedAt", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."status", "Pesquisa"."recompensaId", "Pesquisa"."roletaId", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."text" AS "perguntas.text", "perguntas"."options" AS "perguntas.options", "perguntas"."order" AS "perguntas.order", "perguntas"."required" AS "perguntas.required", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."description" AS "tenant.description", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "roleta"."id" AS "roleta.id", "roleta"."nome" AS "roleta.nome", "roleta"."descricao" AS "roleta.descricao", "roleta"."active" AS "roleta.active" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" LEFT OUTER JOIN "tenants" AS "tenant" ON "Pesquisa"."tenantId" = "tenant"."id" LEFT OUTER JOIN "roletas" AS "roleta" ON "Pesquisa"."roletaId" = "roleta"."id" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (default): SELECT "id", "name" FROM "atendentes" AS "Atendente" WHERE "Atendente"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Atendente"."status" = 'active' ORDER BY "Atendente"."name" ASC;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 23:09:00.028 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "askForAttendant" FROM "pesquisas" AS "Pesquisa" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (default): SELECT "Pesquisa"."id", "Pesquisa"."title", "Pesquisa"."description", "Pesquisa"."createdAt", "Pesquisa"."updatedAt", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."status", "Pesquisa"."recompensaId", "Pesquisa"."roletaId", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."text" AS "perguntas.text", "perguntas"."options" AS "perguntas.options", "perguntas"."order" AS "perguntas.order", "perguntas"."required" AS "perguntas.required", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."description" AS "tenant.description", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "roleta"."id" AS "roleta.id", "roleta"."nome" AS "roleta.nome", "roleta"."descricao" AS "roleta.descricao", "roleta"."active" AS "roleta.active" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" LEFT OUTER JOIN "tenants" AS "tenant" ON "Pesquisa"."tenantId" = "tenant"."id" LEFT OUTER JOIN "roletas" AS "roleta" ON "Pesquisa"."roletaId" = "roleta"."id" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (581da58b-1cfc-4931-a8b0-564bfba4ee20): SELECT "Pesquisa"."id", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."title", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."options" AS "perguntas.options", "perguntas"."required" AS "perguntas.required", "perguntas"."text" AS "perguntas.text" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (581da58b-1cfc-4931-a8b0-564bfba4ee20): INSERT INTO "respostas" ("id","perguntaId","pesquisaId","tenantId","atendenteId","respondentSessionId","ratingValue","textValue","createdAt","updatedAt") VALUES ('281522da-a3ee-47f3-bdce-cb8cb27e0a68','19f1cec2-90b3-4223-b412-3c1d860e20a6','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','67781806-855c-4e48-bf39-d1305176420a','10d12f7d-4480-4209-8698-4913d868a47e',6,NULL,'2026-02-06 23:09:40.532 +00:00','2026-02-06 23:09:40.532 +00:00'),('fcbf8ba0-0911-4bd4-83d6-4ac301962f85','305b7330-b4c3-41b1-8fd1-0f3f91e7e936','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','67781806-855c-4e48-bf39-d1305176420a','10d12f7d-4480-4209-8698-4913d868a47e',3,NULL,'2026-02-06 23:09:40.532 +00:00','2026-02-06 23:09:40.532 +00:00'),('59207b8d-abb0-4b80-9f89-dc641296476e','d91a3ab3-65e2-40d0-acfa-35133ed4a7d4','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','67781806-855c-4e48-bf39-d1305176420a','10d12f7d-4480-4209-8698-4913d868a47e',3,NULL,'2026-02-06 23:09:40.532 +00:00','2026-02-06 23:09:40.532 +00:00'),('487e959b-157d-4bf4-aab6-4160f2ec0317','635f7a66-33fd-40f4-89b4-3c7c83f003aa','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','67781806-855c-4e48-bf39-d1305176420a','10d12f7d-4480-4209-8698-4913d868a47e',3,NULL,'2026-02-06 23:09:40.532 +00:00','2026-02-06 23:09:40.532 +00:00'),('35ca185b-489c-40e2-801b-4397a6599f05','9e5e541a-1930-47da-81a5-e53892d8337a','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','67781806-855c-4e48-bf39-d1305176420a','10d12f7d-4480-4209-8698-4913d868a47e',3,NULL,'2026-02-06 23:09:40.532 +00:00','2026-02-06 23:09:40.532 +00:00'),('07754c2a-e45c-4801-88c8-471bc35d5cfe','2cbd96fb-faa2-495d-99dd-c57af8623c9d','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','67781806-855c-4e48-bf39-d1305176420a','10d12f7d-4480-4209-8698-4913d868a47e',3,NULL,'2026-02-06 23:09:40.532 +00:00','2026-02-06 23:09:40.532 +00:00'),('6fc2375c-1d03-4a42-9dd0-a999d84259a0','89c2b3ed-7104-4a41-991d-565b70294215','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','67781806-855c-4e48-bf39-d1305176420a','10d12f7d-4480-4209-8698-4913d868a47e',3,NULL,'2026-02-06 23:09:40.532 +00:00','2026-02-06 23:09:40.532 +00:00') RETURNING "id","perguntaId","pesquisaId","tenantId","atendenteId","respondentSessionId","ratingValue","textValue","selectedOption","createdAt","updatedAt";
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "postSaleDelayMinutes", "postSaleMessageTemplate", "postSaleSurveyId", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "postSaleDelayMinutes", "postSaleMessageTemplate", "postSaleSurveyId", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "postSaleDelayMinutes", "postSaleMessageTemplate", "postSaleSurveyId", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
[WhatsappService] Resposta da API de status da instância: {
  "instance": {
    "instanceName": "roma-pizzaria--chopperia",
    "state": "close"
  }
}
Falha ao enviar notificação de detrator para o admin 5535991090766: Error: A instância do WhatsApp desta loja não está conectada.
    at getTenantWhatsappConfig (/usr/src/app/src/services/whatsappService.js:169:11)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async Object.sendTenantMessage (/usr/src/app/src/services/whatsappService.js:176:18)
    at async /usr/src/app/src/repositories/publicSurveyRepository.js:325:19
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "postSaleDelayMinutes", "postSaleMessageTemplate", "postSaleSurveyId", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "postSaleDelayMinutes", "postSaleMessageTemplate", "postSaleSurveyId", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
[WhatsappService] Resposta da API de status da instância: {
  "instance": {
    "instanceName": "roma-pizzaria--chopperia",
    "state": "close"
  }
}
Falha ao enviar notificação de detrator para o admin 553591523297: Error: A instância do WhatsApp desta loja não está conectada.
    at getTenantWhatsappConfig (/usr/src/app/src/services/whatsappService.js:169:11)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async Object.sendTenantMessage (/usr/src/app/src/services/whatsappService.js:176:18)
    at async /usr/src/app/src/repositories/publicSurveyRepository.js:325:19
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "postSaleDelayMinutes", "postSaleMessageTemplate", "postSaleSurveyId", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "postSaleDelayMinutes", "postSaleMessageTemplate", "postSaleSurveyId", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
[WhatsappService] Resposta da API de status da instância: {
  "instance": {
    "instanceName": "roma-pizzaria--chopperia",
    "state": "close"
  }
}
Falha ao enviar notificação de detrator para o admin 553598374007: Error: A instância do WhatsApp desta loja não está conectada.
    at getTenantWhatsappConfig (/usr/src/app/src/services/whatsappService.js:169:11)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async Object.sendTenantMessage (/usr/src/app/src/services/whatsappService.js:176:18)
    at async /usr/src/app/src/repositories/publicSurveyRepository.js:325:19
Executing (default): SELECT "id", "name", "logoUrl", "primaryColor", "secondaryColor", "description" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT "id", "name", "logoUrl", "primaryColor", "secondaryColor", "description" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
[CAMPAIGN_MONITOR] Iniciando verificação de campanhas pausadas...
[iFood Job] Starting Polling...
[Delivery Much Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 23:10:00.085 +00:00' LIMIT 50;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."status" = 'paused';
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[CAMPAIGN_MONITOR] Nenhuma campanha pausada encontrada.
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
[SENDER_MONITOR] Verificação de status concluída.
Executing (default): SELECT "tenantId" FROM "respostas" AS "Resposta" WHERE "Resposta"."respondentSessionId" = '10d12f7d-4480-4209-8698-4913d868a47e' LIMIT 1;
Executing (a588a1d4-606e-4ec3-b199-0985b0c4ffd3): SELECT "id", "tenantId", "name", "email", "phone", "birthDate", "respondentSessionId", "gender", "createdAt", "updatedAt" FROM "clients" AS "Client" WHERE "Client"."email" = 'vs369969@gmail.com' AND "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
Executing (a588a1d4-606e-4ec3-b199-0985b0c4ffd3): SELECT "id", "tenantId", "name", "email", "phone", "birthDate", "respondentSessionId", "gender", "createdAt", "updatedAt" FROM "clients" AS "Client" WHERE "Client"."phone" = '(35) 99739-3596' AND "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
Executing (a588a1d4-606e-4ec3-b199-0985b0c4ffd3): SELECT "id", "tenantId", "name", "email", "phone", "birthDate", "respondentSessionId", "gender", "createdAt", "updatedAt" FROM "clients" AS "Client" WHERE "Client"."respondentSessionId" = '10d12f7d-4480-4209-8698-4913d868a47e';
Executing (a588a1d4-606e-4ec3-b199-0985b0c4ffd3): INSERT INTO "clients" ("id","tenantId","name","email","phone","birthDate","respondentSessionId","gender","createdAt","updatedAt") VALUES ($1,$2,$3,$4,$5,$6,$7,$8,$9,$10) RETURNING "id","tenantId","name","email","phone","birthDate","respondentSessionId","gender","createdAt","updatedAt";
Executing (a588a1d4-606e-4ec3-b199-0985b0c4ffd3): SELECT "pesquisaId", "tenantId" FROM "respostas" AS "Resposta" WHERE "Resposta"."respondentSessionId" = '10d12f7d-4480-4209-8698-4913d868a47e' LIMIT 1;
Executing (a588a1d4-606e-4ec3-b199-0985b0c4ffd3): SELECT "recompensaId" FROM "pesquisas" AS "Pesquisa" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (default): SELECT "id", "name", "logoUrl", "primaryColor", "secondaryColor", "description" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT "Pesquisa"."id", "Pesquisa"."title", "Pesquisa"."description", "Pesquisa"."createdAt", "Pesquisa"."updatedAt", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."status", "Pesquisa"."recompensaId", "Pesquisa"."roletaId", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."text" AS "perguntas.text", "perguntas"."options" AS "perguntas.options", "perguntas"."order" AS "perguntas.order", "perguntas"."required" AS "perguntas.required", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."description" AS "tenant.description", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "roleta"."id" AS "roleta.id", "roleta"."nome" AS "roleta.nome", "roleta"."descricao" AS "roleta.descricao", "roleta"."active" AS "roleta.active" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" LEFT OUTER JOIN "tenants" AS "tenant" ON "Pesquisa"."tenantId" = "tenant"."id" LEFT OUTER JOIN "roletas" AS "roleta" ON "Pesquisa"."roletaId" = "roleta"."id" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (default): SELECT "id", "tenantId", "creatorId", "title", "description", "startDate", "endDate", "isOpen", "askForAttendant", "status", "expectedRespondents", "dueDate", "recompensaId", "roletaId", "roletaPrizeMessage", "createdAt", "updatedAt" FROM "pesquisas" AS "Pesquisa" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (default): SELECT "id", "pesquisaId", "campanhaId", "tenantId", "recompensaId", "codigo", "clienteId", "dataGeracao", "dataUtilizacao", "dataValidade", "status", "ultimoContato", "createdAt", "updatedAt" FROM "cupons" AS "Cupom" WHERE "Cupom"."clienteId" = '9e29be6b-bc8c-4bd1-83c4-7f7531aa6032' AND "Cupom"."pesquisaId" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4' ORDER BY "Cupom"."dataGeracao" DESC LIMIT 1;
Executing (default): SELECT "RoletaPremio"."id", "RoletaPremio"."tenantId", "RoletaPremio"."nome", "RoletaPremio"."descricao", "RoletaPremio"."porcentagem", "RoletaPremio"."cor", "RoletaPremio"."recompensaId", "RoletaPremio"."roletaId", "RoletaPremio"."imageUrl", "RoletaPremio"."active", "RoletaPremio"."isNoPrizeOption", "RoletaPremio"."createdAt", "RoletaPremio"."updatedAt", "recompensa"."id" AS "recompensa.id", "recompensa"."tenantId" AS "recompensa.tenantId", "recompensa"."name" AS "recompensa.name", "recompensa"."description" AS "recompensa.description", "recompensa"."conditionDescription" AS "recompensa.conditionDescription", "recompensa"."pointsRequired" AS "recompensa.pointsRequired", "recompensa"."type" AS "recompensa.type", "recompensa"."value" AS "recompensa.value", "recompensa"."imageUrl" AS "recompensa.imageUrl", "recompensa"."active" AS "recompensa.active", "recompensa"."createdAt" AS "recompensa.createdAt", "recompensa"."updatedAt" AS "recompensa.updatedAt" FROM "roleta_premios" AS "RoletaPremio" LEFT OUTER JOIN "recompensas" AS "recompensa" ON "RoletaPremio"."recompensaId" = "recompensa"."id" WHERE "RoletaPremio"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "RoletaPremio"."roletaId" = 'f4da8c53-db4f-4452-8c7d-505be5e99657' ORDER BY "RoletaPremio"."nome" ASC;
Executing (default): SELECT "id", "tenantId", "creatorId", "title", "description", "startDate", "endDate", "isOpen", "askForAttendant", "status", "expectedRespondents", "dueDate", "recompensaId", "roletaId", "roletaPrizeMessage", "createdAt", "updatedAt" FROM "pesquisas" AS "Pesquisa" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (default): SELECT "id", "tenantId", "name", "email", "phone", "birthDate", "respondentSessionId", "gender", "createdAt", "updatedAt" FROM "clients" AS "Client" WHERE "Client"."id" = '9e29be6b-bc8c-4bd1-83c4-7f7531aa6032';
Executing (default): SELECT "id", "pesquisaId", "campanhaId", "tenantId", "recompensaId", "codigo", "clienteId", "dataGeracao", "dataUtilizacao", "dataValidade", "status", "ultimoContato", "createdAt", "updatedAt" FROM "cupons" AS "Cupom" WHERE "Cupom"."clienteId" = '9e29be6b-bc8c-4bd1-83c4-7f7531aa6032' AND "Cupom"."pesquisaId" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4' ORDER BY "Cupom"."dataGeracao" DESC LIMIT 1;
Executing (default): SELECT "RoletaPremio"."id", "RoletaPremio"."tenantId", "RoletaPremio"."nome", "RoletaPremio"."descricao", "RoletaPremio"."porcentagem", "RoletaPremio"."cor", "RoletaPremio"."recompensaId", "RoletaPremio"."roletaId", "RoletaPremio"."imageUrl", "RoletaPremio"."active", "RoletaPremio"."isNoPrizeOption", "RoletaPremio"."createdAt", "RoletaPremio"."updatedAt", "recompensa"."id" AS "recompensa.id", "recompensa"."tenantId" AS "recompensa.tenantId", "recompensa"."name" AS "recompensa.name", "recompensa"."description" AS "recompensa.description", "recompensa"."conditionDescription" AS "recompensa.conditionDescription", "recompensa"."pointsRequired" AS "recompensa.pointsRequired", "recompensa"."type" AS "recompensa.type", "recompensa"."value" AS "recompensa.value", "recompensa"."imageUrl" AS "recompensa.imageUrl", "recompensa"."active" AS "recompensa.active", "recompensa"."createdAt" AS "recompensa.createdAt", "recompensa"."updatedAt" AS "recompensa.updatedAt" FROM "roleta_premios" AS "RoletaPremio" LEFT OUTER JOIN "recompensas" AS "recompensa" ON "RoletaPremio"."recompensaId" = "recompensa"."id" WHERE "RoletaPremio"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "RoletaPremio"."roletaId" = 'f4da8c53-db4f-4452-8c7d-505be5e99657' ORDER BY "RoletaPremio"."nome" ASC;
Executing (default): INSERT INTO "cupons" ("id","pesquisaId","tenantId","recompensaId","codigo","clienteId","dataGeracao","dataValidade","status","createdAt","updatedAt") VALUES ($1,$2,$3,$4,$5,$6,$7,$8,$9,$10,$11) RETURNING "id","pesquisaId","campanhaId","tenantId","recompensaId","codigo","clienteId","dataGeracao","dataUtilizacao","dataValidade","status","ultimoContato","createdAt","updatedAt";
[RoletaController] Iniciando envio de mensagem de prêmio para o tenant eb629ea8-7d69-47a1-b1f1-f9dcb33475f4.
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "postSaleDelayMinutes", "postSaleMessageTemplate", "postSaleSurveyId", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
[RoletaController] Config do WhatsApp para o tenant eb629ea8-7d69-47a1-b1f1-f9dcb33475f4: {
  apiKey: '9df82dcbee60ce08f6ca93aa4024ca6c',
  instanceApiKey: '1EF60F67-BF10-4F82-9BB8-80124CCB17AC',
  id: 'b9d07194-31e9-49e7-bdb8-55d6b3596ef9',
  url: 'https://evolution2.towersfy.com',
  instanceName: 'roma-pizzaria--chopperia',
  instanceStatus: 'disconnected',
  tenantId: 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4',
  sendPrizeMessage: true,
  prizeMessageTemplate: '🎰 *UAAAU, {{cliente}}!* 😍  \n' +
    'Você acabou de girar a *Roleta Premiada da Roma* e saiu com sorte grande! 🍀🔥 \n' +
    '\n' +
    'Você recebeu para usar na sua proxima visita:\n' +
    '🎁 *Prêmio:* *{{premio}}*\n' +
    'Pra resgatar, é só mostrar o cupom 👉 *{{cupom}}* aqui no salão da **Roma Pizzaria & Chopperia** 🍕✨  \n' +
    '\n' +
    'Vem curtir seu prêmio com a galera e comemorar essa sorte toda! 🎉  \n' +
    '📍 *Roma Pizzaria* — diversão, sabor e prêmios te esperando! 😋\n',
  dailyReportEnabled: true,
  reportPhoneNumbers: '5535991090766,553591523297,553598374007',
  weeklyReportEnabled: true,
  monthlyReportEnabled: true,
  birthdayAutomationEnabled: true,
  birthdayMessageTemplate: '🎉 *Seu aniversário tá chegando, {{cliente}}!* 🥳  \n' +
    'E a *Roma Pizzaria* já separou um presente de respeito pra você 🍕🔥  \n' +
    '\n' +
    '🎁 *RODIZIO GRÁTIS* pra você comemorar do jeito certo!  \n' +
    'É só vir até o salão, aproveitar o rodízio e apresentar o cupom 👉 *{{cupom}}* \n' +
    '\n' +
    '📅 Valido para *semana do seu aniversário*,  \n' +
    'lembrando que o *rodízio acontece toda quarta, quinta e sexta* 😉  \n' +
    '\n' +
    '📍 *Válido exclusivamente no salão*  \n' +
    'Chama a galera, escolhe o dia e vem aproveitar! 🎂🍻  \n' +
    '\n' +
    '**Roma Pizzaria** 😍🍕',
  birthdayDaysBefore: 7,
  birthdayRewardType: 'recompensa',
  birthdayRewardId: '17ea8117-07e1-4fca-944b-8454f78079ad',
  birthdayCouponValidityDays: 30,
  sendDetractorMessageToClient: true,
  detractorMessageTemplate: 'Olá, {{cliente}}! 👋\n' +
    '\n' +
    'Recebemos sua avaliação com a nota **{{nota}}** e queremos agradecer por compartilhar sua experiência.  \n' +
    'Lamentamos muito que algo não tenha saído como esperado. 😔\n' +
    '\n' +
    'Seu comentário: _"{{comentario}}"_\n' +
    '\n' +
    'Estamos aqui para resolver isso o mais rápido possível.  \n' +
    'Poderia nos contar um pouco mais sobre o que aconteceu? Seu retorno é essencial para que possamos melhorar e garantir uma próxima experiência muito melhor. 🙏\n' +
    '\n' +
    'Obrigado por nos ajudar a evoluir!  \n' +
    'Nossa equipe está à disposição.\n',
  notifyDetractorToOwner: true,
  detractorOwnerMessageTemplate: '## 🚨 **Alerta de Detrator**\n' +
    '\n' +
    'O cliente **{{cliente}}** registrou uma avaliação **baixa**:\n' +
    '\n' +
    '- **Nota:** **{{nota}}**\n' +
    '- **Comentário:** _"{{comentario}}"_',
  detractorOwnerPhoneNumbers: '5535991090766,553591523297,553598374007',
  postSaleDelayMinutes: 90,
  postSaleMessageTemplate: '🍕 **Olá, {{cliente}}!**  \n' +
    '\n' +
    'Esperamos que você tenha curtido seu pedido da **Roma Pizzaria** 😍  \n' +
    '\n' +
    'Sua opinião é *muito importante* pra gente — é com ela que conseguimos melhorar sabores, atendimento e experiência a cada pedido.\n' +
    '\n' +
    '📝 **Leva menos de 1 minuto:**  \n' +
    '👉 {{link_pesquisa}}\n' +
    '\n' +
    'Como agradecimento, você pode receber **vantagens especiais** nos próximos pedidos 😉\n' +
    '\n' +
    'Obrigado por escolher a Roma ❤️  \n' +
    '*Tradição, sabor e respeito por cada cliente.*',
  postSaleSurveyId: '362bd09a-762a-49d4-9651-415955567e6a',
  createdAt: 2025-11-28T21:25:29.661Z,
  updatedAt: 2026-02-05T22:49:26.315Z
}
[RoletaController] Todas as condições para enviar a mensagem de prêmio foram atendidas para o tenant eb629ea8-7d69-47a1-b1f1-f9dcb33475f4.
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "postSaleDelayMinutes", "postSaleMessageTemplate", "postSaleSurveyId", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "postSaleDelayMinutes", "postSaleMessageTemplate", "postSaleSurveyId", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
[WhatsappService] Resposta da API de status da instância: {
  "instance": {
    "instanceName": "roma-pizzaria--chopperia",
    "state": "close"
  }
}
[RoletaController] Falha ao tentar enviar mensagem de prêmio via WhatsApp para o tenant eb629ea8-7d69-47a1-b1f1-f9dcb33475f4. Erro: A instância do WhatsApp desta loja não está conectada.
Executing (default): SELECT "id", "name", "logoUrl", "primaryColor", "secondaryColor", "description" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "Pesquisa"."id", "Pesquisa"."title", "Pesquisa"."description", "Pesquisa"."createdAt", "Pesquisa"."updatedAt", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."status", "Pesquisa"."recompensaId", "Pesquisa"."roletaId", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."text" AS "perguntas.text", "perguntas"."options" AS "perguntas.options", "perguntas"."order" AS "perguntas.order", "perguntas"."required" AS "perguntas.required", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."description" AS "tenant.description", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "roleta"."id" AS "roleta.id", "roleta"."nome" AS "roleta.nome", "roleta"."descricao" AS "roleta.descricao", "roleta"."active" AS "roleta.active" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" LEFT OUTER JOIN "tenants" AS "tenant" ON "Pesquisa"."tenantId" = "tenant"."id" LEFT OUTER JOIN "roletas" AS "roleta" ON "Pesquisa"."roletaId" = "roleta"."id" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (default): SELECT "id", "name" FROM "atendentes" AS "Atendente" WHERE "Atendente"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Atendente"."status" = 'active' ORDER BY "Atendente"."name" ASC;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 23:11:00.034 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "name", "logoUrl", "primaryColor", "secondaryColor", "description" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT "Pesquisa"."id", "Pesquisa"."title", "Pesquisa"."description", "Pesquisa"."createdAt", "Pesquisa"."updatedAt", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."status", "Pesquisa"."recompensaId", "Pesquisa"."roletaId", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."text" AS "perguntas.text", "perguntas"."options" AS "perguntas.options", "perguntas"."order" AS "perguntas.order", "perguntas"."required" AS "perguntas.required", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."description" AS "tenant.description", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "roleta"."id" AS "roleta.id", "roleta"."nome" AS "roleta.nome", "roleta"."descricao" AS "roleta.descricao", "roleta"."active" AS "roleta.active" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" LEFT OUTER JOIN "tenants" AS "tenant" ON "Pesquisa"."tenantId" = "tenant"."id" LEFT OUTER JOIN "roletas" AS "roleta" ON "Pesquisa"."roletaId" = "roleta"."id" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (default): SELECT "id", "tenantId", "creatorId", "title", "description", "startDate", "endDate", "isOpen", "askForAttendant", "status", "expectedRespondents", "dueDate", "recompensaId", "roletaId", "roletaPrizeMessage", "createdAt", "updatedAt" FROM "pesquisas" AS "Pesquisa" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (default): SELECT "id", "pesquisaId", "campanhaId", "tenantId", "recompensaId", "codigo", "clienteId", "dataGeracao", "dataUtilizacao", "dataValidade", "status", "ultimoContato", "createdAt", "updatedAt" FROM "cupons" AS "Cupom" WHERE "Cupom"."clienteId" = '9e29be6b-bc8c-4bd1-83c4-7f7531aa6032' AND "Cupom"."pesquisaId" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4' ORDER BY "Cupom"."dataGeracao" DESC LIMIT 1;
Executing (default): SELECT "RoletaPremio"."id", "RoletaPremio"."tenantId", "RoletaPremio"."nome", "RoletaPremio"."descricao", "RoletaPremio"."porcentagem", "RoletaPremio"."cor", "RoletaPremio"."recompensaId", "RoletaPremio"."roletaId", "RoletaPremio"."imageUrl", "RoletaPremio"."active", "RoletaPremio"."isNoPrizeOption", "RoletaPremio"."createdAt", "RoletaPremio"."updatedAt", "recompensa"."id" AS "recompensa.id", "recompensa"."tenantId" AS "recompensa.tenantId", "recompensa"."name" AS "recompensa.name", "recompensa"."description" AS "recompensa.description", "recompensa"."conditionDescription" AS "recompensa.conditionDescription", "recompensa"."pointsRequired" AS "recompensa.pointsRequired", "recompensa"."type" AS "recompensa.type", "recompensa"."value" AS "recompensa.value", "recompensa"."imageUrl" AS "recompensa.imageUrl", "recompensa"."active" AS "recompensa.active", "recompensa"."createdAt" AS "recompensa.createdAt", "recompensa"."updatedAt" AS "recompensa.updatedAt" FROM "roleta_premios" AS "RoletaPremio" LEFT OUTER JOIN "recompensas" AS "recompensa" ON "RoletaPremio"."recompensaId" = "recompensa"."id" WHERE "RoletaPremio"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "RoletaPremio"."roletaId" = 'f4da8c53-db4f-4452-8c7d-505be5e99657' ORDER BY "RoletaPremio"."nome" ASC;
Executing (default): SELECT "Pesquisa"."id", "Pesquisa"."title", "Pesquisa"."description", "Pesquisa"."createdAt", "Pesquisa"."updatedAt", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."status", "Pesquisa"."recompensaId", "Pesquisa"."roletaId", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."text" AS "perguntas.text", "perguntas"."options" AS "perguntas.options", "perguntas"."order" AS "perguntas.order", "perguntas"."required" AS "perguntas.required", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."description" AS "tenant.description", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "roleta"."id" AS "roleta.id", "roleta"."nome" AS "roleta.nome", "roleta"."descricao" AS "roleta.descricao", "roleta"."active" AS "roleta.active" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" LEFT OUTER JOIN "tenants" AS "tenant" ON "Pesquisa"."tenantId" = "tenant"."id" LEFT OUTER JOIN "roletas" AS "roleta" ON "Pesquisa"."roletaId" = "roleta"."id" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (default): SELECT "id", "name" FROM "atendentes" AS "Atendente" WHERE "Atendente"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Atendente"."status" = 'active' ORDER BY "Atendente"."name" ASC;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "askForAttendant" FROM "pesquisas" AS "Pesquisa" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (default): SELECT "Pesquisa"."id", "Pesquisa"."title", "Pesquisa"."description", "Pesquisa"."createdAt", "Pesquisa"."updatedAt", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."status", "Pesquisa"."recompensaId", "Pesquisa"."roletaId", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."text" AS "perguntas.text", "perguntas"."options" AS "perguntas.options", "perguntas"."order" AS "perguntas.order", "perguntas"."required" AS "perguntas.required", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."description" AS "tenant.description", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "roleta"."id" AS "roleta.id", "roleta"."nome" AS "roleta.nome", "roleta"."descricao" AS "roleta.descricao", "roleta"."active" AS "roleta.active" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" LEFT OUTER JOIN "tenants" AS "tenant" ON "Pesquisa"."tenantId" = "tenant"."id" LEFT OUTER JOIN "roletas" AS "roleta" ON "Pesquisa"."roletaId" = "roleta"."id" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (3e98f053-f212-402d-b430-f7f6b1c09d00): SELECT "Pesquisa"."id", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."title", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."options" AS "perguntas.options", "perguntas"."required" AS "perguntas.required", "perguntas"."text" AS "perguntas.text" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (3e98f053-f212-402d-b430-f7f6b1c09d00): INSERT INTO "respostas" ("id","perguntaId","pesquisaId","tenantId","atendenteId","respondentSessionId","ratingValue","textValue","createdAt","updatedAt") VALUES ('9b4186da-b65d-4e05-a541-731963049041','19f1cec2-90b3-4223-b412-3c1d860e20a6','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','67781806-855c-4e48-bf39-d1305176420a','9e57cf69-fa09-4f85-a78b-32e93f0d2824',6,NULL,'2026-02-06 23:11:37.986 +00:00','2026-02-06 23:11:37.986 +00:00'),('44631d94-a46d-4dbd-8318-7871434af601','305b7330-b4c3-41b1-8fd1-0f3f91e7e936','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','67781806-855c-4e48-bf39-d1305176420a','9e57cf69-fa09-4f85-a78b-32e93f0d2824',3,NULL,'2026-02-06 23:11:37.986 +00:00','2026-02-06 23:11:37.986 +00:00'),('b0b63155-0c82-4f0f-bca8-16e0b781c761','d91a3ab3-65e2-40d0-acfa-35133ed4a7d4','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','67781806-855c-4e48-bf39-d1305176420a','9e57cf69-fa09-4f85-a78b-32e93f0d2824',3,NULL,'2026-02-06 23:11:37.986 +00:00','2026-02-06 23:11:37.986 +00:00'),('b0735ab7-80d9-44d1-8be7-c08053d889b8','635f7a66-33fd-40f4-89b4-3c7c83f003aa','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','67781806-855c-4e48-bf39-d1305176420a','9e57cf69-fa09-4f85-a78b-32e93f0d2824',3,NULL,'2026-02-06 23:11:37.986 +00:00','2026-02-06 23:11:37.986 +00:00'),('3398f6be-6239-4268-8530-9438c4440652','9e5e541a-1930-47da-81a5-e53892d8337a','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','67781806-855c-4e48-bf39-d1305176420a','9e57cf69-fa09-4f85-a78b-32e93f0d2824',3,NULL,'2026-02-06 23:11:37.986 +00:00','2026-02-06 23:11:37.986 +00:00'),('e7c38a22-7191-4cfc-8d3e-5508facec493','2cbd96fb-faa2-495d-99dd-c57af8623c9d','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','67781806-855c-4e48-bf39-d1305176420a','9e57cf69-fa09-4f85-a78b-32e93f0d2824',3,NULL,'2026-02-06 23:11:37.986 +00:00','2026-02-06 23:11:37.986 +00:00'),('a336a37e-824e-4450-b131-8e8c8fd41f89','89c2b3ed-7104-4a41-991d-565b70294215','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','67781806-855c-4e48-bf39-d1305176420a','9e57cf69-fa09-4f85-a78b-32e93f0d2824',3,NULL,'2026-02-06 23:11:37.986 +00:00','2026-02-06 23:11:37.986 +00:00') RETURNING "id","perguntaId","pesquisaId","tenantId","atendenteId","respondentSessionId","ratingValue","textValue","selectedOption","createdAt","updatedAt";
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "postSaleDelayMinutes", "postSaleMessageTemplate", "postSaleSurveyId", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "postSaleDelayMinutes", "postSaleMessageTemplate", "postSaleSurveyId", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "postSaleDelayMinutes", "postSaleMessageTemplate", "postSaleSurveyId", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
[WhatsappService] Resposta da API de status da instância: {
  "instance": {
    "instanceName": "roma-pizzaria--chopperia",
    "state": "close"
  }
}
Falha ao enviar notificação de detrator para o admin 5535991090766: Error: A instância do WhatsApp desta loja não está conectada.
    at getTenantWhatsappConfig (/usr/src/app/src/services/whatsappService.js:169:11)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async Object.sendTenantMessage (/usr/src/app/src/services/whatsappService.js:176:18)
    at async /usr/src/app/src/repositories/publicSurveyRepository.js:325:19
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "postSaleDelayMinutes", "postSaleMessageTemplate", "postSaleSurveyId", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "postSaleDelayMinutes", "postSaleMessageTemplate", "postSaleSurveyId", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
[WhatsappService] Resposta da API de status da instância: {
  "instance": {
    "instanceName": "roma-pizzaria--chopperia",
    "state": "close"
  }
}
Falha ao enviar notificação de detrator para o admin 553591523297: Error: A instância do WhatsApp desta loja não está conectada.
    at getTenantWhatsappConfig (/usr/src/app/src/services/whatsappService.js:169:11)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async Object.sendTenantMessage (/usr/src/app/src/services/whatsappService.js:176:18)
    at async /usr/src/app/src/repositories/publicSurveyRepository.js:325:19
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "postSaleDelayMinutes", "postSaleMessageTemplate", "postSaleSurveyId", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "postSaleDelayMinutes", "postSaleMessageTemplate", "postSaleSurveyId", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
[WhatsappService] Resposta da API de status da instância: {
  "instance": {
    "instanceName": "roma-pizzaria--chopperia",
    "state": "close"
  }
}
Falha ao enviar notificação de detrator para o admin 553598374007: Error: A instância do WhatsApp desta loja não está conectada.
    at getTenantWhatsappConfig (/usr/src/app/src/services/whatsappService.js:169:11)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async Object.sendTenantMessage (/usr/src/app/src/services/whatsappService.js:176:18)
    at async /usr/src/app/src/repositories/publicSurveyRepository.js:325:19
Executing (default): SELECT "Pesquisa"."id", "Pesquisa"."title", "Pesquisa"."description", "Pesquisa"."createdAt", "Pesquisa"."updatedAt", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."status", "Pesquisa"."recompensaId", "Pesquisa"."roletaId", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."text" AS "perguntas.text", "perguntas"."options" AS "perguntas.options", "perguntas"."order" AS "perguntas.order", "perguntas"."required" AS "perguntas.required", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."description" AS "tenant.description", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "roleta"."id" AS "roleta.id", "roleta"."nome" AS "roleta.nome", "roleta"."descricao" AS "roleta.descricao", "roleta"."active" AS "roleta.active" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" LEFT OUTER JOIN "tenants" AS "tenant" ON "Pesquisa"."tenantId" = "tenant"."id" LEFT OUTER JOIN "roletas" AS "roleta" ON "Pesquisa"."roletaId" = "roleta"."id" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (default): SELECT "id", "name", "logoUrl", "primaryColor", "secondaryColor", "description" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT "id", "name", "logoUrl", "primaryColor", "secondaryColor", "description" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 23:12:00.030 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "tenantId" FROM "respostas" AS "Resposta" WHERE "Resposta"."respondentSessionId" = '9e57cf69-fa09-4f85-a78b-32e93f0d2824' LIMIT 1;
Executing (aec057e2-f522-4637-ae80-9767352150ae): SELECT "id", "tenantId", "name", "email", "phone", "birthDate", "respondentSessionId", "gender", "createdAt", "updatedAt" FROM "clients" AS "Client" WHERE "Client"."email" = 'kingharlequinharlequin@gmail.com' AND "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
Executing (aec057e2-f522-4637-ae80-9767352150ae): SELECT "id", "tenantId", "name", "email", "phone", "birthDate", "respondentSessionId", "gender", "createdAt", "updatedAt" FROM "clients" AS "Client" WHERE "Client"."phone" = '(35) 99889-2973' AND "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
Executing (aec057e2-f522-4637-ae80-9767352150ae): SELECT "id", "tenantId", "name", "email", "phone", "birthDate", "respondentSessionId", "gender", "createdAt", "updatedAt" FROM "clients" AS "Client" WHERE "Client"."respondentSessionId" = '9e57cf69-fa09-4f85-a78b-32e93f0d2824';
Executing (aec057e2-f522-4637-ae80-9767352150ae): INSERT INTO "clients" ("id","tenantId","name","email","phone","birthDate","respondentSessionId","gender","createdAt","updatedAt") VALUES ($1,$2,$3,$4,$5,$6,$7,$8,$9,$10) RETURNING "id","tenantId","name","email","phone","birthDate","respondentSessionId","gender","createdAt","updatedAt";
Executing (aec057e2-f522-4637-ae80-9767352150ae): SELECT "pesquisaId", "tenantId" FROM "respostas" AS "Resposta" WHERE "Resposta"."respondentSessionId" = '9e57cf69-fa09-4f85-a78b-32e93f0d2824' LIMIT 1;
Executing (aec057e2-f522-4637-ae80-9767352150ae): SELECT "recompensaId" FROM "pesquisas" AS "Pesquisa" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (default): SELECT "Pesquisa"."id", "Pesquisa"."title", "Pesquisa"."description", "Pesquisa"."createdAt", "Pesquisa"."updatedAt", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."status", "Pesquisa"."recompensaId", "Pesquisa"."roletaId", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."text" AS "perguntas.text", "perguntas"."options" AS "perguntas.options", "perguntas"."order" AS "perguntas.order", "perguntas"."required" AS "perguntas.required", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."description" AS "tenant.description", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "roleta"."id" AS "roleta.id", "roleta"."nome" AS "roleta.nome", "roleta"."descricao" AS "roleta.descricao", "roleta"."active" AS "roleta.active" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" LEFT OUTER JOIN "tenants" AS "tenant" ON "Pesquisa"."tenantId" = "tenant"."id" LEFT OUTER JOIN "roletas" AS "roleta" ON "Pesquisa"."roletaId" = "roleta"."id" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (default): SELECT "id", "name", "logoUrl", "primaryColor", "secondaryColor", "description" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT "id", "tenantId", "creatorId", "title", "description", "startDate", "endDate", "isOpen", "askForAttendant", "status", "expectedRespondents", "dueDate", "recompensaId", "roletaId", "roletaPrizeMessage", "createdAt", "updatedAt" FROM "pesquisas" AS "Pesquisa" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (default): SELECT "id", "pesquisaId", "campanhaId", "tenantId", "recompensaId", "codigo", "clienteId", "dataGeracao", "dataUtilizacao", "dataValidade", "status", "ultimoContato", "createdAt", "updatedAt" FROM "cupons" AS "Cupom" WHERE "Cupom"."clienteId" = '7afc43a6-3305-444e-9efd-b7e5b3e89c56' AND "Cupom"."pesquisaId" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4' ORDER BY "Cupom"."dataGeracao" DESC LIMIT 1;
Executing (default): SELECT "RoletaPremio"."id", "RoletaPremio"."tenantId", "RoletaPremio"."nome", "RoletaPremio"."descricao", "RoletaPremio"."porcentagem", "RoletaPremio"."cor", "RoletaPremio"."recompensaId", "RoletaPremio"."roletaId", "RoletaPremio"."imageUrl", "RoletaPremio"."active", "RoletaPremio"."isNoPrizeOption", "RoletaPremio"."createdAt", "RoletaPremio"."updatedAt", "recompensa"."id" AS "recompensa.id", "recompensa"."tenantId" AS "recompensa.tenantId", "recompensa"."name" AS "recompensa.name", "recompensa"."description" AS "recompensa.description", "recompensa"."conditionDescription" AS "recompensa.conditionDescription", "recompensa"."pointsRequired" AS "recompensa.pointsRequired", "recompensa"."type" AS "recompensa.type", "recompensa"."value" AS "recompensa.value", "recompensa"."imageUrl" AS "recompensa.imageUrl", "recompensa"."active" AS "recompensa.active", "recompensa"."createdAt" AS "recompensa.createdAt", "recompensa"."updatedAt" AS "recompensa.updatedAt" FROM "roleta_premios" AS "RoletaPremio" LEFT OUTER JOIN "recompensas" AS "recompensa" ON "RoletaPremio"."recompensaId" = "recompensa"."id" WHERE "RoletaPremio"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "RoletaPremio"."roletaId" = 'f4da8c53-db4f-4452-8c7d-505be5e99657' ORDER BY "RoletaPremio"."nome" ASC;
Executing (default): SELECT "id", "tenantId", "creatorId", "title", "description", "startDate", "endDate", "isOpen", "askForAttendant", "status", "expectedRespondents", "dueDate", "recompensaId", "roletaId", "roletaPrizeMessage", "createdAt", "updatedAt" FROM "pesquisas" AS "Pesquisa" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (default): SELECT "id", "tenantId", "name", "email", "phone", "birthDate", "respondentSessionId", "gender", "createdAt", "updatedAt" FROM "clients" AS "Client" WHERE "Client"."id" = '7afc43a6-3305-444e-9efd-b7e5b3e89c56';
Executing (default): SELECT "id", "pesquisaId", "campanhaId", "tenantId", "recompensaId", "codigo", "clienteId", "dataGeracao", "dataUtilizacao", "dataValidade", "status", "ultimoContato", "createdAt", "updatedAt" FROM "cupons" AS "Cupom" WHERE "Cupom"."clienteId" = '7afc43a6-3305-444e-9efd-b7e5b3e89c56' AND "Cupom"."pesquisaId" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4' ORDER BY "Cupom"."dataGeracao" DESC LIMIT 1;
Executing (default): SELECT "RoletaPremio"."id", "RoletaPremio"."tenantId", "RoletaPremio"."nome", "RoletaPremio"."descricao", "RoletaPremio"."porcentagem", "RoletaPremio"."cor", "RoletaPremio"."recompensaId", "RoletaPremio"."roletaId", "RoletaPremio"."imageUrl", "RoletaPremio"."active", "RoletaPremio"."isNoPrizeOption", "RoletaPremio"."createdAt", "RoletaPremio"."updatedAt", "recompensa"."id" AS "recompensa.id", "recompensa"."tenantId" AS "recompensa.tenantId", "recompensa"."name" AS "recompensa.name", "recompensa"."description" AS "recompensa.description", "recompensa"."conditionDescription" AS "recompensa.conditionDescription", "recompensa"."pointsRequired" AS "recompensa.pointsRequired", "recompensa"."type" AS "recompensa.type", "recompensa"."value" AS "recompensa.value", "recompensa"."imageUrl" AS "recompensa.imageUrl", "recompensa"."active" AS "recompensa.active", "recompensa"."createdAt" AS "recompensa.createdAt", "recompensa"."updatedAt" AS "recompensa.updatedAt" FROM "roleta_premios" AS "RoletaPremio" LEFT OUTER JOIN "recompensas" AS "recompensa" ON "RoletaPremio"."recompensaId" = "recompensa"."id" WHERE "RoletaPremio"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "RoletaPremio"."roletaId" = 'f4da8c53-db4f-4452-8c7d-505be5e99657' ORDER BY "RoletaPremio"."nome" ASC;
Executing (default): INSERT INTO "cupons" ("id","pesquisaId","tenantId","recompensaId","codigo","clienteId","dataGeracao","dataValidade","status","createdAt","updatedAt") VALUES ($1,$2,$3,$4,$5,$6,$7,$8,$9,$10,$11) RETURNING "id","pesquisaId","campanhaId","tenantId","recompensaId","codigo","clienteId","dataGeracao","dataUtilizacao","dataValidade","status","ultimoContato","createdAt","updatedAt";
[RoletaController] Iniciando envio de mensagem de prêmio para o tenant eb629ea8-7d69-47a1-b1f1-f9dcb33475f4.
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "postSaleDelayMinutes", "postSaleMessageTemplate", "postSaleSurveyId", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
[RoletaController] Config do WhatsApp para o tenant eb629ea8-7d69-47a1-b1f1-f9dcb33475f4: {
  apiKey: '9df82dcbee60ce08f6ca93aa4024ca6c',
  instanceApiKey: '1EF60F67-BF10-4F82-9BB8-80124CCB17AC',
  id: 'b9d07194-31e9-49e7-bdb8-55d6b3596ef9',
  url: 'https://evolution2.towersfy.com',
  instanceName: 'roma-pizzaria--chopperia',
  instanceStatus: 'disconnected',
  tenantId: 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4',
  sendPrizeMessage: true,
  prizeMessageTemplate: '🎰 *UAAAU, {{cliente}}!* 😍  \n' +
    'Você acabou de girar a *Roleta Premiada da Roma* e saiu com sorte grande! 🍀🔥 \n' +
    '\n' +
    'Você recebeu para usar na sua proxima visita:\n' +
    '🎁 *Prêmio:* *{{premio}}*\n' +
    'Pra resgatar, é só mostrar o cupom 👉 *{{cupom}}* aqui no salão da **Roma Pizzaria & Chopperia** 🍕✨  \n' +
    '\n' +
    'Vem curtir seu prêmio com a galera e comemorar essa sorte toda! 🎉  \n' +
    '📍 *Roma Pizzaria* — diversão, sabor e prêmios te esperando! 😋\n',
  dailyReportEnabled: true,
  reportPhoneNumbers: '5535991090766,553591523297,553598374007',
  weeklyReportEnabled: true,
  monthlyReportEnabled: true,
  birthdayAutomationEnabled: true,
  birthdayMessageTemplate: '🎉 *Seu aniversário tá chegando, {{cliente}}!* 🥳  \n' +
    'E a *Roma Pizzaria* já separou um presente de respeito pra você 🍕🔥  \n' +
    '\n' +
    '🎁 *RODIZIO GRÁTIS* pra você comemorar do jeito certo!  \n' +
    'É só vir até o salão, aproveitar o rodízio e apresentar o cupom 👉 *{{cupom}}* \n' +
    '\n' +
    '📅 Valido para *semana do seu aniversário*,  \n' +
    'lembrando que o *rodízio acontece toda quarta, quinta e sexta* 😉  \n' +
    '\n' +
    '📍 *Válido exclusivamente no salão*  \n' +
    'Chama a galera, escolhe o dia e vem aproveitar! 🎂🍻  \n' +
    '\n' +
    '**Roma Pizzaria** 😍🍕',
  birthdayDaysBefore: 7,
  birthdayRewardType: 'recompensa',
  birthdayRewardId: '17ea8117-07e1-4fca-944b-8454f78079ad',
  birthdayCouponValidityDays: 30,
  sendDetractorMessageToClient: true,
  detractorMessageTemplate: 'Olá, {{cliente}}! 👋\n' +
    '\n' +
    'Recebemos sua avaliação com a nota **{{nota}}** e queremos agradecer por compartilhar sua experiência.  \n' +
    'Lamentamos muito que algo não tenha saído como esperado. 😔\n' +
    '\n' +
    'Seu comentário: _"{{comentario}}"_\n' +
    '\n' +
    'Estamos aqui para resolver isso o mais rápido possível.  \n' +
    'Poderia nos contar um pouco mais sobre o que aconteceu? Seu retorno é essencial para que possamos melhorar e garantir uma próxima experiência muito melhor. 🙏\n' +
    '\n' +
    'Obrigado por nos ajudar a evoluir!  \n' +
    'Nossa equipe está à disposição.\n',
  notifyDetractorToOwner: true,
  detractorOwnerMessageTemplate: '## 🚨 **Alerta de Detrator**\n' +
    '\n' +
    'O cliente **{{cliente}}** registrou uma avaliação **baixa**:\n' +
    '\n' +
    '- **Nota:** **{{nota}}**\n' +
    '- **Comentário:** _"{{comentario}}"_',
  detractorOwnerPhoneNumbers: '5535991090766,553591523297,553598374007',
  postSaleDelayMinutes: 90,
  postSaleMessageTemplate: '🍕 **Olá, {{cliente}}!**  \n' +
    '\n' +
    'Esperamos que você tenha curtido seu pedido da **Roma Pizzaria** 😍  \n' +
    '\n' +
    'Sua opinião é *muito importante* pra gente — é com ela que conseguimos melhorar sabores, atendimento e experiência a cada pedido.\n' +
    '\n' +
    '📝 **Leva menos de 1 minuto:**  \n' +
    '👉 {{link_pesquisa}}\n' +
    '\n' +
    'Como agradecimento, você pode receber **vantagens especiais** nos próximos pedidos 😉\n' +
    '\n' +
    'Obrigado por escolher a Roma ❤️  \n' +
    '*Tradição, sabor e respeito por cada cliente.*',
  postSaleSurveyId: '362bd09a-762a-49d4-9651-415955567e6a',
  createdAt: 2025-11-28T21:25:29.661Z,
  updatedAt: 2026-02-05T22:49:26.315Z
}
[RoletaController] Todas as condições para enviar a mensagem de prêmio foram atendidas para o tenant eb629ea8-7d69-47a1-b1f1-f9dcb33475f4.
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "postSaleDelayMinutes", "postSaleMessageTemplate", "postSaleSurveyId", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "postSaleDelayMinutes", "postSaleMessageTemplate", "postSaleSurveyId", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
[RoletaController] Falha ao tentar enviar mensagem de prêmio via WhatsApp para o tenant eb629ea8-7d69-47a1-b1f1-f9dcb33475f4. Erro: A instância do WhatsApp desta loja não está conectada.
[WhatsappService] Resposta da API de status da instância: {
  "instance": {
    "instanceName": "roma-pizzaria--chopperia",
    "state": "close"
  }
}
Executing (default): SELECT "Pesquisa"."id", "Pesquisa"."title", "Pesquisa"."description", "Pesquisa"."createdAt", "Pesquisa"."updatedAt", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."status", "Pesquisa"."recompensaId", "Pesquisa"."roletaId", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."text" AS "perguntas.text", "perguntas"."options" AS "perguntas.options", "perguntas"."order" AS "perguntas.order", "perguntas"."required" AS "perguntas.required", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."description" AS "tenant.description", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "roleta"."id" AS "roleta.id", "roleta"."nome" AS "roleta.nome", "roleta"."descricao" AS "roleta.descricao", "roleta"."active" AS "roleta.active" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" LEFT OUTER JOIN "tenants" AS "tenant" ON "Pesquisa"."tenantId" = "tenant"."id" LEFT OUTER JOIN "roletas" AS "roleta" ON "Pesquisa"."roletaId" = "roleta"."id" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (default): SELECT "id", "name", "logoUrl", "primaryColor", "secondaryColor", "description" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT "id", "tenantId", "creatorId", "title", "description", "startDate", "endDate", "isOpen", "askForAttendant", "status", "expectedRespondents", "dueDate", "recompensaId", "roletaId", "roletaPrizeMessage", "createdAt", "updatedAt" FROM "pesquisas" AS "Pesquisa" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (default): SELECT "id", "pesquisaId", "campanhaId", "tenantId", "recompensaId", "codigo", "clienteId", "dataGeracao", "dataUtilizacao", "dataValidade", "status", "ultimoContato", "createdAt", "updatedAt" FROM "cupons" AS "Cupom" WHERE "Cupom"."clienteId" = '7afc43a6-3305-444e-9efd-b7e5b3e89c56' AND "Cupom"."pesquisaId" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4' ORDER BY "Cupom"."dataGeracao" DESC LIMIT 1;
Executing (default): SELECT "RoletaPremio"."id", "RoletaPremio"."tenantId", "RoletaPremio"."nome", "RoletaPremio"."descricao", "RoletaPremio"."porcentagem", "RoletaPremio"."cor", "RoletaPremio"."recompensaId", "RoletaPremio"."roletaId", "RoletaPremio"."imageUrl", "RoletaPremio"."active", "RoletaPremio"."isNoPrizeOption", "RoletaPremio"."createdAt", "RoletaPremio"."updatedAt", "recompensa"."id" AS "recompensa.id", "recompensa"."tenantId" AS "recompensa.tenantId", "recompensa"."name" AS "recompensa.name", "recompensa"."description" AS "recompensa.description", "recompensa"."conditionDescription" AS "recompensa.conditionDescription", "recompensa"."pointsRequired" AS "recompensa.pointsRequired", "recompensa"."type" AS "recompensa.type", "recompensa"."value" AS "recompensa.value", "recompensa"."imageUrl" AS "recompensa.imageUrl", "recompensa"."active" AS "recompensa.active", "recompensa"."createdAt" AS "recompensa.createdAt", "recompensa"."updatedAt" AS "recompensa.updatedAt" FROM "roleta_premios" AS "RoletaPremio" LEFT OUTER JOIN "recompensas" AS "recompensa" ON "RoletaPremio"."recompensaId" = "recompensa"."id" WHERE "RoletaPremio"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "RoletaPremio"."roletaId" = 'f4da8c53-db4f-4452-8c7d-505be5e99657' ORDER BY "RoletaPremio"."nome" ASC;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 23:13:00.025 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "Pesquisa"."id", "Pesquisa"."title", "Pesquisa"."description", "Pesquisa"."createdAt", "Pesquisa"."updatedAt", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."status", "Pesquisa"."recompensaId", "Pesquisa"."roletaId", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."text" AS "perguntas.text", "perguntas"."options" AS "perguntas.options", "perguntas"."order" AS "perguntas.order", "perguntas"."required" AS "perguntas.required", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."description" AS "tenant.description", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "roleta"."id" AS "roleta.id", "roleta"."nome" AS "roleta.nome", "roleta"."descricao" AS "roleta.descricao", "roleta"."active" AS "roleta.active" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" LEFT OUTER JOIN "tenants" AS "tenant" ON "Pesquisa"."tenantId" = "tenant"."id" LEFT OUTER JOIN "roletas" AS "roleta" ON "Pesquisa"."roletaId" = "roleta"."id" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (default): SELECT "id", "name", "logoUrl", "primaryColor", "secondaryColor", "description" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT "id", "tenantId", "creatorId", "title", "description", "startDate", "endDate", "isOpen", "askForAttendant", "status", "expectedRespondents", "dueDate", "recompensaId", "roletaId", "roletaPrizeMessage", "createdAt", "updatedAt" FROM "pesquisas" AS "Pesquisa" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (default): SELECT "id", "pesquisaId", "campanhaId", "tenantId", "recompensaId", "codigo", "clienteId", "dataGeracao", "dataUtilizacao", "dataValidade", "status", "ultimoContato", "createdAt", "updatedAt" FROM "cupons" AS "Cupom" WHERE "Cupom"."clienteId" = '7afc43a6-3305-444e-9efd-b7e5b3e89c56' AND "Cupom"."pesquisaId" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4' ORDER BY "Cupom"."dataGeracao" DESC LIMIT 1;
Executing (default): SELECT "RoletaPremio"."id", "RoletaPremio"."tenantId", "RoletaPremio"."nome", "RoletaPremio"."descricao", "RoletaPremio"."porcentagem", "RoletaPremio"."cor", "RoletaPremio"."recompensaId", "RoletaPremio"."roletaId", "RoletaPremio"."imageUrl", "RoletaPremio"."active", "RoletaPremio"."isNoPrizeOption", "RoletaPremio"."createdAt", "RoletaPremio"."updatedAt", "recompensa"."id" AS "recompensa.id", "recompensa"."tenantId" AS "recompensa.tenantId", "recompensa"."name" AS "recompensa.name", "recompensa"."description" AS "recompensa.description", "recompensa"."conditionDescription" AS "recompensa.conditionDescription", "recompensa"."pointsRequired" AS "recompensa.pointsRequired", "recompensa"."type" AS "recompensa.type", "recompensa"."value" AS "recompensa.value", "recompensa"."imageUrl" AS "recompensa.imageUrl", "recompensa"."active" AS "recompensa.active", "recompensa"."createdAt" AS "recompensa.createdAt", "recompensa"."updatedAt" AS "recompensa.updatedAt" FROM "roleta_premios" AS "RoletaPremio" LEFT OUTER JOIN "recompensas" AS "recompensa" ON "RoletaPremio"."recompensaId" = "recompensa"."id" WHERE "RoletaPremio"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "RoletaPremio"."roletaId" = 'f4da8c53-db4f-4452-8c7d-505be5e99657' ORDER BY "RoletaPremio"."nome" ASC;
Executing (default): SELECT "id", "name", "logoUrl", "primaryColor", "secondaryColor", "description" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT "id", "name", "logoUrl", "primaryColor", "secondaryColor", "description" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 23:14:00.045 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Iniciando processamento do webhook do Uai Rango: {
  "id_estabelecimento": 4659,
  "cod_pedido": "A0E263733",
  "data": "2026-02-06 20:14:13",
  "pedido_pronto": 0,
  "data_pedido_pronto": null,
  "cupom": null,
  "tipo_entrega": "Delivery",
  "prazo": null,
  "prazo_min": 30,
  "prazo_max": 50,
  "categoria_pagamento": "Pagamento Online",
  "forma_pagamento": "Pagamento Online",
  "valor_total": 72.49,
  "observacao": "",
  "taxa_entrega": 3,
  "nome_taxa_entrega": "Bairros",
  "status": {

    "id": 0,
    "status": "Pendente"
  },
  "produtos": [
    {
      "id_categoria": 31375,
      "codigo_categoria": "",
      "categoria": "Esfihas Abertas Salgadas",
      "id_opcao": 61487,
      "opcao": "Único",
      "id_produto": 244620,
      "codigo": "",
      "produto": "Strogonoff de Carne",
      "id_produto_2": null,
      "codigo_2": "",
      "produto_2": null,
      "obs": "Sem champignons ",
      "valor": 11,
      "quantidade": 1,
      "adicionais": []
    },
    {
      "id_categoria": 31375,
      "codigo_categoria": "",
      "categoria": "Esfihas Abertas Salgadas",
      "id_opcao": 61487,
      "opcao": "Único",
      "id_produto": 244598,
      "codigo": "",
      "produto": "Lombo 2",
      "id_produto_2": null,
      "codigo_2": "",
      "produto_2": null,
      "obs": "",
      "valor": 11,
      "quantidade": 2,
      "adicionais": []
    },
    {
      "id_categoria": 31375,
      "codigo_categoria": "",
      "categoria": "Esfihas Abertas Salgadas",
      "id_opcao": 61487,
      "opcao": "Único",
      "id_produto": 244595,
      "codigo": "",
      "produto": "Frango Catupiry",
      "id_produto_2": null,
      "codigo_2": "",
      "produto_2": null,
      "obs": "",
      "valor": 9.5,
      "quantidade": 1,
      "adicionais": []
    },
    {
      "id_categoria": 31377,
      "codigo_categoria": "",
      "categoria": "Esfihas Doces",
      "id_opcao": 61489,
      "opcao": "Único",
      "id_produto": 2111627,
      "codigo": "",
      "produto": "Esfiha de Pudim",
      "id_produto_2": null,
      "codigo_2": "",
      "produto_2": null,
      "obs": "",
      "valor": 14.99,
      "quantidade": 1,
      "adicionais": []
    },
    {
      "id_categoria": 31379,
      "codigo_categoria": "",
      "categoria": "Bebidas",
      "id_opcao": 61493,
      "opcao": "2L",
      "id_produto": 244649,
      "codigo": "",
      "produto": "Coca-Cola",
      "id_produto_2": null,
      "codigo_2": "",
      "produto_2": null,
      "obs": "",
      "valor": 15,
      "quantidade": 1,
      "adicionais": []
    }
  ],
  "usuario": {
    "id": "711fe32f3b0511cf",
    "nome": "Marcelo Tognolo",
    "tel1": "35999540426"
  },
  "endereco": {
    "id": 3051503,
    "uf": "MG",
    "cidade": "Andradas",
    "bairro": "Jardim Ipê",
    "rua": "Rua dos Manzoli",
    "num": "109",
    "complemento": null,
    "ponto_referencia": "Portão branco, casa cinza"
  }
}
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "gmb_link", "uairangoEstablishmentId", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt", "ifoodClientId", "ifoodClientSecret", "ifoodAuthVerifier", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt", "franchisorId", "plan", "planExpiresAt", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."uairangoEstablishmentId" = '4659';
[UaiRango Webhook] Tenant encontrado: eb629ea8-7d69-47a1-b1f1-f9dcb33475f4 para o pedido A0E263733
Executing (default): SELECT "id", "tenantId", "name", "email", "phone", "birthDate", "respondentSessionId", "gender", "createdAt", "updatedAt" FROM "clients" AS "Client" WHERE "Client"."phone" = '35999540426' AND "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
Executing (default): INSERT INTO "clients" ("id","tenantId","name","phone","createdAt","updatedAt") VALUES ($1,$2,$3,$4,$5,$6) RETURNING "id","tenantId","name","email","phone","birthDate","respondentSessionId","gender","createdAt","updatedAt";
[UaiRango Webhook] Novo cliente criado: 68156bd1-7225-41bc-9d81-010f4e11f356 para o pedido A0E263733
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."platform" = 'UaiRango' AND "DeliveryOrder"."orderIdPlatform" = 'A0E263733';
Executing (default): INSERT INTO "delivery_orders" ("id","platform","orderIdPlatform","totalAmount","orderDate","payload","clientId","tenantId","surveyStatus","createdAt","updatedAt") VALUES ($1,$2,$3,$4,$5,$6,$7,$8,$9,$10,$11) RETURNING "id","platform","orderIdPlatform","totalAmount","orderDate","payload","clientId","tenantId","surveyStatus","surveyScheduledAt","surveySentAt","createdAt","updatedAt";
[UaiRango Webhook] DeliveryOrder criado: d3f29df9-ee93-435e-91e0-63a14ef05ccc para o pedido A0E263733
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "postSaleDelayMinutes", "postSaleMessageTemplate", "postSaleSurveyId", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
Executing (default): UPDATE "delivery_orders" SET "surveyStatus"=$1,"surveyScheduledAt"=$2,"updatedAt"=$3 WHERE "id" = $4
Pesquisa agendada para o pedido d3f29df9-ee93-435e-91e0-63a14ef05ccc. Delay: 90 min. Envio em: Sat Feb 07 2026 00:44:31 GMT+0000 (Coordinated Universal Time)
[UaiRango Webhook] Pesquisa de satisfação agendada para cliente 68156bd1-7225-41bc-9d81-010f4e11f356, pedido d3f29df9-ee93-435e-91e0-63a14ef05ccc.
[Delivery Much Job] Starting Polling...
[iFood Job] Starting Polling...
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 23:15:00.085 +00:00' LIMIT 50;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
Executing (default): SELECT "Pesquisa"."id", "Pesquisa"."title", "Pesquisa"."description", "Pesquisa"."createdAt", "Pesquisa"."updatedAt", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."status", "Pesquisa"."recompensaId", "Pesquisa"."roletaId", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."text" AS "perguntas.text", "perguntas"."options" AS "perguntas.options", "perguntas"."order" AS "perguntas.order", "perguntas"."required" AS "perguntas.required", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."description" AS "tenant.description", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "roleta"."id" AS "roleta.id", "roleta"."nome" AS "roleta.nome", "roleta"."descricao" AS "roleta.descricao", "roleta"."active" AS "roleta.active" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" LEFT OUTER JOIN "tenants" AS "tenant" ON "Pesquisa"."tenantId" = "tenant"."id" LEFT OUTER JOIN "roletas" AS "roleta" ON "Pesquisa"."roletaId" = "roleta"."id" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (default): SELECT "id", "name" FROM "atendentes" AS "Atendente" WHERE "Atendente"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Atendente"."status" = 'active' ORDER BY "Atendente"."name" ASC;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 23:16:00.046 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "askForAttendant" FROM "pesquisas" AS "Pesquisa" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (default): SELECT "Pesquisa"."id", "Pesquisa"."title", "Pesquisa"."description", "Pesquisa"."createdAt", "Pesquisa"."updatedAt", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."status", "Pesquisa"."recompensaId", "Pesquisa"."roletaId", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."text" AS "perguntas.text", "perguntas"."options" AS "perguntas.options", "perguntas"."order" AS "perguntas.order", "perguntas"."required" AS "perguntas.required", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."description" AS "tenant.description", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "roleta"."id" AS "roleta.id", "roleta"."nome" AS "roleta.nome", "roleta"."descricao" AS "roleta.descricao", "roleta"."active" AS "roleta.active" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" LEFT OUTER JOIN "tenants" AS "tenant" ON "Pesquisa"."tenantId" = "tenant"."id" LEFT OUTER JOIN "roletas" AS "roleta" ON "Pesquisa"."roletaId" = "roleta"."id" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (ccb2c71e-bd22-4b54-b069-f9ecf893b045): SELECT "Pesquisa"."id", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."title", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."options" AS "perguntas.options", "perguntas"."required" AS "perguntas.required", "perguntas"."text" AS "perguntas.text" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (ccb2c71e-bd22-4b54-b069-f9ecf893b045): INSERT INTO "respostas" ("id","perguntaId","pesquisaId","tenantId","atendenteId","respondentSessionId","ratingValue","textValue","createdAt","updatedAt") VALUES ('ba7a6a7c-187b-4a0a-9a15-53ab2c8a7df9','19f1cec2-90b3-4223-b412-3c1d860e20a6','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','56d7b27f-9789-406c-b233-387395e14979','0cd730a8-5182-4bdc-bff3-020b167ed683',10,NULL,'2026-02-06 23:16:56.595 +00:00','2026-02-06 23:16:56.595 +00:00'),('e819ea41-7f62-446b-ab26-09b0b965c0fc','305b7330-b4c3-41b1-8fd1-0f3f91e7e936','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','56d7b27f-9789-406c-b233-387395e14979','0cd730a8-5182-4bdc-bff3-020b167ed683',5,NULL,'2026-02-06 23:16:56.595 +00:00','2026-02-06 23:16:56.595 +00:00'),('3b06b1ff-c403-494c-acf8-9824661947db','d91a3ab3-65e2-40d0-acfa-35133ed4a7d4','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','56d7b27f-9789-406c-b233-387395e14979','0cd730a8-5182-4bdc-bff3-020b167ed683',5,NULL,'2026-02-06 23:16:56.595 +00:00','2026-02-06 23:16:56.595 +00:00'),('c7b880ad-e1e0-49cf-9924-7844d560109a','635f7a66-33fd-40f4-89b4-3c7c83f003aa','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','56d7b27f-9789-406c-b233-387395e14979','0cd730a8-5182-4bdc-bff3-020b167ed683',5,NULL,'2026-02-06 23:16:56.595 +00:00','2026-02-06 23:16:56.595 +00:00'),('e64ce736-a3ea-42c4-a3e4-8c71a9d2169a','9e5e541a-1930-47da-81a5-e53892d8337a','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','56d7b27f-9789-406c-b233-387395e14979','0cd730a8-5182-4bdc-bff3-020b167ed683',5,NULL,'2026-02-06 23:16:56.595 +00:00','2026-02-06 23:16:56.595 +00:00'),('7e6f3021-e5db-4075-98a7-636a393bed69','2cbd96fb-faa2-495d-99dd-c57af8623c9d','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','56d7b27f-9789-406c-b233-387395e14979','0cd730a8-5182-4bdc-bff3-020b167ed683',5,NULL,'2026-02-06 23:16:56.595 +00:00','2026-02-06 23:16:56.595 +00:00'),('120ef439-5ec1-41d0-8965-932f0d78df86','89c2b3ed-7104-4a41-991d-565b70294215','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','56d7b27f-9789-406c-b233-387395e14979','0cd730a8-5182-4bdc-bff3-020b167ed683',5,NULL,'2026-02-06 23:16:56.595 +00:00','2026-02-06 23:16:56.595 +00:00') RETURNING "id","perguntaId","pesquisaId","tenantId","atendenteId","respondentSessionId","ratingValue","textValue","selectedOption","createdAt","updatedAt";
Executing (default): SELECT "gmb_link" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "postSaleDelayMinutes", "postSaleMessageTemplate", "postSaleSurveyId", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
Executing (default): SELECT "id", "name", "logoUrl", "primaryColor", "secondaryColor", "description" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 23:17:00.032 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "logoUrl", "primaryColor", "secondaryColor", "description" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 23:18:00.030 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "tenantId" FROM "respostas" AS "Resposta" WHERE "Resposta"."respondentSessionId" = '0cd730a8-5182-4bdc-bff3-020b167ed683' LIMIT 1;
Executing (57e0ea40-0ec4-4767-bf19-cd29065bf946): SELECT "id", "tenantId", "name", "email", "phone", "birthDate", "respondentSessionId", "gender", "createdAt", "updatedAt" FROM "clients" AS "Client" WHERE "Client"."email" = 'cauamtbblox1@gmail.com' AND "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
Executing (57e0ea40-0ec4-4767-bf19-cd29065bf946): SELECT "id", "tenantId", "name", "email", "phone", "birthDate", "respondentSessionId", "gender", "createdAt", "updatedAt" FROM "clients" AS "Client" WHERE "Client"."phone" = '(35) 99773-6002' AND "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
Executing (57e0ea40-0ec4-4767-bf19-cd29065bf946): SELECT "id", "tenantId", "name", "email", "phone", "birthDate", "respondentSessionId", "gender", "createdAt", "updatedAt" FROM "clients" AS "Client" WHERE "Client"."respondentSessionId" = '0cd730a8-5182-4bdc-bff3-020b167ed683';
Executing (57e0ea40-0ec4-4767-bf19-cd29065bf946): INSERT INTO "clients" ("id","tenantId","name","email","phone","birthDate","respondentSessionId","gender","createdAt","updatedAt") VALUES ($1,$2,$3,$4,$5,$6,$7,$8,$9,$10) RETURNING "id","tenantId","name","email","phone","birthDate","respondentSessionId","gender","createdAt","updatedAt";
Executing (57e0ea40-0ec4-4767-bf19-cd29065bf946): SELECT "pesquisaId", "tenantId" FROM "respostas" AS "Resposta" WHERE "Resposta"."respondentSessionId" = '0cd730a8-5182-4bdc-bff3-020b167ed683' LIMIT 1;
Executing (57e0ea40-0ec4-4767-bf19-cd29065bf946): SELECT "recompensaId" FROM "pesquisas" AS "Pesquisa" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (default): SELECT "Pesquisa"."id", "Pesquisa"."title", "Pesquisa"."description", "Pesquisa"."createdAt", "Pesquisa"."updatedAt", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."status", "Pesquisa"."recompensaId", "Pesquisa"."roletaId", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."text" AS "perguntas.text", "perguntas"."options" AS "perguntas.options", "perguntas"."order" AS "perguntas.order", "perguntas"."required" AS "perguntas.required", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."description" AS "tenant.description", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "roleta"."id" AS "roleta.id", "roleta"."nome" AS "roleta.nome", "roleta"."descricao" AS "roleta.descricao", "roleta"."active" AS "roleta.active" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" LEFT OUTER JOIN "tenants" AS "tenant" ON "Pesquisa"."tenantId" = "tenant"."id" LEFT OUTER JOIN "roletas" AS "roleta" ON "Pesquisa"."roletaId" = "roleta"."id" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (default): SELECT "id", "name", "logoUrl", "primaryColor", "secondaryColor", "description" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT "id", "tenantId", "creatorId", "title", "description", "startDate", "endDate", "isOpen", "askForAttendant", "status", "expectedRespondents", "dueDate", "recompensaId", "roletaId", "roletaPrizeMessage", "createdAt", "updatedAt" FROM "pesquisas" AS "Pesquisa" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (default): SELECT "id", "pesquisaId", "campanhaId", "tenantId", "recompensaId", "codigo", "clienteId", "dataGeracao", "dataUtilizacao", "dataValidade", "status", "ultimoContato", "createdAt", "updatedAt" FROM "cupons" AS "Cupom" WHERE "Cupom"."clienteId" = '06d01c3a-8bb1-42cb-aa89-cdcad395d940' AND "Cupom"."pesquisaId" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4' ORDER BY "Cupom"."dataGeracao" DESC LIMIT 1;
Executing (default): SELECT "RoletaPremio"."id", "RoletaPremio"."tenantId", "RoletaPremio"."nome", "RoletaPremio"."descricao", "RoletaPremio"."porcentagem", "RoletaPremio"."cor", "RoletaPremio"."recompensaId", "RoletaPremio"."roletaId", "RoletaPremio"."imageUrl", "RoletaPremio"."active", "RoletaPremio"."isNoPrizeOption", "RoletaPremio"."createdAt", "RoletaPremio"."updatedAt", "recompensa"."id" AS "recompensa.id", "recompensa"."tenantId" AS "recompensa.tenantId", "recompensa"."name" AS "recompensa.name", "recompensa"."description" AS "recompensa.description", "recompensa"."conditionDescription" AS "recompensa.conditionDescription", "recompensa"."pointsRequired" AS "recompensa.pointsRequired", "recompensa"."type" AS "recompensa.type", "recompensa"."value" AS "recompensa.value", "recompensa"."imageUrl" AS "recompensa.imageUrl", "recompensa"."active" AS "recompensa.active", "recompensa"."createdAt" AS "recompensa.createdAt", "recompensa"."updatedAt" AS "recompensa.updatedAt" FROM "roleta_premios" AS "RoletaPremio" LEFT OUTER JOIN "recompensas" AS "recompensa" ON "RoletaPremio"."recompensaId" = "recompensa"."id" WHERE "RoletaPremio"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "RoletaPremio"."roletaId" = 'f4da8c53-db4f-4452-8c7d-505be5e99657' ORDER BY "RoletaPremio"."nome" ASC;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 23:19:00.030 +00:00' LIMIT 50;
Executing (default): SELECT "id", "tenantId", "creatorId", "title", "description", "startDate", "endDate", "isOpen", "askForAttendant", "status", "expectedRespondents", "dueDate", "recompensaId", "roletaId", "roletaPrizeMessage", "createdAt", "updatedAt" FROM "pesquisas" AS "Pesquisa" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (default): SELECT "id", "tenantId", "name", "email", "phone", "birthDate", "respondentSessionId", "gender", "createdAt", "updatedAt" FROM "clients" AS "Client" WHERE "Client"."id" = '06d01c3a-8bb1-42cb-aa89-cdcad395d940';
Executing (default): SELECT "id", "pesquisaId", "campanhaId", "tenantId", "recompensaId", "codigo", "clienteId", "dataGeracao", "dataUtilizacao", "dataValidade", "status", "ultimoContato", "createdAt", "updatedAt" FROM "cupons" AS "Cupom" WHERE "Cupom"."clienteId" = '06d01c3a-8bb1-42cb-aa89-cdcad395d940' AND "Cupom"."pesquisaId" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4' ORDER BY "Cupom"."dataGeracao" DESC LIMIT 1;
Executing (default): SELECT "RoletaPremio"."id", "RoletaPremio"."tenantId", "RoletaPremio"."nome", "RoletaPremio"."descricao", "RoletaPremio"."porcentagem", "RoletaPremio"."cor", "RoletaPremio"."recompensaId", "RoletaPremio"."roletaId", "RoletaPremio"."imageUrl", "RoletaPremio"."active", "RoletaPremio"."isNoPrizeOption", "RoletaPremio"."createdAt", "RoletaPremio"."updatedAt", "recompensa"."id" AS "recompensa.id", "recompensa"."tenantId" AS "recompensa.tenantId", "recompensa"."name" AS "recompensa.name", "recompensa"."description" AS "recompensa.description", "recompensa"."conditionDescription" AS "recompensa.conditionDescription", "recompensa"."pointsRequired" AS "recompensa.pointsRequired", "recompensa"."type" AS "recompensa.type", "recompensa"."value" AS "recompensa.value", "recompensa"."imageUrl" AS "recompensa.imageUrl", "recompensa"."active" AS "recompensa.active", "recompensa"."createdAt" AS "recompensa.createdAt", "recompensa"."updatedAt" AS "recompensa.updatedAt" FROM "roleta_premios" AS "RoletaPremio" LEFT OUTER JOIN "recompensas" AS "recompensa" ON "RoletaPremio"."recompensaId" = "recompensa"."id" WHERE "RoletaPremio"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "RoletaPremio"."roletaId" = 'f4da8c53-db4f-4452-8c7d-505be5e99657' ORDER BY "RoletaPremio"."nome" ASC;
Executing (default): INSERT INTO "cupons" ("id","pesquisaId","tenantId","recompensaId","codigo","clienteId","dataGeracao","dataValidade","status","createdAt","updatedAt") VALUES ($1,$2,$3,$4,$5,$6,$7,$8,$9,$10,$11) RETURNING "id","pesquisaId","campanhaId","tenantId","recompensaId","codigo","clienteId","dataGeracao","dataUtilizacao","dataValidade","status","ultimoContato","createdAt","updatedAt";
[RoletaController] Iniciando envio de mensagem de prêmio para o tenant eb629ea8-7d69-47a1-b1f1-f9dcb33475f4.
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "postSaleDelayMinutes", "postSaleMessageTemplate", "postSaleSurveyId", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
[RoletaController] Config do WhatsApp para o tenant eb629ea8-7d69-47a1-b1f1-f9dcb33475f4: {
  apiKey: '9df82dcbee60ce08f6ca93aa4024ca6c',
  instanceApiKey: '1EF60F67-BF10-4F82-9BB8-80124CCB17AC',
  id: 'b9d07194-31e9-49e7-bdb8-55d6b3596ef9',
  url: 'https://evolution2.towersfy.com',
  instanceName: 'roma-pizzaria--chopperia',
  instanceStatus: 'disconnected',
  tenantId: 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4',
  sendPrizeMessage: true,
  prizeMessageTemplate: '🎰 *UAAAU, {{cliente}}!* 😍  \n' +
    'Você acabou de girar a *Roleta Premiada da Roma* e saiu com sorte grande! 🍀🔥 \n' +
    '\n' +
    'Você recebeu para usar na sua proxima visita:\n' +
    '🎁 *Prêmio:* *{{premio}}*\n' +
    'Pra resgatar, é só mostrar o cupom 👉 *{{cupom}}* aqui no salão da **Roma Pizzaria & Chopperia** 🍕✨  \n' +
    '\n' +
    'Vem curtir seu prêmio com a galera e comemorar essa sorte toda! 🎉  \n' +
    '📍 *Roma Pizzaria* — diversão, sabor e prêmios te esperando! 😋\n',
  dailyReportEnabled: true,
  reportPhoneNumbers: '5535991090766,553591523297,553598374007',
  weeklyReportEnabled: true,
  monthlyReportEnabled: true,
  birthdayAutomationEnabled: true,
  birthdayMessageTemplate: '🎉 *Seu aniversário tá chegando, {{cliente}}!* 🥳  \n' +
    'E a *Roma Pizzaria* já separou um presente de respeito pra você 🍕🔥  \n' +
    '\n' +
    '🎁 *RODIZIO GRÁTIS* pra você comemorar do jeito certo!  \n' +
    'É só vir até o salão, aproveitar o rodízio e apresentar o cupom 👉 *{{cupom}}* \n' +
    '\n' +
    '📅 Valido para *semana do seu aniversário*,  \n' +
    'lembrando que o *rodízio acontece toda quarta, quinta e sexta* 😉  \n' +
    '\n' +
    '📍 *Válido exclusivamente no salão*  \n' +
    'Chama a galera, escolhe o dia e vem aproveitar! 🎂🍻  \n' +
    '\n' +
    '**Roma Pizzaria** 😍🍕',
  birthdayDaysBefore: 7,
  birthdayRewardType: 'recompensa',
  birthdayRewardId: '17ea8117-07e1-4fca-944b-8454f78079ad',
  birthdayCouponValidityDays: 30,
  sendDetractorMessageToClient: true,
  detractorMessageTemplate: 'Olá, {{cliente}}! 👋\n' +
    '\n' +
    'Recebemos sua avaliação com a nota **{{nota}}** e queremos agradecer por compartilhar sua experiência.  \n' +
    'Lamentamos muito que algo não tenha saído como esperado. 😔\n' +
    '\n' +
    'Seu comentário: _"{{comentario}}"_\n' +
    '\n' +
    'Estamos aqui para resolver isso o mais rápido possível.  \n' +
    'Poderia nos contar um pouco mais sobre o que aconteceu? Seu retorno é essencial para que possamos melhorar e garantir uma próxima experiência muito melhor. 🙏\n' +
    '\n' +
    'Obrigado por nos ajudar a evoluir!  \n' +
    'Nossa equipe está à disposição.\n',
  notifyDetractorToOwner: true,
  detractorOwnerMessageTemplate: '## 🚨 **Alerta de Detrator**\n' +
    '\n' +
    'O cliente **{{cliente}}** registrou uma avaliação **baixa**:\n' +
    '\n' +
    '- **Nota:** **{{nota}}**\n' +
    '- **Comentário:** _"{{comentario}}"_',
  detractorOwnerPhoneNumbers: '5535991090766,553591523297,553598374007',
  postSaleDelayMinutes: 90,
  postSaleMessageTemplate: '🍕 **Olá, {{cliente}}!**  \n' +
    '\n' +
    'Esperamos que você tenha curtido seu pedido da **Roma Pizzaria** 😍  \n' +
    '\n' +
    'Sua opinião é *muito importante* pra gente — é com ela que conseguimos melhorar sabores, atendimento e experiência a cada pedido.\n' +
    '\n' +
    '📝 **Leva menos de 1 minuto:**  \n' +
    '👉 {{link_pesquisa}}\n' +
    '\n' +
    'Como agradecimento, você pode receber **vantagens especiais** nos próximos pedidos 😉\n' +
    '\n' +
    'Obrigado por escolher a Roma ❤️  \n' +
    '*Tradição, sabor e respeito por cada cliente.*',
  postSaleSurveyId: '362bd09a-762a-49d4-9651-415955567e6a',
  createdAt: 2025-11-28T21:25:29.661Z,
  updatedAt: 2026-02-05T22:49:26.315Z
}
[RoletaController] Todas as condições para enviar a mensagem de prêmio foram atendidas para o tenant eb629ea8-7d69-47a1-b1f1-f9dcb33475f4.
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "postSaleDelayMinutes", "postSaleMessageTemplate", "postSaleSurveyId", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "postSaleDelayMinutes", "postSaleMessageTemplate", "postSaleSurveyId", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
[RoletaController] Falha ao tentar enviar mensagem de prêmio via WhatsApp para o tenant eb629ea8-7d69-47a1-b1f1-f9dcb33475f4. Erro: A instância do WhatsApp desta loja não está conectada.
[WhatsappService] Resposta da API de status da instância: {
  "instance": {
    "instanceName": "roma-pizzaria--chopperia",
    "state": "close"
  }
}
Executing (default): SELECT "id", "name", "logoUrl", "primaryColor", "secondaryColor", "description" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
[CAMPAIGN_MONITOR] Iniciando verificação de campanhas pausadas...
[Delivery Much Job] Starting Polling...
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 23:20:00.064 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."status" = 'paused';
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
[CAMPAIGN_MONITOR] Nenhuma campanha pausada encontrada.
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "Pesquisa"."id", "Pesquisa"."title", "Pesquisa"."description", "Pesquisa"."createdAt", "Pesquisa"."updatedAt", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."status", "Pesquisa"."recompensaId", "Pesquisa"."roletaId", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."text" AS "perguntas.text", "perguntas"."options" AS "perguntas.options", "perguntas"."order" AS "perguntas.order", "perguntas"."required" AS "perguntas.required", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."description" AS "tenant.description", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "roleta"."id" AS "roleta.id", "roleta"."nome" AS "roleta.nome", "roleta"."descricao" AS "roleta.descricao", "roleta"."active" AS "roleta.active" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" LEFT OUTER JOIN "tenants" AS "tenant" ON "Pesquisa"."tenantId" = "tenant"."id" LEFT OUTER JOIN "roletas" AS "roleta" ON "Pesquisa"."roletaId" = "roleta"."id" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (default): SELECT "id", "name" FROM "atendentes" AS "Atendente" WHERE "Atendente"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Atendente"."status" = 'active' ORDER BY "Atendente"."name" ASC;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 23:21:00.037 +00:00' LIMIT 50;
Executing (default): SELECT "Pesquisa"."id", "Pesquisa"."title", "Pesquisa"."description", "Pesquisa"."createdAt", "Pesquisa"."updatedAt", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."status", "Pesquisa"."recompensaId", "Pesquisa"."roletaId", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."text" AS "perguntas.text", "perguntas"."options" AS "perguntas.options", "perguntas"."order" AS "perguntas.order", "perguntas"."required" AS "perguntas.required", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."description" AS "tenant.description", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "roleta"."id" AS "roleta.id", "roleta"."nome" AS "roleta.nome", "roleta"."descricao" AS "roleta.descricao", "roleta"."active" AS "roleta.active" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" LEFT OUTER JOIN "tenants" AS "tenant" ON "Pesquisa"."tenantId" = "tenant"."id" LEFT OUTER JOIN "roletas" AS "roleta" ON "Pesquisa"."roletaId" = "roleta"."id" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (default): SELECT "id", "name" FROM "atendentes" AS "Atendente" WHERE "Atendente"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Atendente"."status" = 'active' ORDER BY "Atendente"."name" ASC;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 23:22:00.052 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[Post-Sale Survey Job] Encontrados 1 pedidos pendentes de pesquisa.
Executing (default): SELECT "id", "tenantId", "name", "email", "phone", "birthDate", "respondentSessionId", "gender", "createdAt", "updatedAt" FROM "clients" AS "Client" WHERE "Client"."id" = '761ab141-0667-4409-bd74-64ce65d89f8e' AND "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "postSaleDelayMinutes", "postSaleMessageTemplate", "postSaleSurveyId", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
Erro ao enviar pesquisa de satisfação para o cliente 761ab141-0667-4409-bd74-64ce65d89f8e (tenant: eb629ea8-7d69-47a1-b1f1-f9dcb33475f4, pedido: 9e513e46-a3bd-4893-99ba-603104b3424e): TypeError: Cannot read properties of undefined (reading 'findByPk')
    at Object.sendSatisfactionSurvey (/usr/src/app/src/services/surveyTriggerService.js:63:31)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async cron.schedule.scheduled (/usr/src/app/src/jobs/postSaleSurveyJob.js:38:17)
    at async Timeout._onTimeout (/usr/src/app/node_modules/node-cron/dist/cjs/scheduler/runner.js:70:44)
Executing (default): UPDATE "delivery_orders" SET "surveyStatus"=$1,"updatedAt"=$2 WHERE "id" = $3
[Post-Sale Survey Job] Falha ao processar pedido 9e513e46-a3bd-4893-99ba-603104b3424e: Falha ao enviar pesquisa de satisfação.
Executing (default): SELECT "askForAttendant" FROM "pesquisas" AS "Pesquisa" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (default): SELECT "Pesquisa"."id", "Pesquisa"."title", "Pesquisa"."description", "Pesquisa"."createdAt", "Pesquisa"."updatedAt", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."status", "Pesquisa"."recompensaId", "Pesquisa"."roletaId", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."text" AS "perguntas.text", "perguntas"."options" AS "perguntas.options", "perguntas"."order" AS "perguntas.order", "perguntas"."required" AS "perguntas.required", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."description" AS "tenant.description", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "roleta"."id" AS "roleta.id", "roleta"."nome" AS "roleta.nome", "roleta"."descricao" AS "roleta.descricao", "roleta"."active" AS "roleta.active" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" LEFT OUTER JOIN "tenants" AS "tenant" ON "Pesquisa"."tenantId" = "tenant"."id" LEFT OUTER JOIN "roletas" AS "roleta" ON "Pesquisa"."roletaId" = "roleta"."id" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (ff2f87eb-f89f-4907-b403-fb36cc540c50): SELECT "Pesquisa"."id", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."title", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."options" AS "perguntas.options", "perguntas"."required" AS "perguntas.required", "perguntas"."text" AS "perguntas.text" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (ff2f87eb-f89f-4907-b403-fb36cc540c50): INSERT INTO "respostas" ("id","perguntaId","pesquisaId","tenantId","atendenteId","respondentSessionId","textValue","createdAt","updatedAt","ratingValue") VALUES ('42b540f1-a92f-4d25-a71e-7bdc32526427','3bcaef44-8ad1-4a95-a377-7fae3148fa97','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','67781806-855c-4e48-bf39-d1305176420a','0a19a706-16e8-43a7-a93a-d35ae7d42327','Preços baixos ','2026-02-06 23:22:14.257 +00:00','2026-02-06 23:22:14.257 +00:00',NULL),('064249ba-f038-46f1-a724-08dfb1eaee8f','19f1cec2-90b3-4223-b412-3c1d860e20a6','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','67781806-855c-4e48-bf39-d1305176420a','0a19a706-16e8-43a7-a93a-d35ae7d42327',NULL,'2026-02-06 23:22:14.257 +00:00','2026-02-06 23:22:14.257 +00:00',8),('c7335078-632e-4e12-8e36-8e101cbc5967','305b7330-b4c3-41b1-8fd1-0f3f91e7e936','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','67781806-855c-4e48-bf39-d1305176420a','0a19a706-16e8-43a7-a93a-d35ae7d42327',NULL,'2026-02-06 23:22:14.257 +00:00','2026-02-06 23:22:14.257 +00:00',4),('a15cde8d-68b5-4d03-9a95-c6f44bf06ec8','d91a3ab3-65e2-40d0-acfa-35133ed4a7d4','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','67781806-855c-4e48-bf39-d1305176420a','0a19a706-16e8-43a7-a93a-d35ae7d42327',NULL,'2026-02-06 23:22:14.257 +00:00','2026-02-06 23:22:14.257 +00:00',4),('706197db-af35-4645-915e-fd3d1c47e25c','635f7a66-33fd-40f4-89b4-3c7c83f003aa','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','67781806-855c-4e48-bf39-d1305176420a','0a19a706-16e8-43a7-a93a-d35ae7d42327',NULL,'2026-02-06 23:22:14.257 +00:00','2026-02-06 23:22:14.257 +00:00',4),('49f0300b-6db6-4220-bf63-d5c8a9d06a36','9e5e541a-1930-47da-81a5-e53892d8337a','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','67781806-855c-4e48-bf39-d1305176420a','0a19a706-16e8-43a7-a93a-d35ae7d42327',NULL,'2026-02-06 23:22:14.257 +00:00','2026-02-06 23:22:14.257 +00:00',4),('fa15aad3-e943-40eb-bbbb-1bde97b86494','f3480c2b-6f71-4b2e-bd3b-ac407d1c56dc','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','67781806-855c-4e48-bf39-d1305176420a','0a19a706-16e8-43a7-a93a-d35ae7d42327','Ótimo estabelecimento, porém entregas demoradas.','2026-02-06 23:22:14.257 +00:00','2026-02-06 23:22:14.257 +00:00',NULL),('d20cfb80-0c80-41e7-b459-911e5d793f96','2cbd96fb-faa2-495d-99dd-c57af8623c9d','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','67781806-855c-4e48-bf39-d1305176420a','0a19a706-16e8-43a7-a93a-d35ae7d42327',NULL,'2026-02-06 23:22:14.257 +00:00','2026-02-06 23:22:14.257 +00:00',5),('b74c8655-3305-4655-a7b9-4671c89ec161','89c2b3ed-7104-4a41-991d-565b70294215','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','67781806-855c-4e48-bf39-d1305176420a','0a19a706-16e8-43a7-a93a-d35ae7d42327',NULL,'2026-02-06 23:22:14.257 +00:00','2026-02-06 23:22:14.257 +00:00',3) RETURNING "id","perguntaId","pesquisaId","tenantId","atendenteId","respondentSessionId","ratingValue","textValue","selectedOption","createdAt","updatedAt";
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "postSaleDelayMinutes", "postSaleMessageTemplate", "postSaleSurveyId", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
Executing (default): SELECT "id", "name", "logoUrl", "primaryColor", "secondaryColor", "description" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT "id", "name", "logoUrl", "primaryColor", "secondaryColor", "description" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "tenantId" FROM "respostas" AS "Resposta" WHERE "Resposta"."respondentSessionId" = '0a19a706-16e8-43a7-a93a-d35ae7d42327' LIMIT 1;
Executing (dca2d98a-9687-4a33-bb83-e636cec5a56c): SELECT "id", "tenantId", "name", "email", "phone", "birthDate", "respondentSessionId", "gender", "createdAt", "updatedAt" FROM "clients" AS "Client" WHERE "Client"."email" = 'kingharlequinharlequin@gmail.com' AND "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 23:23:00.034 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "tenantId" FROM "respostas" AS "Resposta" WHERE "Resposta"."respondentSessionId" = '0a19a706-16e8-43a7-a93a-d35ae7d42327' LIMIT 1;
Executing (b88cb1e0-0e06-4d2a-a1cb-d49a7f1c9256): SELECT "id", "tenantId", "name", "email", "phone", "birthDate", "respondentSessionId", "gender", "createdAt", "updatedAt" FROM "clients" AS "Client" WHERE "Client"."email" = 'accmatias38@gmail.com' AND "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
Executing (b88cb1e0-0e06-4d2a-a1cb-d49a7f1c9256): SELECT "id", "tenantId", "name", "email", "phone", "birthDate", "respondentSessionId", "gender", "createdAt", "updatedAt" FROM "clients" AS "Client" WHERE "Client"."phone" = '(35) 99889-2973' AND "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
Executing (default): SELECT "id", "name", "logoUrl", "primaryColor", "secondaryColor", "description" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 23:24:00.029 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "Pesquisa"."id", "Pesquisa"."title", "Pesquisa"."description", "Pesquisa"."createdAt", "Pesquisa"."updatedAt", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."status", "Pesquisa"."recompensaId", "Pesquisa"."roletaId", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."text" AS "perguntas.text", "perguntas"."options" AS "perguntas.options", "perguntas"."order" AS "perguntas.order", "perguntas"."required" AS "perguntas.required", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."description" AS "tenant.description", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "roleta"."id" AS "roleta.id", "roleta"."nome" AS "roleta.nome", "roleta"."descricao" AS "roleta.descricao", "roleta"."active" AS "roleta.active" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" LEFT OUTER JOIN "tenants" AS "tenant" ON "Pesquisa"."tenantId" = "tenant"."id" LEFT OUTER JOIN "roletas" AS "roleta" ON "Pesquisa"."roletaId" = "roleta"."id" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (default): SELECT "id", "name" FROM "atendentes" AS "Atendente" WHERE "Atendente"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Atendente"."status" = 'active' ORDER BY "Atendente"."name" ASC;
Executing (default): SELECT "id", "name", "logoUrl", "primaryColor", "secondaryColor", "description" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT "id", "name", "logoUrl", "primaryColor", "secondaryColor", "description" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT "Pesquisa"."id", "Pesquisa"."title", "Pesquisa"."description", "Pesquisa"."createdAt", "Pesquisa"."updatedAt", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."status", "Pesquisa"."recompensaId", "Pesquisa"."roletaId", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."text" AS "perguntas.text", "perguntas"."options" AS "perguntas.options", "perguntas"."order" AS "perguntas.order", "perguntas"."required" AS "perguntas.required", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."description" AS "tenant.description", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "roleta"."id" AS "roleta.id", "roleta"."nome" AS "roleta.nome", "roleta"."descricao" AS "roleta.descricao", "roleta"."active" AS "roleta.active" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" LEFT OUTER JOIN "tenants" AS "tenant" ON "Pesquisa"."tenantId" = "tenant"."id" LEFT OUTER JOIN "roletas" AS "roleta" ON "Pesquisa"."roletaId" = "roleta"."id" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (default): SELECT "id", "tenantId", "name", "email", "phone", "birthDate", "respondentSessionId", "gender", "createdAt", "updatedAt" FROM "clients" AS "Client" WHERE "Client"."phone" = '(35) 99889-2973' AND "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
Executing (default): SELECT "pesquisaId", "tenantId" FROM "respostas" AS "Resposta" WHERE "Resposta"."respondentSessionId" = '0a19a706-16e8-43a7-a93a-d35ae7d42327' LIMIT 1;
Executing (default): SELECT "recompensaId" FROM "pesquisas" AS "Pesquisa" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (default): SELECT "Pesquisa"."id", "Pesquisa"."title", "Pesquisa"."description", "Pesquisa"."createdAt", "Pesquisa"."updatedAt", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."status", "Pesquisa"."recompensaId", "Pesquisa"."roletaId", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."text" AS "perguntas.text", "perguntas"."options" AS "perguntas.options", "perguntas"."order" AS "perguntas.order", "perguntas"."required" AS "perguntas.required", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."description" AS "tenant.description", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "roleta"."id" AS "roleta.id", "roleta"."nome" AS "roleta.nome", "roleta"."descricao" AS "roleta.descricao", "roleta"."active" AS "roleta.active" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" LEFT OUTER JOIN "tenants" AS "tenant" ON "Pesquisa"."tenantId" = "tenant"."id" LEFT OUTER JOIN "roletas" AS "roleta" ON "Pesquisa"."roletaId" = "roleta"."id" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (default): SELECT "id", "name", "logoUrl", "primaryColor", "secondaryColor", "description" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT "id", "tenantId", "creatorId", "title", "description", "startDate", "endDate", "isOpen", "askForAttendant", "status", "expectedRespondents", "dueDate", "recompensaId", "roletaId", "roletaPrizeMessage", "createdAt", "updatedAt" FROM "pesquisas" AS "Pesquisa" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (default): SELECT "id", "pesquisaId", "campanhaId", "tenantId", "recompensaId", "codigo", "clienteId", "dataGeracao", "dataUtilizacao", "dataValidade", "status", "ultimoContato", "createdAt", "updatedAt" FROM "cupons" AS "Cupom" WHERE "Cupom"."clienteId" = '7afc43a6-3305-444e-9efd-b7e5b3e89c56' AND "Cupom"."pesquisaId" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4' ORDER BY "Cupom"."dataGeracao" DESC LIMIT 1;
Executing (default): SELECT "RoletaPremio"."id", "RoletaPremio"."tenantId", "RoletaPremio"."nome", "RoletaPremio"."descricao", "RoletaPremio"."porcentagem", "RoletaPremio"."cor", "RoletaPremio"."recompensaId", "RoletaPremio"."roletaId", "RoletaPremio"."imageUrl", "RoletaPremio"."active", "RoletaPremio"."isNoPrizeOption", "RoletaPremio"."createdAt", "RoletaPremio"."updatedAt", "recompensa"."id" AS "recompensa.id", "recompensa"."tenantId" AS "recompensa.tenantId", "recompensa"."name" AS "recompensa.name", "recompensa"."description" AS "recompensa.description", "recompensa"."conditionDescription" AS "recompensa.conditionDescription", "recompensa"."pointsRequired" AS "recompensa.pointsRequired", "recompensa"."type" AS "recompensa.type", "recompensa"."value" AS "recompensa.value", "recompensa"."imageUrl" AS "recompensa.imageUrl", "recompensa"."active" AS "recompensa.active", "recompensa"."createdAt" AS "recompensa.createdAt", "recompensa"."updatedAt" AS "recompensa.updatedAt" FROM "roleta_premios" AS "RoletaPremio" LEFT OUTER JOIN "recompensas" AS "recompensa" ON "RoletaPremio"."recompensaId" = "recompensa"."id" WHERE "RoletaPremio"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "RoletaPremio"."roletaId" = 'f4da8c53-db4f-4452-8c7d-505be5e99657' ORDER BY "RoletaPremio"."nome" ASC;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[Delivery Much Job] Starting Polling...
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 23:25:00.071 +00:00' LIMIT 50;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 23:26:00.047 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 23:27:00.046 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 23:28:00.045 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 23:29:00.041 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Iniciando processamento do webhook do Uai Rango: {
  "id_estabelecimento": 4659,
  "cod_pedido": "0A03D9818",
  "data": "2026-02-06 20:29:29",
  "pedido_pronto": 0,
  "data_pedido_pronto": null,

  "cupom": {
    "codigo": "ESQUENTA",
    "tipo": "Porcentagem",
    "valor": "20",
    "desconto_maximo": 10,
    "desconto_valor": 8.598
  },
  "tipo_entrega": "Delivery",
  "prazo": null,
  "prazo_min": 30,
  "prazo_max": 50,
  "categoria_pagamento": "Pagamento Online",
  "forma_pagamento": "Pagamento Online",
  "valor_total": 42.99,
  "observacao": "",
  "taxa_entrega": 3,
  "nome_taxa_entrega": "Bairros",
  "status": {

    "id": 0,
    "status": "Pendente"
  },
  "produtos": [
    {
      "id_categoria": 307609,
      "codigo_categoria": "",
      "categoria": "Novos Combos de Esfiha",
      "id_opcao": 595325,
      "opcao": "Combo",
      "id_produto": 2277723,
      "codigo": "",
      "produto": "Combo 06",
      "id_produto_2": null,
      "codigo_2": "",
      "produto_2": null,
      "obs": "",
      "valor": 42.99,
      "quantidade": 1,
      "adicionais": []
    }
  ],
  "usuario": {
    "id": "086ce2dd8d113a84",
    "nome": "Jamilly",
    "tel1": "35991307081"
  },
  "endereco": {
    "id": 4037781,
    "uf": "MG",
    "cidade": "Andradas",
    "bairro": "Samambaia",
    "rua": "Rua Benedito Felisberto dos Reis",
    "num": "",
    "complemento": "Ap 2",
    "ponto_referencia": "Do lado da mais que sabor/em cima do Rafael tênis "
  }
}
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "gmb_link", "uairangoEstablishmentId", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt", "ifoodClientId", "ifoodClientSecret", "ifoodAuthVerifier", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt", "franchisorId", "plan", "planExpiresAt", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."uairangoEstablishmentId" = '4659';
[UaiRango Webhook] Tenant encontrado: eb629ea8-7d69-47a1-b1f1-f9dcb33475f4 para o pedido 0A03D9818
Executing (default): SELECT "id", "tenantId", "name", "email", "phone", "birthDate", "respondentSessionId", "gender", "createdAt", "updatedAt" FROM "clients" AS "Client" WHERE "Client"."phone" = '35991307081' AND "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
[UaiRango Webhook] Cliente existente encontrado: 4146610a-0e0d-43b3-bfad-dfae5f7c0f1e para o pedido 0A03D9818
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."platform" = 'UaiRango' AND "DeliveryOrder"."orderIdPlatform" = '0A03D9818';
Executing (default): INSERT INTO "delivery_orders" ("id","platform","orderIdPlatform","totalAmount","orderDate","payload","clientId","tenantId","surveyStatus","createdAt","updatedAt") VALUES ($1,$2,$3,$4,$5,$6,$7,$8,$9,$10,$11) RETURNING "id","platform","orderIdPlatform","totalAmount","orderDate","payload","clientId","tenantId","surveyStatus","surveyScheduledAt","surveySentAt","createdAt","updatedAt";
[UaiRango Webhook] DeliveryOrder criado: 97c7d66c-754b-4dfd-b583-6cbafbfca990 para o pedido 0A03D9818
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "postSaleDelayMinutes", "postSaleMessageTemplate", "postSaleSurveyId", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
Executing (default): UPDATE "delivery_orders" SET "surveyStatus"=$1,"surveyScheduledAt"=$2,"updatedAt"=$3 WHERE "id" = $4
Pesquisa agendada para o pedido 97c7d66c-754b-4dfd-b583-6cbafbfca990. Delay: 90 min. Envio em: Sat Feb 07 2026 00:59:31 GMT+0000 (Coordinated Universal Time)
[UaiRango Webhook] Pesquisa de satisfação agendada para cliente 4146610a-0e0d-43b3-bfad-dfae5f7c0f1e, pedido 97c7d66c-754b-4dfd-b583-6cbafbfca990.
[CAMPAIGN_MONITOR] Iniciando verificação de campanhas pausadas...
[Delivery Much Job] Starting Polling...
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."status" = 'paused';
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 23:30:00.118 +00:00' LIMIT 50;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[CAMPAIGN_MONITOR] Nenhuma campanha pausada encontrada.
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 23:31:00.042 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 23:32:00.039 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 23:33:00.033 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 23:34:00.029 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[Delivery Much Job] Starting Polling...
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 23:35:00.071 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 23:36:00.037 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 23:37:00.030 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 23:38:00.029 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 23:39:00.043 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[CAMPAIGN_MONITOR] Iniciando verificação de campanhas pausadas...
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[iFood Job] Starting Polling...
[Delivery Much Job] Starting Polling...
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."status" = 'paused';
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[CAMPAIGN_MONITOR] Nenhuma campanha pausada encontrada.
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 23:40:00.072 +00:00' LIMIT 50;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 23:41:00.037 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 23:42:00.036 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 23:43:00.035 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 23:44:00.030 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[Delivery Much Job] Starting Polling...
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 23:45:00.075 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 23:46:00.033 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 23:47:00.043 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 23:48:00.038 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "name", "logoUrl", "primaryColor", "secondaryColor", "description" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT "Pesquisa"."id", "Pesquisa"."title", "Pesquisa"."description", "Pesquisa"."createdAt", "Pesquisa"."updatedAt", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."status", "Pesquisa"."recompensaId", "Pesquisa"."roletaId", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."text" AS "perguntas.text", "perguntas"."options" AS "perguntas.options", "perguntas"."order" AS "perguntas.order", "perguntas"."required" AS "perguntas.required", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."description" AS "tenant.description", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "roleta"."id" AS "roleta.id", "roleta"."nome" AS "roleta.nome", "roleta"."descricao" AS "roleta.descricao", "roleta"."active" AS "roleta.active" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" LEFT OUTER JOIN "tenants" AS "tenant" ON "Pesquisa"."tenantId" = "tenant"."id" LEFT OUTER JOIN "roletas" AS "roleta" ON "Pesquisa"."roletaId" = "roleta"."id" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 23:49:00.037 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[Delivery Much Job] Starting Polling...
[CAMPAIGN_MONITOR] Iniciando verificação de campanhas pausadas...
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."status" = 'paused';
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 23:50:00.078 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[CAMPAIGN_MONITOR] Nenhuma campanha pausada encontrada.
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 23:51:00.045 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 23:52:00.037 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 23:53:00.038 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 23:54:00.032 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
[Delivery Much Job] Starting Polling...
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 23:55:00.061 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 23:56:00.030 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 23:57:00.028 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "Pesquisa"."id", "Pesquisa"."title", "Pesquisa"."description", "Pesquisa"."createdAt", "Pesquisa"."updatedAt", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."status", "Pesquisa"."recompensaId", "Pesquisa"."roletaId", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."text" AS "perguntas.text", "perguntas"."options" AS "perguntas.options", "perguntas"."order" AS "perguntas.order", "perguntas"."required" AS "perguntas.required", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."description" AS "tenant.description", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "roleta"."id" AS "roleta.id", "roleta"."nome" AS "roleta.nome", "roleta"."descricao" AS "roleta.descricao", "roleta"."active" AS "roleta.active" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" LEFT OUTER JOIN "tenants" AS "tenant" ON "Pesquisa"."tenantId" = "tenant"."id" LEFT OUTER JOIN "roletas" AS "roleta" ON "Pesquisa"."roletaId" = "roleta"."id" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (default): SELECT "id", "name" FROM "atendentes" AS "Atendente" WHERE "Atendente"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Atendente"."status" = 'active' ORDER BY "Atendente"."name" ASC;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 23:58:00.036 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "askForAttendant" FROM "pesquisas" AS "Pesquisa" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (default): SELECT "Pesquisa"."id", "Pesquisa"."title", "Pesquisa"."description", "Pesquisa"."createdAt", "Pesquisa"."updatedAt", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."status", "Pesquisa"."recompensaId", "Pesquisa"."roletaId", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."text" AS "perguntas.text", "perguntas"."options" AS "perguntas.options", "perguntas"."order" AS "perguntas.order", "perguntas"."required" AS "perguntas.required", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."description" AS "tenant.description", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "roleta"."id" AS "roleta.id", "roleta"."nome" AS "roleta.nome", "roleta"."descricao" AS "roleta.descricao", "roleta"."active" AS "roleta.active" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" LEFT OUTER JOIN "tenants" AS "tenant" ON "Pesquisa"."tenantId" = "tenant"."id" LEFT OUTER JOIN "roletas" AS "roleta" ON "Pesquisa"."roletaId" = "roleta"."id" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (c21ebf44-47fc-49cd-a812-4b39792c8cce): SELECT "Pesquisa"."id", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."title", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."options" AS "perguntas.options", "perguntas"."required" AS "perguntas.required", "perguntas"."text" AS "perguntas.text" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (c21ebf44-47fc-49cd-a812-4b39792c8cce): INSERT INTO "respostas" ("id","perguntaId","pesquisaId","tenantId","atendenteId","respondentSessionId","textValue","createdAt","updatedAt","ratingValue") VALUES ('fd910df6-ec6a-4d50-9f62-98c711c5660a','3bcaef44-8ad1-4a95-a377-7fae3148fa97','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','d1ec3ff8-81b0-4d89-9d7b-9da2f859fc07','a664eefa-ce82-4898-9516-3f9389edb646','Anéis de cebola','2026-02-06 23:58:37.949 +00:00','2026-02-06 23:58:37.949 +00:00',NULL),('97d73c31-25f8-4de6-a12c-89eb762fcb62','19f1cec2-90b3-4223-b412-3c1d860e20a6','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','d1ec3ff8-81b0-4d89-9d7b-9da2f859fc07','a664eefa-ce82-4898-9516-3f9389edb646',NULL,'2026-02-06 23:58:37.949 +00:00','2026-02-06 23:58:37.949 +00:00',10),('71029b1d-dae6-483f-831d-0aef8ba1cf6f','305b7330-b4c3-41b1-8fd1-0f3f91e7e936','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','d1ec3ff8-81b0-4d89-9d7b-9da2f859fc07','a664eefa-ce82-4898-9516-3f9389edb646',NULL,'2026-02-06 23:58:37.949 +00:00','2026-02-06 23:58:37.949 +00:00',5),('fd3f8710-2eb4-4097-b6ed-1f16ec52ec23','d91a3ab3-65e2-40d0-acfa-35133ed4a7d4','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','d1ec3ff8-81b0-4d89-9d7b-9da2f859fc07','a664eefa-ce82-4898-9516-3f9389edb646',NULL,'2026-02-06 23:58:37.949 +00:00','2026-02-06 23:58:37.949 +00:00',5),('2bf2ce7a-a211-4480-a4de-046f28824c84','635f7a66-33fd-40f4-89b4-3c7c83f003aa','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','d1ec3ff8-81b0-4d89-9d7b-9da2f859fc07','a664eefa-ce82-4898-9516-3f9389edb646',NULL,'2026-02-06 23:58:37.949 +00:00','2026-02-06 23:58:37.949 +00:00',5),('f540379f-c4bc-431b-90b3-483e65b4f73f','9e5e541a-1930-47da-81a5-e53892d8337a','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','d1ec3ff8-81b0-4d89-9d7b-9da2f859fc07','a664eefa-ce82-4898-9516-3f9389edb646',NULL,'2026-02-06 23:58:37.949 +00:00','2026-02-06 23:58:37.949 +00:00',5),('8af28115-e7a5-4ca3-a554-44319a4a19c4','f3480c2b-6f71-4b2e-bd3b-ac407d1c56dc','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','d1ec3ff8-81b0-4d89-9d7b-9da2f859fc07','a664eefa-ce82-4898-9516-3f9389edb646','Pizza e atendimento bons ','2026-02-06 23:58:37.949 +00:00','2026-02-06 23:58:37.949 +00:00',NULL),('e695167f-bda4-4b4e-9222-0817456ac455','2cbd96fb-faa2-495d-99dd-c57af8623c9d','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','d1ec3ff8-81b0-4d89-9d7b-9da2f859fc07','a664eefa-ce82-4898-9516-3f9389edb646',NULL,'2026-02-06 23:58:37.949 +00:00','2026-02-06 23:58:37.949 +00:00',5),('29021e47-843f-4f47-ae67-d4095713a8b0','89c2b3ed-7104-4a41-991d-565b70294215','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','d1ec3ff8-81b0-4d89-9d7b-9da2f859fc07','a664eefa-ce82-4898-9516-3f9389edb646',NULL,'2026-02-06 23:58:37.949 +00:00','2026-02-06 23:58:37.949 +00:00',4) RETURNING "id","perguntaId","pesquisaId","tenantId","atendenteId","respondentSessionId","ratingValue","textValue","selectedOption","createdAt","updatedAt";
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "postSaleDelayMinutes", "postSaleMessageTemplate", "postSaleSurveyId", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-06 23:59:00.034 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "name", "logoUrl", "primaryColor", "secondaryColor", "description" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT "id", "name", "logoUrl", "primaryColor", "secondaryColor", "description" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[iFood Job] Starting Polling...
[CAMPAIGN_MONITOR] Iniciando verificação de campanhas pausadas...
[Delivery Much Job] Starting Polling...
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 00:00:00.100 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."status" = 'paused';
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[CAMPAIGN_MONITOR] Nenhuma campanha pausada encontrada.
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "tenantId" FROM "respostas" AS "Resposta" WHERE "Resposta"."respondentSessionId" = 'a664eefa-ce82-4898-9516-3f9389edb646' LIMIT 1;
Executing (ffe6d2b9-4515-459c-ad04-fc823faf0930): SELECT "id", "tenantId", "name", "email", "phone", "birthDate", "respondentSessionId", "gender", "createdAt", "updatedAt" FROM "clients" AS "Client" WHERE "Client"."email" = 'paulamedeirossimionato@gmail.com' AND "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
Executing (ffe6d2b9-4515-459c-ad04-fc823faf0930): SELECT "id", "tenantId", "name", "email", "phone", "birthDate", "respondentSessionId", "gender", "createdAt", "updatedAt" FROM "clients" AS "Client" WHERE "Client"."phone" = '(35) 99775-3812' AND "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
Executing (ffe6d2b9-4515-459c-ad04-fc823faf0930): SELECT "id", "tenantId", "name", "email", "phone", "birthDate", "respondentSessionId", "gender", "createdAt", "updatedAt" FROM "clients" AS "Client" WHERE "Client"."respondentSessionId" = 'a664eefa-ce82-4898-9516-3f9389edb646';
Executing (ffe6d2b9-4515-459c-ad04-fc823faf0930): INSERT INTO "clients" ("id","tenantId","name","email","phone","birthDate","respondentSessionId","gender","createdAt","updatedAt") VALUES ($1,$2,$3,$4,$5,$6,$7,$8,$9,$10) RETURNING "id","tenantId","name","email","phone","birthDate","respondentSessionId","gender","createdAt","updatedAt";
Executing (ffe6d2b9-4515-459c-ad04-fc823faf0930): SELECT "pesquisaId", "tenantId" FROM "respostas" AS "Resposta" WHERE "Resposta"."respondentSessionId" = 'a664eefa-ce82-4898-9516-3f9389edb646' LIMIT 1;
Executing (ffe6d2b9-4515-459c-ad04-fc823faf0930): SELECT "recompensaId" FROM "pesquisas" AS "Pesquisa" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 00:01:00.034 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "Pesquisa"."id", "Pesquisa"."title", "Pesquisa"."description", "Pesquisa"."createdAt", "Pesquisa"."updatedAt", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."status", "Pesquisa"."recompensaId", "Pesquisa"."roletaId", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."text" AS "perguntas.text", "perguntas"."options" AS "perguntas.options", "perguntas"."order" AS "perguntas.order", "perguntas"."required" AS "perguntas.required", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."description" AS "tenant.description", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "roleta"."id" AS "roleta.id", "roleta"."nome" AS "roleta.nome", "roleta"."descricao" AS "roleta.descricao", "roleta"."active" AS "roleta.active" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" LEFT OUTER JOIN "tenants" AS "tenant" ON "Pesquisa"."tenantId" = "tenant"."id" LEFT OUTER JOIN "roletas" AS "roleta" ON "Pesquisa"."roletaId" = "roleta"."id" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (default): SELECT "id", "name", "logoUrl", "primaryColor", "secondaryColor", "description" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT "id", "tenantId", "creatorId", "title", "description", "startDate", "endDate", "isOpen", "askForAttendant", "status", "expectedRespondents", "dueDate", "recompensaId", "roletaId", "roletaPrizeMessage", "createdAt", "updatedAt" FROM "pesquisas" AS "Pesquisa" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (default): SELECT "id", "pesquisaId", "campanhaId", "tenantId", "recompensaId", "codigo", "clienteId", "dataGeracao", "dataUtilizacao", "dataValidade", "status", "ultimoContato", "createdAt", "updatedAt" FROM "cupons" AS "Cupom" WHERE "Cupom"."clienteId" = '42c5cf9f-b0f3-4f09-a290-0e1711cad84c' AND "Cupom"."pesquisaId" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4' ORDER BY "Cupom"."dataGeracao" DESC LIMIT 1;
Executing (default): SELECT "RoletaPremio"."id", "RoletaPremio"."tenantId", "RoletaPremio"."nome", "RoletaPremio"."descricao", "RoletaPremio"."porcentagem", "RoletaPremio"."cor", "RoletaPremio"."recompensaId", "RoletaPremio"."roletaId", "RoletaPremio"."imageUrl", "RoletaPremio"."active", "RoletaPremio"."isNoPrizeOption", "RoletaPremio"."createdAt", "RoletaPremio"."updatedAt", "recompensa"."id" AS "recompensa.id", "recompensa"."tenantId" AS "recompensa.tenantId", "recompensa"."name" AS "recompensa.name", "recompensa"."description" AS "recompensa.description", "recompensa"."conditionDescription" AS "recompensa.conditionDescription", "recompensa"."pointsRequired" AS "recompensa.pointsRequired", "recompensa"."type" AS "recompensa.type", "recompensa"."value" AS "recompensa.value", "recompensa"."imageUrl" AS "recompensa.imageUrl", "recompensa"."active" AS "recompensa.active", "recompensa"."createdAt" AS "recompensa.createdAt", "recompensa"."updatedAt" AS "recompensa.updatedAt" FROM "roleta_premios" AS "RoletaPremio" LEFT OUTER JOIN "recompensas" AS "recompensa" ON "RoletaPremio"."recompensaId" = "recompensa"."id" WHERE "RoletaPremio"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "RoletaPremio"."roletaId" = 'f4da8c53-db4f-4452-8c7d-505be5e99657' ORDER BY "RoletaPremio"."nome" ASC;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "tenantId", "creatorId", "title", "description", "startDate", "endDate", "isOpen", "askForAttendant", "status", "expectedRespondents", "dueDate", "recompensaId", "roletaId", "roletaPrizeMessage", "createdAt", "updatedAt" FROM "pesquisas" AS "Pesquisa" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (default): SELECT "id", "tenantId", "name", "email", "phone", "birthDate", "respondentSessionId", "gender", "createdAt", "updatedAt" FROM "clients" AS "Client" WHERE "Client"."id" = '42c5cf9f-b0f3-4f09-a290-0e1711cad84c';
Executing (default): SELECT "id", "pesquisaId", "campanhaId", "tenantId", "recompensaId", "codigo", "clienteId", "dataGeracao", "dataUtilizacao", "dataValidade", "status", "ultimoContato", "createdAt", "updatedAt" FROM "cupons" AS "Cupom" WHERE "Cupom"."clienteId" = '42c5cf9f-b0f3-4f09-a290-0e1711cad84c' AND "Cupom"."pesquisaId" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4' ORDER BY "Cupom"."dataGeracao" DESC LIMIT 1;
Executing (default): SELECT "RoletaPremio"."id", "RoletaPremio"."tenantId", "RoletaPremio"."nome", "RoletaPremio"."descricao", "RoletaPremio"."porcentagem", "RoletaPremio"."cor", "RoletaPremio"."recompensaId", "RoletaPremio"."roletaId", "RoletaPremio"."imageUrl", "RoletaPremio"."active", "RoletaPremio"."isNoPrizeOption", "RoletaPremio"."createdAt", "RoletaPremio"."updatedAt", "recompensa"."id" AS "recompensa.id", "recompensa"."tenantId" AS "recompensa.tenantId", "recompensa"."name" AS "recompensa.name", "recompensa"."description" AS "recompensa.description", "recompensa"."conditionDescription" AS "recompensa.conditionDescription", "recompensa"."pointsRequired" AS "recompensa.pointsRequired", "recompensa"."type" AS "recompensa.type", "recompensa"."value" AS "recompensa.value", "recompensa"."imageUrl" AS "recompensa.imageUrl", "recompensa"."active" AS "recompensa.active", "recompensa"."createdAt" AS "recompensa.createdAt", "recompensa"."updatedAt" AS "recompensa.updatedAt" FROM "roleta_premios" AS "RoletaPremio" LEFT OUTER JOIN "recompensas" AS "recompensa" ON "RoletaPremio"."recompensaId" = "recompensa"."id" WHERE "RoletaPremio"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "RoletaPremio"."roletaId" = 'f4da8c53-db4f-4452-8c7d-505be5e99657' ORDER BY "RoletaPremio"."nome" ASC;
Executing (default): INSERT INTO "cupons" ("id","pesquisaId","tenantId","recompensaId","codigo","clienteId","dataGeracao","dataValidade","status","createdAt","updatedAt") VALUES ($1,$2,$3,$4,$5,$6,$7,$8,$9,$10,$11) RETURNING "id","pesquisaId","campanhaId","tenantId","recompensaId","codigo","clienteId","dataGeracao","dataUtilizacao","dataValidade","status","ultimoContato","createdAt","updatedAt";
[RoletaController] Iniciando envio de mensagem de prêmio para o tenant eb629ea8-7d69-47a1-b1f1-f9dcb33475f4.
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "postSaleDelayMinutes", "postSaleMessageTemplate", "postSaleSurveyId", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
[RoletaController] Config do WhatsApp para o tenant eb629ea8-7d69-47a1-b1f1-f9dcb33475f4: {
  apiKey: '9df82dcbee60ce08f6ca93aa4024ca6c',
  instanceApiKey: '1EF60F67-BF10-4F82-9BB8-80124CCB17AC',
  id: 'b9d07194-31e9-49e7-bdb8-55d6b3596ef9',
  url: 'https://evolution2.towersfy.com',
  instanceName: 'roma-pizzaria--chopperia',
  instanceStatus: 'disconnected',
  tenantId: 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4',
  sendPrizeMessage: true,
  prizeMessageTemplate: '🎰 *UAAAU, {{cliente}}!* 😍  \n' +
    'Você acabou de girar a *Roleta Premiada da Roma* e saiu com sorte grande! 🍀🔥 \n' +
    '\n' +
    'Você recebeu para usar na sua proxima visita:\n' +
    '🎁 *Prêmio:* *{{premio}}*\n' +
    'Pra resgatar, é só mostrar o cupom 👉 *{{cupom}}* aqui no salão da **Roma Pizzaria & Chopperia** 🍕✨  \n' +
    '\n' +
    'Vem curtir seu prêmio com a galera e comemorar essa sorte toda! 🎉  \n' +
    '📍 *Roma Pizzaria* — diversão, sabor e prêmios te esperando! 😋\n',
  dailyReportEnabled: true,
  reportPhoneNumbers: '5535991090766,553591523297,553598374007',
  weeklyReportEnabled: true,
  monthlyReportEnabled: true,
  birthdayAutomationEnabled: true,
  birthdayMessageTemplate: '🎉 *Seu aniversário tá chegando, {{cliente}}!* 🥳  \n' +
    'E a *Roma Pizzaria* já separou um presente de respeito pra você 🍕🔥  \n' +
    '\n' +
    '🎁 *RODIZIO GRÁTIS* pra você comemorar do jeito certo!  \n' +
    'É só vir até o salão, aproveitar o rodízio e apresentar o cupom 👉 *{{cupom}}* \n' +
    '\n' +
    '📅 Valido para *semana do seu aniversário*,  \n' +
    'lembrando que o *rodízio acontece toda quarta, quinta e sexta* 😉  \n' +
    '\n' +
    '📍 *Válido exclusivamente no salão*  \n' +
    'Chama a galera, escolhe o dia e vem aproveitar! 🎂🍻  \n' +
    '\n' +
    '**Roma Pizzaria** 😍🍕',
  birthdayDaysBefore: 7,
  birthdayRewardType: 'recompensa',
  birthdayRewardId: '17ea8117-07e1-4fca-944b-8454f78079ad',
  birthdayCouponValidityDays: 30,
  sendDetractorMessageToClient: true,
  detractorMessageTemplate: 'Olá, {{cliente}}! 👋\n' +
    '\n' +
    'Recebemos sua avaliação com a nota **{{nota}}** e queremos agradecer por compartilhar sua experiência.  \n' +
    'Lamentamos muito que algo não tenha saído como esperado. 😔\n' +
    '\n' +
    'Seu comentário: _"{{comentario}}"_\n' +
    '\n' +
    'Estamos aqui para resolver isso o mais rápido possível.  \n' +
    'Poderia nos contar um pouco mais sobre o que aconteceu? Seu retorno é essencial para que possamos melhorar e garantir uma próxima experiência muito melhor. 🙏\n' +
    '\n' +
    'Obrigado por nos ajudar a evoluir!  \n' +
    'Nossa equipe está à disposição.\n',
  notifyDetractorToOwner: true,
  detractorOwnerMessageTemplate: '## 🚨 **Alerta de Detrator**\n' +
    '\n' +
    'O cliente **{{cliente}}** registrou uma avaliação **baixa**:\n' +
    '\n' +
    '- **Nota:** **{{nota}}**\n' +
    '- **Comentário:** _"{{comentario}}"_',
  detractorOwnerPhoneNumbers: '5535991090766,553591523297,553598374007',
  postSaleDelayMinutes: 90,
  postSaleMessageTemplate: '🍕 **Olá, {{cliente}}!**  \n' +
    '\n' +
    'Esperamos que você tenha curtido seu pedido da **Roma Pizzaria** 😍  \n' +
    '\n' +
    'Sua opinião é *muito importante* pra gente — é com ela que conseguimos melhorar sabores, atendimento e experiência a cada pedido.\n' +
    '\n' +
    '📝 **Leva menos de 1 minuto:**  \n' +
    '👉 {{link_pesquisa}}\n' +
    '\n' +
    'Como agradecimento, você pode receber **vantagens especiais** nos próximos pedidos 😉\n' +
    '\n' +
    'Obrigado por escolher a Roma ❤️  \n' +
    '*Tradição, sabor e respeito por cada cliente.*',
  postSaleSurveyId: '362bd09a-762a-49d4-9651-415955567e6a',
  createdAt: 2025-11-28T21:25:29.661Z,
  updatedAt: 2026-02-05T22:49:26.315Z
}
[RoletaController] Todas as condições para enviar a mensagem de prêmio foram atendidas para o tenant eb629ea8-7d69-47a1-b1f1-f9dcb33475f4.
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "postSaleDelayMinutes", "postSaleMessageTemplate", "postSaleSurveyId", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "postSaleDelayMinutes", "postSaleMessageTemplate", "postSaleSurveyId", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
[WhatsappService] Resposta da API de status da instância: {
  "instance": {
    "instanceName": "roma-pizzaria--chopperia",
    "state": "close"
  }
}
[RoletaController] Falha ao tentar enviar mensagem de prêmio via WhatsApp para o tenant eb629ea8-7d69-47a1-b1f1-f9dcb33475f4. Erro: A instância do WhatsApp desta loja não está conectada.
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 00:02:00.029 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 00:03:00.041 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 00:04:00.042 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[Delivery Much Job] Starting Polling...
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 00:05:00.076 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Iniciando processamento do webhook do Uai Rango: {
  "id_estabelecimento": 4659,
  "cod_pedido": "B4B85950A",
  "data": "2026-02-06 21:05:21",
  "pedido_pronto": 0,
  "data_pedido_pronto": null,
  "cupom": null,
  "tipo_entrega": "Delivery",
  "prazo": null,
  "prazo_min": 30,
  "prazo_max": 50,
  "categoria_pagamento": "Dinheiro",
  "forma_pagamento": "Dinheiro",
  "troco": 100,
  "valor_total": 28.5,
  "observacao": "",
  "taxa_entrega": 3,
  "nome_taxa_entrega": "Bairros",
  "status": {

    "id": 0,
    "status": "Pendente"
  },
  "produtos": [
    {
      "id_categoria": 31375,
      "codigo_categoria": "",
      "categoria": "Esfihas Abertas Salgadas",
      "id_opcao": 61487,
      "opcao": "Único",
      "id_produto": 244614,
      "codigo": "",
      "produto": "Quatrino",
      "id_produto_2": null,
      "codigo_2": "",
      "produto_2": null,
      "obs": "",
      "valor": 11,
      "quantidade": 1,
      "adicionais": []
    },
    {
      "id_categoria": 31377,
      "codigo_categoria": "",
      "categoria": "Esfihas Doces",
      "id_opcao": 61489,
      "opcao": "Único",
      "id_produto": 2218133,
      "codigo": "",
      "produto": "Banana Nevada",
      "id_produto_2": null,
      "codigo_2": "",
      "produto_2": null,
      "obs": "",
      "valor": 11,
      "quantidade": 1,
      "adicionais": []
    },
    {
      "id_categoria": 31375,
      "codigo_categoria": "",
      "categoria": "Esfihas Abertas Salgadas",
      "id_opcao": 61487,
      "opcao": "Único",
      "id_produto": 244603,
      "codigo": "",
      "produto": "Mussarela",
      "id_produto_2": null,
      "codigo_2": "",
      "produto_2": null,
      "obs": "",
      "valor": 6.5,
      "quantidade": 1,
      "adicionais": []
    }
  ],
  "usuario": {
    "id": "953b0b0dd6ca051d",
    "nome": "luis claudio caldas",
    "tel1": "35991822696"
  },
  "endereco": {
    "id": 275755,
    "uf": "Mg",
    "cidade": "Andradas ",
    "bairro": "Vila caracol",
    "rua": "Solon Ribeiro ",
    "num": "190",
    "complemento": "",
    "ponto_referencia": "Perto de escola Paulo Drummond "
  }
}
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "gmb_link", "uairangoEstablishmentId", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt", "ifoodClientId", "ifoodClientSecret", "ifoodAuthVerifier", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt", "franchisorId", "plan", "planExpiresAt", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."uairangoEstablishmentId" = '4659';
[UaiRango Webhook] Tenant encontrado: eb629ea8-7d69-47a1-b1f1-f9dcb33475f4 para o pedido B4B85950A
Executing (default): SELECT "id", "tenantId", "name", "email", "phone", "birthDate", "respondentSessionId", "gender", "createdAt", "updatedAt" FROM "clients" AS "Client" WHERE "Client"."phone" = '35991822696' AND "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
Executing (default): INSERT INTO "clients" ("id","tenantId","name","phone","createdAt","updatedAt") VALUES ($1,$2,$3,$4,$5,$6) RETURNING "id","tenantId","name","email","phone","birthDate","respondentSessionId","gender","createdAt","updatedAt";
[UaiRango Webhook] Novo cliente criado: 1a40a1e8-0537-4fb6-9c95-042ee9011e78 para o pedido B4B85950A
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."platform" = 'UaiRango' AND "DeliveryOrder"."orderIdPlatform" = 'B4B85950A';
Executing (default): INSERT INTO "delivery_orders" ("id","platform","orderIdPlatform","totalAmount","orderDate","payload","clientId","tenantId","surveyStatus","createdAt","updatedAt") VALUES ($1,$2,$3,$4,$5,$6,$7,$8,$9,$10,$11) RETURNING "id","platform","orderIdPlatform","totalAmount","orderDate","payload","clientId","tenantId","surveyStatus","surveyScheduledAt","surveySentAt","createdAt","updatedAt";
[UaiRango Webhook] DeliveryOrder criado: f48be6f4-ecd8-435a-87e2-cc1f75cadecf para o pedido B4B85950A
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "postSaleDelayMinutes", "postSaleMessageTemplate", "postSaleSurveyId", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
Executing (default): UPDATE "delivery_orders" SET "surveyStatus"=$1,"surveyScheduledAt"=$2,"updatedAt"=$3 WHERE "id" = $4
Pesquisa agendada para o pedido f48be6f4-ecd8-435a-87e2-cc1f75cadecf. Delay: 90 min. Envio em: Sat Feb 07 2026 01:35:31 GMT+0000 (Coordinated Universal Time)
[UaiRango Webhook] Pesquisa de satisfação agendada para cliente 1a40a1e8-0537-4fb6-9c95-042ee9011e78, pedido f48be6f4-ecd8-435a-87e2-cc1f75cadecf.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 00:06:00.035 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[Post-Sale Survey Job] Encontrados 1 pedidos pendentes de pesquisa.
Executing (default): SELECT "id", "tenantId", "name", "email", "phone", "birthDate", "respondentSessionId", "gender", "createdAt", "updatedAt" FROM "clients" AS "Client" WHERE "Client"."id" = '64ac41d3-c3b6-49a1-8211-8776bbd2bccd' AND "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "postSaleDelayMinutes", "postSaleMessageTemplate", "postSaleSurveyId", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
Erro ao enviar pesquisa de satisfação para o cliente 64ac41d3-c3b6-49a1-8211-8776bbd2bccd (tenant: eb629ea8-7d69-47a1-b1f1-f9dcb33475f4, pedido: 212421ed-5082-422b-9436-72e32d766327): TypeError: Cannot read properties of undefined (reading 'findByPk')
    at Object.sendSatisfactionSurvey (/usr/src/app/src/services/surveyTriggerService.js:63:31)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async cron.schedule.scheduled (/usr/src/app/src/jobs/postSaleSurveyJob.js:38:17)
    at async Timeout._onTimeout (/usr/src/app/node_modules/node-cron/dist/cjs/scheduler/runner.js:70:44)
Executing (default): UPDATE "delivery_orders" SET "surveyStatus"=$1,"updatedAt"=$2 WHERE "id" = $3
[Post-Sale Survey Job] Falha ao processar pedido 212421ed-5082-422b-9436-72e32d766327: Falha ao enviar pesquisa de satisfação.
Executing (default): SELECT "id", "name", "logoUrl", "primaryColor", "secondaryColor", "description" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT "Pesquisa"."id", "Pesquisa"."title", "Pesquisa"."description", "Pesquisa"."createdAt", "Pesquisa"."updatedAt", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."status", "Pesquisa"."recompensaId", "Pesquisa"."roletaId", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."text" AS "perguntas.text", "perguntas"."options" AS "perguntas.options", "perguntas"."order" AS "perguntas.order", "perguntas"."required" AS "perguntas.required", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."description" AS "tenant.description", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "roleta"."id" AS "roleta.id", "roleta"."nome" AS "roleta.nome", "roleta"."descricao" AS "roleta.descricao", "roleta"."active" AS "roleta.active" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" LEFT OUTER JOIN "tenants" AS "tenant" ON "Pesquisa"."tenantId" = "tenant"."id" LEFT OUTER JOIN "roletas" AS "roleta" ON "Pesquisa"."roletaId" = "roleta"."id" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (default): SELECT "id", "tenantId", "creatorId", "title", "description", "startDate", "endDate", "isOpen", "askForAttendant", "status", "expectedRespondents", "dueDate", "recompensaId", "roletaId", "roletaPrizeMessage", "createdAt", "updatedAt" FROM "pesquisas" AS "Pesquisa" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (default): SELECT "id", "pesquisaId", "campanhaId", "tenantId", "recompensaId", "codigo", "clienteId", "dataGeracao", "dataUtilizacao", "dataValidade", "status", "ultimoContato", "createdAt", "updatedAt" FROM "cupons" AS "Cupom" WHERE "Cupom"."clienteId" = '42c5cf9f-b0f3-4f09-a290-0e1711cad84c' AND "Cupom"."pesquisaId" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4' ORDER BY "Cupom"."dataGeracao" DESC LIMIT 1;
Executing (default): SELECT "RoletaPremio"."id", "RoletaPremio"."tenantId", "RoletaPremio"."nome", "RoletaPremio"."descricao", "RoletaPremio"."porcentagem", "RoletaPremio"."cor", "RoletaPremio"."recompensaId", "RoletaPremio"."roletaId", "RoletaPremio"."imageUrl", "RoletaPremio"."active", "RoletaPremio"."isNoPrizeOption", "RoletaPremio"."createdAt", "RoletaPremio"."updatedAt", "recompensa"."id" AS "recompensa.id", "recompensa"."tenantId" AS "recompensa.tenantId", "recompensa"."name" AS "recompensa.name", "recompensa"."description" AS "recompensa.description", "recompensa"."conditionDescription" AS "recompensa.conditionDescription", "recompensa"."pointsRequired" AS "recompensa.pointsRequired", "recompensa"."type" AS "recompensa.type", "recompensa"."value" AS "recompensa.value", "recompensa"."imageUrl" AS "recompensa.imageUrl", "recompensa"."active" AS "recompensa.active", "recompensa"."createdAt" AS "recompensa.createdAt", "recompensa"."updatedAt" AS "recompensa.updatedAt" FROM "roleta_premios" AS "RoletaPremio" LEFT OUTER JOIN "recompensas" AS "recompensa" ON "RoletaPremio"."recompensaId" = "recompensa"."id" WHERE "RoletaPremio"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "RoletaPremio"."roletaId" = 'f4da8c53-db4f-4452-8c7d-505be5e99657' ORDER BY "RoletaPremio"."nome" ASC;
Executing (default): SELECT "id", "name", "logoUrl", "primaryColor", "secondaryColor", "description" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT "Pesquisa"."id", "Pesquisa"."title", "Pesquisa"."description", "Pesquisa"."createdAt", "Pesquisa"."updatedAt", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."status", "Pesquisa"."recompensaId", "Pesquisa"."roletaId", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."text" AS "perguntas.text", "perguntas"."options" AS "perguntas.options", "perguntas"."order" AS "perguntas.order", "perguntas"."required" AS "perguntas.required", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."description" AS "tenant.description", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "roleta"."id" AS "roleta.id", "roleta"."nome" AS "roleta.nome", "roleta"."descricao" AS "roleta.descricao", "roleta"."active" AS "roleta.active" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" LEFT OUTER JOIN "tenants" AS "tenant" ON "Pesquisa"."tenantId" = "tenant"."id" LEFT OUTER JOIN "roletas" AS "roleta" ON "Pesquisa"."roletaId" = "roleta"."id" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (default): SELECT "id", "tenantId", "creatorId", "title", "description", "startDate", "endDate", "isOpen", "askForAttendant", "status", "expectedRespondents", "dueDate", "recompensaId", "roletaId", "roletaPrizeMessage", "createdAt", "updatedAt" FROM "pesquisas" AS "Pesquisa" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (default): SELECT "id", "pesquisaId", "campanhaId", "tenantId", "recompensaId", "codigo", "clienteId", "dataGeracao", "dataUtilizacao", "dataValidade", "status", "ultimoContato", "createdAt", "updatedAt" FROM "cupons" AS "Cupom" WHERE "Cupom"."clienteId" = '42c5cf9f-b0f3-4f09-a290-0e1711cad84c' AND "Cupom"."pesquisaId" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4' ORDER BY "Cupom"."dataGeracao" DESC LIMIT 1;
Executing (default): SELECT "RoletaPremio"."id", "RoletaPremio"."tenantId", "RoletaPremio"."nome", "RoletaPremio"."descricao", "RoletaPremio"."porcentagem", "RoletaPremio"."cor", "RoletaPremio"."recompensaId", "RoletaPremio"."roletaId", "RoletaPremio"."imageUrl", "RoletaPremio"."active", "RoletaPremio"."isNoPrizeOption", "RoletaPremio"."createdAt", "RoletaPremio"."updatedAt", "recompensa"."id" AS "recompensa.id", "recompensa"."tenantId" AS "recompensa.tenantId", "recompensa"."name" AS "recompensa.name", "recompensa"."description" AS "recompensa.description", "recompensa"."conditionDescription" AS "recompensa.conditionDescription", "recompensa"."pointsRequired" AS "recompensa.pointsRequired", "recompensa"."type" AS "recompensa.type", "recompensa"."value" AS "recompensa.value", "recompensa"."imageUrl" AS "recompensa.imageUrl", "recompensa"."active" AS "recompensa.active", "recompensa"."createdAt" AS "recompensa.createdAt", "recompensa"."updatedAt" AS "recompensa.updatedAt" FROM "roleta_premios" AS "RoletaPremio" LEFT OUTER JOIN "recompensas" AS "recompensa" ON "RoletaPremio"."recompensaId" = "recompensa"."id" WHERE "RoletaPremio"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "RoletaPremio"."roletaId" = 'f4da8c53-db4f-4452-8c7d-505be5e99657' ORDER BY "RoletaPremio"."nome" ASC;
Executing (default): SELECT "id", "name", "logoUrl", "primaryColor", "secondaryColor", "description" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "name", "logoUrl", "primaryColor", "secondaryColor", "description" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT "Pesquisa"."id", "Pesquisa"."title", "Pesquisa"."description", "Pesquisa"."createdAt", "Pesquisa"."updatedAt", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."status", "Pesquisa"."recompensaId", "Pesquisa"."roletaId", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."text" AS "perguntas.text", "perguntas"."options" AS "perguntas.options", "perguntas"."order" AS "perguntas.order", "perguntas"."required" AS "perguntas.required", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."description" AS "tenant.description", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "roleta"."id" AS "roleta.id", "roleta"."nome" AS "roleta.nome", "roleta"."descricao" AS "roleta.descricao", "roleta"."active" AS "roleta.active" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" LEFT OUTER JOIN "tenants" AS "tenant" ON "Pesquisa"."tenantId" = "tenant"."id" LEFT OUTER JOIN "roletas" AS "roleta" ON "Pesquisa"."roletaId" = "roleta"."id" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (default): SELECT "id", "name" FROM "atendentes" AS "Atendente" WHERE "Atendente"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Atendente"."status" = 'active' ORDER BY "Atendente"."name" ASC;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 00:07:00.044 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 00:08:00.066 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 00:09:00.027 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[Delivery Much Job] Starting Polling...
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[iFood Job] Starting Polling...
[CAMPAIGN_MONITOR] Iniciando verificação de campanhas pausadas...
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 00:10:00.061 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."status" = 'paused';
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[CAMPAIGN_MONITOR] Nenhuma campanha pausada encontrada.
[SENDER_MONITOR] Verificação de status concluída.
Iniciando processamento do webhook do Uai Rango: {
  "id_estabelecimento": 4659,
  "cod_pedido": "68C34B2FC",
  "data": "2026-02-06 21:09:49",
  "pedido_pronto": 0,
  "data_pedido_pronto": null,
  "cupom": null,
  "tipo_entrega": "Delivery",
  "prazo": null,
  "prazo_min": 30,
  "prazo_max": 50,
  "categoria_pagamento": "Cartão",
  "forma_pagamento": "Mastercard Débito",
  "valor_total": 70.99,
  "observacao": "",
  "taxa_entrega": 3,
  "nome_taxa_entrega": "Bairros",
  "status": {

    "id": 0,
    "status": "Pendente"
  },
  "produtos": [
    {
      "id_categoria": 31340,
      "codigo_categoria": "",
      "categoria": "Pizzas Salgadas",
      "id_opcao": 61419,
      "opcao": "Grande - 8 Fatias",
      "id_produto": 244331,
      "codigo": "",
      "produto": "Calabresa",
      "id_produto_2": 244317,
      "codigo_2": "",
      "produto_2": "Marguerita",
      "obs": "",
      "valor": 53.99,
      "quantidade": 1,
      "adicionais": [

{
          "id_tipo": 81757,
          "id_adicional": 645809,
          "codigo": "",
          "nome": "Catupiry",
          "valor": 8,
          "quantidade": 1

}
      ]
    },
    {
      "id_categoria": 31379,
      "codigo_categoria": "",
      "categoria": "Bebidas",
      "id_opcao": 61495,
      "opcao": "600ml",
      "id_produto": 244654,
      "codigo": "",
      "produto": "Guaraná Antártica",
      "id_produto_2": null,
      "codigo_2": "",
      "produto_2": null,
      "obs": "",
      "valor": 9,
      "quantidade": 1,
      "adicionais": []
    }
  ],
  "usuario": {
    "id": "6a21e53f02a89a1e",
    "nome": "Marcus Vinicius",
    "tel1": "35997725292"
  },
  "endereco": {
    "id": 3668971,
    "uf": "MG",
    "cidade": "Andradas",
    "bairro": "Jardim Primavera",
    "rua": "Rua Luiz Bensi",
    "num": "34",
    "complemento": null,
    "ponto_referencia": "Poliesportivo \n\n"
  }
}
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "gmb_link", "uairangoEstablishmentId", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt", "ifoodClientId", "ifoodClientSecret", "ifoodAuthVerifier", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt", "franchisorId", "plan", "planExpiresAt", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."uairangoEstablishmentId" = '4659';
[UaiRango Webhook] Tenant encontrado: eb629ea8-7d69-47a1-b1f1-f9dcb33475f4 para o pedido 68C34B2FC
Executing (default): SELECT "id", "tenantId", "name", "email", "phone", "birthDate", "respondentSessionId", "gender", "createdAt", "updatedAt" FROM "clients" AS "Client" WHERE "Client"."phone" = '35997725292' AND "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
[UaiRango Webhook] Cliente existente encontrado: 787ff35a-c5f5-4bc9-863c-9df8d6c820a1 para o pedido 68C34B2FC
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."platform" = 'UaiRango' AND "DeliveryOrder"."orderIdPlatform" = '68C34B2FC';
Executing (default): INSERT INTO "delivery_orders" ("id","platform","orderIdPlatform","totalAmount","orderDate","payload","clientId","tenantId","surveyStatus","createdAt","updatedAt") VALUES ($1,$2,$3,$4,$5,$6,$7,$8,$9,$10,$11) RETURNING "id","platform","orderIdPlatform","totalAmount","orderDate","payload","clientId","tenantId","surveyStatus","surveyScheduledAt","surveySentAt","createdAt","updatedAt";
[UaiRango Webhook] DeliveryOrder criado: 4f8bf890-bf77-411b-a90b-f0b4c873add6 para o pedido 68C34B2FC
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "postSaleDelayMinutes", "postSaleMessageTemplate", "postSaleSurveyId", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
Executing (default): UPDATE "delivery_orders" SET "surveyStatus"=$1,"surveyScheduledAt"=$2,"updatedAt"=$3 WHERE "id" = $4
Pesquisa agendada para o pedido 4f8bf890-bf77-411b-a90b-f0b4c873add6. Delay: 90 min. Envio em: Sat Feb 07 2026 01:40:01 GMT+0000 (Coordinated Universal Time)
[UaiRango Webhook] Pesquisa de satisfação agendada para cliente 787ff35a-c5f5-4bc9-863c-9df8d6c820a1, pedido 4f8bf890-bf77-411b-a90b-f0b4c873add6.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 00:11:00.029 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 00:12:00.034 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 00:13:00.043 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 00:14:00.028 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
[Delivery Much Job] Starting Polling...
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 00:15:00.073 +00:00' LIMIT 50;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 00:16:00.035 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 00:17:00.028 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 00:18:00.028 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 00:19:00.031 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[CAMPAIGN_MONITOR] Iniciando verificação de campanhas pausadas...
[iFood Job] Starting Polling...
[Delivery Much Job] Starting Polling...
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."status" = 'paused';
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[CAMPAIGN_MONITOR] Nenhuma campanha pausada encontrada.
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 00:20:00.068 +00:00' LIMIT 50;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 00:21:00.040 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 00:22:00.028 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 00:23:00.030 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 00:24:00.046 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[Delivery Much Job] Starting Polling...
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 00:25:00.065 +00:00' LIMIT 50;
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 00:26:00.035 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 00:27:00.032 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 00:28:00.030 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 00:29:00.041 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[iFood Job] Starting Polling...
[CAMPAIGN_MONITOR] Iniciando verificação de campanhas pausadas...
[Delivery Much Job] Starting Polling...
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 00:30:00.081 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."status" = 'paused';
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
[CAMPAIGN_MONITOR] Nenhuma campanha pausada encontrada.
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 00:31:00.046 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 00:32:00.049 +00:00' LIMIT 50;
Executing (default): SELECT "askForAttendant" FROM "pesquisas" AS "Pesquisa" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (default): SELECT "Pesquisa"."id", "Pesquisa"."title", "Pesquisa"."description", "Pesquisa"."createdAt", "Pesquisa"."updatedAt", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."status", "Pesquisa"."recompensaId", "Pesquisa"."roletaId", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."text" AS "perguntas.text", "perguntas"."options" AS "perguntas.options", "perguntas"."order" AS "perguntas.order", "perguntas"."required" AS "perguntas.required", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."description" AS "tenant.description", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "roleta"."id" AS "roleta.id", "roleta"."nome" AS "roleta.nome", "roleta"."descricao" AS "roleta.descricao", "roleta"."active" AS "roleta.active" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" LEFT OUTER JOIN "tenants" AS "tenant" ON "Pesquisa"."tenantId" = "tenant"."id" LEFT OUTER JOIN "roletas" AS "roleta" ON "Pesquisa"."roletaId" = "roleta"."id" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (0e808689-070f-4488-a885-a13817851cd4): SELECT "Pesquisa"."id", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."title", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."options" AS "perguntas.options", "perguntas"."required" AS "perguntas.required", "perguntas"."text" AS "perguntas.text" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (0e808689-070f-4488-a885-a13817851cd4): INSERT INTO "respostas" ("id","perguntaId","pesquisaId","tenantId","atendenteId","respondentSessionId","textValue","createdAt","updatedAt","ratingValue") VALUES ('0052e661-f63f-4643-979f-afaf6545c554','3bcaef44-8ad1-4a95-a377-7fae3148fa97','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','67781806-855c-4e48-bf39-d1305176420a','34cc46cb-22df-47fe-a422-7a432dd94ac4','Não falta nada a recepção excelente e as pizzas são muitos saborosas

-02-07 00:32:04.409 +00:00','2026-02-07 00:32:04.409 +00:00',NULL),('94279d10-c1f8-4e69-9f3b-7a3c0f8462a4','19f1cec2-90b3-4223-b412-3c1d860e20a6','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','67781806-855c-4e48-bf39-d1305176420a','34cc46cb-22df-47fe-a422-7a432dd94ac4',NULL,'2026-02-07 00:32:04.409 +00:00','2026-02-07 00:32:04.409 +00:00',10),('2036832c-c477-442f-9018-9a6e79948fc6','305b7330-b4c3-41b1-8fd1-0f3f91e7e936','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','67781806-855c-4e48-bf39-d1305176420a','34cc46cb-22df-47fe-a422-7a432dd94ac4',NULL,'2026-02-07 00:32:04.409 +00:00','2026-02-07 00:32:04.409 +00:00',5),('99b12066-bd1d-47e4-b89c-9fb71b0bf0a2','d91a3ab3-65e2-40d0-acfa-35133ed4a7d4','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','67781806-855c-4e48-bf39-d1305176420a','34cc46cb-22df-47fe-a422-7a432dd94ac4','Sim ','2026-02-07 00:32:04.409 +00:00','2026-02-07 00:32:04.409 +00:00',5),('f9392485-bfe8-4f82-8510-a74f2dc66f9d','635f7a66-33fd-40f4-89b4-3c7c83f003aa','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','67781806-855c-4e48-bf39-d1305176420a','34cc46cb-22df-47fe-a422-7a432dd94ac4','Excelente ','2026-02-07 00:32:04.409 +00:00','2026-02-07 00:32:04.409 +00:00',5),('78b5ed5c-6c6e-471c-b2ea-0cc36666a64e','9e5e541a-1930-47da-81a5-e53892d8337a','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','67781806-855c-4e48-bf39-d1305176420a','34cc46cb-22df-47fe-a422-7a432dd94ac4','Razoável ','2026-02-07 00:32:04.409 +00:00','2026-02-07 00:32:04.409 +00:00',4),('9ae832d7-89f8-418e-8e7e-5a7aee07c159','f3480c2b-6f71-4b2e-bd3b-ac407d1c56dc','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','67781806-855c-4e48-bf39-d1305176420a','34cc46cb-22df-47fe-a422-7a432dd94ac4','Amo o ambiente,  a qualidade das pizzas é excelente ','2026-02-07 00:32:04.409 +00:00','2026-02-07 00:32:04.409 +00:00',NULL),('8ef3bbae-71d4-4836-8ac3-65dec91c9e78','2cbd96fb-faa2-495d-99dd-c57af8623c9d','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','67781806-855c-4e48-bf39-d1305176420a','34cc46cb-22df-47fe-a422-7a432dd94ac4',NULL,'2026-02-07 00:32:04.409 +00:00','2026-02-07 00:32:04.409 +00:00',5),('891c73b4-06cc-4f0f-bd74-e92b7ba9f861','89c2b3ed-7104-4a41-991d-565b70294215','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','67781806-855c-4e48-bf39-d1305176420a','34cc46cb-22df-47fe-a422-7a432dd94ac4','Bom ','2026-02-07 00:32:04.409 +00:00','2026-02-07 00:32:04.409 +00:00',4) RETURNING "id","perguntaId","pesquisaId","tenantId","atendenteId","respondentSessionId","ratingValue","textValue","selectedOption","createdAt","updatedAt";
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "postSaleDelayMinutes", "postSaleMessageTemplate", "postSaleSurveyId", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 00:33:00.042 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 00:34:00.042 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "Pesquisa"."id", "Pesquisa"."title", "Pesquisa"."description", "Pesquisa"."createdAt", "Pesquisa"."updatedAt", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."status", "Pesquisa"."recompensaId", "Pesquisa"."roletaId", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."text" AS "perguntas.text", "perguntas"."options" AS "perguntas.options", "perguntas"."order" AS "perguntas.order", "perguntas"."required" AS "perguntas.required", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."description" AS "tenant.description", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "roleta"."id" AS "roleta.id", "roleta"."nome" AS "roleta.nome", "roleta"."descricao" AS "roleta.descricao", "roleta"."active" AS "roleta.active" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" LEFT OUTER JOIN "tenants" AS "tenant" ON "Pesquisa"."tenantId" = "tenant"."id" LEFT OUTER JOIN "roletas" AS "roleta" ON "Pesquisa"."roletaId" = "roleta"."id" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (default): SELECT "id", "name" FROM "atendentes" AS "Atendente" WHERE "Atendente"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Atendente"."status" = 'active' ORDER BY "Atendente"."name" ASC;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[Delivery Much Job] Starting Polling...
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 00:35:00.067 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 00:36:00.039 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 00:37:00.032 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 00:38:00.026 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 00:39:00.045 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[CAMPAIGN_MONITOR] Iniciando verificação de campanhas pausadas...
[Delivery Much Job] Starting Polling...
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 00:40:00.080 +00:00' LIMIT 50;
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."status" = 'paused';
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[CAMPAIGN_MONITOR] Nenhuma campanha pausada encontrada.
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
Iniciando processamento do webhook do Uai Rango: {
  "id_estabelecimento": 4659,
  "cod_pedido": "8E486B815",
  "data": "2026-02-06 21:39:52",
  "pedido_pronto": 0,
  "data_pedido_pronto": null,

  "cupom": {
    "codigo": "ESQUENTA",
    "tipo": "Porcentagem",
    "valor": "20",
    "desconto_maximo": 10,
    "desconto_valor": 8.598
  },
  "tipo_entrega": "Delivery",
  "prazo": null,
  "prazo_min": 30,
  "prazo_max": 50,
  "categoria_pagamento": "Pagamento Online",
  "forma_pagamento": "Pagamento Online",
  "valor_total": 42.99,
  "observacao": "",
  "taxa_entrega": 2,
  "nome_taxa_entrega": "Área Central",
  "status": {

    "id": 0,
    "status": "Pendente"
  },
  "produtos": [
    {
      "id_categoria": 307609,
      "codigo_categoria": "",
      "categoria": "Novos Combos de Esfiha",
      "id_opcao": 595325,
      "opcao": "Combo",
      "id_produto": 2277707,
      "codigo": "",
      "produto": "Combo 01",
      "id_produto_2": null,
      "codigo_2": "",
      "produto_2": null,
      "obs": "",
      "valor": 42.99,
      "quantidade": 1,
      "adicionais": []
    }
  ],
  "usuario": {
    "id": "2e51053e757e98c4",
    "nome": "Adriano Cesar Lobo",
    "tel1": "35992181375"
  },
  "endereco": {
    "id": 2621397,
    "uf": "MG",
    "cidade": "Andradas",
    "bairro": "Vila Buzato",
    "rua": "Rua Vitória Varaldi Buzato",
    "num": "250",
    "complemento": null,
    "ponto_referencia": "Delegacia de Polícia Civil"
  }
}
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "gmb_link", "uairangoEstablishmentId", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt", "ifoodClientId", "ifoodClientSecret", "ifoodAuthVerifier", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt", "franchisorId", "plan", "planExpiresAt", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."uairangoEstablishmentId" = '4659';
[UaiRango Webhook] Tenant encontrado: eb629ea8-7d69-47a1-b1f1-f9dcb33475f4 para o pedido 8E486B815
Executing (default): SELECT "id", "tenantId", "name", "email", "phone", "birthDate", "respondentSessionId", "gender", "createdAt", "updatedAt" FROM "clients" AS "Client" WHERE "Client"."phone" = '35992181375' AND "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
[UaiRango Webhook] Cliente existente encontrado: 1a9d9445-37dc-45a8-a391-1c4174a7dee6 para o pedido 8E486B815
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."platform" = 'UaiRango' AND "DeliveryOrder"."orderIdPlatform" = '8E486B815';
Executing (default): INSERT INTO "delivery_orders" ("id","platform","orderIdPlatform","totalAmount","orderDate","payload","clientId","tenantId","surveyStatus","createdAt","updatedAt") VALUES ($1,$2,$3,$4,$5,$6,$7,$8,$9,$10,$11) RETURNING "id","platform","orderIdPlatform","totalAmount","orderDate","payload","clientId","tenantId","surveyStatus","surveyScheduledAt","surveySentAt","createdAt","updatedAt";
[UaiRango Webhook] DeliveryOrder criado: 3baf42d6-c877-4b66-ae8b-68dab8174c74 para o pedido 8E486B815
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "postSaleDelayMinutes", "postSaleMessageTemplate", "postSaleSurveyId", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
Executing (default): UPDATE "delivery_orders" SET "surveyStatus"=$1,"surveyScheduledAt"=$2,"updatedAt"=$3 WHERE "id" = $4
Pesquisa agendada para o pedido 3baf42d6-c877-4b66-ae8b-68dab8174c74. Delay: 90 min. Envio em: Sat Feb 07 2026 02:10:01 GMT+0000 (Coordinated Universal Time)
[UaiRango Webhook] Pesquisa de satisfação agendada para cliente 1a9d9445-37dc-45a8-a391-1c4174a7dee6, pedido 3baf42d6-c877-4b66-ae8b-68dab8174c74.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 00:41:00.043 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "Pesquisa"."id", "Pesquisa"."title", "Pesquisa"."description", "Pesquisa"."createdAt", "Pesquisa"."updatedAt", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."status", "Pesquisa"."recompensaId", "Pesquisa"."roletaId", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."text" AS "perguntas.text", "perguntas"."options" AS "perguntas.options", "perguntas"."order" AS "perguntas.order", "perguntas"."required" AS "perguntas.required", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."description" AS "tenant.description", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "roleta"."id" AS "roleta.id", "roleta"."nome" AS "roleta.nome", "roleta"."descricao" AS "roleta.descricao", "roleta"."active" AS "roleta.active" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" LEFT OUTER JOIN "tenants" AS "tenant" ON "Pesquisa"."tenantId" = "tenant"."id" LEFT OUTER JOIN "roletas" AS "roleta" ON "Pesquisa"."roletaId" = "roleta"."id" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (default): SELECT "id", "name" FROM "atendentes" AS "Atendente" WHERE "Atendente"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Atendente"."status" = 'active' ORDER BY "Atendente"."name" ASC;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 00:42:00.033 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "askForAttendant" FROM "pesquisas" AS "Pesquisa" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (default): SELECT "Pesquisa"."id", "Pesquisa"."title", "Pesquisa"."description", "Pesquisa"."createdAt", "Pesquisa"."updatedAt", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."status", "Pesquisa"."recompensaId", "Pesquisa"."roletaId", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."text" AS "perguntas.text", "perguntas"."options" AS "perguntas.options", "perguntas"."order" AS "perguntas.order", "perguntas"."required" AS "perguntas.required", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."description" AS "tenant.description", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "roleta"."id" AS "roleta.id", "roleta"."nome" AS "roleta.nome", "roleta"."descricao" AS "roleta.descricao", "roleta"."active" AS "roleta.active" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" LEFT OUTER JOIN "tenants" AS "tenant" ON "Pesquisa"."tenantId" = "tenant"."id" LEFT OUTER JOIN "roletas" AS "roleta" ON "Pesquisa"."roletaId" = "roleta"."id" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (16bd07c6-5b1e-4eb1-b963-11cb3d886948): SELECT "Pesquisa"."id", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."title", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."options" AS "perguntas.options", "perguntas"."required" AS "perguntas.required", "perguntas"."text" AS "perguntas.text" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (16bd07c6-5b1e-4eb1-b963-11cb3d886948): INSERT INTO "respostas" ("id","perguntaId","pesquisaId","tenantId","atendenteId","respondentSessionId","textValue","createdAt","updatedAt","ratingValue") VALUES ('b88695ed-167f-457b-a5dc-bf5099fbe4cc','3bcaef44-8ad1-4a95-a377-7fae3148fa97','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','67781806-855c-4e48-bf39-d1305176420a','76f08805-4786-4cee-8460-591167d3a207','Nada acho tudo excelente ','2026-02-07 00:42:40.399 +00:00','2026-02-07 00:42:40.399 +00:00',NULL),('7c876e1e-759f-4d11-ac66-e1a57caaa281','19f1cec2-90b3-4223-b412-3c1d860e20a6','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','67781806-855c-4e48-bf39-d1305176420a','76f08805-4786-4cee-8460-591167d3a207',NULL,'2026-02-07 00:42:40.399 +00:00','2026-02-07 00:42:40.399 +00:00',10),('e8358467-4e42-41d3-8066-84b243ac097b','305b7330-b4c3-41b1-8fd1-0f3f91e7e936','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','67781806-855c-4e48-bf39-d1305176420a','76f08805-4786-4cee-8460-591167d3a207',NULL,'2026-02-07 00:42:40.399 +00:00','2026-02-07 00:42:40.399 +00:00',5),('e8097d2b-404d-4bc6-afa2-0a006b2f7b79','d91a3ab3-65e2-40d0-acfa-35133ed4a7d4','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','67781806-855c-4e48-bf39-d1305176420a','76f08805-4786-4cee-8460-591167d3a207',NULL,'2026-02-07 00:42:40.399 +00:00','2026-02-07 00:42:40.399 +00:00',5),('8c16011d-bef8-4476-8c0e-baa15dd35bfc','635f7a66-33fd-40f4-89b4-3c7c83f003aa','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','67781806-855c-4e48-bf39-d1305176420a','76f08805-4786-4cee-8460-591167d3a207',NULL,'2026-02-07 00:42:40.399 +00:00','2026-02-07 00:42:40.399 +00:00',5),('46210dfc-89b8-47a0-a0a8-293aa55e081b','9e5e541a-1930-47da-81a5-e53892d8337a','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','67781806-855c-4e48-bf39-d1305176420a','76f08805-4786-4cee-8460-591167d3a207',NULL,'2026-02-07 00:42:40.399 +00:00','2026-02-07 00:42:40.399 +00:00',4),('41bbcfc2-2852-4aee-9d11-0c758392951b','f3480c2b-6f71-4b2e-bd3b-ac407d1c56dc','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','67781806-855c-4e48-bf39-d1305176420a','76f08805-4786-4cee-8460-591167d3a207','Amo o ambiente ','2026-02-07 00:42:40.399 +00:00','2026-02-07 00:42:40.399 +00:00',NULL),('b5eb8d91-ae13-4b52-acd4-9bd7349f7a19','2cbd96fb-faa2-495d-99dd-c57af8623c9d','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','67781806-855c-4e48-bf39-d1305176420a','76f08805-4786-4cee-8460-591167d3a207',NULL,'2026-02-07 00:42:40.399 +00:00','2026-02-07 00:42:40.399 +00:00',5),('bfa49424-a8db-4caa-80c3-e9ee6626f96d','89c2b3ed-7104-4a41-991d-565b70294215','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','67781806-855c-4e48-bf39-d1305176420a','76f08805-4786-4cee-8460-591167d3a207',NULL,'2026-02-07 00:42:40.399 +00:00','2026-02-07 00:42:40.399 +00:00',4) RETURNING "id","perguntaId","pesquisaId","tenantId","atendenteId","respondentSessionId","ratingValue","textValue","selectedOption","createdAt","updatedAt";
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "postSaleDelayMinutes", "postSaleMessageTemplate", "postSaleSurveyId", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 00:43:00.033 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 00:44:00.047 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "Pesquisa"."id", "Pesquisa"."title", "Pesquisa"."description", "Pesquisa"."createdAt", "Pesquisa"."updatedAt", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."status", "Pesquisa"."recompensaId", "Pesquisa"."roletaId", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."text" AS "perguntas.text", "perguntas"."options" AS "perguntas.options", "perguntas"."order" AS "perguntas.order", "perguntas"."required" AS "perguntas.required", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."description" AS "tenant.description", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "roleta"."id" AS "roleta.id", "roleta"."nome" AS "roleta.nome", "roleta"."descricao" AS "roleta.descricao", "roleta"."active" AS "roleta.active" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" LEFT OUTER JOIN "tenants" AS "tenant" ON "Pesquisa"."tenantId" = "tenant"."id" LEFT OUTER JOIN "roletas" AS "roleta" ON "Pesquisa"."roletaId" = "roleta"."id" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (default): SELECT "id", "name" FROM "atendentes" AS "Atendente" WHERE "Atendente"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "Atendente"."status" = 'active' ORDER BY "Atendente"."name" ASC;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[Delivery Much Job] Starting Polling...
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 00:45:00.114 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[Post-Sale Survey Job] Encontrados 1 pedidos pendentes de pesquisa.
Executing (default): SELECT "id", "tenantId", "name", "email", "phone", "birthDate", "respondentSessionId", "gender", "createdAt", "updatedAt" FROM "clients" AS "Client" WHERE "Client"."id" = '68156bd1-7225-41bc-9d81-010f4e11f356' AND "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "postSaleDelayMinutes", "postSaleMessageTemplate", "postSaleSurveyId", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
Erro ao enviar pesquisa de satisfação para o cliente 68156bd1-7225-41bc-9d81-010f4e11f356 (tenant: eb629ea8-7d69-47a1-b1f1-f9dcb33475f4, pedido: d3f29df9-ee93-435e-91e0-63a14ef05ccc): TypeError: Cannot read properties of undefined (reading 'findByPk')
    at Object.sendSatisfactionSurvey (/usr/src/app/src/services/surveyTriggerService.js:63:31)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async cron.schedule.scheduled (/usr/src/app/src/jobs/postSaleSurveyJob.js:38:17)
    at async Timeout._onTimeout (/usr/src/app/node_modules/node-cron/dist/cjs/scheduler/runner.js:70:44)
Executing (default): UPDATE "delivery_orders" SET "surveyStatus"=$1,"updatedAt"=$2 WHERE "id" = $3
[Post-Sale Survey Job] Falha ao processar pedido d3f29df9-ee93-435e-91e0-63a14ef05ccc: Falha ao enviar pesquisa de satisfação.
[SENDER_MONITOR] Verificação de status concluída.
Executing (default): SELECT "askForAttendant" FROM "pesquisas" AS "Pesquisa" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (default): SELECT "Pesquisa"."id", "Pesquisa"."title", "Pesquisa"."description", "Pesquisa"."createdAt", "Pesquisa"."updatedAt", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."status", "Pesquisa"."recompensaId", "Pesquisa"."roletaId", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."text" AS "perguntas.text", "perguntas"."options" AS "perguntas.options", "perguntas"."order" AS "perguntas.order", "perguntas"."required" AS "perguntas.required", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."description" AS "tenant.description", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "roleta"."id" AS "roleta.id", "roleta"."nome" AS "roleta.nome", "roleta"."descricao" AS "roleta.descricao", "roleta"."active" AS "roleta.active" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" LEFT OUTER JOIN "tenants" AS "tenant" ON "Pesquisa"."tenantId" = "tenant"."id" LEFT OUTER JOIN "roletas" AS "roleta" ON "Pesquisa"."roletaId" = "roleta"."id" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (9bab097c-803e-4a6c-be8f-300b593b020f): SELECT "Pesquisa"."id", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."title", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."options" AS "perguntas.options", "perguntas"."required" AS "perguntas.required", "perguntas"."text" AS "perguntas.text" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" WHERE "Pesquisa"."id" = '70644ab0-f9a5-49e5-88cc-86773acfd2a4';
Executing (9bab097c-803e-4a6c-be8f-300b593b020f): INSERT INTO "respostas" ("id","perguntaId","pesquisaId","tenantId","atendenteId","respondentSessionId","textValue","createdAt","updatedAt","ratingValue") VALUES ('0915f5af-7087-4ca4-b93c-cb525b58a0fd','3bcaef44-8ad1-4a95-a377-7fae3148fa97','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','87ccfbbd-4e8c-41ec-afc9-b3e14aacfdb0','bfcb0814-115a-482a-9d36-4a2626ef60ae','Nada amo o lugar ','2026-02-07 00:45:07.513 +00:00','2026-02-07 00:45:07.513 +00:00',NULL),('64a90af4-96eb-4431-8481-1e5348af047a','19f1cec2-90b3-4223-b412-3c1d860e20a6','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','87ccfbbd-4e8c-41ec-afc9-b3e14aacfdb0','bfcb0814-115a-482a-9d36-4a2626ef60ae',NULL,'2026-02-07 00:45:07.513 +00:00','2026-02-07 00:45:07.513 +00:00',10),('3bbb9e00-2e39-4951-933f-07f206ad547b','305b7330-b4c3-41b1-8fd1-0f3f91e7e936','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','87ccfbbd-4e8c-41ec-afc9-b3e14aacfdb0','bfcb0814-115a-482a-9d36-4a2626ef60ae',NULL,'2026-02-07 00:45:07.513 +00:00','2026-02-07 00:45:07.513 +00:00',5),('aac41b01-553b-41d2-a2d0-08069e14e37f','d91a3ab3-65e2-40d0-acfa-35133ed4a7d4','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','87ccfbbd-4e8c-41ec-afc9-b3e14aacfdb0','bfcb0814-115a-482a-9d36-4a2626ef60ae',NULL,'2026-02-07 00:45:07.513 +00:00','2026-02-07 00:45:07.513 +00:00',5),('5b911ba1-03cb-4894-b1d1-1b3529db8b6c','635f7a66-33fd-40f4-89b4-3c7c83f003aa','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','87ccfbbd-4e8c-41ec-afc9-b3e14aacfdb0','bfcb0814-115a-482a-9d36-4a2626ef60ae',NULL,'2026-02-07 00:45:07.513 +00:00','2026-02-07 00:45:07.513 +00:00',5),('da638c2b-975e-4dc8-8d13-7e7be531e1df','9e5e541a-1930-47da-81a5-e53892d8337a','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','87ccfbbd-4e8c-41ec-afc9-b3e14aacfdb0','bfcb0814-115a-482a-9d36-4a2626ef60ae',NULL,'2026-02-07 00:45:07.513 +00:00','2026-02-07 00:45:07.513 +00:00',4),('c6143544-65aa-4449-8528-72e0d2587ec0','f3480c2b-6f71-4b2e-bd3b-ac407d1c56dc','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','87ccfbbd-4e8c-41ec-afc9-b3e14aacfdb0','bfcb0814-115a-482a-9d36-4a2626ef60ae','Amo o ambiente ','2026-02-07 00:45:07.513 +00:00','2026-02-07 00:45:07.513 +00:00',NULL),('868cf538-8f57-410b-ab02-a0523af0b877','2cbd96fb-faa2-495d-99dd-c57af8623c9d','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','87ccfbbd-4e8c-41ec-afc9-b3e14aacfdb0','bfcb0814-115a-482a-9d36-4a2626ef60ae',NULL,'2026-02-07 00:45:07.513 +00:00','2026-02-07 00:45:07.513 +00:00',5),('1d262de2-48b2-46cd-8333-b7a616e99ed6','89c2b3ed-7104-4a41-991d-565b70294215','70644ab0-f9a5-49e5-88cc-86773acfd2a4','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4','87ccfbbd-4e8c-41ec-afc9-b3e14aacfdb0','bfcb0814-115a-482a-9d36-4a2626ef60ae',NULL,'2026-02-07 00:45:07.513 +00:00','2026-02-07 00:45:07.513 +00:00',5) RETURNING "id","perguntaId","pesquisaId","tenantId","atendenteId","respondentSessionId","ratingValue","textValue","selectedOption","createdAt","updatedAt";
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "postSaleDelayMinutes", "postSaleMessageTemplate", "postSaleSurveyId", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 00:46:00.036 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 00:47:00.047 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 00:48:00.043 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 00:49:00.033 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[Delivery Much Job] Starting Polling...
[iFood Job] Starting Polling...
[CAMPAIGN_MONITOR] Iniciando verificação de campanhas pausadas...
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."status" = 'paused';
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 00:50:00.084 +00:00' LIMIT 50;
[CAMPAIGN_MONITOR] Nenhuma campanha pausada encontrada.
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 00:51:00.044 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 00:52:00.046 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 00:53:00.043 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 00:54:00.036 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[Delivery Much Job] Starting Polling...
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 00:55:00.072 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 00:56:00.041 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 00:57:00.039 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 00:58:00.040 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 00:59:00.035 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[Delivery Much Job] Starting Polling...
[CAMPAIGN_MONITOR] Iniciando verificação de campanhas pausadas...
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 01:00:00.079 +00:00' LIMIT 50;
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."status" = 'paused';
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[Post-Sale Survey Job] Encontrados 1 pedidos pendentes de pesquisa.
Executing (default): SELECT "id", "tenantId", "name", "email", "phone", "birthDate", "respondentSessionId", "gender", "createdAt", "updatedAt" FROM "clients" AS "Client" WHERE "Client"."id" = '4146610a-0e0d-43b3-bfad-dfae5f7c0f1e' AND "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
[CAMPAIGN_MONITOR] Nenhuma campanha pausada encontrada.
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "postSaleDelayMinutes", "postSaleMessageTemplate", "postSaleSurveyId", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
Erro ao enviar pesquisa de satisfação para o cliente 4146610a-0e0d-43b3-bfad-dfae5f7c0f1e (tenant: eb629ea8-7d69-47a1-b1f1-f9dcb33475f4, pedido: 97c7d66c-754b-4dfd-b583-6cbafbfca990): TypeError: Cannot read properties of undefined (reading 'findByPk')
    at Object.sendSatisfactionSurvey (/usr/src/app/src/services/surveyTriggerService.js:63:31)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async cron.schedule.scheduled (/usr/src/app/src/jobs/postSaleSurveyJob.js:38:17)
    at async Timeout._onTimeout (/usr/src/app/node_modules/node-cron/dist/cjs/scheduler/runner.js:70:44)
Executing (default): UPDATE "delivery_orders" SET "surveyStatus"=$1,"updatedAt"=$2 WHERE "id" = $3
[Post-Sale Survey Job] Falha ao processar pedido 97c7d66c-754b-4dfd-b583-6cbafbfca990: Falha ao enviar pesquisa de satisfação.
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 01:01:00.043 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 01:02:00.043 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 01:03:00.040 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[Auth Middleware] Request: POST /api/auth/verify-token
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."ifoodAuthVerifier" AS "tenant.ifoodAuthVerifier", "tenant"."deliveryMuchClientId" AS "tenant.deliveryMuchClientId", "tenant"."deliveryMuchClientSecret" AS "tenant.deliveryMuchClientSecret", "tenant"."deliveryMuchUsername" AS "tenant.deliveryMuchUsername", "tenant"."deliveryMuchPassword" AS "tenant.deliveryMuchPassword", "tenant"."deliveryMuchToken" AS "tenant.deliveryMuchToken", "tenant"."deliveryMuchTokenExpiresAt" AS "tenant.deliveryMuchTokenExpiresAt", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."plan" AS "tenant.plan", "tenant"."planExpiresAt" AS "tenant.planExpiresAt", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = '77f853e9-deb2-4067-881e-71fa16d3054f';
[Auth Middleware] Request: GET /api/cupons?search=&status=&recompensaId=
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."ifoodAuthVerifier" AS "tenant.ifoodAuthVerifier", "tenant"."deliveryMuchClientId" AS "tenant.deliveryMuchClientId", "tenant"."deliveryMuchClientSecret" AS "tenant.deliveryMuchClientSecret", "tenant"."deliveryMuchUsername" AS "tenant.deliveryMuchUsername", "tenant"."deliveryMuchPassword" AS "tenant.deliveryMuchPassword", "tenant"."deliveryMuchToken" AS "tenant.deliveryMuchToken", "tenant"."deliveryMuchTokenExpiresAt" AS "tenant.deliveryMuchTokenExpiresAt", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."plan" AS "tenant.plan", "tenant"."planExpiresAt" AS "tenant.planExpiresAt", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = '77f853e9-deb2-4067-881e-71fa16d3054f';
[Auth Middleware] Request: GET /api/recompensas
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."ifoodAuthVerifier" AS "tenant.ifoodAuthVerifier", "tenant"."deliveryMuchClientId" AS "tenant.deliveryMuchClientId", "tenant"."deliveryMuchClientSecret" AS "tenant.deliveryMuchClientSecret", "tenant"."deliveryMuchUsername" AS "tenant.deliveryMuchUsername", "tenant"."deliveryMuchPassword" AS "tenant.deliveryMuchPassword", "tenant"."deliveryMuchToken" AS "tenant.deliveryMuchToken", "tenant"."deliveryMuchTokenExpiresAt" AS "tenant.deliveryMuchTokenExpiresAt", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."plan" AS "tenant.plan", "tenant"."planExpiresAt" AS "tenant.planExpiresAt", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = '77f853e9-deb2-4067-881e-71fa16d3054f';
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'cupons' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'recompensas' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';

oExecuting (default): SELECT "Cupom"."id", "Cupom"."pesquisaId", "Cupom"."campanhaId", "Cupom"."tenantId", "Cupom"."recompensaId", "Cupom"."codigo", "Cupom"."clienteId", "Cupom"."dataGeracao", "Cupom"."dataUtilizacao", "Cupom"."dataValidade", "Cupom"."status", "Cupom"."ultimoContato", "Cupom"."createdAt", "Cupom"."updatedAt", "recompensa"."id" AS "recompensa.id", "recompensa"."tenantId" AS "recompensa.tenantId", "recompensa"."name" AS "recompensa.name", "recompensa"."description" AS "recompensa.description", "recompensa"."conditionDescription" AS "recompensa.conditionDescription", "recompensa"."pointsRequired" AS "recompensa.pointsRequired", "recompensa"."type" AS "recompensa.type", "recompensa"."value" AS "recompensa.value", "recompensa"."imageUrl" AS "recompensa.imageUrl", "recompensa"."active" AS "recompensa.active", "recompensa"."createdAt" AS "recompensa.createdAt", "recompensa"."updatedAt" AS "recompensa.updatedAt", "client"."id" AS "client.id", "client"."tenantId" AS "client.tenantId", "client"."name" AS "client.name", "client"."email" AS "client.email", "client"."phone" AS "client.phone", "client"."birthDate" AS "client.birthDate", "client"."respondentSessionId" AS "client.respondentSessionId", "client"."gender" AS "client.gender", "client"."createdAt" AS "client.createdAt", "client"."updatedAt" AS "client.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."ifoodAuthVerifier" AS "tenant.ifoodAuthVerifier", "tenant"."deliveryMuchClientId" AS "tenant.deliveryMuchClientId", "tenant"."deliveryMuchClientSecret" AS "tenant.deliveryMuchClientSecret", "tenant"."deliveryMuchUsername" AS "tenant.deliveryMuchUsername", "tenant"."deliveryMuchPassword" AS "tenant.deliveryMuchPassword", "tenant"."deliveryMuchToken" AS "tenant.deliveryMuchToken", "tenant"."deliveryMuchTokenExpiresAt" AS "tenant.deliveryMuchTokenExpiresAt", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."plan" AS "tenant.plan", "tenant"."planExpiresAt" AS "tenant.planExpiresAt", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "cupons" AS "Cupom" LEFT OUTER JOIN "recompensas" AS "recompensa" ON "Cupom"."recompensaId" = "recompensa"."id" LEFT OUTER JOIN "clients" AS "client" ON "Cupom"."clienteId" = "client"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Cupom"."tenantId" = "tenant"."id" WHERE "Cupom"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' ORDER BY "Cupom"."dataGeracao" DESC;
Executing (default): SELECT "id", "tenantId", "name", "description", "conditionDescription", "pointsRequired", "type", "value", "imageUrl", "active", "createdAt", "updatedAt" FROM "recompensas" AS "Recompensa" WHERE "Recompensa"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' ORDER BY "Recompensa"."name" ASC;
[Auth Middleware] Request: GET /api/cupons?search=&status=&recompensaId=
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."franchisorId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."key" AS "role.key", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."ifoodAuthVerifier" AS "tenant.ifoodAuthVerifier", "tenant"."deliveryMuchClientId" AS "tenant.deliveryMuchClientId", "tenant"."deliveryMuchClientSecret" AS "tenant.deliveryMuchClientSecret", "tenant"."deliveryMuchUsername" AS "tenant.deliveryMuchUsername", "tenant"."deliveryMuchPassword" AS "tenant.deliveryMuchPassword", "tenant"."deliveryMuchToken" AS "tenant.deliveryMuchToken", "tenant"."deliveryMuchTokenExpiresAt" AS "tenant.deliveryMuchTokenExpiresAt", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."plan" AS "tenant.plan", "tenant"."planExpiresAt" AS "tenant.planExpiresAt", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = '77f853e9-deb2-4067-881e-71fa16d3054f';
Executing (default): SELECT "id", "name", "key", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'cupons' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';

oExecuting (default): SELECT "Cupom"."id", "Cupom"."pesquisaId", "Cupom"."campanhaId", "Cupom"."tenantId", "Cupom"."recompensaId", "Cupom"."codigo", "Cupom"."clienteId", "Cupom"."dataGeracao", "Cupom"."dataUtilizacao", "Cupom"."dataValidade", "Cupom"."status", "Cupom"."ultimoContato", "Cupom"."createdAt", "Cupom"."updatedAt", "recompensa"."id" AS "recompensa.id", "recompensa"."tenantId" AS "recompensa.tenantId", "recompensa"."name" AS "recompensa.name", "recompensa"."description" AS "recompensa.description", "recompensa"."conditionDescription" AS "recompensa.conditionDescription", "recompensa"."pointsRequired" AS "recompensa.pointsRequired", "recompensa"."type" AS "recompensa.type", "recompensa"."value" AS "recompensa.value", "recompensa"."imageUrl" AS "recompensa.imageUrl", "recompensa"."active" AS "recompensa.active", "recompensa"."createdAt" AS "recompensa.createdAt", "recompensa"."updatedAt" AS "recompensa.updatedAt", "client"."id" AS "client.id", "client"."tenantId" AS "client.tenantId", "client"."name" AS "client.name", "client"."email" AS "client.email", "client"."phone" AS "client.phone", "client"."birthDate" AS "client.birthDate", "client"."respondentSessionId" AS "client.respondentSessionId", "client"."gender" AS "client.gender", "client"."createdAt" AS "client.createdAt", "client"."updatedAt" AS "client.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."uairangoEstablishmentId" AS "tenant.uairangoEstablishmentId", "tenant"."ifoodMerchantId" AS "tenant.ifoodMerchantId", "tenant"."ifoodAccessToken" AS "tenant.ifoodAccessToken", "tenant"."ifoodRefreshToken" AS "tenant.ifoodRefreshToken", "tenant"."ifoodTokenExpiresAt" AS "tenant.ifoodTokenExpiresAt", "tenant"."ifoodClientId" AS "tenant.ifoodClientId", "tenant"."ifoodClientSecret" AS "tenant.ifoodClientSecret", "tenant"."ifoodAuthVerifier" AS "tenant.ifoodAuthVerifier", "tenant"."deliveryMuchClientId" AS "tenant.deliveryMuchClientId", "tenant"."deliveryMuchClientSecret" AS "tenant.deliveryMuchClientSecret", "tenant"."deliveryMuchUsername" AS "tenant.deliveryMuchUsername", "tenant"."deliveryMuchPassword" AS "tenant.deliveryMuchPassword", "tenant"."deliveryMuchToken" AS "tenant.deliveryMuchToken", "tenant"."deliveryMuchTokenExpiresAt" AS "tenant.deliveryMuchTokenExpiresAt", "tenant"."franchisorId" AS "tenant.franchisorId", "tenant"."plan" AS "tenant.plan", "tenant"."planExpiresAt" AS "tenant.planExpiresAt", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "cupons" AS "Cupom" LEFT OUTER JOIN "recompensas" AS "recompensa" ON "Cupom"."recompensaId" = "recompensa"."id" LEFT OUTER JOIN "clients" AS "client" ON "Cupom"."clienteId" = "client"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Cupom"."tenantId" = "tenant"."id" WHERE "Cupom"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' ORDER BY "Cupom"."dataGeracao" DESC;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 01:04:00.032 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[Delivery Much Job] Starting Polling...
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 01:05:00.059 +00:00' LIMIT 50;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 01:06:00.044 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "Pesquisa"."id", "Pesquisa"."title", "Pesquisa"."description", "Pesquisa"."createdAt", "Pesquisa"."updatedAt", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."status", "Pesquisa"."recompensaId", "Pesquisa"."roletaId", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."text" AS "perguntas.text", "perguntas"."options" AS "perguntas.options", "perguntas"."order" AS "perguntas.order", "perguntas"."required" AS "perguntas.required", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."description" AS "tenant.description", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "roleta"."id" AS "roleta.id", "roleta"."nome" AS "roleta.nome", "roleta"."descricao" AS "roleta.descricao", "roleta"."active" AS "roleta.active" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" LEFT OUTER JOIN "tenants" AS "tenant" ON "Pesquisa"."tenantId" = "tenant"."id" LEFT OUTER JOIN "roletas" AS "roleta" ON "Pesquisa"."roletaId" = "roleta"."id" WHERE "Pesquisa"."id" = '362bd09a-762a-49d4-9651-415955567e6a';
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 01:07:00.033 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 01:08:00.043 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 01:09:00.032 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[CAMPAIGN_MONITOR] Iniciando verificação de campanhas pausadas...
[Delivery Much Job] Starting Polling...
[iFood Job] Starting Polling...
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."status" = 'paused';
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 01:10:00.081 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[CAMPAIGN_MONITOR] Nenhuma campanha pausada encontrada.
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 01:11:00.037 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 01:12:00.033 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 01:13:00.040 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 01:14:00.034 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[Delivery Much Job] Starting Polling...
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 01:15:00.084 +00:00' LIMIT 50;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 01:16:00.037 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 01:17:00.031 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 01:18:00.041 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 01:19:00.032 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[CAMPAIGN_MONITOR] Iniciando verificação de campanhas pausadas...
[Delivery Much Job] Starting Polling...
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."status" = 'paused';
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
[CAMPAIGN_MONITOR] Nenhuma campanha pausada encontrada.
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 01:20:00.076 +00:00' LIMIT 50;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 01:21:00.033 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 01:22:00.039 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 01:23:00.037 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 01:24:00.029 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[Delivery Much Job] Starting Polling...
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 01:25:00.064 +00:00' LIMIT 50;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 01:26:00.041 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 01:27:00.033 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 01:28:00.038 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 01:29:00.031 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[CAMPAIGN_MONITOR] Iniciando verificação de campanhas pausadas...
[Delivery Much Job] Starting Polling...
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."status" = 'paused';
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
[CAMPAIGN_MONITOR] Nenhuma campanha pausada encontrada.
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 01:30:00.093 +00:00' LIMIT 50;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 01:31:00.034 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 01:32:00.037 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 01:33:00.042 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 01:34:00.026 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[Delivery Much Job] Starting Polling...
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 01:35:00.068 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "askForAttendant" FROM "pesquisas" AS "Pesquisa" WHERE "Pesquisa"."id" = '362bd09a-762a-49d4-9651-415955567e6a';
Executing (default): SELECT "Pesquisa"."id", "Pesquisa"."title", "Pesquisa"."description", "Pesquisa"."createdAt", "Pesquisa"."updatedAt", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."status", "Pesquisa"."recompensaId", "Pesquisa"."roletaId", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."text" AS "perguntas.text", "perguntas"."options" AS "perguntas.options", "perguntas"."order" AS "perguntas.order", "perguntas"."required" AS "perguntas.required", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."description" AS "tenant.description", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "roleta"."id" AS "roleta.id", "roleta"."nome" AS "roleta.nome", "roleta"."descricao" AS "roleta.descricao", "roleta"."active" AS "roleta.active" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" LEFT OUTER JOIN "tenants" AS "tenant" ON "Pesquisa"."tenantId" = "tenant"."id" LEFT OUTER JOIN "roletas" AS "roleta" ON "Pesquisa"."roletaId" = "roleta"."id" WHERE "Pesquisa"."id" = '362bd09a-762a-49d4-9651-415955567e6a';
Executing (69549674-263f-4d86-b3f8-fd8d3defe46b): SELECT "Pesquisa"."id", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."title", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."options" AS "perguntas.options", "perguntas"."required" AS "perguntas.required", "perguntas"."text" AS "perguntas.text" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" WHERE "Pesquisa"."id" = '362bd09a-762a-49d4-9651-415955567e6a';
Executing (69549674-263f-4d86-b3f8-fd8d3defe46b): INSERT INTO "respostas" ("id","perguntaId","pesquisaId","tenantId","atendenteId","respondentSessionId","ratingValue","textValue","createdAt","updatedAt","selectedOption") VALUES ('21fd8cb1-c533-4984-ace2-16db14e7e47e','2759aba5-c900-40b3-a372-b8c801a8361f','362bd09a-762a-49d4-9651-415955567e6a','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4',NULL,'98add30d-17f0-4b3d-8753-3a68701af2a7',9,NULL,'2026-02-07 01:35:42.497 +00:00','2026-02-07 01:35:42.497 +00:00',NULL),('f09df218-e333-4e1f-8ec5-37ef96bd255f','a0107f03-4e13-44a5-93b7-68ae6f21154d','362bd09a-762a-49d4-9651-415955567e6a','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4',NULL,'98add30d-17f0-4b3d-8753-3a68701af2a7',NULL,NULL,'2026-02-07 01:35:42.497 +00:00','2026-02-07 01:35:42.497 +00:00','["Sim"]'),('f8f5d546-4379-4d41-94eb-340f1ce02b1d','9b81d1c9-fcc7-4f47-8444-0dc48230e2cd','362bd09a-762a-49d4-9651-415955567e6a','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4',NULL,'98add30d-17f0-4b3d-8753-3a68701af2a7',5,NULL,'2026-02-07 01:35:42.497 +00:00','2026-02-07 01:35:42.497 +00:00',NULL),('2d3187b1-607f-437e-8fd8-db53efab33ec','80361456-1d69-48d5-a941-fc3dd7b000b6','362bd09a-762a-49d4-9651-415955567e6a','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4',NULL,'98add30d-17f0-4b3d-8753-3a68701af2a7',4,NULL,'2026-02-07 01:35:42.497 +00:00','2026-02-07 01:35:42.497 +00:00',NULL),('b1b6381c-fa5f-44d9-b0bc-6a412e6c5095','5e55eb00-46d0-48c8-a8e4-118eb9242155','362bd09a-762a-49d4-9651-415955567e6a','eb629ea8-7d69-47a1-b1f1-f9dcb33475f4',NULL,'98add30d-17f0-4b3d-8753-3a68701af2a7',4,NULL,'2026-02-07 01:35:42.497 +00:00','2026-02-07 01:35:42.497 +00:00',NULL) RETURNING "id","perguntaId","pesquisaId","tenantId","atendenteId","respondentSessionId","ratingValue","textValue","selectedOption","createdAt","updatedAt";
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "postSaleDelayMinutes", "postSaleMessageTemplate", "postSaleSurveyId", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
Executing (default): SELECT "id", "name", "logoUrl", "primaryColor", "secondaryColor", "description" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT "id", "name", "logoUrl", "primaryColor", "secondaryColor", "description" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 01:36:00.034 +00:00' LIMIT 50;
[Post-Sale Survey Job] Encontrados 1 pedidos pendentes de pesquisa.
Executing (default): SELECT "id", "tenantId", "name", "email", "phone", "birthDate", "respondentSessionId", "gender", "createdAt", "updatedAt" FROM "clients" AS "Client" WHERE "Client"."id" = '1a40a1e8-0537-4fb6-9c95-042ee9011e78' AND "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "postSaleDelayMinutes", "postSaleMessageTemplate", "postSaleSurveyId", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
Erro ao enviar pesquisa de satisfação para o cliente 1a40a1e8-0537-4fb6-9c95-042ee9011e78 (tenant: eb629ea8-7d69-47a1-b1f1-f9dcb33475f4, pedido: f48be6f4-ecd8-435a-87e2-cc1f75cadecf): TypeError: Cannot read properties of undefined (reading 'findByPk')
    at Object.sendSatisfactionSurvey (/usr/src/app/src/services/surveyTriggerService.js:63:31)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async cron.schedule.scheduled (/usr/src/app/src/jobs/postSaleSurveyJob.js:38:17)
    at async Timeout._onTimeout (/usr/src/app/node_modules/node-cron/dist/cjs/scheduler/runner.js:70:44)
Executing (default): UPDATE "delivery_orders" SET "surveyStatus"=$1,"updatedAt"=$2 WHERE "id" = $3
[Post-Sale Survey Job] Falha ao processar pedido f48be6f4-ecd8-435a-87e2-cc1f75cadecf: Falha ao enviar pesquisa de satisfação.
Executing (default): SELECT "tenantId" FROM "respostas" AS "Resposta" WHERE "Resposta"."respondentSessionId" = '98add30d-17f0-4b3d-8753-3a68701af2a7' LIMIT 1;
Executing (fb9ad0e5-d8ad-4044-893f-20b75c598367): SELECT "id", "tenantId", "name", "email", "phone", "birthDate", "respondentSessionId", "gender", "createdAt", "updatedAt" FROM "clients" AS "Client" WHERE "Client"."phone" = '(35) 99742-3947' AND "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
Executing (fb9ad0e5-d8ad-4044-893f-20b75c598367): SELECT "id", "tenantId", "name", "email", "phone", "birthDate", "respondentSessionId", "gender", "createdAt", "updatedAt" FROM "clients" AS "Client" WHERE "Client"."respondentSessionId" = '98add30d-17f0-4b3d-8753-3a68701af2a7';
Executing (fb9ad0e5-d8ad-4044-893f-20b75c598367): INSERT INTO "clients" ("id","tenantId","name","email","phone","birthDate","respondentSessionId","gender","createdAt","updatedAt") VALUES ($1,$2,$3,$4,$5,$6,$7,$8,$9,$10) RETURNING "id","tenantId","name","email","phone","birthDate","respondentSessionId","gender","createdAt","updatedAt";
Executing (fb9ad0e5-d8ad-4044-893f-20b75c598367): SELECT "pesquisaId", "tenantId" FROM "respostas" AS "Resposta" WHERE "Resposta"."respondentSessionId" = '98add30d-17f0-4b3d-8753-3a68701af2a7' LIMIT 1;
Executing (fb9ad0e5-d8ad-4044-893f-20b75c598367): SELECT "recompensaId" FROM "pesquisas" AS "Pesquisa" WHERE "Pesquisa"."id" = '362bd09a-762a-49d4-9651-415955567e6a';
Executing (default): SELECT "Pesquisa"."id", "Pesquisa"."title", "Pesquisa"."description", "Pesquisa"."createdAt", "Pesquisa"."updatedAt", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."status", "Pesquisa"."recompensaId", "Pesquisa"."roletaId", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."text" AS "perguntas.text", "perguntas"."options" AS "perguntas.options", "perguntas"."order" AS "perguntas.order", "perguntas"."required" AS "perguntas.required", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."description" AS "tenant.description", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "roleta"."id" AS "roleta.id", "roleta"."nome" AS "roleta.nome", "roleta"."descricao" AS "roleta.descricao", "roleta"."active" AS "roleta.active" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" LEFT OUTER JOIN "tenants" AS "tenant" ON "Pesquisa"."tenantId" = "tenant"."id" LEFT OUTER JOIN "roletas" AS "roleta" ON "Pesquisa"."roletaId" = "roleta"."id" WHERE "Pesquisa"."id" = '362bd09a-762a-49d4-9651-415955567e6a';
Executing (default): SELECT "id", "name", "logoUrl", "primaryColor", "secondaryColor", "description" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT "id", "tenantId", "creatorId", "title", "description", "startDate", "endDate", "isOpen", "askForAttendant", "status", "expectedRespondents", "dueDate", "recompensaId", "roletaId", "roletaPrizeMessage", "createdAt", "updatedAt" FROM "pesquisas" AS "Pesquisa" WHERE "Pesquisa"."id" = '362bd09a-762a-49d4-9651-415955567e6a';
Executing (default): SELECT "id", "pesquisaId", "campanhaId", "tenantId", "recompensaId", "codigo", "clienteId", "dataGeracao", "dataUtilizacao", "dataValidade", "status", "ultimoContato", "createdAt", "updatedAt" FROM "cupons" AS "Cupom" WHERE "Cupom"."clienteId" = '325c3393-c45c-428a-b500-3fcbd4f85f45' AND "Cupom"."pesquisaId" = '362bd09a-762a-49d4-9651-415955567e6a' ORDER BY "Cupom"."dataGeracao" DESC LIMIT 1;
Executing (default): SELECT "RoletaPremio"."id", "RoletaPremio"."tenantId", "RoletaPremio"."nome", "RoletaPremio"."descricao", "RoletaPremio"."porcentagem", "RoletaPremio"."cor", "RoletaPremio"."recompensaId", "RoletaPremio"."roletaId", "RoletaPremio"."imageUrl", "RoletaPremio"."active", "RoletaPremio"."isNoPrizeOption", "RoletaPremio"."createdAt", "RoletaPremio"."updatedAt", "recompensa"."id" AS "recompensa.id", "recompensa"."tenantId" AS "recompensa.tenantId", "recompensa"."name" AS "recompensa.name", "recompensa"."description" AS "recompensa.description", "recompensa"."conditionDescription" AS "recompensa.conditionDescription", "recompensa"."pointsRequired" AS "recompensa.pointsRequired", "recompensa"."type" AS "recompensa.type", "recompensa"."value" AS "recompensa.value", "recompensa"."imageUrl" AS "recompensa.imageUrl", "recompensa"."active" AS "recompensa.active", "recompensa"."createdAt" AS "recompensa.createdAt", "recompensa"."updatedAt" AS "recompensa.updatedAt" FROM "roleta_premios" AS "RoletaPremio" LEFT OUTER JOIN "recompensas" AS "recompensa" ON "RoletaPremio"."recompensaId" = "recompensa"."id" WHERE "RoletaPremio"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "RoletaPremio"."roletaId" = 'e9b203c9-2aa6-4c09-9683-2f1bbea06da3' ORDER BY "RoletaPremio"."nome" ASC;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "tenantId", "creatorId", "title", "description", "startDate", "endDate", "isOpen", "askForAttendant", "status", "expectedRespondents", "dueDate", "recompensaId", "roletaId", "roletaPrizeMessage", "createdAt", "updatedAt" FROM "pesquisas" AS "Pesquisa" WHERE "Pesquisa"."id" = '362bd09a-762a-49d4-9651-415955567e6a';
Executing (default): SELECT "id", "tenantId", "name", "email", "phone", "birthDate", "respondentSessionId", "gender", "createdAt", "updatedAt" FROM "clients" AS "Client" WHERE "Client"."id" = '325c3393-c45c-428a-b500-3fcbd4f85f45';
Executing (default): SELECT "id", "pesquisaId", "campanhaId", "tenantId", "recompensaId", "codigo", "clienteId", "dataGeracao", "dataUtilizacao", "dataValidade", "status", "ultimoContato", "createdAt", "updatedAt" FROM "cupons" AS "Cupom" WHERE "Cupom"."clienteId" = '325c3393-c45c-428a-b500-3fcbd4f85f45' AND "Cupom"."pesquisaId" = '362bd09a-762a-49d4-9651-415955567e6a' ORDER BY "Cupom"."dataGeracao" DESC LIMIT 1;
Executing (default): SELECT "RoletaPremio"."id", "RoletaPremio"."tenantId", "RoletaPremio"."nome", "RoletaPremio"."descricao", "RoletaPremio"."porcentagem", "RoletaPremio"."cor", "RoletaPremio"."recompensaId", "RoletaPremio"."roletaId", "RoletaPremio"."imageUrl", "RoletaPremio"."active", "RoletaPremio"."isNoPrizeOption", "RoletaPremio"."createdAt", "RoletaPremio"."updatedAt", "recompensa"."id" AS "recompensa.id", "recompensa"."tenantId" AS "recompensa.tenantId", "recompensa"."name" AS "recompensa.name", "recompensa"."description" AS "recompensa.description", "recompensa"."conditionDescription" AS "recompensa.conditionDescription", "recompensa"."pointsRequired" AS "recompensa.pointsRequired", "recompensa"."type" AS "recompensa.type", "recompensa"."value" AS "recompensa.value", "recompensa"."imageUrl" AS "recompensa.imageUrl", "recompensa"."active" AS "recompensa.active", "recompensa"."createdAt" AS "recompensa.createdAt", "recompensa"."updatedAt" AS "recompensa.updatedAt" FROM "roleta_premios" AS "RoletaPremio" LEFT OUTER JOIN "recompensas" AS "recompensa" ON "RoletaPremio"."recompensaId" = "recompensa"."id" WHERE "RoletaPremio"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' AND "RoletaPremio"."roletaId" = 'e9b203c9-2aa6-4c09-9683-2f1bbea06da3' ORDER BY "RoletaPremio"."nome" ASC;
Executing (default): INSERT INTO "cupons" ("id","pesquisaId","tenantId","recompensaId","codigo","clienteId","dataGeracao","dataValidade","status","createdAt","updatedAt") VALUES ($1,$2,$3,$4,$5,$6,$7,$8,$9,$10,$11) RETURNING "id","pesquisaId","campanhaId","tenantId","recompensaId","codigo","clienteId","dataGeracao","dataUtilizacao","dataValidade","status","ultimoContato","createdAt","updatedAt";
[RoletaController] Iniciando envio de mensagem de prêmio para o tenant eb629ea8-7d69-47a1-b1f1-f9dcb33475f4.
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "postSaleDelayMinutes", "postSaleMessageTemplate", "postSaleSurveyId", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
[RoletaController] Config do WhatsApp para o tenant eb629ea8-7d69-47a1-b1f1-f9dcb33475f4: {
  apiKey: '9df82dcbee60ce08f6ca93aa4024ca6c',
  instanceApiKey: '1EF60F67-BF10-4F82-9BB8-80124CCB17AC',
  id: 'b9d07194-31e9-49e7-bdb8-55d6b3596ef9',
  url: 'https://evolution2.towersfy.com',
  instanceName: 'roma-pizzaria--chopperia',
  instanceStatus: 'disconnected',
  tenantId: 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4',
  sendPrizeMessage: true,
  prizeMessageTemplate: '🎰 *UAAAU, {{cliente}}!* 😍  \n' +
    'Você acabou de girar a *Roleta Premiada da Roma* e saiu com sorte grande! 🍀🔥 \n' +
    '\n' +
    'Você recebeu para usar na sua proxima visita:\n' +
    '🎁 *Prêmio:* *{{premio}}*\n' +
    'Pra resgatar, é só mostrar o cupom 👉 *{{cupom}}* aqui no salão da **Roma Pizzaria & Chopperia** 🍕✨  \n' +
    '\n' +
    'Vem curtir seu prêmio com a galera e comemorar essa sorte toda! 🎉  \n' +
    '📍 *Roma Pizzaria* — diversão, sabor e prêmios te esperando! 😋\n',
  dailyReportEnabled: true,
  reportPhoneNumbers: '5535991090766,553591523297,553598374007',
  weeklyReportEnabled: true,
  monthlyReportEnabled: true,
  birthdayAutomationEnabled: true,
  birthdayMessageTemplate: '🎉 *Seu aniversário tá chegando, {{cliente}}!* 🥳  \n' +
    'E a *Roma Pizzaria* já separou um presente de respeito pra você 🍕🔥  \n' +
    '\n' +
    '🎁 *RODIZIO GRÁTIS* pra você comemorar do jeito certo!  \n' +
    'É só vir até o salão, aproveitar o rodízio e apresentar o cupom 👉 *{{cupom}}* \n' +
    '\n' +
    '📅 Valido para *semana do seu aniversário*,  \n' +
    'lembrando que o *rodízio acontece toda quarta, quinta e sexta* 😉  \n' +
    '\n' +
    '📍 *Válido exclusivamente no salão*  \n' +
    'Chama a galera, escolhe o dia e vem aproveitar! 🎂🍻  \n' +
    '\n' +
    '**Roma Pizzaria** 😍🍕',
  birthdayDaysBefore: 7,
  birthdayRewardType: 'recompensa',
  birthdayRewardId: '17ea8117-07e1-4fca-944b-8454f78079ad',
  birthdayCouponValidityDays: 30,
  sendDetractorMessageToClient: true,
  detractorMessageTemplate: 'Olá, {{cliente}}! 👋\n' +
    '\n' +
    'Recebemos sua avaliação com a nota **{{nota}}** e queremos agradecer por compartilhar sua experiência.  \n' +
    'Lamentamos muito que algo não tenha saído como esperado. 😔\n' +
    '\n' +
    'Seu comentário: _"{{comentario}}"_\n' +
    '\n' +
    'Estamos aqui para resolver isso o mais rápido possível.  \n' +
    'Poderia nos contar um pouco mais sobre o que aconteceu? Seu retorno é essencial para que possamos melhorar e garantir uma próxima experiência muito melhor. 🙏\n' +
    '\n' +
    'Obrigado por nos ajudar a evoluir!  \n' +
    'Nossa equipe está à disposição.\n',
  notifyDetractorToOwner: true,
  detractorOwnerMessageTemplate: '## 🚨 **Alerta de Detrator**\n' +
    '\n' +
    'O cliente **{{cliente}}** registrou uma avaliação **baixa**:\n' +
    '\n' +
    '- **Nota:** **{{nota}}**\n' +
    '- **Comentário:** _"{{comentario}}"_',
  detractorOwnerPhoneNumbers: '5535991090766,553591523297,553598374007',
  postSaleDelayMinutes: 90,
  postSaleMessageTemplate: '🍕 **Olá, {{cliente}}!**  \n' +
    '\n' +
    'Esperamos que você tenha curtido seu pedido da **Roma Pizzaria** 😍  \n' +
    '\n' +
    'Sua opinião é *muito importante* pra gente — é com ela que conseguimos melhorar sabores, atendimento e experiência a cada pedido.\n' +
    '\n' +
    '📝 **Leva menos de 1 minuto:**  \n' +
    '👉 {{link_pesquisa}}\n' +
    '\n' +
    'Como agradecimento, você pode receber **vantagens especiais** nos próximos pedidos 😉\n' +
    '\n' +
    'Obrigado por escolher a Roma ❤️  \n' +
    '*Tradição, sabor e respeito por cada cliente.*',
  postSaleSurveyId: '362bd09a-762a-49d4-9651-415955567e6a',
  createdAt: 2025-11-28T21:25:29.661Z,
  updatedAt: 2026-02-05T22:49:26.315Z
}
[RoletaController] Todas as condições para enviar a mensagem de prêmio foram atendidas para o tenant eb629ea8-7d69-47a1-b1f1-f9dcb33475f4.
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "postSaleDelayMinutes", "postSaleMessageTemplate", "postSaleSurveyId", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "postSaleDelayMinutes", "postSaleMessageTemplate", "postSaleSurveyId", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
[WhatsappService] Resposta da API de status da instância: {
  "instance": {
    "instanceName": "roma-pizzaria--chopperia",
    "state": "close"
  }
}
[RoletaController] Falha ao tentar enviar mensagem de prêmio via WhatsApp para o tenant eb629ea8-7d69-47a1-b1f1-f9dcb33475f4. Erro: A instância do WhatsApp desta loja não está conectada.
Executing (default): SELECT "id", "name", "logoUrl", "primaryColor", "secondaryColor", "description" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 01:37:00.037 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 01:38:00.030 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 01:39:00.028 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[CAMPAIGN_MONITOR] Iniciando verificação de campanhas pausadas...
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[iFood Job] Starting Polling...
[Delivery Much Job] Starting Polling...
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."status" = 'paused';
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 01:40:00.093 +00:00' LIMIT 50;
[CAMPAIGN_MONITOR] Nenhuma campanha pausada encontrada.
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Iniciando processamento do webhook do Uai Rango: {
  "id_estabelecimento": 4659,
  "cod_pedido": "7F77840DA",
  "data": "2026-02-06 22:40:03",
  "pedido_pronto": 0,
  "data_pedido_pronto": null,

  "cupom": {
    "codigo": "ESQUENTA",
    "tipo": "Porcentagem",
    "valor": "20",
    "desconto_maximo": 10,
    "desconto_valor": 8.74
  },
  "tipo_entrega": "Delivery",
  "prazo": null,
  "prazo_min": 30,
  "prazo_max": 50,
  "categoria_pagamento": "Pagamento Online",
  "forma_pagamento": "Pagamento Online",
  "valor_total": 43.7,
  "observacao": "",
  "taxa_entrega": 2,
  "nome_taxa_entrega": "Área Central",
  "status": {

    "id": 0,
    "status": "Pendente"
  },
  "produtos": [
    {
      "id_categoria": 31340,
      "codigo_categoria": "",
      "categoria": "Pizzas Salgadas",
      "id_opcao": 61418,
      "opcao": "Pequena - 4 Fatias",
      "id_produto": 244555,
      "codigo": "",
      "produto": "Lombo Canadense",
      "id_produto_2": null,
      "codigo_2": "",
      "produto_2": null,
      "obs": "",
      "valor": 43.7,
      "quantidade": 1,
      "adicionais": []
    }
  ],
  "usuario": {
    "id": "dcc0746c5166c79b",
    "nome": "Ana Mendes",
    "tel1": "35997677914"
  },
  "endereco": {
    "id": 1122459,
    "uf": "MG",
    "cidade": "Andradas",
    "bairro": "vila Mosconi",
    "rua": "rua Dr Oscar de oliveira",
    "num": "532",
    "complemento": "",
    "ponto_referencia": "casa de muro baixo"
  }
}
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "gmb_link", "uairangoEstablishmentId", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt", "ifoodClientId", "ifoodClientSecret", "ifoodAuthVerifier", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt", "franchisorId", "plan", "planExpiresAt", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."uairangoEstablishmentId" = '4659';
[UaiRango Webhook] Tenant encontrado: eb629ea8-7d69-47a1-b1f1-f9dcb33475f4 para o pedido 7F77840DA
Executing (default): SELECT "id", "tenantId", "name", "email", "phone", "birthDate", "respondentSessionId", "gender", "createdAt", "updatedAt" FROM "clients" AS "Client" WHERE "Client"."phone" = '35997677914' AND "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
Executing (default): INSERT INTO "clients" ("id","tenantId","name","phone","createdAt","updatedAt") VALUES ($1,$2,$3,$4,$5,$6) RETURNING "id","tenantId","name","email","phone","birthDate","respondentSessionId","gender","createdAt","updatedAt";
[UaiRango Webhook] Novo cliente criado: e86f1f84-0a36-426a-b288-1e1fd840bfbf para o pedido 7F77840DA
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."platform" = 'UaiRango' AND "DeliveryOrder"."orderIdPlatform" = '7F77840DA';
Executing (default): INSERT INTO "delivery_orders" ("id","platform","orderIdPlatform","totalAmount","orderDate","payload","clientId","tenantId","surveyStatus","createdAt","updatedAt") VALUES ($1,$2,$3,$4,$5,$6,$7,$8,$9,$10,$11) RETURNING "id","platform","orderIdPlatform","totalAmount","orderDate","payload","clientId","tenantId","surveyStatus","surveyScheduledAt","surveySentAt","createdAt","updatedAt";
[UaiRango Webhook] DeliveryOrder criado: 22ca05aa-2e67-430e-9085-5cbacf9ef13f para o pedido 7F77840DA
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "postSaleDelayMinutes", "postSaleMessageTemplate", "postSaleSurveyId", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
Executing (default): UPDATE "delivery_orders" SET "surveyStatus"=$1,"surveyScheduledAt"=$2,"updatedAt"=$3 WHERE "id" = $4
Pesquisa agendada para o pedido 22ca05aa-2e67-430e-9085-5cbacf9ef13f. Delay: 90 min. Envio em: Sat Feb 07 2026 03:10:32 GMT+0000 (Coordinated Universal Time)
[UaiRango Webhook] Pesquisa de satisfação agendada para cliente e86f1f84-0a36-426a-b288-1e1fd840bfbf, pedido 22ca05aa-2e67-430e-9085-5cbacf9ef13f.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 01:41:00.036 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[Post-Sale Survey Job] Encontrados 1 pedidos pendentes de pesquisa.
Executing (default): SELECT "id", "tenantId", "name", "email", "phone", "birthDate", "respondentSessionId", "gender", "createdAt", "updatedAt" FROM "clients" AS "Client" WHERE "Client"."id" = '787ff35a-c5f5-4bc9-863c-9df8d6c820a1' AND "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "postSaleDelayMinutes", "postSaleMessageTemplate", "postSaleSurveyId", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
Erro ao enviar pesquisa de satisfação para o cliente 787ff35a-c5f5-4bc9-863c-9df8d6c820a1 (tenant: eb629ea8-7d69-47a1-b1f1-f9dcb33475f4, pedido: 4f8bf890-bf77-411b-a90b-f0b4c873add6): TypeError: Cannot read properties of undefined (reading 'findByPk')
    at Object.sendSatisfactionSurvey (/usr/src/app/src/services/surveyTriggerService.js:63:31)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async cron.schedule.scheduled (/usr/src/app/src/jobs/postSaleSurveyJob.js:38:17)
    at async Timeout._onTimeout (/usr/src/app/node_modules/node-cron/dist/cjs/scheduler/runner.js:70:44)
Executing (default): UPDATE "delivery_orders" SET "surveyStatus"=$1,"updatedAt"=$2 WHERE "id" = $3
[Post-Sale Survey Job] Falha ao processar pedido 4f8bf890-bf77-411b-a90b-f0b4c873add6: Falha ao enviar pesquisa de satisfação.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 01:42:00.031 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 01:43:00.026 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 01:44:00.031 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[Delivery Much Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 01:45:00.115 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 01:46:00.038 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 01:47:00.043 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 01:48:00.043 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 01:49:00.029 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[CAMPAIGN_MONITOR] Iniciando verificação de campanhas pausadas...
[Delivery Much Job] Starting Polling...
[iFood Job] Starting Polling...
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."status" = 'paused';
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 01:50:00.087 +00:00' LIMIT 50;
[CAMPAIGN_MONITOR] Nenhuma campanha pausada encontrada.
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 01:51:00.037 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 01:52:00.045 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 01:53:00.045 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 01:54:00.039 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[Delivery Much Job] Starting Polling...
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 01:55:00.069 +00:00' LIMIT 50;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 01:56:00.048 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 01:57:00.042 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 01:58:00.049 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 01:59:00.026 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[Delivery Much Job] Starting Polling...
[iFood Job] Starting Polling...
[CAMPAIGN_MONITOR] Iniciando verificação de campanhas pausadas...
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 02:00:00.139 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."status" = 'paused';
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
[CAMPAIGN_MONITOR] Nenhuma campanha pausada encontrada.
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 02:01:00.046 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 02:02:00.031 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 02:03:00.057 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 02:04:00.040 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[Delivery Much Job] Starting Polling...
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 02:05:00.061 +00:00' LIMIT 50;
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 02:06:00.034 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 02:07:00.049 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 02:08:00.035 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 02:09:00.038 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[Delivery Much Job] Starting Polling...
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[CAMPAIGN_MONITOR] Iniciando verificação de campanhas pausadas...
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."status" = 'paused';
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 02:10:00.091 +00:00' LIMIT 50;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[CAMPAIGN_MONITOR] Nenhuma campanha pausada encontrada.
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 02:11:00.037 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[Post-Sale Survey Job] Encontrados 1 pedidos pendentes de pesquisa.
Executing (default): SELECT "id", "tenantId", "name", "email", "phone", "birthDate", "respondentSessionId", "gender", "createdAt", "updatedAt" FROM "clients" AS "Client" WHERE "Client"."id" = '1a9d9445-37dc-45a8-a391-1c4174a7dee6' AND "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "postSaleDelayMinutes", "postSaleMessageTemplate", "postSaleSurveyId", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
Erro ao enviar pesquisa de satisfação para o cliente 1a9d9445-37dc-45a8-a391-1c4174a7dee6 (tenant: eb629ea8-7d69-47a1-b1f1-f9dcb33475f4, pedido: 3baf42d6-c877-4b66-ae8b-68dab8174c74): TypeError: Cannot read properties of undefined (reading 'findByPk')
    at Object.sendSatisfactionSurvey (/usr/src/app/src/services/surveyTriggerService.js:63:31)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async cron.schedule.scheduled (/usr/src/app/src/jobs/postSaleSurveyJob.js:38:17)
    at async Timeout._onTimeout (/usr/src/app/node_modules/node-cron/dist/cjs/scheduler/runner.js:70:44)
Executing (default): UPDATE "delivery_orders" SET "surveyStatus"=$1,"updatedAt"=$2 WHERE "id" = $3
[Post-Sale Survey Job] Falha ao processar pedido 3baf42d6-c877-4b66-ae8b-68dab8174c74: Falha ao enviar pesquisa de satisfação.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 02:12:00.044 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 02:13:00.038 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 02:14:00.041 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[Delivery Much Job] Starting Polling...
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 02:15:00.062 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 02:16:00.055 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 02:17:00.045 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 02:18:00.036 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 02:19:00.041 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[CAMPAIGN_MONITOR] Iniciando verificação de campanhas pausadas...
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[Delivery Much Job] Starting Polling...
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."status" = 'paused';
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
[CAMPAIGN_MONITOR] Nenhuma campanha pausada encontrada.
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 02:20:00.118 +00:00' LIMIT 50;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 02:21:00.033 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 02:22:00.038 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 02:23:00.048 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 02:24:00.043 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[Delivery Much Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 02:25:00.053 +00:00' LIMIT 50;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 02:26:00.041 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 02:27:00.033 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 02:28:00.030 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 02:29:00.029 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
[CAMPAIGN_MONITOR] Iniciando verificação de campanhas pausadas...
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[Delivery Much Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 02:30:00.073 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."status" = 'paused';
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
[CAMPAIGN_MONITOR] Nenhuma campanha pausada encontrada.
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 02:31:00.035 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 02:32:00.042 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 02:33:00.041 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 02:34:00.046 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[Delivery Much Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 02:35:00.069 +00:00' LIMIT 50;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 02:36:00.052 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 02:37:00.045 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 02:38:00.036 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 02:39:00.028 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[CAMPAIGN_MONITOR] Iniciando verificação de campanhas pausadas...
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[Delivery Much Job] Starting Polling...
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 02:40:00.063 +00:00' LIMIT 50;
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."status" = 'paused';
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
[CAMPAIGN_MONITOR] Nenhuma campanha pausada encontrada.
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 02:41:00.038 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 02:42:00.028 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 02:43:00.042 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 02:44:00.040 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[iFood Job] Starting Polling...
[Delivery Much Job] Starting Polling...
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 02:45:00.066 +00:00' LIMIT 50;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 02:46:00.038 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 02:47:00.037 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 02:48:00.035 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 02:49:00.042 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[CAMPAIGN_MONITOR] Iniciando verificação de campanhas pausadas...
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[Delivery Much Job] Starting Polling...
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."status" = 'paused';
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
[CAMPAIGN_MONITOR] Nenhuma campanha pausada encontrada.
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 02:50:00.082 +00:00' LIMIT 50;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 02:51:00.023 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 02:52:00.027 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 02:53:00.041 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 02:54:00.031 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[iFood Job] Starting Polling...
[Delivery Much Job] Starting Polling...
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 02:55:00.079 +00:00' LIMIT 50;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 02:56:00.032 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 02:57:00.041 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 02:58:00.035 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 02:59:00.034 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[Job] Iniciando verificação de cupons expirados...
[Delivery Much Job] Starting Polling...
[iFood Job] Starting Polling...
Running scheduled job: Reset Sender Daily Counts
[SenderPoolService] Resetando contagem diária de mensagens...
[CAMPAIGN_MONITOR] Iniciando verificação de campanhas pausadas...
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
Executing (default): UPDATE "cupons" SET "status"=$1,"updatedAt"=$2 WHERE "status" = $3 AND "dataValidade" < '2026-02-07 00:00:00.000 +00:00'
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): UPDATE "WhatsappSenders" SET "messagesSentToday"=$1,"updatedAt"=$2 WHERE "messagesSentToday" > 0
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."status" = 'paused';
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
[SenderPoolService] Contagem diária resetada.
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 03:00:00.148 +00:00' LIMIT 50;
[Job] 5 cupons foram atualizados para 'expirado'.
[Job] Verificação de cupons expirados concluída.
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[CAMPAIGN_MONITOR] Nenhuma campanha pausada encontrada.
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 03:01:00.039 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 03:02:00.026 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 03:03:00.039 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 03:04:00.041 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[Delivery Much Job] Starting Polling...
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 03:05:00.073 +00:00' LIMIT 50;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 03:06:00.034 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 03:07:00.032 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 03:08:00.046 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 03:09:00.028 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[CAMPAIGN_MONITOR] Iniciando verificação de campanhas pausadas...
[Delivery Much Job] Starting Polling...
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."status" = 'paused';
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 03:10:00.097 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[CAMPAIGN_MONITOR] Nenhuma campanha pausada encontrada.
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 03:11:00.043 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[Post-Sale Survey Job] Encontrados 1 pedidos pendentes de pesquisa.
Executing (default): SELECT "id", "tenantId", "name", "email", "phone", "birthDate", "respondentSessionId", "gender", "createdAt", "updatedAt" FROM "clients" AS "Client" WHERE "Client"."id" = 'e86f1f84-0a36-426a-b288-1e1fd840bfbf' AND "Client"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4';
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "weeklyReportEnabled", "monthlyReportEnabled", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "sendDetractorMessageToClient", "detractorMessageTemplate", "notifyDetractorToOwner", "detractorOwnerMessageTemplate", "detractorOwnerPhoneNumbers", "postSaleDelayMinutes", "postSaleMessageTemplate", "postSaleSurveyId", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = 'eb629ea8-7d69-47a1-b1f1-f9dcb33475f4' LIMIT 1;
Erro ao enviar pesquisa de satisfação para o cliente e86f1f84-0a36-426a-b288-1e1fd840bfbf (tenant: eb629ea8-7d69-47a1-b1f1-f9dcb33475f4, pedido: 22ca05aa-2e67-430e-9085-5cbacf9ef13f): TypeError: Cannot read properties of undefined (reading 'findByPk')
    at Object.sendSatisfactionSurvey (/usr/src/app/src/services/surveyTriggerService.js:63:31)
    at process.processTicksAndRejections (node:internal/process/task_queues:95:5)
    at async cron.schedule.scheduled (/usr/src/app/src/jobs/postSaleSurveyJob.js:38:17)
    at async Timeout._onTimeout (/usr/src/app/node_modules/node-cron/dist/cjs/scheduler/runner.js:70:44)
Executing (default): UPDATE "delivery_orders" SET "surveyStatus"=$1,"updatedAt"=$2 WHERE "id" = $3
[Post-Sale Survey Job] Falha ao processar pedido 22ca05aa-2e67-430e-9085-5cbacf9ef13f: Falha ao enviar pesquisa de satisfação.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 03:12:00.035 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 03:13:00.029 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 03:14:00.048 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[Delivery Much Job] Starting Polling...
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
[SENDER_MONITOR] Verificando 1 disparador(es) inativo(s).
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 03:15:00.081 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Verificação de status concluída.
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 03:16:00.047 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 03:17:00.033 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 03:18:00.039 +00:00' LIMIT 50;
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 03:19:00.050 +00:00' LIMIT 50;
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "ifoodMerchantId", "ifoodAccessToken", "ifoodRefreshToken", "ifoodTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."ifoodMerchantId" IS NOT NULL AND "Tenant"."ifoodAccessToken" IS NOT NULL AND "Tenant"."ifoodRefreshToken" IS NOT NULL;
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
[CAMPAIGN_MONITOR] Iniciando verificação de campanhas pausadas...
[Delivery Much Job] Starting Polling...
[iFood Job] Starting Polling...
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
Executing (default): SELECT "id", "platform", "orderIdPlatform", "totalAmount", "orderDate", "payload", "clientId", "tenantId", "surveyStatus", "surveyScheduledAt", "surveySentAt", "createdAt", "updatedAt" FROM "delivery_orders" AS "DeliveryOrder" WHERE "DeliveryOrder"."surveyStatus" = 'SCHEDULED' AND "DeliveryOrder"."surveyScheduledAt" <= '2026-02-07 03:20:00.096 +00:00' LIMIT 50;
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."status" = 'paused';
Executing (default): SELECT "id", "deliveryMuchClientId", "deliveryMuchClientSecret", "deliveryMuchUsername", "deliveryMuchPassword", "deliveryMuchToken", "deliveryMuchTokenExpiresAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."deliveryMuchClientId" IS NOT NULL AND "Tenant"."deliveryMuchClientSecret" IS NOT NULL AND "Tenant"."deliveryMuchUsername" IS NOT NULL AND "Tenant"."deliveryMuchPassword" IS NOT NULL;
[SENDER_MONITOR] Veri