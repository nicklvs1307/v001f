Postgres is up - executing command
Server.js is being executed!
Conexão com o banco de dados estabelecida com sucesso (Sequelize).
Server is running on port 5000
Agendador de relatório diário iniciado. A tarefa será executada todos os dias às 8:00.
Agendador de lembrete de cupons iniciado. A tarefa será executada todos os dias às 9:00.
Agendador de expiração de cupons iniciado. A tarefa será executada todo dia à meia-noite.
[SenderMonitorJob] Job de monitoramento de disparadores inicializado para rodar a cada 5 minutos.
[WarmingUpProgressJob] Job de progressão de aquecimento inicializado para rodar diariamente à 1h.
[CampaignMonitorJob] Job de monitoramento de campanhas inicializado para rodar a cada 10 minutos.
[CampanhaService] Inicializando campanhas agendadas...
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."status" = 'scheduled' AND "Campanha"."startDate" IS NOT NULL;
[CampanhaService] 0 campanhas reagendadas.
Executing (default): SELECT "Usuario"."id", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."tenantId", "Usuario"."roleId", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."email" = 'rafael1@towersfy.com';
Executing (default): SELECT "name" FROM "roles" AS "Role" WHERE "Role"."id" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
[Auth Middleware] Request: POST /api/auth/verify-token
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
[Auth Middleware] Request: GET /api/dashboard/main
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
Executing (default): SELECT "id", "name", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT count(*) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "Resposta"."id", "Resposta"."perguntaId", "Resposta"."pesquisaId", "Resposta"."tenantId", "Resposta"."atendenteId", "Resposta"."respondentSessionId", "Resposta"."ratingValue", "Resposta"."textValue", "Resposta"."selectedOption", "Resposta"."createdAt", "Resposta"."updatedAt", "pergunta"."id" AS "pergunta.id", "pergunta"."type" AS "pergunta.type" FROM "respostas" AS "Resposta" INNER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."ratingValue" IS NOT NULL;
Executing (default): SELECT date_trunc('day', "createdAt") AS "period", COUNT("id") AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' GROUP BY date_trunc('day', "createdAt") ORDER BY date_trunc('day', "createdAt") ASC;
Executing (default): SELECT date_trunc('day', "createdAt") AS "period", SUM(CASE WHEN "ratingValue" >= 9 THEN 1 ELSE 0 END) AS "promoters", SUM(CASE WHEN "ratingValue" <= 6 THEN 1 ELSE 0 END) AS "detractors", COUNT("id") AS "total" FROM "respostas" AS "Resposta" WHERE "Resposta"."ratingValue" IS NOT NULL AND "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' GROUP BY date_trunc('day', "createdAt") ORDER BY date_trunc('day', "createdAt") ASC;
Executing (default): SELECT "Resposta"."id", "Resposta"."perguntaId", "Resposta"."pesquisaId", "Resposta"."tenantId", "Resposta"."atendenteId", "Resposta"."respondentSessionId", "Resposta"."ratingValue", "Resposta"."textValue", "Resposta"."selectedOption", "Resposta"."createdAt", "Resposta"."updatedAt", "pergunta"."id" AS "pergunta.id", "pergunta"."type" AS "pergunta.type" FROM "respostas" AS "Resposta" INNER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" WHERE "Resposta"."ratingValue" IS NOT NULL AND "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "Criterio"."id", "Criterio"."name", SUM(CASE WHEN "perguntas->respostas"."ratingValue" >= 9 THEN 1 ELSE 0 END) AS "promoters", SUM(CASE WHEN "perguntas->respostas"."ratingValue" <= 6 THEN 1 ELSE 0 END) AS "detractors", COUNT("perguntas->respostas"."id") AS "total" FROM "criterios" AS "Criterio" INNER JOIN "perguntas" AS "perguntas" ON "Criterio"."id" = "perguntas"."criterioId" AND "perguntas"."type" LIKE 'rating%' INNER JOIN "respostas" AS "perguntas->respostas" ON "perguntas"."id" = "perguntas->respostas"."perguntaId" AND "perguntas->respostas"."ratingValue" IS NOT NULL AND "perguntas->respostas"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' GROUP BY "Criterio"."id", "Criterio"."name";
Executing (default): SELECT "Resposta"."id", "Resposta"."createdAt", "Resposta"."textValue", "Resposta"."ratingValue", "Resposta"."respondentSessionId", "client"."id" AS "client.id", "client"."name" AS "client.name" FROM "respostas" AS "Resposta" LEFT OUTER JOIN "clients" AS "client" ON "Resposta"."respondentSessionId" = "client"."respondentSessionId" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."textValue" != '' ORDER BY "Resposta"."createdAt" DESC LIMIT 7;
Executing (default): SELECT "Atendente"."id", "Atendente"."tenantId", "Atendente"."name", "Atendente"."code", "Atendente"."status", "Atendente"."createdAt", "Atendente"."updatedAt", "meta"."id" AS "meta.id", "meta"."atendenteId" AS "meta.atendenteId", "meta"."tenantId" AS "meta.tenantId", "meta"."npsGoal" AS "meta.npsGoal", "meta"."responsesGoal" AS "meta.responsesGoal", "meta"."registrationsGoal" AS "meta.registrationsGoal", "meta"."createdAt" AS "meta.createdAt", "meta"."updatedAt" AS "meta.updatedAt" FROM "atendentes" AS "Atendente" LEFT OUTER JOIN "atendente_metas" AS "meta" ON "Atendente"."id" = "meta"."atendenteId" WHERE "Atendente"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Atendente"."status" = 'active';
Executing (default): SELECT "textValue" FROM "respostas" AS "Resposta" WHERE "Resposta"."textValue" != '' AND "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT EXTRACT(DOW FROM "Resposta"."createdAt") AS "dayOfWeek", SUM(CASE WHEN "ratingValue" >= 9 THEN 1 ELSE 0 END) AS "promoters", SUM(CASE WHEN "ratingValue" <= 6 THEN 1 ELSE 0 END) AS "detractors", COUNT("id") AS "total" FROM "respostas" AS "Resposta" WHERE "Resposta"."ratingValue" IS NOT NULL AND "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' GROUP BY EXTRACT(DOW FROM "Resposta"."createdAt") ORDER BY EXTRACT(DOW FROM "Resposta"."createdAt") ASC;
Executing (default): SELECT date_trunc('day', "createdAt") AS "period", COUNT(DISTINCT("respondentSessionId")) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."respondentSessionId" IS NOT NULL GROUP BY date_trunc('day', "createdAt") ORDER BY date_trunc('day', "createdAt") ASC;
Executing (default): SELECT "gender", "birthDate" FROM "clients" AS "Client" WHERE "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT count(DISTINCT("respondentSessionId")) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."ratingValue" >= 9 AND "Resposta"."respondentSessionId" IS NOT NULL;
Executing (default): SELECT count(*) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = 'f60c5a4d-1c9a-474c-89db-2abd95e8e06f';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Cupom"."status" = 'used' AND "Cupom"."updatedAt" = '2025-11-23 12:06:06.176 +00:00';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = '49c162d2-fdde-448c-86f8-14b9c93be792';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Cupom"."status" = 'used';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = 'b13aa606-ae37-4d5b-8405-9610cbdffc25';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = 'ead2104c-7963-47ff-8336-852ad10d355f';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = '78b6809d-1ef3-4950-920c-ca4adfdbf114';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = '1c1b649b-a287-4430-84ba-3648a81a5001';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = '2a4fd6a3-c581-401d-ba65-9225b56cd850';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = '8b5efb23-f875-4ada-a3ae-e83e1f70e8cb';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = '2dbadb84-aafa-4c99-a50d-9b01d56ca921';
[Auth Middleware] Request: GET /api/recompensas?active=false
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
[Auth Middleware] Request: GET /api/automations
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
Executing (default): SELECT "id", "name", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
[Auth Middleware] Request: GET /api/roletas
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'recompensas' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' LIMIT 1;
Executing (default): SELECT "id", "tenantId", "name", "description", "pointsRequired", "type", "value", "imageUrl", "active", "createdAt", "updatedAt" FROM "recompensas" AS "Recompensa" WHERE "Recompensa"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Recompensa"."active" = false ORDER BY "Recompensa"."name" ASC;
Executing (default): SELECT "id", "name", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "id", "tenantId", "type", "isEnabled", "daysBefore", "message", "createdAt", "updatedAt" FROM "whatsapp_templates" AS "WhatsappTemplate" WHERE "WhatsappTemplate"."type" = 'COUPON_REMINDER' AND "WhatsappTemplate"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' LIMIT 1;
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'roletas' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT "Roleta"."id", "Roleta"."tenantId", "Roleta"."nome", "Roleta"."descricao", "Roleta"."active", "Roleta"."createdAt", "Roleta"."updatedAt", "premios"."id" AS "premios.id", "premios"."tenantId" AS "premios.tenantId", "premios"."nome" AS "premios.nome", "premios"."descricao" AS "premios.descricao", "premios"."porcentagem" AS "premios.porcentagem", "premios"."cor" AS "premios.cor", "premios"."recompensaId" AS "premios.recompensaId", "premios"."roletaId" AS "premios.roletaId", "premios"."imageUrl" AS "premios.imageUrl", "premios"."active" AS "premios.active", "premios"."createdAt" AS "premios.createdAt", "premios"."updatedAt" AS "premios.updatedAt" FROM "roletas" AS "Roleta" LEFT OUTER JOIN "roleta_premios" AS "premios" ON "Roleta"."id" = "premios"."roletaId" WHERE "Roleta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: POST /api/automations/daily-report/test
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
Executing (default): SELECT "Resposta"."id", "Resposta"."perguntaId", "Resposta"."pesquisaId", "Resposta"."tenantId", "Resposta"."atendenteId", "Resposta"."respondentSessionId", "Resposta"."ratingValue", "Resposta"."textValue", "Resposta"."selectedOption", "Resposta"."createdAt", "Resposta"."updatedAt", "pergunta"."id" AS "pergunta.id", "pergunta"."type" AS "pergunta.type" FROM "respostas" AS "Resposta" INNER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."ratingValue" IS NOT NULL;
Executing (default): SELECT count(DISTINCT("respondentSessionId")) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."ratingValue" >= 9 AND "Resposta"."respondentSessionId" IS NOT NULL;
Executing (default): SELECT count(*) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Cupom"."status" = 'used' AND ("Cupom"."updatedAt" >= '2025-11-22 00:00:00.000 +00:00' AND "Cupom"."updatedAt" <= '2025-11-22 23:59:59.999 +00:00');
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' LIMIT 1;
[WhatsApp Service] Enviando mensagem de tenant 3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd para: 5535998374007@s.whatsapp.net
Relatório de teste enviado para 5535998374007 do tenant 3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd
[Auth Middleware] Request: GET /api/dashboard/main
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
Executing (default): SELECT "id", "name", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT count(*) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "Resposta"."id", "Resposta"."perguntaId", "Resposta"."pesquisaId", "Resposta"."tenantId", "Resposta"."atendenteId", "Resposta"."respondentSessionId", "Resposta"."ratingValue", "Resposta"."textValue", "Resposta"."selectedOption", "Resposta"."createdAt", "Resposta"."updatedAt", "pergunta"."id" AS "pergunta.id", "pergunta"."type" AS "pergunta.type" FROM "respostas" AS "Resposta" INNER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."ratingValue" IS NOT NULL;
Executing (default): SELECT date_trunc('day', "createdAt") AS "period", COUNT("id") AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' GROUP BY date_trunc('day', "createdAt") ORDER BY date_trunc('day', "createdAt") ASC;
Executing (default): SELECT date_trunc('day', "createdAt") AS "period", SUM(CASE WHEN "ratingValue" >= 9 THEN 1 ELSE 0 END) AS "promoters", SUM(CASE WHEN "ratingValue" <= 6 THEN 1 ELSE 0 END) AS "detractors", COUNT("id") AS "total" FROM "respostas" AS "Resposta" WHERE "Resposta"."ratingValue" IS NOT NULL AND "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' GROUP BY date_trunc('day', "createdAt") ORDER BY date_trunc('day', "createdAt") ASC;
Executing (default): SELECT "Resposta"."id", "Resposta"."perguntaId", "Resposta"."pesquisaId", "Resposta"."tenantId", "Resposta"."atendenteId", "Resposta"."respondentSessionId", "Resposta"."ratingValue", "Resposta"."textValue", "Resposta"."selectedOption", "Resposta"."createdAt", "Resposta"."updatedAt", "pergunta"."id" AS "pergunta.id", "pergunta"."type" AS "pergunta.type" FROM "respostas" AS "Resposta" INNER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" WHERE "Resposta"."ratingValue" IS NOT NULL AND "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "Criterio"."id", "Criterio"."name", SUM(CASE WHEN "perguntas->respostas"."ratingValue" >= 9 THEN 1 ELSE 0 END) AS "promoters", SUM(CASE WHEN "perguntas->respostas"."ratingValue" <= 6 THEN 1 ELSE 0 END) AS "detractors", COUNT("perguntas->respostas"."id") AS "total" FROM "criterios" AS "Criterio" INNER JOIN "perguntas" AS "perguntas" ON "Criterio"."id" = "perguntas"."criterioId" AND "perguntas"."type" LIKE 'rating%' INNER JOIN "respostas" AS "perguntas->respostas" ON "perguntas"."id" = "perguntas->respostas"."perguntaId" AND "perguntas->respostas"."ratingValue" IS NOT NULL AND "perguntas->respostas"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' GROUP BY "Criterio"."id", "Criterio"."name";
Executing (default): SELECT "Resposta"."id", "Resposta"."createdAt", "Resposta"."textValue", "Resposta"."ratingValue", "Resposta"."respondentSessionId", "client"."id" AS "client.id", "client"."name" AS "client.name" FROM "respostas" AS "Resposta" LEFT OUTER JOIN "clients" AS "client" ON "Resposta"."respondentSessionId" = "client"."respondentSessionId" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."textValue" != '' ORDER BY "Resposta"."createdAt" DESC LIMIT 7;
Executing (default): SELECT "Atendente"."id", "Atendente"."tenantId", "Atendente"."name", "Atendente"."code", "Atendente"."status", "Atendente"."createdAt", "Atendente"."updatedAt", "meta"."id" AS "meta.id", "meta"."atendenteId" AS "meta.atendenteId", "meta"."tenantId" AS "meta.tenantId", "meta"."npsGoal" AS "meta.npsGoal", "meta"."responsesGoal" AS "meta.responsesGoal", "meta"."registrationsGoal" AS "meta.registrationsGoal", "meta"."createdAt" AS "meta.createdAt", "meta"."updatedAt" AS "meta.updatedAt" FROM "atendentes" AS "Atendente" LEFT OUTER JOIN "atendente_metas" AS "meta" ON "Atendente"."id" = "meta"."atendenteId" WHERE "Atendente"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Atendente"."status" = 'active';
Executing (default): SELECT "textValue" FROM "respostas" AS "Resposta" WHERE "Resposta"."textValue" != '' AND "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT EXTRACT(DOW FROM "Resposta"."createdAt") AS "dayOfWeek", SUM(CASE WHEN "ratingValue" >= 9 THEN 1 ELSE 0 END) AS "promoters", SUM(CASE WHEN "ratingValue" <= 6 THEN 1 ELSE 0 END) AS "detractors", COUNT("id") AS "total" FROM "respostas" AS "Resposta" WHERE "Resposta"."ratingValue" IS NOT NULL AND "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' GROUP BY EXTRACT(DOW FROM "Resposta"."createdAt") ORDER BY EXTRACT(DOW FROM "Resposta"."createdAt") ASC;
Executing (default): SELECT date_trunc('day', "createdAt") AS "period", COUNT(DISTINCT("respondentSessionId")) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."respondentSessionId" IS NOT NULL GROUP BY date_trunc('day', "createdAt") ORDER BY date_trunc('day', "createdAt") ASC;
Executing (default): SELECT "gender", "birthDate" FROM "clients" AS "Client" WHERE "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT count(DISTINCT("respondentSessionId")) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."ratingValue" >= 9 AND "Resposta"."respondentSessionId" IS NOT NULL;
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = 'f60c5a4d-1c9a-474c-89db-2abd95e8e06f';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT count(*) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Cupom"."status" = 'used';
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = '49c162d2-fdde-448c-86f8-14b9c93be792';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = 'b13aa606-ae37-4d5b-8405-9610cbdffc25';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Cupom"."status" = 'used' AND "Cupom"."updatedAt" = '2025-11-23 12:06:37.733 +00:00';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = 'ead2104c-7963-47ff-8336-852ad10d355f';
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = '78b6809d-1ef3-4950-920c-ca4adfdbf114';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = '1c1b649b-a287-4430-84ba-3648a81a5001';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = '2a4fd6a3-c581-401d-ba65-9225b56cd850';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = '8b5efb23-f875-4ada-a3ae-e83e1f70e8cb';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = '2dbadb84-aafa-4c99-a50d-9b01d56ca921';
[Auth Middleware] Request: POST /api/auth/verify-token
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
[Auth Middleware] Request: GET /api/dashboard/main
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
Executing (default): SELECT "id", "name", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT count(*) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "Resposta"."id", "Resposta"."perguntaId", "Resposta"."pesquisaId", "Resposta"."tenantId", "Resposta"."atendenteId", "Resposta"."respondentSessionId", "Resposta"."ratingValue", "Resposta"."textValue", "Resposta"."selectedOption", "Resposta"."createdAt", "Resposta"."updatedAt", "pergunta"."id" AS "pergunta.id", "pergunta"."type" AS "pergunta.type" FROM "respostas" AS "Resposta" INNER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."ratingValue" IS NOT NULL;
Executing (default): SELECT date_trunc('day', "createdAt") AS "period", COUNT("id") AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' GROUP BY date_trunc('day', "createdAt") ORDER BY date_trunc('day', "createdAt") ASC;
Executing (default): SELECT date_trunc('day', "createdAt") AS "period", SUM(CASE WHEN "ratingValue" >= 9 THEN 1 ELSE 0 END) AS "promoters", SUM(CASE WHEN "ratingValue" <= 6 THEN 1 ELSE 0 END) AS "detractors", COUNT("id") AS "total" FROM "respostas" AS "Resposta" WHERE "Resposta"."ratingValue" IS NOT NULL AND "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' GROUP BY date_trunc('day', "createdAt") ORDER BY date_trunc('day', "createdAt") ASC;
Executing (default): SELECT "Resposta"."id", "Resposta"."perguntaId", "Resposta"."pesquisaId", "Resposta"."tenantId", "Resposta"."atendenteId", "Resposta"."respondentSessionId", "Resposta"."ratingValue", "Resposta"."textValue", "Resposta"."selectedOption", "Resposta"."createdAt", "Resposta"."updatedAt", "pergunta"."id" AS "pergunta.id", "pergunta"."type" AS "pergunta.type" FROM "respostas" AS "Resposta" INNER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" WHERE "Resposta"."ratingValue" IS NOT NULL AND "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "Criterio"."id", "Criterio"."name", SUM(CASE WHEN "perguntas->respostas"."ratingValue" >= 9 THEN 1 ELSE 0 END) AS "promoters", SUM(CASE WHEN "perguntas->respostas"."ratingValue" <= 6 THEN 1 ELSE 0 END) AS "detractors", COUNT("perguntas->respostas"."id") AS "total" FROM "criterios" AS "Criterio" INNER JOIN "perguntas" AS "perguntas" ON "Criterio"."id" = "perguntas"."criterioId" AND "perguntas"."type" LIKE 'rating%' INNER JOIN "respostas" AS "perguntas->respostas" ON "perguntas"."id" = "perguntas->respostas"."perguntaId" AND "perguntas->respostas"."ratingValue" IS NOT NULL AND "perguntas->respostas"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' GROUP BY "Criterio"."id", "Criterio"."name";
Executing (default): SELECT "Resposta"."id", "Resposta"."createdAt", "Resposta"."textValue", "Resposta"."ratingValue", "Resposta"."respondentSessionId", "client"."id" AS "client.id", "client"."name" AS "client.name" FROM "respostas" AS "Resposta" LEFT OUTER JOIN "clients" AS "client" ON "Resposta"."respondentSessionId" = "client"."respondentSessionId" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."textValue" != '' ORDER BY "Resposta"."createdAt" DESC LIMIT 7;
Executing (default): SELECT "Atendente"."id", "Atendente"."tenantId", "Atendente"."name", "Atendente"."code", "Atendente"."status", "Atendente"."createdAt", "Atendente"."updatedAt", "meta"."id" AS "meta.id", "meta"."atendenteId" AS "meta.atendenteId", "meta"."tenantId" AS "meta.tenantId", "meta"."npsGoal" AS "meta.npsGoal", "meta"."responsesGoal" AS "meta.responsesGoal", "meta"."registrationsGoal" AS "meta.registrationsGoal", "meta"."createdAt" AS "meta.createdAt", "meta"."updatedAt" AS "meta.updatedAt" FROM "atendentes" AS "Atendente" LEFT OUTER JOIN "atendente_metas" AS "meta" ON "Atendente"."id" = "meta"."atendenteId" WHERE "Atendente"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Atendente"."status" = 'active';
Executing (default): SELECT "textValue" FROM "respostas" AS "Resposta" WHERE "Resposta"."textValue" != '' AND "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT EXTRACT(DOW FROM "Resposta"."createdAt") AS "dayOfWeek", SUM(CASE WHEN "ratingValue" >= 9 THEN 1 ELSE 0 END) AS "promoters", SUM(CASE WHEN "ratingValue" <= 6 THEN 1 ELSE 0 END) AS "detractors", COUNT("id") AS "total" FROM "respostas" AS "Resposta" WHERE "Resposta"."ratingValue" IS NOT NULL AND "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' GROUP BY EXTRACT(DOW FROM "Resposta"."createdAt") ORDER BY EXTRACT(DOW FROM "Resposta"."createdAt") ASC;
Executing (default): SELECT date_trunc('day', "createdAt") AS "period", COUNT(DISTINCT("respondentSessionId")) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."respondentSessionId" IS NOT NULL GROUP BY date_trunc('day', "createdAt") ORDER BY date_trunc('day', "createdAt") ASC;
Executing (default): SELECT "gender", "birthDate" FROM "clients" AS "Client" WHERE "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT count(DISTINCT("respondentSessionId")) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."ratingValue" >= 9 AND "Resposta"."respondentSessionId" IS NOT NULL;
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = 'f60c5a4d-1c9a-474c-89db-2abd95e8e06f';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT count(*) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = '49c162d2-fdde-448c-86f8-14b9c93be792';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Cupom"."status" = 'used';
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = 'b13aa606-ae37-4d5b-8405-9610cbdffc25';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = 'ead2104c-7963-47ff-8336-852ad10d355f';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Cupom"."status" = 'used' AND "Cupom"."updatedAt" = '2025-11-23 12:06:46.717 +00:00';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = '78b6809d-1ef3-4950-920c-ca4adfdbf114';
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = '1c1b649b-a287-4430-84ba-3648a81a5001';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = '2a4fd6a3-c581-401d-ba65-9225b56cd850';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = '8b5efb23-f875-4ada-a3ae-e83e1f70e8cb';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = '2dbadb84-aafa-4c99-a50d-9b01d56ca921';
[Auth Middleware] Request: GET /api/dashboard/main?tenantId=3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd&startDate=2025-10-24T03:00:00.000Z&endDate=2025-11-24T02:59:59.999Z
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
Executing (default): SELECT "id", "name", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT count(*) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "Resposta"."id", "Resposta"."perguntaId", "Resposta"."pesquisaId", "Resposta"."tenantId", "Resposta"."atendenteId", "Resposta"."respondentSessionId", "Resposta"."ratingValue", "Resposta"."textValue", "Resposta"."selectedOption", "Resposta"."createdAt", "Resposta"."updatedAt", "pergunta"."id" AS "pergunta.id", "pergunta"."type" AS "pergunta.type" FROM "respostas" AS "Resposta" INNER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."ratingValue" IS NOT NULL;
Executing (default): SELECT date_trunc('day', "createdAt") AS "period", COUNT("id") AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' GROUP BY date_trunc('day', "createdAt") ORDER BY date_trunc('day', "createdAt") ASC;
Executing (default): SELECT date_trunc('day', "createdAt") AS "period", SUM(CASE WHEN "ratingValue" >= 9 THEN 1 ELSE 0 END) AS "promoters", SUM(CASE WHEN "ratingValue" <= 6 THEN 1 ELSE 0 END) AS "detractors", COUNT("id") AS "total" FROM "respostas" AS "Resposta" WHERE "Resposta"."ratingValue" IS NOT NULL AND "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' GROUP BY date_trunc('day', "createdAt") ORDER BY date_trunc('day', "createdAt") ASC;
Executing (default): SELECT "Resposta"."id", "Resposta"."perguntaId", "Resposta"."pesquisaId", "Resposta"."tenantId", "Resposta"."atendenteId", "Resposta"."respondentSessionId", "Resposta"."ratingValue", "Resposta"."textValue", "Resposta"."selectedOption", "Resposta"."createdAt", "Resposta"."updatedAt", "pergunta"."id" AS "pergunta.id", "pergunta"."type" AS "pergunta.type" FROM "respostas" AS "Resposta" INNER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" WHERE "Resposta"."ratingValue" IS NOT NULL AND "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "Criterio"."id", "Criterio"."name", SUM(CASE WHEN "perguntas->respostas"."ratingValue" >= 9 THEN 1 ELSE 0 END) AS "promoters", SUM(CASE WHEN "perguntas->respostas"."ratingValue" <= 6 THEN 1 ELSE 0 END) AS "detractors", COUNT("perguntas->respostas"."id") AS "total" FROM "criterios" AS "Criterio" INNER JOIN "perguntas" AS "perguntas" ON "Criterio"."id" = "perguntas"."criterioId" AND "perguntas"."type" LIKE 'rating%' INNER JOIN "respostas" AS "perguntas->respostas" ON "perguntas"."id" = "perguntas->respostas"."perguntaId" AND "perguntas->respostas"."ratingValue" IS NOT NULL AND "perguntas->respostas"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' GROUP BY "Criterio"."id", "Criterio"."name";
Executing (default): SELECT "Resposta"."id", "Resposta"."createdAt", "Resposta"."textValue", "Resposta"."ratingValue", "Resposta"."respondentSessionId", "client"."id" AS "client.id", "client"."name" AS "client.name" FROM "respostas" AS "Resposta" LEFT OUTER JOIN "clients" AS "client" ON "Resposta"."respondentSessionId" = "client"."respondentSessionId" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."textValue" != '' ORDER BY "Resposta"."createdAt" DESC LIMIT 7;
Executing (default): SELECT "Atendente"."id", "Atendente"."tenantId", "Atendente"."name", "Atendente"."code", "Atendente"."status", "Atendente"."createdAt", "Atendente"."updatedAt", "meta"."id" AS "meta.id", "meta"."atendenteId" AS "meta.atendenteId", "meta"."tenantId" AS "meta.tenantId", "meta"."npsGoal" AS "meta.npsGoal", "meta"."responsesGoal" AS "meta.responsesGoal", "meta"."registrationsGoal" AS "meta.registrationsGoal", "meta"."createdAt" AS "meta.createdAt", "meta"."updatedAt" AS "meta.updatedAt" FROM "atendentes" AS "Atendente" LEFT OUTER JOIN "atendente_metas" AS "meta" ON "Atendente"."id" = "meta"."atendenteId" WHERE "Atendente"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Atendente"."status" = 'active';
Executing (default): SELECT "textValue" FROM "respostas" AS "Resposta" WHERE "Resposta"."textValue" != '' AND "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT EXTRACT(DOW FROM "Resposta"."createdAt") AS "dayOfWeek", SUM(CASE WHEN "ratingValue" >= 9 THEN 1 ELSE 0 END) AS "promoters", SUM(CASE WHEN "ratingValue" <= 6 THEN 1 ELSE 0 END) AS "detractors", COUNT("id") AS "total" FROM "respostas" AS "Resposta" WHERE "Resposta"."ratingValue" IS NOT NULL AND "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' GROUP BY EXTRACT(DOW FROM "Resposta"."createdAt") ORDER BY EXTRACT(DOW FROM "Resposta"."createdAt") ASC;
Executing (default): SELECT date_trunc('day', "createdAt") AS "period", COUNT(DISTINCT("respondentSessionId")) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."respondentSessionId" IS NOT NULL GROUP BY date_trunc('day', "createdAt") ORDER BY date_trunc('day', "createdAt") ASC;
Executing (default): SELECT "gender", "birthDate" FROM "clients" AS "Client" WHERE "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT count(DISTINCT("respondentSessionId")) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."ratingValue" >= 9 AND "Resposta"."respondentSessionId" IS NOT NULL;
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = 'f60c5a4d-1c9a-474c-89db-2abd95e8e06f';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT count(*) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = '49c162d2-fdde-448c-86f8-14b9c93be792';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Cupom"."status" = 'used';
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = 'b13aa606-ae37-4d5b-8405-9610cbdffc25';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Cupom"."status" = 'used' AND ("Cupom"."updatedAt" >= '2025-10-24 03:00:00.000 +00:00' AND "Cupom"."updatedAt" <= '2025-11-24 02:59:59.999 +00:00');
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = 'ead2104c-7963-47ff-8336-852ad10d355f';
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = '78b6809d-1ef3-4950-920c-ca4adfdbf114';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = '1c1b649b-a287-4430-84ba-3648a81a5001';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = '2a4fd6a3-c581-401d-ba65-9225b56cd850';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = '8b5efb23-f875-4ada-a3ae-e83e1f70e8cb';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = '2dbadb84-aafa-4c99-a50d-9b01d56ca921';
[Auth Middleware] Request: POST /api/auth/verify-token
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
[Auth Middleware] Request: GET /api/dashboard/main
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
Executing (default): SELECT "id", "name", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT count(*) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "Resposta"."id", "Resposta"."perguntaId", "Resposta"."pesquisaId", "Resposta"."tenantId", "Resposta"."atendenteId", "Resposta"."respondentSessionId", "Resposta"."ratingValue", "Resposta"."textValue", "Resposta"."selectedOption", "Resposta"."createdAt", "Resposta"."updatedAt", "pergunta"."id" AS "pergunta.id", "pergunta"."type" AS "pergunta.type" FROM "respostas" AS "Resposta" INNER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."ratingValue" IS NOT NULL;
Executing (default): SELECT date_trunc('day', "createdAt") AS "period", COUNT("id") AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' GROUP BY date_trunc('day', "createdAt") ORDER BY date_trunc('day', "createdAt") ASC;
Executing (default): SELECT date_trunc('day', "createdAt") AS "period", SUM(CASE WHEN "ratingValue" >= 9 THEN 1 ELSE 0 END) AS "promoters", SUM(CASE WHEN "ratingValue" <= 6 THEN 1 ELSE 0 END) AS "detractors", COUNT("id") AS "total" FROM "respostas" AS "Resposta" WHERE "Resposta"."ratingValue" IS NOT NULL AND "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' GROUP BY date_trunc('day', "createdAt") ORDER BY date_trunc('day', "createdAt") ASC;
Executing (default): SELECT "Resposta"."id", "Resposta"."perguntaId", "Resposta"."pesquisaId", "Resposta"."tenantId", "Resposta"."atendenteId", "Resposta"."respondentSessionId", "Resposta"."ratingValue", "Resposta"."textValue", "Resposta"."selectedOption", "Resposta"."createdAt", "Resposta"."updatedAt", "pergunta"."id" AS "pergunta.id", "pergunta"."type" AS "pergunta.type" FROM "respostas" AS "Resposta" INNER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" WHERE "Resposta"."ratingValue" IS NOT NULL AND "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "Criterio"."id", "Criterio"."name", SUM(CASE WHEN "perguntas->respostas"."ratingValue" >= 9 THEN 1 ELSE 0 END) AS "promoters", SUM(CASE WHEN "perguntas->respostas"."ratingValue" <= 6 THEN 1 ELSE 0 END) AS "detractors", COUNT("perguntas->respostas"."id") AS "total" FROM "criterios" AS "Criterio" INNER JOIN "perguntas" AS "perguntas" ON "Criterio"."id" = "perguntas"."criterioId" AND "perguntas"."type" LIKE 'rating%' INNER JOIN "respostas" AS "perguntas->respostas" ON "perguntas"."id" = "perguntas->respostas"."perguntaId" AND "perguntas->respostas"."ratingValue" IS NOT NULL AND "perguntas->respostas"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' GROUP BY "Criterio"."id", "Criterio"."name";
Executing (default): SELECT "Resposta"."id", "Resposta"."createdAt", "Resposta"."textValue", "Resposta"."ratingValue", "Resposta"."respondentSessionId", "client"."id" AS "client.id", "client"."name" AS "client.name" FROM "respostas" AS "Resposta" LEFT OUTER JOIN "clients" AS "client" ON "Resposta"."respondentSessionId" = "client"."respondentSessionId" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."textValue" != '' ORDER BY "Resposta"."createdAt" DESC LIMIT 7;
Executing (default): SELECT "Atendente"."id", "Atendente"."tenantId", "Atendente"."name", "Atendente"."code", "Atendente"."status", "Atendente"."createdAt", "Atendente"."updatedAt", "meta"."id" AS "meta.id", "meta"."atendenteId" AS "meta.atendenteId", "meta"."tenantId" AS "meta.tenantId", "meta"."npsGoal" AS "meta.npsGoal", "meta"."responsesGoal" AS "meta.responsesGoal", "meta"."registrationsGoal" AS "meta.registrationsGoal", "meta"."createdAt" AS "meta.createdAt", "meta"."updatedAt" AS "meta.updatedAt" FROM "atendentes" AS "Atendente" LEFT OUTER JOIN "atendente_metas" AS "meta" ON "Atendente"."id" = "meta"."atendenteId" WHERE "Atendente"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Atendente"."status" = 'active';
Executing (default): SELECT "textValue" FROM "respostas" AS "Resposta" WHERE "Resposta"."textValue" != '' AND "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT EXTRACT(DOW FROM "Resposta"."createdAt") AS "dayOfWeek", SUM(CASE WHEN "ratingValue" >= 9 THEN 1 ELSE 0 END) AS "promoters", SUM(CASE WHEN "ratingValue" <= 6 THEN 1 ELSE 0 END) AS "detractors", COUNT("id") AS "total" FROM "respostas" AS "Resposta" WHERE "Resposta"."ratingValue" IS NOT NULL AND "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' GROUP BY EXTRACT(DOW FROM "Resposta"."createdAt") ORDER BY EXTRACT(DOW FROM "Resposta"."createdAt") ASC;
Executing (default): SELECT date_trunc('day', "createdAt") AS "period", COUNT(DISTINCT("respondentSessionId")) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."respondentSessionId" IS NOT NULL GROUP BY date_trunc('day', "createdAt") ORDER BY date_trunc('day', "createdAt") ASC;
Executing (default): SELECT "gender", "birthDate" FROM "clients" AS "Client" WHERE "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT count(DISTINCT("respondentSessionId")) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."ratingValue" >= 9 AND "Resposta"."respondentSessionId" IS NOT NULL;
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = 'f60c5a4d-1c9a-474c-89db-2abd95e8e06f';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT count(*) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Cupom"."status" = 'used';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = '49c162d2-fdde-448c-86f8-14b9c93be792';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Cupom"."status" = 'used' AND "Cupom"."updatedAt" = '2025-11-23 12:07:10.861 +00:00';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = 'b13aa606-ae37-4d5b-8405-9610cbdffc25';
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = 'ead2104c-7963-47ff-8336-852ad10d355f';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = '78b6809d-1ef3-4950-920c-ca4adfdbf114';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = '1c1b649b-a287-4430-84ba-3648a81a5001';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = '2a4fd6a3-c581-401d-ba65-9225b56cd850';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = '8b5efb23-f875-4ada-a3ae-e83e1f70e8cb';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = '2dbadb84-aafa-4c99-a50d-9b01d56ca921';
[Auth Middleware] Request: GET /api/dashboard/main?tenantId=3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd&startDate=2025-11-23T03:00:00.000Z&endDate=2025-11-24T02:59:59.999Z
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
Executing (default): SELECT "id", "name", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT count(*) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "Resposta"."id", "Resposta"."perguntaId", "Resposta"."pesquisaId", "Resposta"."tenantId", "Resposta"."atendenteId", "Resposta"."respondentSessionId", "Resposta"."ratingValue", "Resposta"."textValue", "Resposta"."selectedOption", "Resposta"."createdAt", "Resposta"."updatedAt", "pergunta"."id" AS "pergunta.id", "pergunta"."type" AS "pergunta.type" FROM "respostas" AS "Resposta" INNER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."ratingValue" IS NOT NULL;
Executing (default): SELECT date_trunc('day', "createdAt") AS "period", COUNT("id") AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' GROUP BY date_trunc('day', "createdAt") ORDER BY date_trunc('day', "createdAt") ASC;
Executing (default): SELECT date_trunc('day', "createdAt") AS "period", SUM(CASE WHEN "ratingValue" >= 9 THEN 1 ELSE 0 END) AS "promoters", SUM(CASE WHEN "ratingValue" <= 6 THEN 1 ELSE 0 END) AS "detractors", COUNT("id") AS "total" FROM "respostas" AS "Resposta" WHERE "Resposta"."ratingValue" IS NOT NULL AND "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' GROUP BY date_trunc('day', "createdAt") ORDER BY date_trunc('day', "createdAt") ASC;
Executing (default): SELECT "Resposta"."id", "Resposta"."perguntaId", "Resposta"."pesquisaId", "Resposta"."tenantId", "Resposta"."atendenteId", "Resposta"."respondentSessionId", "Resposta"."ratingValue", "Resposta"."textValue", "Resposta"."selectedOption", "Resposta"."createdAt", "Resposta"."updatedAt", "pergunta"."id" AS "pergunta.id", "pergunta"."type" AS "pergunta.type" FROM "respostas" AS "Resposta" INNER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" WHERE "Resposta"."ratingValue" IS NOT NULL AND "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "Criterio"."id", "Criterio"."name", SUM(CASE WHEN "perguntas->respostas"."ratingValue" >= 9 THEN 1 ELSE 0 END) AS "promoters", SUM(CASE WHEN "perguntas->respostas"."ratingValue" <= 6 THEN 1 ELSE 0 END) AS "detractors", COUNT("perguntas->respostas"."id") AS "total" FROM "criterios" AS "Criterio" INNER JOIN "perguntas" AS "perguntas" ON "Criterio"."id" = "perguntas"."criterioId" AND "perguntas"."type" LIKE 'rating%' INNER JOIN "respostas" AS "perguntas->respostas" ON "perguntas"."id" = "perguntas->respostas"."perguntaId" AND "perguntas->respostas"."ratingValue" IS NOT NULL AND "perguntas->respostas"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' GROUP BY "Criterio"."id", "Criterio"."name";
Executing (default): SELECT "Resposta"."id", "Resposta"."createdAt", "Resposta"."textValue", "Resposta"."ratingValue", "Resposta"."respondentSessionId", "client"."id" AS "client.id", "client"."name" AS "client.name" FROM "respostas" AS "Resposta" LEFT OUTER JOIN "clients" AS "client" ON "Resposta"."respondentSessionId" = "client"."respondentSessionId" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."textValue" != '' ORDER BY "Resposta"."createdAt" DESC LIMIT 7;
Executing (default): SELECT "Atendente"."id", "Atendente"."tenantId", "Atendente"."name", "Atendente"."code", "Atendente"."status", "Atendente"."createdAt", "Atendente"."updatedAt", "meta"."id" AS "meta.id", "meta"."atendenteId" AS "meta.atendenteId", "meta"."tenantId" AS "meta.tenantId", "meta"."npsGoal" AS "meta.npsGoal", "meta"."responsesGoal" AS "meta.responsesGoal", "meta"."registrationsGoal" AS "meta.registrationsGoal", "meta"."createdAt" AS "meta.createdAt", "meta"."updatedAt" AS "meta.updatedAt" FROM "atendentes" AS "Atendente" LEFT OUTER JOIN "atendente_metas" AS "meta" ON "Atendente"."id" = "meta"."atendenteId" WHERE "Atendente"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Atendente"."status" = 'active';
Executing (default): SELECT "textValue" FROM "respostas" AS "Resposta" WHERE "Resposta"."textValue" != '' AND "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT EXTRACT(DOW FROM "Resposta"."createdAt") AS "dayOfWeek", SUM(CASE WHEN "ratingValue" >= 9 THEN 1 ELSE 0 END) AS "promoters", SUM(CASE WHEN "ratingValue" <= 6 THEN 1 ELSE 0 END) AS "detractors", COUNT("id") AS "total" FROM "respostas" AS "Resposta" WHERE "Resposta"."ratingValue" IS NOT NULL AND "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' GROUP BY EXTRACT(DOW FROM "Resposta"."createdAt") ORDER BY EXTRACT(DOW FROM "Resposta"."createdAt") ASC;
Executing (default): SELECT date_trunc('day', "createdAt") AS "period", COUNT(DISTINCT("respondentSessionId")) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."respondentSessionId" IS NOT NULL GROUP BY date_trunc('day', "createdAt") ORDER BY date_trunc('day', "createdAt") ASC;
Executing (default): SELECT "gender", "birthDate" FROM "clients" AS "Client" WHERE "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT count(DISTINCT("respondentSessionId")) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."ratingValue" >= 9 AND "Resposta"."respondentSessionId" IS NOT NULL;
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = 'f60c5a4d-1c9a-474c-89db-2abd95e8e06f';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Cupom"."status" = 'used';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = '49c162d2-fdde-448c-86f8-14b9c93be792';
Executing (default): SELECT count(*) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = 'b13aa606-ae37-4d5b-8405-9610cbdffc25';
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = 'ead2104c-7963-47ff-8336-852ad10d355f';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = '78b6809d-1ef3-4950-920c-ca4adfdbf114';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = '1c1b649b-a287-4430-84ba-3648a81a5001';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Cupom"."status" = 'used' AND ("Cupom"."updatedAt" >= '2025-11-23 03:00:00.000 +00:00' AND "Cupom"."updatedAt" <= '2025-11-24 02:59:59.999 +00:00');
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = '2a4fd6a3-c581-401d-ba65-9225b56cd850';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = '8b5efb23-f875-4ada-a3ae-e83e1f70e8cb';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = '2dbadb84-aafa-4c99-a50d-9b01d56ca921';
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: GET /api/dashboard/main?tenantId=3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd&startDate=2025-11-01T03:00:00.000Z&endDate=2025-12-01T02:59:59.999Z
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
Executing (default): SELECT "id", "name", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT count(*) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "Resposta"."id", "Resposta"."perguntaId", "Resposta"."pesquisaId", "Resposta"."tenantId", "Resposta"."atendenteId", "Resposta"."respondentSessionId", "Resposta"."ratingValue", "Resposta"."textValue", "Resposta"."selectedOption", "Resposta"."createdAt", "Resposta"."updatedAt", "pergunta"."id" AS "pergunta.id", "pergunta"."type" AS "pergunta.type" FROM "respostas" AS "Resposta" INNER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."ratingValue" IS NOT NULL;
Executing (default): SELECT date_trunc('day', "createdAt") AS "period", COUNT("id") AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' GROUP BY date_trunc('day', "createdAt") ORDER BY date_trunc('day', "createdAt") ASC;
Executing (default): SELECT date_trunc('day', "createdAt") AS "period", SUM(CASE WHEN "ratingValue" >= 9 THEN 1 ELSE 0 END) AS "promoters", SUM(CASE WHEN "ratingValue" <= 6 THEN 1 ELSE 0 END) AS "detractors", COUNT("id") AS "total" FROM "respostas" AS "Resposta" WHERE "Resposta"."ratingValue" IS NOT NULL AND "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' GROUP BY date_trunc('day', "createdAt") ORDER BY date_trunc('day', "createdAt") ASC;
Executing (default): SELECT "Resposta"."id", "Resposta"."perguntaId", "Resposta"."pesquisaId", "Resposta"."tenantId", "Resposta"."atendenteId", "Resposta"."respondentSessionId", "Resposta"."ratingValue", "Resposta"."textValue", "Resposta"."selectedOption", "Resposta"."createdAt", "Resposta"."updatedAt", "pergunta"."id" AS "pergunta.id", "pergunta"."type" AS "pergunta.type" FROM "respostas" AS "Resposta" INNER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" WHERE "Resposta"."ratingValue" IS NOT NULL AND "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "Criterio"."id", "Criterio"."name", SUM(CASE WHEN "perguntas->respostas"."ratingValue" >= 9 THEN 1 ELSE 0 END) AS "promoters", SUM(CASE WHEN "perguntas->respostas"."ratingValue" <= 6 THEN 1 ELSE 0 END) AS "detractors", COUNT("perguntas->respostas"."id") AS "total" FROM "criterios" AS "Criterio" INNER JOIN "perguntas" AS "perguntas" ON "Criterio"."id" = "perguntas"."criterioId" AND "perguntas"."type" LIKE 'rating%' INNER JOIN "respostas" AS "perguntas->respostas" ON "perguntas"."id" = "perguntas->respostas"."perguntaId" AND "perguntas->respostas"."ratingValue" IS NOT NULL AND "perguntas->respostas"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' GROUP BY "Criterio"."id", "Criterio"."name";
Executing (default): SELECT "Resposta"."id", "Resposta"."createdAt", "Resposta"."textValue", "Resposta"."ratingValue", "Resposta"."respondentSessionId", "client"."id" AS "client.id", "client"."name" AS "client.name" FROM "respostas" AS "Resposta" LEFT OUTER JOIN "clients" AS "client" ON "Resposta"."respondentSessionId" = "client"."respondentSessionId" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."textValue" != '' ORDER BY "Resposta"."createdAt" DESC LIMIT 7;
Executing (default): SELECT "Atendente"."id", "Atendente"."tenantId", "Atendente"."name", "Atendente"."code", "Atendente"."status", "Atendente"."createdAt", "Atendente"."updatedAt", "meta"."id" AS "meta.id", "meta"."atendenteId" AS "meta.atendenteId", "meta"."tenantId" AS "meta.tenantId", "meta"."npsGoal" AS "meta.npsGoal", "meta"."responsesGoal" AS "meta.responsesGoal", "meta"."registrationsGoal" AS "meta.registrationsGoal", "meta"."createdAt" AS "meta.createdAt", "meta"."updatedAt" AS "meta.updatedAt" FROM "atendentes" AS "Atendente" LEFT OUTER JOIN "atendente_metas" AS "meta" ON "Atendente"."id" = "meta"."atendenteId" WHERE "Atendente"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Atendente"."status" = 'active';
Executing (default): SELECT "textValue" FROM "respostas" AS "Resposta" WHERE "Resposta"."textValue" != '' AND "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT EXTRACT(DOW FROM "Resposta"."createdAt") AS "dayOfWeek", SUM(CASE WHEN "ratingValue" >= 9 THEN 1 ELSE 0 END) AS "promoters", SUM(CASE WHEN "ratingValue" <= 6 THEN 1 ELSE 0 END) AS "detractors", COUNT("id") AS "total" FROM "respostas" AS "Resposta" WHERE "Resposta"."ratingValue" IS NOT NULL AND "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' GROUP BY EXTRACT(DOW FROM "Resposta"."createdAt") ORDER BY EXTRACT(DOW FROM "Resposta"."createdAt") ASC;
Executing (default): SELECT date_trunc('day', "createdAt") AS "period", COUNT(DISTINCT("respondentSessionId")) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."respondentSessionId" IS NOT NULL GROUP BY date_trunc('day', "createdAt") ORDER BY date_trunc('day', "createdAt") ASC;
Executing (default): SELECT "gender", "birthDate" FROM "clients" AS "Client" WHERE "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT count(DISTINCT("respondentSessionId")) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."ratingValue" >= 9 AND "Resposta"."respondentSessionId" IS NOT NULL;
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = 'f60c5a4d-1c9a-474c-89db-2abd95e8e06f';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT count(*) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Cupom"."status" = 'used';
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = '49c162d2-fdde-448c-86f8-14b9c93be792';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Cupom"."status" = 'used' AND ("Cupom"."updatedAt" >= '2025-11-01 03:00:00.000 +00:00' AND "Cupom"."updatedAt" <= '2025-12-01 02:59:59.999 +00:00');
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = 'b13aa606-ae37-4d5b-8405-9610cbdffc25';
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = 'ead2104c-7963-47ff-8336-852ad10d355f';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = '78b6809d-1ef3-4950-920c-ca4adfdbf114';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = '1c1b649b-a287-4430-84ba-3648a81a5001';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = '2a4fd6a3-c581-401d-ba65-9225b56cd850';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = '8b5efb23-f875-4ada-a3ae-e83e1f70e8cb';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = '2dbadb84-aafa-4c99-a50d-9b01d56ca921';
[Auth Middleware] Request: GET /api/dashboard/main?tenantId=3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd&startDate=2025-11-01T03:00:00.000Z&endDate=2025-12-01T02:59:59.999Z
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
Executing (default): SELECT "id", "name", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT count(*) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "Resposta"."id", "Resposta"."perguntaId", "Resposta"."pesquisaId", "Resposta"."tenantId", "Resposta"."atendenteId", "Resposta"."respondentSessionId", "Resposta"."ratingValue", "Resposta"."textValue", "Resposta"."selectedOption", "Resposta"."createdAt", "Resposta"."updatedAt", "pergunta"."id" AS "pergunta.id", "pergunta"."type" AS "pergunta.type" FROM "respostas" AS "Resposta" INNER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."ratingValue" IS NOT NULL;
Executing (default): SELECT date_trunc('day', "createdAt") AS "period", COUNT("id") AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' GROUP BY date_trunc('day', "createdAt") ORDER BY date_trunc('day', "createdAt") ASC;
Executing (default): SELECT date_trunc('day', "createdAt") AS "period", SUM(CASE WHEN "ratingValue" >= 9 THEN 1 ELSE 0 END) AS "promoters", SUM(CASE WHEN "ratingValue" <= 6 THEN 1 ELSE 0 END) AS "detractors", COUNT("id") AS "total" FROM "respostas" AS "Resposta" WHERE "Resposta"."ratingValue" IS NOT NULL AND "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' GROUP BY date_trunc('day', "createdAt") ORDER BY date_trunc('day', "createdAt") ASC;
Executing (default): SELECT "Resposta"."id", "Resposta"."perguntaId", "Resposta"."pesquisaId", "Resposta"."tenantId", "Resposta"."atendenteId", "Resposta"."respondentSessionId", "Resposta"."ratingValue", "Resposta"."textValue", "Resposta"."selectedOption", "Resposta"."createdAt", "Resposta"."updatedAt", "pergunta"."id" AS "pergunta.id", "pergunta"."type" AS "pergunta.type" FROM "respostas" AS "Resposta" INNER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" WHERE "Resposta"."ratingValue" IS NOT NULL AND "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "Criterio"."id", "Criterio"."name", SUM(CASE WHEN "perguntas->respostas"."ratingValue" >= 9 THEN 1 ELSE 0 END) AS "promoters", SUM(CASE WHEN "perguntas->respostas"."ratingValue" <= 6 THEN 1 ELSE 0 END) AS "detractors", COUNT("perguntas->respostas"."id") AS "total" FROM "criterios" AS "Criterio" INNER JOIN "perguntas" AS "perguntas" ON "Criterio"."id" = "perguntas"."criterioId" AND "perguntas"."type" LIKE 'rating%' INNER JOIN "respostas" AS "perguntas->respostas" ON "perguntas"."id" = "perguntas->respostas"."perguntaId" AND "perguntas->respostas"."ratingValue" IS NOT NULL AND "perguntas->respostas"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' GROUP BY "Criterio"."id", "Criterio"."name";
Executing (default): SELECT "Resposta"."id", "Resposta"."createdAt", "Resposta"."textValue", "Resposta"."ratingValue", "Resposta"."respondentSessionId", "client"."id" AS "client.id", "client"."name" AS "client.name" FROM "respostas" AS "Resposta" LEFT OUTER JOIN "clients" AS "client" ON "Resposta"."respondentSessionId" = "client"."respondentSessionId" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."textValue" != '' ORDER BY "Resposta"."createdAt" DESC LIMIT 7;
Executing (default): SELECT "Atendente"."id", "Atendente"."tenantId", "Atendente"."name", "Atendente"."code", "Atendente"."status", "Atendente"."createdAt", "Atendente"."updatedAt", "meta"."id" AS "meta.id", "meta"."atendenteId" AS "meta.atendenteId", "meta"."tenantId" AS "meta.tenantId", "meta"."npsGoal" AS "meta.npsGoal", "meta"."responsesGoal" AS "meta.responsesGoal", "meta"."registrationsGoal" AS "meta.registrationsGoal", "meta"."createdAt" AS "meta.createdAt", "meta"."updatedAt" AS "meta.updatedAt" FROM "atendentes" AS "Atendente" LEFT OUTER JOIN "atendente_metas" AS "meta" ON "Atendente"."id" = "meta"."atendenteId" WHERE "Atendente"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Atendente"."status" = 'active';
Executing (default): SELECT "textValue" FROM "respostas" AS "Resposta" WHERE "Resposta"."textValue" != '' AND "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT EXTRACT(DOW FROM "Resposta"."createdAt") AS "dayOfWeek", SUM(CASE WHEN "ratingValue" >= 9 THEN 1 ELSE 0 END) AS "promoters", SUM(CASE WHEN "ratingValue" <= 6 THEN 1 ELSE 0 END) AS "detractors", COUNT("id") AS "total" FROM "respostas" AS "Resposta" WHERE "Resposta"."ratingValue" IS NOT NULL AND "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' GROUP BY EXTRACT(DOW FROM "Resposta"."createdAt") ORDER BY EXTRACT(DOW FROM "Resposta"."createdAt") ASC;
Executing (default): SELECT date_trunc('day', "createdAt") AS "period", COUNT(DISTINCT("respondentSessionId")) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."respondentSessionId" IS NOT NULL GROUP BY date_trunc('day', "createdAt") ORDER BY date_trunc('day', "createdAt") ASC;
Executing (default): SELECT "gender", "birthDate" FROM "clients" AS "Client" WHERE "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT count(DISTINCT("respondentSessionId")) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."ratingValue" >= 9 AND "Resposta"."respondentSessionId" IS NOT NULL;
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = 'f60c5a4d-1c9a-474c-89db-2abd95e8e06f';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT count(*) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = '49c162d2-fdde-448c-86f8-14b9c93be792';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Cupom"."status" = 'used';
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = 'b13aa606-ae37-4d5b-8405-9610cbdffc25';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Cupom"."status" = 'used' AND ("Cupom"."updatedAt" >= '2025-11-01 03:00:00.000 +00:00' AND "Cupom"."updatedAt" <= '2025-12-01 02:59:59.999 +00:00');
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = 'ead2104c-7963-47ff-8336-852ad10d355f';
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = '78b6809d-1ef3-4950-920c-ca4adfdbf114';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = '1c1b649b-a287-4430-84ba-3648a81a5001';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = '2a4fd6a3-c581-401d-ba65-9225b56cd850';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = '8b5efb23-f875-4ada-a3ae-e83e1f70e8cb';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = '2dbadb84-aafa-4c99-a50d-9b01d56ca921';
[Auth Middleware] Request: GET /api/dashboard/month-summary?startDate=2025-11-01T03:00:00.000Z&endDate=2025-12-01T02:59:59.999Z
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
Executing (default): SELECT "id", "name", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT "Resposta"."id", "Resposta"."perguntaId", "Resposta"."pesquisaId", "Resposta"."tenantId", "Resposta"."atendenteId", "Resposta"."respondentSessionId", "Resposta"."ratingValue", "Resposta"."textValue", "Resposta"."selectedOption", "Resposta"."createdAt", "Resposta"."updatedAt", "pergunta"."id" AS "pergunta.id", "pergunta"."type" AS "pergunta.type" FROM "respostas" AS "Resposta" INNER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."ratingValue" IS NOT NULL;
Executing (default): SELECT count(DISTINCT("respondentSessionId")) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."ratingValue" >= 9 AND "Resposta"."respondentSessionId" IS NOT NULL;
Executing (default): SELECT count(*) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Cupom"."status" = 'used' AND ("Cupom"."updatedAt" >= '2025-11-01 03:00:00.000 +00:00' AND "Cupom"."updatedAt" <= '2025-12-01 02:59:59.999 +00:00');
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
[Auth Middleware] Request: POST /api/auth/verify-token
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
[Auth Middleware] Request: GET /api/dashboard/main?tenantId=3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd&startDate=2025-11-01T03:00:00.000Z&endDate=2025-12-01T02:59:59.999Z
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
Executing (default): SELECT "id", "name", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT count(*) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "Resposta"."id", "Resposta"."perguntaId", "Resposta"."pesquisaId", "Resposta"."tenantId", "Resposta"."atendenteId", "Resposta"."respondentSessionId", "Resposta"."ratingValue", "Resposta"."textValue", "Resposta"."selectedOption", "Resposta"."createdAt", "Resposta"."updatedAt", "pergunta"."id" AS "pergunta.id", "pergunta"."type" AS "pergunta.type" FROM "respostas" AS "Resposta" INNER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."ratingValue" IS NOT NULL;
Executing (default): SELECT date_trunc('day', "createdAt") AS "period", COUNT("id") AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' GROUP BY date_trunc('day', "createdAt") ORDER BY date_trunc('day', "createdAt") ASC;
Executing (default): SELECT date_trunc('day', "createdAt") AS "period", SUM(CASE WHEN "ratingValue" >= 9 THEN 1 ELSE 0 END) AS "promoters", SUM(CASE WHEN "ratingValue" <= 6 THEN 1 ELSE 0 END) AS "detractors", COUNT("id") AS "total" FROM "respostas" AS "Resposta" WHERE "Resposta"."ratingValue" IS NOT NULL AND "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' GROUP BY date_trunc('day', "createdAt") ORDER BY date_trunc('day', "createdAt") ASC;
Executing (default): SELECT "Resposta"."id", "Resposta"."perguntaId", "Resposta"."pesquisaId", "Resposta"."tenantId", "Resposta"."atendenteId", "Resposta"."respondentSessionId", "Resposta"."ratingValue", "Resposta"."textValue", "Resposta"."selectedOption", "Resposta"."createdAt", "Resposta"."updatedAt", "pergunta"."id" AS "pergunta.id", "pergunta"."type" AS "pergunta.type" FROM "respostas" AS "Resposta" INNER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" WHERE "Resposta"."ratingValue" IS NOT NULL AND "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "Criterio"."id", "Criterio"."name", SUM(CASE WHEN "perguntas->respostas"."ratingValue" >= 9 THEN 1 ELSE 0 END) AS "promoters", SUM(CASE WHEN "perguntas->respostas"."ratingValue" <= 6 THEN 1 ELSE 0 END) AS "detractors", COUNT("perguntas->respostas"."id") AS "total" FROM "criterios" AS "Criterio" INNER JOIN "perguntas" AS "perguntas" ON "Criterio"."id" = "perguntas"."criterioId" AND "perguntas"."type" LIKE 'rating%' INNER JOIN "respostas" AS "perguntas->respostas" ON "perguntas"."id" = "perguntas->respostas"."perguntaId" AND "perguntas->respostas"."ratingValue" IS NOT NULL AND "perguntas->respostas"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' GROUP BY "Criterio"."id", "Criterio"."name";
Executing (default): SELECT "Resposta"."id", "Resposta"."createdAt", "Resposta"."textValue", "Resposta"."ratingValue", "Resposta"."respondentSessionId", "client"."id" AS "client.id", "client"."name" AS "client.name" FROM "respostas" AS "Resposta" LEFT OUTER JOIN "clients" AS "client" ON "Resposta"."respondentSessionId" = "client"."respondentSessionId" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."textValue" != '' ORDER BY "Resposta"."createdAt" DESC LIMIT 7;
Executing (default): SELECT "Atendente"."id", "Atendente"."tenantId", "Atendente"."name", "Atendente"."code", "Atendente"."status", "Atendente"."createdAt", "Atendente"."updatedAt", "meta"."id" AS "meta.id", "meta"."atendenteId" AS "meta.atendenteId", "meta"."tenantId" AS "meta.tenantId", "meta"."npsGoal" AS "meta.npsGoal", "meta"."responsesGoal" AS "meta.responsesGoal", "meta"."registrationsGoal" AS "meta.registrationsGoal", "meta"."createdAt" AS "meta.createdAt", "meta"."updatedAt" AS "meta.updatedAt" FROM "atendentes" AS "Atendente" LEFT OUTER JOIN "atendente_metas" AS "meta" ON "Atendente"."id" = "meta"."atendenteId" WHERE "Atendente"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Atendente"."status" = 'active';
Executing (default): SELECT "textValue" FROM "respostas" AS "Resposta" WHERE "Resposta"."textValue" != '' AND "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT EXTRACT(DOW FROM "Resposta"."createdAt") AS "dayOfWeek", SUM(CASE WHEN "ratingValue" >= 9 THEN 1 ELSE 0 END) AS "promoters", SUM(CASE WHEN "ratingValue" <= 6 THEN 1 ELSE 0 END) AS "detractors", COUNT("id") AS "total" FROM "respostas" AS "Resposta" WHERE "Resposta"."ratingValue" IS NOT NULL AND "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' GROUP BY EXTRACT(DOW FROM "Resposta"."createdAt") ORDER BY EXTRACT(DOW FROM "Resposta"."createdAt") ASC;
Executing (default): SELECT date_trunc('day', "createdAt") AS "period", COUNT(DISTINCT("respondentSessionId")) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."respondentSessionId" IS NOT NULL GROUP BY date_trunc('day', "createdAt") ORDER BY date_trunc('day', "createdAt") ASC;
Executing (default): SELECT "gender", "birthDate" FROM "clients" AS "Client" WHERE "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT count(DISTINCT("respondentSessionId")) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."ratingValue" >= 9 AND "Resposta"."respondentSessionId" IS NOT NULL;
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = 'f60c5a4d-1c9a-474c-89db-2abd95e8e06f';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Cupom"."status" = 'used';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = '49c162d2-fdde-448c-86f8-14b9c93be792';
Executing (default): SELECT count(*) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = 'b13aa606-ae37-4d5b-8405-9610cbdffc25';
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = 'ead2104c-7963-47ff-8336-852ad10d355f';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Cupom"."status" = 'used' AND ("Cupom"."updatedAt" >= '2025-11-01 03:00:00.000 +00:00' AND "Cupom"."updatedAt" <= '2025-12-01 02:59:59.999 +00:00');
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = '78b6809d-1ef3-4950-920c-ca4adfdbf114';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = '1c1b649b-a287-4430-84ba-3648a81a5001';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = '2a4fd6a3-c581-401d-ba65-9225b56cd850';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = '8b5efb23-f875-4ada-a3ae-e83e1f70e8cb';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = '2dbadb84-aafa-4c99-a50d-9b01d56ca921';
[Auth Middleware] Request: GET /api/dashboard/main?tenantId=3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd&startDate=2025-10-24T03:00:00.000Z&endDate=2025-11-24T02:59:59.999Z
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
Executing (default): SELECT "id", "name", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT count(*) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "Resposta"."id", "Resposta"."perguntaId", "Resposta"."pesquisaId", "Resposta"."tenantId", "Resposta"."atendenteId", "Resposta"."respondentSessionId", "Resposta"."ratingValue", "Resposta"."textValue", "Resposta"."selectedOption", "Resposta"."createdAt", "Resposta"."updatedAt", "pergunta"."id" AS "pergunta.id", "pergunta"."type" AS "pergunta.type" FROM "respostas" AS "Resposta" INNER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."ratingValue" IS NOT NULL;
Executing (default): SELECT date_trunc('day', "createdAt") AS "period", COUNT("id") AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' GROUP BY date_trunc('day', "createdAt") ORDER BY date_trunc('day', "createdAt") ASC;
Executing (default): SELECT date_trunc('day', "createdAt") AS "period", SUM(CASE WHEN "ratingValue" >= 9 THEN 1 ELSE 0 END) AS "promoters", SUM(CASE WHEN "ratingValue" <= 6 THEN 1 ELSE 0 END) AS "detractors", COUNT("id") AS "total" FROM "respostas" AS "Resposta" WHERE "Resposta"."ratingValue" IS NOT NULL AND "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' GROUP BY date_trunc('day', "createdAt") ORDER BY date_trunc('day', "createdAt") ASC;
Executing (default): SELECT "Resposta"."id", "Resposta"."perguntaId", "Resposta"."pesquisaId", "Resposta"."tenantId", "Resposta"."atendenteId", "Resposta"."respondentSessionId", "Resposta"."ratingValue", "Resposta"."textValue", "Resposta"."selectedOption", "Resposta"."createdAt", "Resposta"."updatedAt", "pergunta"."id" AS "pergunta.id", "pergunta"."type" AS "pergunta.type" FROM "respostas" AS "Resposta" INNER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" WHERE "Resposta"."ratingValue" IS NOT NULL AND "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "Criterio"."id", "Criterio"."name", SUM(CASE WHEN "perguntas->respostas"."ratingValue" >= 9 THEN 1 ELSE 0 END) AS "promoters", SUM(CASE WHEN "perguntas->respostas"."ratingValue" <= 6 THEN 1 ELSE 0 END) AS "detractors", COUNT("perguntas->respostas"."id") AS "total" FROM "criterios" AS "Criterio" INNER JOIN "perguntas" AS "perguntas" ON "Criterio"."id" = "perguntas"."criterioId" AND "perguntas"."type" LIKE 'rating%' INNER JOIN "respostas" AS "perguntas->respostas" ON "perguntas"."id" = "perguntas->respostas"."perguntaId" AND "perguntas->respostas"."ratingValue" IS NOT NULL AND "perguntas->respostas"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' GROUP BY "Criterio"."id", "Criterio"."name";
Executing (default): SELECT "Resposta"."id", "Resposta"."createdAt", "Resposta"."textValue", "Resposta"."ratingValue", "Resposta"."respondentSessionId", "client"."id" AS "client.id", "client"."name" AS "client.name" FROM "respostas" AS "Resposta" LEFT OUTER JOIN "clients" AS "client" ON "Resposta"."respondentSessionId" = "client"."respondentSessionId" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."textValue" != '' ORDER BY "Resposta"."createdAt" DESC LIMIT 7;
Executing (default): SELECT "Atendente"."id", "Atendente"."tenantId", "Atendente"."name", "Atendente"."code", "Atendente"."status", "Atendente"."createdAt", "Atendente"."updatedAt", "meta"."id" AS "meta.id", "meta"."atendenteId" AS "meta.atendenteId", "meta"."tenantId" AS "meta.tenantId", "meta"."npsGoal" AS "meta.npsGoal", "meta"."responsesGoal" AS "meta.responsesGoal", "meta"."registrationsGoal" AS "meta.registrationsGoal", "meta"."createdAt" AS "meta.createdAt", "meta"."updatedAt" AS "meta.updatedAt" FROM "atendentes" AS "Atendente" LEFT OUTER JOIN "atendente_metas" AS "meta" ON "Atendente"."id" = "meta"."atendenteId" WHERE "Atendente"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Atendente"."status" = 'active';
Executing (default): SELECT "textValue" FROM "respostas" AS "Resposta" WHERE "Resposta"."textValue" != '' AND "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT EXTRACT(DOW FROM "Resposta"."createdAt") AS "dayOfWeek", SUM(CASE WHEN "ratingValue" >= 9 THEN 1 ELSE 0 END) AS "promoters", SUM(CASE WHEN "ratingValue" <= 6 THEN 1 ELSE 0 END) AS "detractors", COUNT("id") AS "total" FROM "respostas" AS "Resposta" WHERE "Resposta"."ratingValue" IS NOT NULL AND "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' GROUP BY EXTRACT(DOW FROM "Resposta"."createdAt") ORDER BY EXTRACT(DOW FROM "Resposta"."createdAt") ASC;
Executing (default): SELECT date_trunc('day', "createdAt") AS "period", COUNT(DISTINCT("respondentSessionId")) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."respondentSessionId" IS NOT NULL GROUP BY date_trunc('day', "createdAt") ORDER BY date_trunc('day', "createdAt") ASC;
Executing (default): SELECT "gender", "birthDate" FROM "clients" AS "Client" WHERE "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT count(DISTINCT("respondentSessionId")) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."ratingValue" >= 9 AND "Resposta"."respondentSessionId" IS NOT NULL;
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = 'f60c5a4d-1c9a-474c-89db-2abd95e8e06f';
Executing (default): SELECT count(*) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = '49c162d2-fdde-448c-86f8-14b9c93be792';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Cupom"."status" = 'used';
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = 'b13aa606-ae37-4d5b-8405-9610cbdffc25';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Cupom"."status" = 'used' AND ("Cupom"."updatedAt" >= '2025-10-24 03:00:00.000 +00:00' AND "Cupom"."updatedAt" <= '2025-11-24 02:59:59.999 +00:00');
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = 'ead2104c-7963-47ff-8336-852ad10d355f';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = '78b6809d-1ef3-4950-920c-ca4adfdbf114';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = '1c1b649b-a287-4430-84ba-3648a81a5001';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = '2a4fd6a3-c581-401d-ba65-9225b56cd850';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = '8b5efb23-f875-4ada-a3ae-e83e1f70e8cb';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = '2dbadb84-aafa-4c99-a50d-9b01d56ca921';
[Auth Middleware] Request: POST /api/auth/verify-token
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
[Auth Middleware] Request: GET /api/dashboard/main?tenantId=3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd&startDate=2025-11-01T03:00:00.000Z&endDate=2025-12-01T02:59:59.999Z
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
Executing (default): SELECT "id", "name", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'dashboard' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT count(*) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "Resposta"."id", "Resposta"."perguntaId", "Resposta"."pesquisaId", "Resposta"."tenantId", "Resposta"."atendenteId", "Resposta"."respondentSessionId", "Resposta"."ratingValue", "Resposta"."textValue", "Resposta"."selectedOption", "Resposta"."createdAt", "Resposta"."updatedAt", "pergunta"."id" AS "pergunta.id", "pergunta"."type" AS "pergunta.type" FROM "respostas" AS "Resposta" INNER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."ratingValue" IS NOT NULL;
Executing (default): SELECT date_trunc('day', "createdAt") AS "period", COUNT("id") AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' GROUP BY date_trunc('day', "createdAt") ORDER BY date_trunc('day', "createdAt") ASC;
Executing (default): SELECT date_trunc('day', "createdAt") AS "period", SUM(CASE WHEN "ratingValue" >= 9 THEN 1 ELSE 0 END) AS "promoters", SUM(CASE WHEN "ratingValue" <= 6 THEN 1 ELSE 0 END) AS "detractors", COUNT("id") AS "total" FROM "respostas" AS "Resposta" WHERE "Resposta"."ratingValue" IS NOT NULL AND "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' GROUP BY date_trunc('day', "createdAt") ORDER BY date_trunc('day', "createdAt") ASC;
Executing (default): SELECT "Resposta"."id", "Resposta"."perguntaId", "Resposta"."pesquisaId", "Resposta"."tenantId", "Resposta"."atendenteId", "Resposta"."respondentSessionId", "Resposta"."ratingValue", "Resposta"."textValue", "Resposta"."selectedOption", "Resposta"."createdAt", "Resposta"."updatedAt", "pergunta"."id" AS "pergunta.id", "pergunta"."type" AS "pergunta.type" FROM "respostas" AS "Resposta" INNER JOIN "perguntas" AS "pergunta" ON "Resposta"."perguntaId" = "pergunta"."id" WHERE "Resposta"."ratingValue" IS NOT NULL AND "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "Criterio"."id", "Criterio"."name", SUM(CASE WHEN "perguntas->respostas"."ratingValue" >= 9 THEN 1 ELSE 0 END) AS "promoters", SUM(CASE WHEN "perguntas->respostas"."ratingValue" <= 6 THEN 1 ELSE 0 END) AS "detractors", COUNT("perguntas->respostas"."id") AS "total" FROM "criterios" AS "Criterio" INNER JOIN "perguntas" AS "perguntas" ON "Criterio"."id" = "perguntas"."criterioId" AND "perguntas"."type" LIKE 'rating%' INNER JOIN "respostas" AS "perguntas->respostas" ON "perguntas"."id" = "perguntas->respostas"."perguntaId" AND "perguntas->respostas"."ratingValue" IS NOT NULL AND "perguntas->respostas"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' GROUP BY "Criterio"."id", "Criterio"."name";
Executing (default): SELECT "Resposta"."id", "Resposta"."createdAt", "Resposta"."textValue", "Resposta"."ratingValue", "Resposta"."respondentSessionId", "client"."id" AS "client.id", "client"."name" AS "client.name" FROM "respostas" AS "Resposta" LEFT OUTER JOIN "clients" AS "client" ON "Resposta"."respondentSessionId" = "client"."respondentSessionId" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."textValue" != '' ORDER BY "Resposta"."createdAt" DESC LIMIT 7;
Executing (default): SELECT "Atendente"."id", "Atendente"."tenantId", "Atendente"."name", "Atendente"."code", "Atendente"."status", "Atendente"."createdAt", "Atendente"."updatedAt", "meta"."id" AS "meta.id", "meta"."atendenteId" AS "meta.atendenteId", "meta"."tenantId" AS "meta.tenantId", "meta"."npsGoal" AS "meta.npsGoal", "meta"."responsesGoal" AS "meta.responsesGoal", "meta"."registrationsGoal" AS "meta.registrationsGoal", "meta"."createdAt" AS "meta.createdAt", "meta"."updatedAt" AS "meta.updatedAt" FROM "atendentes" AS "Atendente" LEFT OUTER JOIN "atendente_metas" AS "meta" ON "Atendente"."id" = "meta"."atendenteId" WHERE "Atendente"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Atendente"."status" = 'active';
Executing (default): SELECT "textValue" FROM "respostas" AS "Resposta" WHERE "Resposta"."textValue" != '' AND "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT EXTRACT(DOW FROM "Resposta"."createdAt") AS "dayOfWeek", SUM(CASE WHEN "ratingValue" >= 9 THEN 1 ELSE 0 END) AS "promoters", SUM(CASE WHEN "ratingValue" <= 6 THEN 1 ELSE 0 END) AS "detractors", COUNT("id") AS "total" FROM "respostas" AS "Resposta" WHERE "Resposta"."ratingValue" IS NOT NULL AND "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' GROUP BY EXTRACT(DOW FROM "Resposta"."createdAt") ORDER BY EXTRACT(DOW FROM "Resposta"."createdAt") ASC;
Executing (default): SELECT date_trunc('day', "createdAt") AS "period", COUNT(DISTINCT("respondentSessionId")) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."respondentSessionId" IS NOT NULL GROUP BY date_trunc('day', "createdAt") ORDER BY date_trunc('day', "createdAt") ASC;
Executing (default): SELECT "gender", "birthDate" FROM "clients" AS "Client" WHERE "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT count(DISTINCT("respondentSessionId")) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."ratingValue" >= 9 AND "Resposta"."respondentSessionId" IS NOT NULL;
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = 'f60c5a4d-1c9a-474c-89db-2abd95e8e06f';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Cupom"."status" = 'used';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = '49c162d2-fdde-448c-86f8-14b9c93be792';
Executing (default): SELECT count(*) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = 'b13aa606-ae37-4d5b-8405-9610cbdffc25';
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = 'ead2104c-7963-47ff-8336-852ad10d355f';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = '78b6809d-1ef3-4950-920c-ca4adfdbf114';
Executing (default): SELECT count(*) AS "count" FROM "cupons" AS "Cupom" WHERE "Cupom"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Cupom"."status" = 'used' AND ("Cupom"."updatedAt" >= '2025-11-01 03:00:00.000 +00:00' AND "Cupom"."updatedAt" <= '2025-12-01 02:59:59.999 +00:00');
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = '1c1b649b-a287-4430-84ba-3648a81a5001';
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = '2a4fd6a3-c581-401d-ba65-9225b56cd850';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = '8b5efb23-f875-4ada-a3ae-e83e1f70e8cb';
Executing (default): SELECT "id", "perguntaId", "pesquisaId", "tenantId", "atendenteId", "respondentSessionId", "ratingValue", "textValue", "selectedOption", "createdAt", "updatedAt" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."atendenteId" = '2dbadb84-aafa-4c99-a50d-9b01d56ca921';
[Auth Middleware] Request: GET /api/surveys/stats
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
Executing (default): SELECT "id", "name", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'surveys' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT count(*) AS "count" FROM "pesquisas" AS "Pesquisa" WHERE "Pesquisa"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Pesquisa"."status" = 'active';
Executing (default): SELECT count(DISTINCT("respondentSessionId")) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Resposta"."createdAt" >= '2025-11-01 00:00:00.000 +00:00';
Executing (default): SELECT count(*) AS "count" FROM "clients" AS "Client" WHERE "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT count(*) AS "count" FROM "pesquisas" AS "Pesquisa" WHERE "Pesquisa"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Pesquisa"."status" = 'pending';
[Auth Middleware] Request: GET /api/surveys/list?status=all
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
Executing (default): SELECT "id", "name", "description", "isSystemRole", "createdAt", "updatedAt" FROM "roles" AS "Role" WHERE "Role"."name" = 'Admin';
Executing (default): SELECT "RolePermissao"."roleId", "RolePermissao"."permissaoId", "RolePermissao"."createdAt", "RolePermissao"."updatedAt", "permissao"."id" AS "permissao.id", "permissao"."module" AS "permissao.module", "permissao"."action" AS "permissao.action", "permissao"."description" AS "permissao.description", "permissao"."createdAt" AS "permissao.createdAt", "permissao"."updatedAt" AS "permissao.updatedAt" FROM "role_permissoes" AS "RolePermissao" INNER JOIN "permissoes" AS "permissao" ON "RolePermissao"."permissaoId" = "permissao"."id" AND "permissao"."module" = 'surveys' AND "permissao"."action" = 'read' WHERE "RolePermissao"."roleId" = 'ce609d07-d83f-4002-a892-e17c91b767d3';
Executing (default): SELECT "Pesquisa"."id", "Pesquisa"."title", "Pesquisa"."description", "Pesquisa"."createdAt", "Pesquisa"."dueDate", "Pesquisa"."status", "Pesquisa"."isOpen", "Pesquisa"."expectedRespondents", "Pesquisa"."askForAttendant", "Pesquisa"."tenantId", "perguntas"."id" AS "perguntas.id", "perguntas"."text" AS "perguntas.text", "perguntas"."type" AS "perguntas.type", "perguntas"."options" AS "perguntas.options", "perguntas"."order" AS "perguntas.order" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" WHERE "Pesquisa"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' ORDER BY "Pesquisa"."createdAt" DESC;
Executing (default): SELECT "pesquisaId", COUNT(DISTINCT("respondentSessionId")) AS "count" FROM "respostas" AS "Resposta" WHERE "Resposta"."pesquisaId" IN ('53d96820-1ea1-4c5b-b033-78ed0aa3e4d0', '87d63f62-4bb9-43e5-ab76-9eb004d4d2bb') GROUP BY "pesquisaId";
Executing (default): SELECT "Pesquisa"."id", "Pesquisa"."title", "Pesquisa"."description", "Pesquisa"."createdAt", "Pesquisa"."updatedAt", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."status", "Pesquisa"."recompensaId", "Pesquisa"."roletaId", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."text" AS "perguntas.text", "perguntas"."options" AS "perguntas.options", "perguntas"."order" AS "perguntas.order", "perguntas"."required" AS "perguntas.required", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."description" AS "tenant.description", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "roleta"."id" AS "roleta.id", "roleta"."nome" AS "roleta.nome", "roleta"."descricao" AS "roleta.descricao", "roleta"."active" AS "roleta.active" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" LEFT OUTER JOIN "tenants" AS "tenant" ON "Pesquisa"."tenantId" = "tenant"."id" LEFT OUTER JOIN "roletas" AS "roleta" ON "Pesquisa"."roletaId" = "roleta"."id" WHERE "Pesquisa"."id" = '87d63f62-4bb9-43e5-ab76-9eb004d4d2bb';
[Auth Middleware] Request: POST /api/auth/verify-token
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
Executing (default): SELECT "id", "name" FROM "atendentes" AS "Atendente" WHERE "Atendente"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Atendente"."status" = 'active' ORDER BY "Atendente"."name" ASC;
Executing (default): SELECT "askForAttendant" FROM "pesquisas" AS "Pesquisa" WHERE "Pesquisa"."id" = '87d63f62-4bb9-43e5-ab76-9eb004d4d2bb';
Executing (f5e2ca9a-abef-4914-aacd-00f1e7862ea1): SELECT "Pesquisa"."id", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."title", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."options" AS "perguntas.options", "perguntas"."required" AS "perguntas.required", "perguntas"."text" AS "perguntas.text" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" WHERE "Pesquisa"."id" = '87d63f62-4bb9-43e5-ab76-9eb004d4d2bb';
Executing (f5e2ca9a-abef-4914-aacd-00f1e7862ea1): INSERT INTO "respostas" ("id","perguntaId","pesquisaId","tenantId","atendenteId","respondentSessionId","ratingValue","textValue","createdAt","updatedAt") VALUES ('f17dfa99-c9bc-4b04-8508-3a8f310212dc','cc2c724c-3580-4f94-ab87-5822e4497770','87d63f62-4bb9-43e5-ab76-9eb004d4d2bb','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd','b13aa606-ae37-4d5b-8405-9610cbdffc25','a23646ec-228b-435d-a2dd-e307c94f6d02',5,NULL,'2025-11-23 12:09:10.381 +00:00','2025-11-23 12:09:10.381 +00:00'),('91572488-3b87-41ea-a72a-9ea377667c67','2ffb181f-141b-472d-9abd-3c51595c7f29','87d63f62-4bb9-43e5-ab76-9eb004d4d2bb','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd','b13aa606-ae37-4d5b-8405-9610cbdffc25','a23646ec-228b-435d-a2dd-e307c94f6d02',5,NULL,'2025-11-23 12:09:10.381 +00:00','2025-11-23 12:09:10.381 +00:00'),('07d8fc8e-f623-4765-9bb7-a83ea8333dd2','5f7acf91-90d6-44cd-963f-6f81effd5e1a','87d63f62-4bb9-43e5-ab76-9eb004d4d2bb','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd','b13aa606-ae37-4d5b-8405-9610cbdffc25','a23646ec-228b-435d-a2dd-e307c94f6d02',5,NULL,'2025-11-23 12:09:10.381 +00:00','2025-11-23 12:09:10.381 +00:00'),('047067d5-0a12-426a-b02e-d6e8e3980ed4','d5938446-234d-40c3-967c-050cb336aa06','87d63f62-4bb9-43e5-ab76-9eb004d4d2bb','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd','b13aa606-ae37-4d5b-8405-9610cbdffc25','a23646ec-228b-435d-a2dd-e307c94f6d02',10,NULL,'2025-11-23 12:09:10.381 +00:00','2025-11-23 12:09:10.381 +00:00') RETURNING "id","perguntaId","pesquisaId","tenantId","atendenteId","respondentSessionId","ratingValue","textValue","selectedOption","createdAt","updatedAt";
Executing (default): SELECT "gmb_link" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "gmb_link", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "Pesquisa"."id", "Pesquisa"."title", "Pesquisa"."description", "Pesquisa"."createdAt", "Pesquisa"."updatedAt", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."status", "Pesquisa"."recompensaId", "Pesquisa"."roletaId", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."text" AS "perguntas.text", "perguntas"."options" AS "perguntas.options", "perguntas"."order" AS "perguntas.order", "perguntas"."required" AS "perguntas.required", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."description" AS "tenant.description", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "roleta"."id" AS "roleta.id", "roleta"."nome" AS "roleta.nome", "roleta"."descricao" AS "roleta.descricao", "roleta"."active" AS "roleta.active" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" LEFT OUTER JOIN "tenants" AS "tenant" ON "Pesquisa"."tenantId" = "tenant"."id" LEFT OUTER JOIN "roletas" AS "roleta" ON "Pesquisa"."roletaId" = "roleta"."id" WHERE "Pesquisa"."id" = '87d63f62-4bb9-43e5-ab76-9eb004d4d2bb';
Executing (default): SELECT "id", "tenantId", "name", "email", "phone", "birthDate", "respondentSessionId", "gender", "createdAt", "updatedAt" FROM "clients" AS "Client" WHERE "Client"."phone" = '(35) 99130-4603' AND "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' LIMIT 1;
Executing (4c582f07-3d8e-4e37-9e87-a8af629393e1): SELECT "Pesquisa"."id", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."title", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."options" AS "perguntas.options", "perguntas"."required" AS "perguntas.required", "perguntas"."text" AS "perguntas.text" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" WHERE "Pesquisa"."id" = '87d63f62-4bb9-43e5-ab76-9eb004d4d2bb';
Executing (4c582f07-3d8e-4e37-9e87-a8af629393e1): INSERT INTO "respostas" ("id","perguntaId","pesquisaId","tenantId","atendenteId","respondentSessionId","ratingValue","textValue","createdAt","updatedAt") VALUES ('891ac39e-4720-4ef6-8f4a-2b1cff21f49c','cc2c724c-3580-4f94-ab87-5822e4497770','87d63f62-4bb9-43e5-ab76-9eb004d4d2bb','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd','b13aa606-ae37-4d5b-8405-9610cbdffc25','1bb3de81-8c8e-40c7-9179-b06e9c3a04af',5,NULL,'2025-11-23 12:09:14.174 +00:00','2025-11-23 12:09:14.174 +00:00'),('0e221565-ba9c-4847-90d1-098575c79ea7','2ffb181f-141b-472d-9abd-3c51595c7f29','87d63f62-4bb9-43e5-ab76-9eb004d4d2bb','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd','b13aa606-ae37-4d5b-8405-9610cbdffc25','1bb3de81-8c8e-40c7-9179-b06e9c3a04af',5,NULL,'2025-11-23 12:09:14.174 +00:00','2025-11-23 12:09:14.174 +00:00'),('b42f006a-9032-4e53-8fc0-6955e77d421a','5f7acf91-90d6-44cd-963f-6f81effd5e1a','87d63f62-4bb9-43e5-ab76-9eb004d4d2bb','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd','b13aa606-ae37-4d5b-8405-9610cbdffc25','1bb3de81-8c8e-40c7-9179-b06e9c3a04af',5,NULL,'2025-11-23 12:09:14.174 +00:00','2025-11-23 12:09:14.174 +00:00'),('45479f6f-2b1c-4a38-9f70-7b7fb74ed6b6','d5938446-234d-40c3-967c-050cb336aa06','87d63f62-4bb9-43e5-ab76-9eb004d4d2bb','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd','b13aa606-ae37-4d5b-8405-9610cbdffc25','1bb3de81-8c8e-40c7-9179-b06e9c3a04af',10,NULL,'2025-11-23 12:09:14.174 +00:00','2025-11-23 12:09:14.174 +00:00') RETURNING "id","perguntaId","pesquisaId","tenantId","atendenteId","respondentSessionId","ratingValue","textValue","selectedOption","createdAt","updatedAt";
Executing (default): SELECT "gmb_link" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "gmb_link", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "name", "logoUrl", "primaryColor", "secondaryColor", "description" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "Pesquisa"."id", "Pesquisa"."title", "Pesquisa"."description", "Pesquisa"."createdAt", "Pesquisa"."updatedAt", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."status", "Pesquisa"."recompensaId", "Pesquisa"."roletaId", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."text" AS "perguntas.text", "perguntas"."options" AS "perguntas.options", "perguntas"."order" AS "perguntas.order", "perguntas"."required" AS "perguntas.required", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."description" AS "tenant.description", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "roleta"."id" AS "roleta.id", "roleta"."nome" AS "roleta.nome", "roleta"."descricao" AS "roleta.descricao", "roleta"."active" AS "roleta.active" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" LEFT OUTER JOIN "tenants" AS "tenant" ON "Pesquisa"."tenantId" = "tenant"."id" LEFT OUTER JOIN "roletas" AS "roleta" ON "Pesquisa"."roletaId" = "roleta"."id" WHERE "Pesquisa"."id" = '87d63f62-4bb9-43e5-ab76-9eb004d4d2bb';
Executing (default): SELECT "id", "tenantId", "creatorId", "title", "description", "startDate", "endDate", "isOpen", "askForAttendant", "status", "expectedRespondents", "dueDate", "recompensaId", "roletaId", "createdAt", "updatedAt" FROM "pesquisas" AS "Pesquisa" WHERE "Pesquisa"."id" = '87d63f62-4bb9-43e5-ab76-9eb004d4d2bb';
Executing (default): SELECT "id", "pesquisaId", "tenantId", "recompensaId", "codigo", "clienteId", "dataGeracao", "dataUtilizacao", "dataValidade", "status", "ultimoContato", "createdAt", "updatedAt", "campanhaId" FROM "cupons" AS "Cupom" WHERE "Cupom"."clienteId" = '08ceabba-dd1d-44d4-ae37-b904443de7b9' AND "Cupom"."pesquisaId" = '87d63f62-4bb9-43e5-ab76-9eb004d4d2bb' ORDER BY "Cupom"."dataGeracao" DESC LIMIT 1;
Executing (default): SELECT "RoletaPremio"."id", "RoletaPremio"."tenantId", "RoletaPremio"."nome", "RoletaPremio"."descricao", "RoletaPremio"."porcentagem", "RoletaPremio"."cor", "RoletaPremio"."recompensaId", "RoletaPremio"."roletaId", "RoletaPremio"."imageUrl", "RoletaPremio"."active", "RoletaPremio"."createdAt", "RoletaPremio"."updatedAt", "recompensa"."id" AS "recompensa.id", "recompensa"."tenantId" AS "recompensa.tenantId", "recompensa"."name" AS "recompensa.name", "recompensa"."description" AS "recompensa.description", "recompensa"."pointsRequired" AS "recompensa.pointsRequired", "recompensa"."type" AS "recompensa.type", "recompensa"."value" AS "recompensa.value", "recompensa"."imageUrl" AS "recompensa.imageUrl", "recompensa"."active" AS "recompensa.active", "recompensa"."createdAt" AS "recompensa.createdAt", "recompensa"."updatedAt" AS "recompensa.updatedAt" FROM "roleta_premios" AS "RoletaPremio" LEFT OUTER JOIN "recompensas" AS "recompensa" ON "RoletaPremio"."recompensaId" = "recompensa"."id" WHERE "RoletaPremio"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "RoletaPremio"."roletaId" = 'f40e45de-fb16-477d-b385-85eb9d38304c' ORDER BY "RoletaPremio"."nome" ASC;
Executing (default): SELECT "Pesquisa"."id", "Pesquisa"."title", "Pesquisa"."description", "Pesquisa"."createdAt", "Pesquisa"."updatedAt", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."status", "Pesquisa"."recompensaId", "Pesquisa"."roletaId", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."text" AS "perguntas.text", "perguntas"."options" AS "perguntas.options", "perguntas"."order" AS "perguntas.order", "perguntas"."required" AS "perguntas.required", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."description" AS "tenant.description", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "roleta"."id" AS "roleta.id", "roleta"."nome" AS "roleta.nome", "roleta"."descricao" AS "roleta.descricao", "roleta"."active" AS "roleta.active" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" LEFT OUTER JOIN "tenants" AS "tenant" ON "Pesquisa"."tenantId" = "tenant"."id" LEFT OUTER JOIN "roletas" AS "roleta" ON "Pesquisa"."roletaId" = "roleta"."id" WHERE "Pesquisa"."id" = '87d63f62-4bb9-43e5-ab76-9eb004d4d2bb';
[Auth Middleware] Request: POST /api/auth/verify-token
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
Executing (default): SELECT "id", "name" FROM "atendentes" AS "Atendente" WHERE "Atendente"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Atendente"."status" = 'active' ORDER BY "Atendente"."name" ASC;
Executing (default): SELECT "askForAttendant" FROM "pesquisas" AS "Pesquisa" WHERE "Pesquisa"."id" = '87d63f62-4bb9-43e5-ab76-9eb004d4d2bb';
Executing (57a1a1ce-348b-43b4-aff0-b563d2bfcb8c): SELECT "Pesquisa"."id", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."title", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."options" AS "perguntas.options", "perguntas"."required" AS "perguntas.required", "perguntas"."text" AS "perguntas.text" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" WHERE "Pesquisa"."id" = '87d63f62-4bb9-43e5-ab76-9eb004d4d2bb';
Executing (57a1a1ce-348b-43b4-aff0-b563d2bfcb8c): INSERT INTO "respostas" ("id","perguntaId","pesquisaId","tenantId","atendenteId","respondentSessionId","ratingValue","textValue","createdAt","updatedAt") VALUES ('810d7bfe-9ca5-4a69-8966-2cc144f78506','cc2c724c-3580-4f94-ab87-5822e4497770','87d63f62-4bb9-43e5-ab76-9eb004d4d2bb','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd','ead2104c-7963-47ff-8336-852ad10d355f','ef37f145-0788-4df9-a338-418f86774751',5,NULL,'2025-11-23 12:09:33.314 +00:00','2025-11-23 12:09:33.314 +00:00'),('f1d7ff04-28e0-454c-88fe-e7653ef7e4ac','2ffb181f-141b-472d-9abd-3c51595c7f29','87d63f62-4bb9-43e5-ab76-9eb004d4d2bb','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd','ead2104c-7963-47ff-8336-852ad10d355f','ef37f145-0788-4df9-a338-418f86774751',5,NULL,'2025-11-23 12:09:33.314 +00:00','2025-11-23 12:09:33.314 +00:00'),('bdfd9d81-525e-4ebf-a2e5-2b898a10080f','5f7acf91-90d6-44cd-963f-6f81effd5e1a','87d63f62-4bb9-43e5-ab76-9eb004d4d2bb','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd','ead2104c-7963-47ff-8336-852ad10d355f','ef37f145-0788-4df9-a338-418f86774751',5,NULL,'2025-11-23 12:09:33.314 +00:00','2025-11-23 12:09:33.314 +00:00'),('519d7851-796f-44db-bea3-dfce524a2749','d5938446-234d-40c3-967c-050cb336aa06','87d63f62-4bb9-43e5-ab76-9eb004d4d2bb','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd','ead2104c-7963-47ff-8336-852ad10d355f','ef37f145-0788-4df9-a338-418f86774751',10,NULL,'2025-11-23 12:09:33.314 +00:00','2025-11-23 12:09:33.314 +00:00') RETURNING "id","perguntaId","pesquisaId","tenantId","atendenteId","respondentSessionId","ratingValue","textValue","selectedOption","createdAt","updatedAt";
Executing (default): SELECT "gmb_link" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "gmb_link", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "name", "logoUrl", "primaryColor", "secondaryColor", "description" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "name", "logoUrl", "primaryColor", "secondaryColor", "description" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "Pesquisa"."id", "Pesquisa"."title", "Pesquisa"."description", "Pesquisa"."createdAt", "Pesquisa"."updatedAt", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."status", "Pesquisa"."recompensaId", "Pesquisa"."roletaId", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."text" AS "perguntas.text", "perguntas"."options" AS "perguntas.options", "perguntas"."order" AS "perguntas.order", "perguntas"."required" AS "perguntas.required", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."description" AS "tenant.description", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "roleta"."id" AS "roleta.id", "roleta"."nome" AS "roleta.nome", "roleta"."descricao" AS "roleta.descricao", "roleta"."active" AS "roleta.active" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" LEFT OUTER JOIN "tenants" AS "tenant" ON "Pesquisa"."tenantId" = "tenant"."id" LEFT OUTER JOIN "roletas" AS "roleta" ON "Pesquisa"."roletaId" = "roleta"."id" WHERE "Pesquisa"."id" = '87d63f62-4bb9-43e5-ab76-9eb004d4d2bb';
Executing (default): SELECT "id", "tenantId", "name", "email", "phone", "birthDate", "respondentSessionId", "gender", "createdAt", "updatedAt" FROM "clients" AS "Client" WHERE "Client"."phone" = '(35) 99837-4007' AND "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' LIMIT 1;
Executing (c927f43c-b09e-47c4-9b0a-56db1d7f5b7a): SELECT "Pesquisa"."id", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."title", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."options" AS "perguntas.options", "perguntas"."required" AS "perguntas.required", "perguntas"."text" AS "perguntas.text" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" WHERE "Pesquisa"."id" = '87d63f62-4bb9-43e5-ab76-9eb004d4d2bb';
Executing (c927f43c-b09e-47c4-9b0a-56db1d7f5b7a): INSERT INTO "respostas" ("id","perguntaId","pesquisaId","tenantId","atendenteId","respondentSessionId","ratingValue","textValue","createdAt","updatedAt") VALUES ('6d04465d-afa2-42fa-a4a0-a13d8d7b7f0e','cc2c724c-3580-4f94-ab87-5822e4497770','87d63f62-4bb9-43e5-ab76-9eb004d4d2bb','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd','ead2104c-7963-47ff-8336-852ad10d355f','9005bad3-9300-4d54-813e-b2eec48198d2',5,NULL,'2025-11-23 12:09:46.258 +00:00','2025-11-23 12:09:46.258 +00:00'),('c97aba9e-62e5-4707-bbae-c8a905e345e9','2ffb181f-141b-472d-9abd-3c51595c7f29','87d63f62-4bb9-43e5-ab76-9eb004d4d2bb','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd','ead2104c-7963-47ff-8336-852ad10d355f','9005bad3-9300-4d54-813e-b2eec48198d2',5,NULL,'2025-11-23 12:09:46.258 +00:00','2025-11-23 12:09:46.258 +00:00'),('659876c8-e619-46e8-addf-0fd3881894af','5f7acf91-90d6-44cd-963f-6f81effd5e1a','87d63f62-4bb9-43e5-ab76-9eb004d4d2bb','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd','ead2104c-7963-47ff-8336-852ad10d355f','9005bad3-9300-4d54-813e-b2eec48198d2',5,NULL,'2025-11-23 12:09:46.258 +00:00','2025-11-23 12:09:46.258 +00:00'),('e58ed3b0-e8fd-4073-bcb3-6794a47acdc8','d5938446-234d-40c3-967c-050cb336aa06','87d63f62-4bb9-43e5-ab76-9eb004d4d2bb','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd','ead2104c-7963-47ff-8336-852ad10d355f','9005bad3-9300-4d54-813e-b2eec48198d2',10,NULL,'2025-11-23 12:09:46.258 +00:00','2025-11-23 12:09:46.258 +00:00') RETURNING "id","perguntaId","pesquisaId","tenantId","atendenteId","respondentSessionId","ratingValue","textValue","selectedOption","createdAt","updatedAt";
Executing (default): SELECT "gmb_link" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "gmb_link", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "Pesquisa"."id", "Pesquisa"."title", "Pesquisa"."description", "Pesquisa"."createdAt", "Pesquisa"."updatedAt", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."status", "Pesquisa"."recompensaId", "Pesquisa"."roletaId", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."text" AS "perguntas.text", "perguntas"."options" AS "perguntas.options", "perguntas"."order" AS "perguntas.order", "perguntas"."required" AS "perguntas.required", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."description" AS "tenant.description", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "roleta"."id" AS "roleta.id", "roleta"."nome" AS "roleta.nome", "roleta"."descricao" AS "roleta.descricao", "roleta"."active" AS "roleta.active" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" LEFT OUTER JOIN "tenants" AS "tenant" ON "Pesquisa"."tenantId" = "tenant"."id" LEFT OUTER JOIN "roletas" AS "roleta" ON "Pesquisa"."roletaId" = "roleta"."id" WHERE "Pesquisa"."id" = '87d63f62-4bb9-43e5-ab76-9eb004d4d2bb';
Executing (default): SELECT "id", "name", "logoUrl", "primaryColor", "secondaryColor", "description" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "tenantId", "creatorId", "title", "description", "startDate", "endDate", "isOpen", "askForAttendant", "status", "expectedRespondents", "dueDate", "recompensaId", "roletaId", "createdAt", "updatedAt" FROM "pesquisas" AS "Pesquisa" WHERE "Pesquisa"."id" = '87d63f62-4bb9-43e5-ab76-9eb004d4d2bb';
Executing (default): SELECT "id", "pesquisaId", "tenantId", "recompensaId", "codigo", "clienteId", "dataGeracao", "dataUtilizacao", "dataValidade", "status", "ultimoContato", "createdAt", "updatedAt", "campanhaId" FROM "cupons" AS "Cupom" WHERE "Cupom"."clienteId" = '7809ef0d-14c0-47dd-bee2-09ebcc7c2150' AND "Cupom"."pesquisaId" = '87d63f62-4bb9-43e5-ab76-9eb004d4d2bb' ORDER BY "Cupom"."dataGeracao" DESC LIMIT 1;
Executing (default): SELECT "RoletaPremio"."id", "RoletaPremio"."tenantId", "RoletaPremio"."nome", "RoletaPremio"."descricao", "RoletaPremio"."porcentagem", "RoletaPremio"."cor", "RoletaPremio"."recompensaId", "RoletaPremio"."roletaId", "RoletaPremio"."imageUrl", "RoletaPremio"."active", "RoletaPremio"."createdAt", "RoletaPremio"."updatedAt", "recompensa"."id" AS "recompensa.id", "recompensa"."tenantId" AS "recompensa.tenantId", "recompensa"."name" AS "recompensa.name", "recompensa"."description" AS "recompensa.description", "recompensa"."pointsRequired" AS "recompensa.pointsRequired", "recompensa"."type" AS "recompensa.type", "recompensa"."value" AS "recompensa.value", "recompensa"."imageUrl" AS "recompensa.imageUrl", "recompensa"."active" AS "recompensa.active", "recompensa"."createdAt" AS "recompensa.createdAt", "recompensa"."updatedAt" AS "recompensa.updatedAt" FROM "roleta_premios" AS "RoletaPremio" LEFT OUTER JOIN "recompensas" AS "recompensa" ON "RoletaPremio"."recompensaId" = "recompensa"."id" WHERE "RoletaPremio"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "RoletaPremio"."roletaId" = 'f40e45de-fb16-477d-b385-85eb9d38304c' ORDER BY "RoletaPremio"."nome" ASC;
Executing (default): SELECT "Pesquisa"."id", "Pesquisa"."title", "Pesquisa"."description", "Pesquisa"."createdAt", "Pesquisa"."updatedAt", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."status", "Pesquisa"."recompensaId", "Pesquisa"."roletaId", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."text" AS "perguntas.text", "perguntas"."options" AS "perguntas.options", "perguntas"."order" AS "perguntas.order", "perguntas"."required" AS "perguntas.required", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."description" AS "tenant.description", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "roleta"."id" AS "roleta.id", "roleta"."nome" AS "roleta.nome", "roleta"."descricao" AS "roleta.descricao", "roleta"."active" AS "roleta.active" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" LEFT OUTER JOIN "tenants" AS "tenant" ON "Pesquisa"."tenantId" = "tenant"."id" LEFT OUTER JOIN "roletas" AS "roleta" ON "Pesquisa"."roletaId" = "roleta"."id" WHERE "Pesquisa"."id" = '87d63f62-4bb9-43e5-ab76-9eb004d4d2bb';
[Auth Middleware] Request: POST /api/auth/verify-token
Executing (default): SELECT "Usuario"."id", "Usuario"."tenantId", "Usuario"."roleId", "Usuario"."name", "Usuario"."email", "Usuario"."passwordHash", "Usuario"."profilePictureUrl", "Usuario"."createdAt", "Usuario"."updatedAt", "role"."id" AS "role.id", "role"."name" AS "role.name", "role"."description" AS "role.description", "role"."isSystemRole" AS "role.isSystemRole", "role"."createdAt" AS "role.createdAt", "role"."updatedAt" AS "role.updatedAt", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."address" AS "tenant.address", "tenant"."phone" AS "tenant.phone", "tenant"."email" AS "tenant.email", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "tenant"."description" AS "tenant.description", "tenant"."website" AS "tenant.website", "tenant"."cnpj" AS "tenant.cnpj", "tenant"."inscricaoEstadual" AS "tenant.inscricaoEstadual", "tenant"."reportPhoneNumber" AS "tenant.reportPhoneNumber", "tenant"."gmb_link" AS "tenant.gmb_link", "tenant"."createdAt" AS "tenant.createdAt", "tenant"."updatedAt" AS "tenant.updatedAt" FROM "usuarios" AS "Usuario" LEFT OUTER JOIN "roles" AS "role" ON "Usuario"."roleId" = "role"."id" LEFT OUTER JOIN "tenants" AS "tenant" ON "Usuario"."tenantId" = "tenant"."id" WHERE "Usuario"."id" = 'bfe6c6f3-bc13-44b7-a796-d7b3ce2353e5';
Executing (default): SELECT "id", "name" FROM "atendentes" AS "Atendente" WHERE "Atendente"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "Atendente"."status" = 'active' ORDER BY "Atendente"."name" ASC;
[SENDER_MONITOR] Iniciando verificação de status dos disparadores...
Executing (default): SELECT "id", "name", "apiUrl", "apiKey", "instanceName", "status", "priority", "dailyLimit", "messagesSentToday", "lastUsedAt", "warmingUpDay", "createdAt", "updatedAt" FROM "WhatsappSenders" AS "WhatsappSender" WHERE "WhatsappSender"."status" IN ('disconnected', 'blocked', 'resting');
[CAMPAIGN_MONITOR] Iniciando verificação de campanhas pausadas...
Executing (default): SELECT "id", "tenantId", "nome", "mensagens", "rewardType", "recompensaId", "roletaId", "dataValidade", "criterioSelecao", "status", "startDate", "endDate", "minMessageDelaySeconds", "maxMessageDelaySeconds", "mediaUrl", "createdAt", "updatedAt" FROM "campanhas" AS "Campanha" WHERE "Campanha"."status" = 'paused';
[SENDER_MONITOR] Nenhum disparador inativo encontrado.
[CAMPAIGN_MONITOR] Nenhuma campanha pausada encontrada.
Executing (default): SELECT "askForAttendant" FROM "pesquisas" AS "Pesquisa" WHERE "Pesquisa"."id" = '87d63f62-4bb9-43e5-ab76-9eb004d4d2bb';
Executing (80abb457-4414-40c5-9b73-996b96ec7278): SELECT "Pesquisa"."id", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."title", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."options" AS "perguntas.options", "perguntas"."required" AS "perguntas.required", "perguntas"."text" AS "perguntas.text" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" WHERE "Pesquisa"."id" = '87d63f62-4bb9-43e5-ab76-9eb004d4d2bb';
Executing (80abb457-4414-40c5-9b73-996b96ec7278): INSERT INTO "respostas" ("id","perguntaId","pesquisaId","tenantId","atendenteId","respondentSessionId","ratingValue","textValue","createdAt","updatedAt") VALUES ('84039cf0-c7cf-4cd7-bebe-60a8400d1bd5','cc2c724c-3580-4f94-ab87-5822e4497770','87d63f62-4bb9-43e5-ab76-9eb004d4d2bb','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd','ead2104c-7963-47ff-8336-852ad10d355f','d4d31e47-6686-4e01-b179-39cf85cb7ce2',5,NULL,'2025-11-23 12:10:02.123 +00:00','2025-11-23 12:10:02.123 +00:00'),('0e9a3f75-60c8-4f72-8ef6-0e5cdf759440','2ffb181f-141b-472d-9abd-3c51595c7f29','87d63f62-4bb9-43e5-ab76-9eb004d4d2bb','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd','ead2104c-7963-47ff-8336-852ad10d355f','d4d31e47-6686-4e01-b179-39cf85cb7ce2',5,NULL,'2025-11-23 12:10:02.123 +00:00','2025-11-23 12:10:02.123 +00:00'),('d3d2213b-7e9b-4c79-bb10-5ddda9db7e39','5f7acf91-90d6-44cd-963f-6f81effd5e1a','87d63f62-4bb9-43e5-ab76-9eb004d4d2bb','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd','ead2104c-7963-47ff-8336-852ad10d355f','d4d31e47-6686-4e01-b179-39cf85cb7ce2',5,NULL,'2025-11-23 12:10:02.123 +00:00','2025-11-23 12:10:02.123 +00:00'),('ba31feb9-b1f9-4649-82d2-2a2b81f3f1ce','d5938446-234d-40c3-967c-050cb336aa06','87d63f62-4bb9-43e5-ab76-9eb004d4d2bb','3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd','ead2104c-7963-47ff-8336-852ad10d355f','d4d31e47-6686-4e01-b179-39cf85cb7ce2',10,NULL,'2025-11-23 12:10:02.123 +00:00','2025-11-23 12:10:02.123 +00:00') RETURNING "id","perguntaId","pesquisaId","tenantId","atendenteId","respondentSessionId","ratingValue","textValue","selectedOption","createdAt","updatedAt";
Executing (default): SELECT "gmb_link" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "name", "address", "phone", "email", "logoUrl", "primaryColor", "secondaryColor", "description", "website", "cnpj", "inscricaoEstadual", "reportPhoneNumber", "gmb_link", "createdAt", "updatedAt" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "name", "logoUrl", "primaryColor", "secondaryColor", "description" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "name", "logoUrl", "primaryColor", "secondaryColor", "description" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "tenantId" FROM "respostas" AS "Resposta" WHERE "Resposta"."respondentSessionId" = 'd4d31e47-6686-4e01-b179-39cf85cb7ce2' LIMIT 1;
Executing (df85b3ab-4e5d-4edd-877c-69357ca68c8a): SELECT "id", "tenantId", "name", "email", "phone", "birthDate", "respondentSessionId", "gender", "createdAt", "updatedAt" FROM "clients" AS "Client" WHERE "Client"."email" = 'vobela@email.com' AND "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' LIMIT 1;
Executing (df85b3ab-4e5d-4edd-877c-69357ca68c8a): SELECT "id", "tenantId", "name", "email", "phone", "birthDate", "respondentSessionId", "gender", "createdAt", "updatedAt" FROM "clients" AS "Client" WHERE "Client"."phone" = '(35) 99165-7791' AND "Client"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' LIMIT 1;
Executing (df85b3ab-4e5d-4edd-877c-69357ca68c8a): SELECT "id", "tenantId", "name", "email", "phone", "birthDate", "respondentSessionId", "gender", "createdAt", "updatedAt" FROM "clients" AS "Client" WHERE "Client"."respondentSessionId" = 'd4d31e47-6686-4e01-b179-39cf85cb7ce2';
Executing (df85b3ab-4e5d-4edd-877c-69357ca68c8a): INSERT INTO "clients" ("id","tenantId","name","email","phone","birthDate","respondentSessionId","gender","createdAt","updatedAt") VALUES ($1,$2,$3,$4,$5,$6,$7,$8,$9,$10) RETURNING "id","tenantId","name","email","phone","birthDate","respondentSessionId","gender","createdAt","updatedAt";
Executing (df85b3ab-4e5d-4edd-877c-69357ca68c8a): SELECT "pesquisaId", "tenantId" FROM "respostas" AS "Resposta" WHERE "Resposta"."respondentSessionId" = 'd4d31e47-6686-4e01-b179-39cf85cb7ce2' LIMIT 1;
Executing (df85b3ab-4e5d-4edd-877c-69357ca68c8a): SELECT "recompensaId" FROM "pesquisas" AS "Pesquisa" WHERE "Pesquisa"."id" = '87d63f62-4bb9-43e5-ab76-9eb004d4d2bb';
Executing (default): SELECT "Pesquisa"."id", "Pesquisa"."title", "Pesquisa"."description", "Pesquisa"."createdAt", "Pesquisa"."updatedAt", "Pesquisa"."isOpen", "Pesquisa"."tenantId", "Pesquisa"."askForAttendant", "Pesquisa"."status", "Pesquisa"."recompensaId", "Pesquisa"."roletaId", "perguntas"."id" AS "perguntas.id", "perguntas"."type" AS "perguntas.type", "perguntas"."text" AS "perguntas.text", "perguntas"."options" AS "perguntas.options", "perguntas"."order" AS "perguntas.order", "perguntas"."required" AS "perguntas.required", "tenant"."id" AS "tenant.id", "tenant"."name" AS "tenant.name", "tenant"."logoUrl" AS "tenant.logoUrl", "tenant"."description" AS "tenant.description", "tenant"."primaryColor" AS "tenant.primaryColor", "tenant"."secondaryColor" AS "tenant.secondaryColor", "roleta"."id" AS "roleta.id", "roleta"."nome" AS "roleta.nome", "roleta"."descricao" AS "roleta.descricao", "roleta"."active" AS "roleta.active" FROM "pesquisas" AS "Pesquisa" LEFT OUTER JOIN "perguntas" AS "perguntas" ON "Pesquisa"."id" = "perguntas"."pesquisaId" LEFT OUTER JOIN "tenants" AS "tenant" ON "Pesquisa"."tenantId" = "tenant"."id" LEFT OUTER JOIN "roletas" AS "roleta" ON "Pesquisa"."roletaId" = "roleta"."id" WHERE "Pesquisa"."id" = '87d63f62-4bb9-43e5-ab76-9eb004d4d2bb';
Executing (default): SELECT "id", "name", "logoUrl", "primaryColor", "secondaryColor", "description" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "id", "tenantId", "creatorId", "title", "description", "startDate", "endDate", "isOpen", "askForAttendant", "status", "expectedRespondents", "dueDate", "recompensaId", "roletaId", "createdAt", "updatedAt" FROM "pesquisas" AS "Pesquisa" WHERE "Pesquisa"."id" = '87d63f62-4bb9-43e5-ab76-9eb004d4d2bb';
Executing (default): SELECT "id", "pesquisaId", "tenantId", "recompensaId", "codigo", "clienteId", "dataGeracao", "dataUtilizacao", "dataValidade", "status", "ultimoContato", "createdAt", "updatedAt", "campanhaId" FROM "cupons" AS "Cupom" WHERE "Cupom"."clienteId" = '4bf6faba-d64c-4812-afe2-0d7ee2066161' AND "Cupom"."pesquisaId" = '87d63f62-4bb9-43e5-ab76-9eb004d4d2bb' ORDER BY "Cupom"."dataGeracao" DESC LIMIT 1;
Executing (default): SELECT "RoletaPremio"."id", "RoletaPremio"."tenantId", "RoletaPremio"."nome", "RoletaPremio"."descricao", "RoletaPremio"."porcentagem", "RoletaPremio"."cor", "RoletaPremio"."recompensaId", "RoletaPremio"."roletaId", "RoletaPremio"."imageUrl", "RoletaPremio"."active", "RoletaPremio"."createdAt", "RoletaPremio"."updatedAt", "recompensa"."id" AS "recompensa.id", "recompensa"."tenantId" AS "recompensa.tenantId", "recompensa"."name" AS "recompensa.name", "recompensa"."description" AS "recompensa.description", "recompensa"."pointsRequired" AS "recompensa.pointsRequired", "recompensa"."type" AS "recompensa.type", "recompensa"."value" AS "recompensa.value", "recompensa"."imageUrl" AS "recompensa.imageUrl", "recompensa"."active" AS "recompensa.active", "recompensa"."createdAt" AS "recompensa.createdAt", "recompensa"."updatedAt" AS "recompensa.updatedAt" FROM "roleta_premios" AS "RoletaPremio" LEFT OUTER JOIN "recompensas" AS "recompensa" ON "RoletaPremio"."recompensaId" = "recompensa"."id" WHERE "RoletaPremio"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "RoletaPremio"."roletaId" = 'f40e45de-fb16-477d-b385-85eb9d38304c' ORDER BY "RoletaPremio"."nome" ASC;
Executing (default): SELECT "id", "tenantId", "creatorId", "title", "description", "startDate", "endDate", "isOpen", "askForAttendant", "status", "expectedRespondents", "dueDate", "recompensaId", "roletaId", "createdAt", "updatedAt" FROM "pesquisas" AS "Pesquisa" WHERE "Pesquisa"."id" = '87d63f62-4bb9-43e5-ab76-9eb004d4d2bb';
Executing (default): SELECT "id", "tenantId", "name", "email", "phone", "birthDate", "respondentSessionId", "gender", "createdAt", "updatedAt" FROM "clients" AS "Client" WHERE "Client"."id" = '4bf6faba-d64c-4812-afe2-0d7ee2066161';
Executing (default): SELECT "id", "pesquisaId", "tenantId", "recompensaId", "codigo", "clienteId", "dataGeracao", "dataUtilizacao", "dataValidade", "status", "ultimoContato", "createdAt", "updatedAt", "campanhaId" FROM "cupons" AS "Cupom" WHERE "Cupom"."clienteId" = '4bf6faba-d64c-4812-afe2-0d7ee2066161' AND "Cupom"."pesquisaId" = '87d63f62-4bb9-43e5-ab76-9eb004d4d2bb' ORDER BY "Cupom"."dataGeracao" DESC LIMIT 1;
Executing (default): SELECT "RoletaPremio"."id", "RoletaPremio"."tenantId", "RoletaPremio"."nome", "RoletaPremio"."descricao", "RoletaPremio"."porcentagem", "RoletaPremio"."cor", "RoletaPremio"."recompensaId", "RoletaPremio"."roletaId", "RoletaPremio"."imageUrl", "RoletaPremio"."active", "RoletaPremio"."createdAt", "RoletaPremio"."updatedAt", "recompensa"."id" AS "recompensa.id", "recompensa"."tenantId" AS "recompensa.tenantId", "recompensa"."name" AS "recompensa.name", "recompensa"."description" AS "recompensa.description", "recompensa"."pointsRequired" AS "recompensa.pointsRequired", "recompensa"."type" AS "recompensa.type", "recompensa"."value" AS "recompensa.value", "recompensa"."imageUrl" AS "recompensa.imageUrl", "recompensa"."active" AS "recompensa.active", "recompensa"."createdAt" AS "recompensa.createdAt", "recompensa"."updatedAt" AS "recompensa.updatedAt" FROM "roleta_premios" AS "RoletaPremio" LEFT OUTER JOIN "recompensas" AS "recompensa" ON "RoletaPremio"."recompensaId" = "recompensa"."id" WHERE "RoletaPremio"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' AND "RoletaPremio"."roletaId" = 'f40e45de-fb16-477d-b385-85eb9d38304c' ORDER BY "RoletaPremio"."nome" ASC;
Executing (default): INSERT INTO "cupons" ("id","pesquisaId","tenantId","recompensaId","codigo","clienteId","dataGeracao","dataValidade","status","createdAt","updatedAt") VALUES ($1,$2,$3,$4,$5,$6,$7,$8,$9,$10,$11) RETURNING "id","pesquisaId","tenantId","recompensaId","codigo","clienteId","dataGeracao","dataUtilizacao","dataValidade","status","ultimoContato","createdAt","updatedAt","campanhaId";
Executing (default): SELECT "Cupom"."id", "Cupom"."pesquisaId", "Cupom"."tenantId", "Cupom"."recompensaId", "Cupom"."codigo", "Cupom"."clienteId", "Cupom"."dataGeracao", "Cupom"."dataUtilizacao", "Cupom"."dataValidade", "Cupom"."status", "Cupom"."ultimoContato", "Cupom"."createdAt", "Cupom"."updatedAt", "Cupom"."campanhaId", "recompensa"."id" AS "recompensa.id", "recompensa"."tenantId" AS "recompensa.tenantId", "recompensa"."name" AS "recompensa.name", "recompensa"."description" AS "recompensa.description", "recompensa"."pointsRequired" AS "recompensa.pointsRequired", "recompensa"."type" AS "recompensa.type", "recompensa"."value" AS "recompensa.value", "recompensa"."imageUrl" AS "recompensa.imageUrl", "recompensa"."active" AS "recompensa.active", "recompensa"."createdAt" AS "recompensa.createdAt", "recompensa"."updatedAt" AS "recompensa.updatedAt", "client"."id" AS "client.id", "client"."tenantId" AS "client.tenantId", "client"."name" AS "client.name", "client"."email" AS "client.email", "client"."phone" AS "client.phone", "client"."birthDate" AS "client.birthDate", "client"."respondentSessionId" AS "client.respondentSessionId", "client"."gender" AS "client.gender", "client"."createdAt" AS "client.createdAt", "client"."updatedAt" AS "client.updatedAt" FROM "cupons" AS "Cupom" LEFT OUTER JOIN "recompensas" AS "recompensa" ON "Cupom"."recompensaId" = "recompensa"."id" LEFT OUTER JOIN "clients" AS "client" ON "Cupom"."clienteId" = "client"."id" WHERE "Cupom"."id" = 'f8792e1d-c9ae-48f0-9711-a15b02b5b1a6';
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' LIMIT 1;
Executing (default): SELECT "id", "name", "logoUrl", "primaryColor", "secondaryColor", "description" FROM "tenants" AS "Tenant" WHERE "Tenant"."id" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd';
Executing (default): SELECT "Cupom"."id", "Cupom"."pesquisaId", "Cupom"."tenantId", "Cupom"."recompensaId", "Cupom"."codigo", "Cupom"."clienteId", "Cupom"."dataGeracao", "Cupom"."dataUtilizacao", "Cupom"."dataValidade", "Cupom"."status", "Cupom"."ultimoContato", "Cupom"."createdAt", "Cupom"."updatedAt", "Cupom"."campanhaId", "recompensa"."id" AS "recompensa.id", "recompensa"."tenantId" AS "recompensa.tenantId", "recompensa"."name" AS "recompensa.name", "recompensa"."description" AS "recompensa.description", "recompensa"."pointsRequired" AS "recompensa.pointsRequired", "recompensa"."type" AS "recompensa.type", "recompensa"."value" AS "recompensa.value", "recompensa"."imageUrl" AS "recompensa.imageUrl", "recompensa"."active" AS "recompensa.active", "recompensa"."createdAt" AS "recompensa.createdAt", "recompensa"."updatedAt" AS "recompensa.updatedAt", "client"."id" AS "client.id", "client"."tenantId" AS "client.tenantId", "client"."name" AS "client.name", "client"."email" AS "client.email", "client"."phone" AS "client.phone", "client"."birthDate" AS "client.birthDate", "client"."respondentSessionId" AS "client.respondentSessionId", "client"."gender" AS "client.gender", "client"."createdAt" AS "client.createdAt", "client"."updatedAt" AS "client.updatedAt" FROM "cupons" AS "Cupom" LEFT OUTER JOIN "recompensas" AS "recompensa" ON "Cupom"."recompensaId" = "recompensa"."id" LEFT OUTER JOIN "clients" AS "client" ON "Cupom"."clienteId" = "client"."id" WHERE "Cupom"."id" = 'f8792e1d-c9ae-48f0-9711-a15b02b5b1a6';
Executing (default): SELECT "id", "url", "apiKey", "instanceApiKey", "instanceName", "instanceStatus", "tenantId", "sendPrizeMessage", "prizeMessageTemplate", "dailyReportEnabled", "reportPhoneNumbers", "birthdayAutomationEnabled", "birthdayMessageTemplate", "birthdayDaysBefore", "birthdayRewardType", "birthdayRewardId", "birthdayCouponValidityDays", "createdAt", "updatedAt" FROM "whatsapp_configs" AS "WhatsappConfig" WHERE "WhatsappConfig"."tenantId" = '3bd5b49a-56e6-45b7-9710-8d51b8f6e8dd' LIMIT 1;